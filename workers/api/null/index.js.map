{
  "version": 3,
  "sources": ["../../../node_modules/hono/dist/compose.js", "../../../node_modules/hono/dist/request/constants.js", "../../../node_modules/hono/dist/utils/body.js", "../../../node_modules/hono/dist/utils/url.js", "../../../node_modules/hono/dist/request.js", "../../../node_modules/hono/dist/utils/html.js", "../../../node_modules/hono/dist/context.js", "../../../node_modules/hono/dist/router.js", "../../../node_modules/hono/dist/utils/constants.js", "../../../node_modules/hono/dist/hono-base.js", "../../../node_modules/hono/dist/router/reg-exp-router/matcher.js", "../../../node_modules/hono/dist/router/reg-exp-router/node.js", "../../../node_modules/hono/dist/router/reg-exp-router/trie.js", "../../../node_modules/hono/dist/router/reg-exp-router/router.js", "../../../node_modules/hono/dist/router/smart-router/router.js", "../../../node_modules/hono/dist/router/trie-router/node.js", "../../../node_modules/hono/dist/router/trie-router/router.js", "../../../node_modules/hono/dist/hono.js", "../../../node_modules/hono/dist/middleware/cors/index.js", "../../../node_modules/hono/dist/utils/color.js", "../../../node_modules/hono/dist/middleware/logger/index.js", "../../../node_modules/hono/dist/middleware/secure-headers/secure-headers.js", "../config/lenders.json", "../src/constants.ts", "../src/utils/time.ts", "../src/durable/run-lock.ts", "../src/db/app-config.ts", "../src/ingest/normalize.ts", "../src/ingest/lender-playbooks.ts", "../src/ingest/cdr.ts", "../src/db/endpoint-cache.ts", "../src/db/run-reports.ts", "../src/db/rba-cash-rate.ts", "../src/ingest/rba.ts", "../src/utils/idempotency.ts", "../src/queue/producer.ts", "../src/utils/logger.ts", "../src/pipeline/bootstrap-jobs.ts", "../src/pipeline/scheduled.ts", "../src/db/historical-rates.ts", "../src/ingest/normalize-savings.ts", "../src/db/savings-rates.ts", "../src/db/td-rates.ts", "../src/utils/hash.ts", "../src/db/raw-payloads.ts", "../src/ingest/cdr-savings.ts", "../src/ingest/html-rate-parser.ts", "../src/queue/consumer.ts", "../src/utils/http.ts", "../../../node_modules/jose/dist/browser/runtime/webcrypto.js", "../../../node_modules/jose/dist/browser/lib/buffer_utils.js", "../../../node_modules/jose/dist/browser/runtime/base64url.js", "../../../node_modules/jose/dist/browser/util/errors.js", "../../../node_modules/jose/dist/browser/lib/crypto_key.js", "../../../node_modules/jose/dist/browser/lib/invalid_key_input.js", "../../../node_modules/jose/dist/browser/runtime/is_key_like.js", "../../../node_modules/jose/dist/browser/lib/is_disjoint.js", "../../../node_modules/jose/dist/browser/lib/is_object.js", "../../../node_modules/jose/dist/browser/runtime/check_key_length.js", "../../../node_modules/jose/dist/browser/lib/is_jwk.js", "../../../node_modules/jose/dist/browser/runtime/jwk_to_key.js", "../../../node_modules/jose/dist/browser/runtime/normalize_key.js", "../../../node_modules/jose/dist/browser/key/import.js", "../../../node_modules/jose/dist/browser/lib/check_key_type.js", "../../../node_modules/jose/dist/browser/lib/validate_crit.js", "../../../node_modules/jose/dist/browser/lib/validate_algorithms.js", "../../../node_modules/jose/dist/browser/runtime/subtle_dsa.js", "../../../node_modules/jose/dist/browser/runtime/get_sign_verify_key.js", "../../../node_modules/jose/dist/browser/runtime/verify.js", "../../../node_modules/jose/dist/browser/jws/flattened/verify.js", "../../../node_modules/jose/dist/browser/jws/compact/verify.js", "../../../node_modules/jose/dist/browser/lib/epoch.js", "../../../node_modules/jose/dist/browser/lib/secs.js", "../../../node_modules/jose/dist/browser/lib/jwt_claims_set.js", "../../../node_modules/jose/dist/browser/jwt/verify.js", "../../../node_modules/jose/dist/browser/jwks/local.js", "../../../node_modules/jose/dist/browser/runtime/fetch_jwks.js", "../../../node_modules/jose/dist/browser/jwks/remote.js", "../src/auth/access-jwt.ts", "../src/auth/admin.ts", "../src/routes/admin-config.ts", "../src/routes/admin-db.ts", "../src/routes/admin.ts", "../src/db/queries.ts", "../src/routes/public.ts", "../src/db/savings-queries.ts", "../src/routes/savings-public.ts", "../src/db/td-queries.ts", "../src/routes/td-public.ts", "../src/index.ts"],
  "sourceRoot": "null",
  "sourcesContent": ["// src/compose.ts\nvar compose = (middleware, onError, onNotFound) => {\n  return (context, next) => {\n    let index = -1;\n    return dispatch(0);\n    async function dispatch(i) {\n      if (i <= index) {\n        throw new Error(\"next() called multiple times\");\n      }\n      index = i;\n      let res;\n      let isError = false;\n      let handler;\n      if (middleware[i]) {\n        handler = middleware[i][0][0];\n        context.req.routeIndex = i;\n      } else {\n        handler = i === middleware.length && next || void 0;\n      }\n      if (handler) {\n        try {\n          res = await handler(context, () => dispatch(i + 1));\n        } catch (err) {\n          if (err instanceof Error && onError) {\n            context.error = err;\n            res = await onError(err, context);\n            isError = true;\n          } else {\n            throw err;\n          }\n        }\n      } else {\n        if (context.finalized === false && onNotFound) {\n          res = await onNotFound(context);\n        }\n      }\n      if (res && (context.finalized === false || isError)) {\n        context.res = res;\n      }\n      return context;\n    }\n  };\n};\nexport {\n  compose\n};\n", "// src/request/constants.ts\nvar GET_MATCH_RESULT = /* @__PURE__ */ Symbol();\nexport {\n  GET_MATCH_RESULT\n};\n", "// src/utils/body.ts\nimport { HonoRequest } from \"../request.js\";\nvar parseBody = async (request, options = /* @__PURE__ */ Object.create(null)) => {\n  const { all = false, dot = false } = options;\n  const headers = request instanceof HonoRequest ? request.raw.headers : request.headers;\n  const contentType = headers.get(\"Content-Type\");\n  if (contentType?.startsWith(\"multipart/form-data\") || contentType?.startsWith(\"application/x-www-form-urlencoded\")) {\n    return parseFormData(request, { all, dot });\n  }\n  return {};\n};\nasync function parseFormData(request, options) {\n  const formData = await request.formData();\n  if (formData) {\n    return convertFormDataToBodyData(formData, options);\n  }\n  return {};\n}\nfunction convertFormDataToBodyData(formData, options) {\n  const form = /* @__PURE__ */ Object.create(null);\n  formData.forEach((value, key) => {\n    const shouldParseAllValues = options.all || key.endsWith(\"[]\");\n    if (!shouldParseAllValues) {\n      form[key] = value;\n    } else {\n      handleParsingAllValues(form, key, value);\n    }\n  });\n  if (options.dot) {\n    Object.entries(form).forEach(([key, value]) => {\n      const shouldParseDotValues = key.includes(\".\");\n      if (shouldParseDotValues) {\n        handleParsingNestedValues(form, key, value);\n        delete form[key];\n      }\n    });\n  }\n  return form;\n}\nvar handleParsingAllValues = (form, key, value) => {\n  if (form[key] !== void 0) {\n    if (Array.isArray(form[key])) {\n      ;\n      form[key].push(value);\n    } else {\n      form[key] = [form[key], value];\n    }\n  } else {\n    if (!key.endsWith(\"[]\")) {\n      form[key] = value;\n    } else {\n      form[key] = [value];\n    }\n  }\n};\nvar handleParsingNestedValues = (form, key, value) => {\n  let nestedForm = form;\n  const keys = key.split(\".\");\n  keys.forEach((key2, index) => {\n    if (index === keys.length - 1) {\n      nestedForm[key2] = value;\n    } else {\n      if (!nestedForm[key2] || typeof nestedForm[key2] !== \"object\" || Array.isArray(nestedForm[key2]) || nestedForm[key2] instanceof File) {\n        nestedForm[key2] = /* @__PURE__ */ Object.create(null);\n      }\n      nestedForm = nestedForm[key2];\n    }\n  });\n};\nexport {\n  parseBody\n};\n", "// src/utils/url.ts\nvar splitPath = (path) => {\n  const paths = path.split(\"/\");\n  if (paths[0] === \"\") {\n    paths.shift();\n  }\n  return paths;\n};\nvar splitRoutingPath = (routePath) => {\n  const { groups, path } = extractGroupsFromPath(routePath);\n  const paths = splitPath(path);\n  return replaceGroupMarks(paths, groups);\n};\nvar extractGroupsFromPath = (path) => {\n  const groups = [];\n  path = path.replace(/\\{[^}]+\\}/g, (match, index) => {\n    const mark = `@${index}`;\n    groups.push([mark, match]);\n    return mark;\n  });\n  return { groups, path };\n};\nvar replaceGroupMarks = (paths, groups) => {\n  for (let i = groups.length - 1; i >= 0; i--) {\n    const [mark] = groups[i];\n    for (let j = paths.length - 1; j >= 0; j--) {\n      if (paths[j].includes(mark)) {\n        paths[j] = paths[j].replace(mark, groups[i][1]);\n        break;\n      }\n    }\n  }\n  return paths;\n};\nvar patternCache = {};\nvar getPattern = (label, next) => {\n  if (label === \"*\") {\n    return \"*\";\n  }\n  const match = label.match(/^\\:([^\\{\\}]+)(?:\\{(.+)\\})?$/);\n  if (match) {\n    const cacheKey = `${label}#${next}`;\n    if (!patternCache[cacheKey]) {\n      if (match[2]) {\n        patternCache[cacheKey] = next && next[0] !== \":\" && next[0] !== \"*\" ? [cacheKey, match[1], new RegExp(`^${match[2]}(?=/${next})`)] : [label, match[1], new RegExp(`^${match[2]}$`)];\n      } else {\n        patternCache[cacheKey] = [label, match[1], true];\n      }\n    }\n    return patternCache[cacheKey];\n  }\n  return null;\n};\nvar tryDecode = (str, decoder) => {\n  try {\n    return decoder(str);\n  } catch {\n    return str.replace(/(?:%[0-9A-Fa-f]{2})+/g, (match) => {\n      try {\n        return decoder(match);\n      } catch {\n        return match;\n      }\n    });\n  }\n};\nvar tryDecodeURI = (str) => tryDecode(str, decodeURI);\nvar getPath = (request) => {\n  const url = request.url;\n  const start = url.indexOf(\"/\", url.indexOf(\":\") + 4);\n  let i = start;\n  for (; i < url.length; i++) {\n    const charCode = url.charCodeAt(i);\n    if (charCode === 37) {\n      const queryIndex = url.indexOf(\"?\", i);\n      const hashIndex = url.indexOf(\"#\", i);\n      const end = queryIndex === -1 ? hashIndex === -1 ? void 0 : hashIndex : hashIndex === -1 ? queryIndex : Math.min(queryIndex, hashIndex);\n      const path = url.slice(start, end);\n      return tryDecodeURI(path.includes(\"%25\") ? path.replace(/%25/g, \"%2525\") : path);\n    } else if (charCode === 63 || charCode === 35) {\n      break;\n    }\n  }\n  return url.slice(start, i);\n};\nvar getQueryStrings = (url) => {\n  const queryIndex = url.indexOf(\"?\", 8);\n  return queryIndex === -1 ? \"\" : \"?\" + url.slice(queryIndex + 1);\n};\nvar getPathNoStrict = (request) => {\n  const result = getPath(request);\n  return result.length > 1 && result.at(-1) === \"/\" ? result.slice(0, -1) : result;\n};\nvar mergePath = (base, sub, ...rest) => {\n  if (rest.length) {\n    sub = mergePath(sub, ...rest);\n  }\n  return `${base?.[0] === \"/\" ? \"\" : \"/\"}${base}${sub === \"/\" ? \"\" : `${base?.at(-1) === \"/\" ? \"\" : \"/\"}${sub?.[0] === \"/\" ? sub.slice(1) : sub}`}`;\n};\nvar checkOptionalParameter = (path) => {\n  if (path.charCodeAt(path.length - 1) !== 63 || !path.includes(\":\")) {\n    return null;\n  }\n  const segments = path.split(\"/\");\n  const results = [];\n  let basePath = \"\";\n  segments.forEach((segment) => {\n    if (segment !== \"\" && !/\\:/.test(segment)) {\n      basePath += \"/\" + segment;\n    } else if (/\\:/.test(segment)) {\n      if (/\\?/.test(segment)) {\n        if (results.length === 0 && basePath === \"\") {\n          results.push(\"/\");\n        } else {\n          results.push(basePath);\n        }\n        const optionalSegment = segment.replace(\"?\", \"\");\n        basePath += \"/\" + optionalSegment;\n        results.push(basePath);\n      } else {\n        basePath += \"/\" + segment;\n      }\n    }\n  });\n  return results.filter((v, i, a) => a.indexOf(v) === i);\n};\nvar _decodeURI = (value) => {\n  if (!/[%+]/.test(value)) {\n    return value;\n  }\n  if (value.indexOf(\"+\") !== -1) {\n    value = value.replace(/\\+/g, \" \");\n  }\n  return value.indexOf(\"%\") !== -1 ? tryDecode(value, decodeURIComponent_) : value;\n};\nvar _getQueryParam = (url, key, multiple) => {\n  let encoded;\n  if (!multiple && key && !/[%+]/.test(key)) {\n    let keyIndex2 = url.indexOf(\"?\", 8);\n    if (keyIndex2 === -1) {\n      return void 0;\n    }\n    if (!url.startsWith(key, keyIndex2 + 1)) {\n      keyIndex2 = url.indexOf(`&${key}`, keyIndex2 + 1);\n    }\n    while (keyIndex2 !== -1) {\n      const trailingKeyCode = url.charCodeAt(keyIndex2 + key.length + 1);\n      if (trailingKeyCode === 61) {\n        const valueIndex = keyIndex2 + key.length + 2;\n        const endIndex = url.indexOf(\"&\", valueIndex);\n        return _decodeURI(url.slice(valueIndex, endIndex === -1 ? void 0 : endIndex));\n      } else if (trailingKeyCode == 38 || isNaN(trailingKeyCode)) {\n        return \"\";\n      }\n      keyIndex2 = url.indexOf(`&${key}`, keyIndex2 + 1);\n    }\n    encoded = /[%+]/.test(url);\n    if (!encoded) {\n      return void 0;\n    }\n  }\n  const results = {};\n  encoded ??= /[%+]/.test(url);\n  let keyIndex = url.indexOf(\"?\", 8);\n  while (keyIndex !== -1) {\n    const nextKeyIndex = url.indexOf(\"&\", keyIndex + 1);\n    let valueIndex = url.indexOf(\"=\", keyIndex);\n    if (valueIndex > nextKeyIndex && nextKeyIndex !== -1) {\n      valueIndex = -1;\n    }\n    let name = url.slice(\n      keyIndex + 1,\n      valueIndex === -1 ? nextKeyIndex === -1 ? void 0 : nextKeyIndex : valueIndex\n    );\n    if (encoded) {\n      name = _decodeURI(name);\n    }\n    keyIndex = nextKeyIndex;\n    if (name === \"\") {\n      continue;\n    }\n    let value;\n    if (valueIndex === -1) {\n      value = \"\";\n    } else {\n      value = url.slice(valueIndex + 1, nextKeyIndex === -1 ? void 0 : nextKeyIndex);\n      if (encoded) {\n        value = _decodeURI(value);\n      }\n    }\n    if (multiple) {\n      if (!(results[name] && Array.isArray(results[name]))) {\n        results[name] = [];\n      }\n      ;\n      results[name].push(value);\n    } else {\n      results[name] ??= value;\n    }\n  }\n  return key ? results[key] : results;\n};\nvar getQueryParam = _getQueryParam;\nvar getQueryParams = (url, key) => {\n  return _getQueryParam(url, key, true);\n};\nvar decodeURIComponent_ = decodeURIComponent;\nexport {\n  checkOptionalParameter,\n  decodeURIComponent_,\n  getPath,\n  getPathNoStrict,\n  getPattern,\n  getQueryParam,\n  getQueryParams,\n  getQueryStrings,\n  mergePath,\n  splitPath,\n  splitRoutingPath,\n  tryDecode\n};\n", "// src/request.ts\nimport { HTTPException } from \"./http-exception.js\";\nimport { GET_MATCH_RESULT } from \"./request/constants.js\";\nimport { parseBody } from \"./utils/body.js\";\nimport { decodeURIComponent_, getQueryParam, getQueryParams, tryDecode } from \"./utils/url.js\";\nvar tryDecodeURIComponent = (str) => tryDecode(str, decodeURIComponent_);\nvar HonoRequest = class {\n  /**\n   * `.raw` can get the raw Request object.\n   *\n   * @see {@link https://hono.dev/docs/api/request#raw}\n   *\n   * @example\n   * ```ts\n   * // For Cloudflare Workers\n   * app.post('/', async (c) => {\n   *   const metadata = c.req.raw.cf?.hostMetadata?\n   *   ...\n   * })\n   * ```\n   */\n  raw;\n  #validatedData;\n  // Short name of validatedData\n  #matchResult;\n  routeIndex = 0;\n  /**\n   * `.path` can get the pathname of the request.\n   *\n   * @see {@link https://hono.dev/docs/api/request#path}\n   *\n   * @example\n   * ```ts\n   * app.get('/about/me', (c) => {\n   *   const pathname = c.req.path // `/about/me`\n   * })\n   * ```\n   */\n  path;\n  bodyCache = {};\n  constructor(request, path = \"/\", matchResult = [[]]) {\n    this.raw = request;\n    this.path = path;\n    this.#matchResult = matchResult;\n    this.#validatedData = {};\n  }\n  param(key) {\n    return key ? this.#getDecodedParam(key) : this.#getAllDecodedParams();\n  }\n  #getDecodedParam(key) {\n    const paramKey = this.#matchResult[0][this.routeIndex][1][key];\n    const param = this.#getParamValue(paramKey);\n    return param && /\\%/.test(param) ? tryDecodeURIComponent(param) : param;\n  }\n  #getAllDecodedParams() {\n    const decoded = {};\n    const keys = Object.keys(this.#matchResult[0][this.routeIndex][1]);\n    for (const key of keys) {\n      const value = this.#getParamValue(this.#matchResult[0][this.routeIndex][1][key]);\n      if (value !== void 0) {\n        decoded[key] = /\\%/.test(value) ? tryDecodeURIComponent(value) : value;\n      }\n    }\n    return decoded;\n  }\n  #getParamValue(paramKey) {\n    return this.#matchResult[1] ? this.#matchResult[1][paramKey] : paramKey;\n  }\n  query(key) {\n    return getQueryParam(this.url, key);\n  }\n  queries(key) {\n    return getQueryParams(this.url, key);\n  }\n  header(name) {\n    if (name) {\n      return this.raw.headers.get(name) ?? void 0;\n    }\n    const headerData = {};\n    this.raw.headers.forEach((value, key) => {\n      headerData[key] = value;\n    });\n    return headerData;\n  }\n  async parseBody(options) {\n    return this.bodyCache.parsedBody ??= await parseBody(this, options);\n  }\n  #cachedBody = (key) => {\n    const { bodyCache, raw } = this;\n    const cachedBody = bodyCache[key];\n    if (cachedBody) {\n      return cachedBody;\n    }\n    const anyCachedKey = Object.keys(bodyCache)[0];\n    if (anyCachedKey) {\n      return bodyCache[anyCachedKey].then((body) => {\n        if (anyCachedKey === \"json\") {\n          body = JSON.stringify(body);\n        }\n        return new Response(body)[key]();\n      });\n    }\n    return bodyCache[key] = raw[key]();\n  };\n  /**\n   * `.json()` can parse Request body of type `application/json`\n   *\n   * @see {@link https://hono.dev/docs/api/request#json}\n   *\n   * @example\n   * ```ts\n   * app.post('/entry', async (c) => {\n   *   const body = await c.req.json()\n   * })\n   * ```\n   */\n  json() {\n    return this.#cachedBody(\"text\").then((text) => JSON.parse(text));\n  }\n  /**\n   * `.text()` can parse Request body of type `text/plain`\n   *\n   * @see {@link https://hono.dev/docs/api/request#text}\n   *\n   * @example\n   * ```ts\n   * app.post('/entry', async (c) => {\n   *   const body = await c.req.text()\n   * })\n   * ```\n   */\n  text() {\n    return this.#cachedBody(\"text\");\n  }\n  /**\n   * `.arrayBuffer()` parse Request body as an `ArrayBuffer`\n   *\n   * @see {@link https://hono.dev/docs/api/request#arraybuffer}\n   *\n   * @example\n   * ```ts\n   * app.post('/entry', async (c) => {\n   *   const body = await c.req.arrayBuffer()\n   * })\n   * ```\n   */\n  arrayBuffer() {\n    return this.#cachedBody(\"arrayBuffer\");\n  }\n  /**\n   * Parses the request body as a `Blob`.\n   * @example\n   * ```ts\n   * app.post('/entry', async (c) => {\n   *   const body = await c.req.blob();\n   * });\n   * ```\n   * @see https://hono.dev/docs/api/request#blob\n   */\n  blob() {\n    return this.#cachedBody(\"blob\");\n  }\n  /**\n   * Parses the request body as `FormData`.\n   * @example\n   * ```ts\n   * app.post('/entry', async (c) => {\n   *   const body = await c.req.formData();\n   * });\n   * ```\n   * @see https://hono.dev/docs/api/request#formdata\n   */\n  formData() {\n    return this.#cachedBody(\"formData\");\n  }\n  /**\n   * Adds validated data to the request.\n   *\n   * @param target - The target of the validation.\n   * @param data - The validated data to add.\n   */\n  addValidatedData(target, data) {\n    this.#validatedData[target] = data;\n  }\n  valid(target) {\n    return this.#validatedData[target];\n  }\n  /**\n   * `.url()` can get the request url strings.\n   *\n   * @see {@link https://hono.dev/docs/api/request#url}\n   *\n   * @example\n   * ```ts\n   * app.get('/about/me', (c) => {\n   *   const url = c.req.url // `http://localhost:8787/about/me`\n   *   ...\n   * })\n   * ```\n   */\n  get url() {\n    return this.raw.url;\n  }\n  /**\n   * `.method()` can get the method name of the request.\n   *\n   * @see {@link https://hono.dev/docs/api/request#method}\n   *\n   * @example\n   * ```ts\n   * app.get('/about/me', (c) => {\n   *   const method = c.req.method // `GET`\n   * })\n   * ```\n   */\n  get method() {\n    return this.raw.method;\n  }\n  get [GET_MATCH_RESULT]() {\n    return this.#matchResult;\n  }\n  /**\n   * `.matchedRoutes()` can return a matched route in the handler\n   *\n   * @deprecated\n   *\n   * Use matchedRoutes helper defined in \"hono/route\" instead.\n   *\n   * @see {@link https://hono.dev/docs/api/request#matchedroutes}\n   *\n   * @example\n   * ```ts\n   * app.use('*', async function logger(c, next) {\n   *   await next()\n   *   c.req.matchedRoutes.forEach(({ handler, method, path }, i) => {\n   *     const name = handler.name || (handler.length < 2 ? '[handler]' : '[middleware]')\n   *     console.log(\n   *       method,\n   *       ' ',\n   *       path,\n   *       ' '.repeat(Math.max(10 - path.length, 0)),\n   *       name,\n   *       i === c.req.routeIndex ? '<- respond from here' : ''\n   *     )\n   *   })\n   * })\n   * ```\n   */\n  get matchedRoutes() {\n    return this.#matchResult[0].map(([[, route]]) => route);\n  }\n  /**\n   * `routePath()` can retrieve the path registered within the handler\n   *\n   * @deprecated\n   *\n   * Use routePath helper defined in \"hono/route\" instead.\n   *\n   * @see {@link https://hono.dev/docs/api/request#routepath}\n   *\n   * @example\n   * ```ts\n   * app.get('/posts/:id', (c) => {\n   *   return c.json({ path: c.req.routePath })\n   * })\n   * ```\n   */\n  get routePath() {\n    return this.#matchResult[0].map(([[, route]]) => route)[this.routeIndex].path;\n  }\n};\nvar cloneRawRequest = async (req) => {\n  if (!req.raw.bodyUsed) {\n    return req.raw.clone();\n  }\n  const cacheKey = Object.keys(req.bodyCache)[0];\n  if (!cacheKey) {\n    throw new HTTPException(500, {\n      message: \"Cannot clone request: body was already consumed and not cached. Please use HonoRequest methods (e.g., req.json(), req.text()) instead of consuming req.raw directly.\"\n    });\n  }\n  const requestInit = {\n    body: await req[cacheKey](),\n    cache: req.raw.cache,\n    credentials: req.raw.credentials,\n    headers: req.header(),\n    integrity: req.raw.integrity,\n    keepalive: req.raw.keepalive,\n    method: req.method,\n    mode: req.raw.mode,\n    redirect: req.raw.redirect,\n    referrer: req.raw.referrer,\n    referrerPolicy: req.raw.referrerPolicy,\n    signal: req.raw.signal\n  };\n  return new Request(req.url, requestInit);\n};\nexport {\n  HonoRequest,\n  cloneRawRequest\n};\n", "// src/utils/html.ts\nvar HtmlEscapedCallbackPhase = {\n  Stringify: 1,\n  BeforeStream: 2,\n  Stream: 3\n};\nvar raw = (value, callbacks) => {\n  const escapedString = new String(value);\n  escapedString.isEscaped = true;\n  escapedString.callbacks = callbacks;\n  return escapedString;\n};\nvar escapeRe = /[&<>'\"]/;\nvar stringBufferToString = async (buffer, callbacks) => {\n  let str = \"\";\n  callbacks ||= [];\n  const resolvedBuffer = await Promise.all(buffer);\n  for (let i = resolvedBuffer.length - 1; ; i--) {\n    str += resolvedBuffer[i];\n    i--;\n    if (i < 0) {\n      break;\n    }\n    let r = resolvedBuffer[i];\n    if (typeof r === \"object\") {\n      callbacks.push(...r.callbacks || []);\n    }\n    const isEscaped = r.isEscaped;\n    r = await (typeof r === \"object\" ? r.toString() : r);\n    if (typeof r === \"object\") {\n      callbacks.push(...r.callbacks || []);\n    }\n    if (r.isEscaped ?? isEscaped) {\n      str += r;\n    } else {\n      const buf = [str];\n      escapeToBuffer(r, buf);\n      str = buf[0];\n    }\n  }\n  return raw(str, callbacks);\n};\nvar escapeToBuffer = (str, buffer) => {\n  const match = str.search(escapeRe);\n  if (match === -1) {\n    buffer[0] += str;\n    return;\n  }\n  let escape;\n  let index;\n  let lastIndex = 0;\n  for (index = match; index < str.length; index++) {\n    switch (str.charCodeAt(index)) {\n      case 34:\n        escape = \"&quot;\";\n        break;\n      case 39:\n        escape = \"&#39;\";\n        break;\n      case 38:\n        escape = \"&amp;\";\n        break;\n      case 60:\n        escape = \"&lt;\";\n        break;\n      case 62:\n        escape = \"&gt;\";\n        break;\n      default:\n        continue;\n    }\n    buffer[0] += str.substring(lastIndex, index) + escape;\n    lastIndex = index + 1;\n  }\n  buffer[0] += str.substring(lastIndex, index);\n};\nvar resolveCallbackSync = (str) => {\n  const callbacks = str.callbacks;\n  if (!callbacks?.length) {\n    return str;\n  }\n  const buffer = [str];\n  const context = {};\n  callbacks.forEach((c) => c({ phase: HtmlEscapedCallbackPhase.Stringify, buffer, context }));\n  return buffer[0];\n};\nvar resolveCallback = async (str, phase, preserveCallbacks, context, buffer) => {\n  if (typeof str === \"object\" && !(str instanceof String)) {\n    if (!(str instanceof Promise)) {\n      str = str.toString();\n    }\n    if (str instanceof Promise) {\n      str = await str;\n    }\n  }\n  const callbacks = str.callbacks;\n  if (!callbacks?.length) {\n    return Promise.resolve(str);\n  }\n  if (buffer) {\n    buffer[0] += str;\n  } else {\n    buffer = [str];\n  }\n  const resStr = Promise.all(callbacks.map((c) => c({ phase, buffer, context }))).then(\n    (res) => Promise.all(\n      res.filter(Boolean).map((str2) => resolveCallback(str2, phase, false, context, buffer))\n    ).then(() => buffer[0])\n  );\n  if (preserveCallbacks) {\n    return raw(await resStr, callbacks);\n  } else {\n    return resStr;\n  }\n};\nexport {\n  HtmlEscapedCallbackPhase,\n  escapeToBuffer,\n  raw,\n  resolveCallback,\n  resolveCallbackSync,\n  stringBufferToString\n};\n", "// src/context.ts\nimport { HonoRequest } from \"./request.js\";\nimport { HtmlEscapedCallbackPhase, resolveCallback } from \"./utils/html.js\";\nvar TEXT_PLAIN = \"text/plain; charset=UTF-8\";\nvar setDefaultContentType = (contentType, headers) => {\n  return {\n    \"Content-Type\": contentType,\n    ...headers\n  };\n};\nvar createResponseInstance = (body, init) => new Response(body, init);\nvar Context = class {\n  #rawRequest;\n  #req;\n  /**\n   * `.env` can get bindings (environment variables, secrets, KV namespaces, D1 database, R2 bucket etc.) in Cloudflare Workers.\n   *\n   * @see {@link https://hono.dev/docs/api/context#env}\n   *\n   * @example\n   * ```ts\n   * // Environment object for Cloudflare Workers\n   * app.get('*', async c => {\n   *   const counter = c.env.COUNTER\n   * })\n   * ```\n   */\n  env = {};\n  #var;\n  finalized = false;\n  /**\n   * `.error` can get the error object from the middleware if the Handler throws an error.\n   *\n   * @see {@link https://hono.dev/docs/api/context#error}\n   *\n   * @example\n   * ```ts\n   * app.use('*', async (c, next) => {\n   *   await next()\n   *   if (c.error) {\n   *     // do something...\n   *   }\n   * })\n   * ```\n   */\n  error;\n  #status;\n  #executionCtx;\n  #res;\n  #layout;\n  #renderer;\n  #notFoundHandler;\n  #preparedHeaders;\n  #matchResult;\n  #path;\n  /**\n   * Creates an instance of the Context class.\n   *\n   * @param req - The Request object.\n   * @param options - Optional configuration options for the context.\n   */\n  constructor(req, options) {\n    this.#rawRequest = req;\n    if (options) {\n      this.#executionCtx = options.executionCtx;\n      this.env = options.env;\n      this.#notFoundHandler = options.notFoundHandler;\n      this.#path = options.path;\n      this.#matchResult = options.matchResult;\n    }\n  }\n  /**\n   * `.req` is the instance of {@link HonoRequest}.\n   */\n  get req() {\n    this.#req ??= new HonoRequest(this.#rawRequest, this.#path, this.#matchResult);\n    return this.#req;\n  }\n  /**\n   * @see {@link https://hono.dev/docs/api/context#event}\n   * The FetchEvent associated with the current request.\n   *\n   * @throws Will throw an error if the context does not have a FetchEvent.\n   */\n  get event() {\n    if (this.#executionCtx && \"respondWith\" in this.#executionCtx) {\n      return this.#executionCtx;\n    } else {\n      throw Error(\"This context has no FetchEvent\");\n    }\n  }\n  /**\n   * @see {@link https://hono.dev/docs/api/context#executionctx}\n   * The ExecutionContext associated with the current request.\n   *\n   * @throws Will throw an error if the context does not have an ExecutionContext.\n   */\n  get executionCtx() {\n    if (this.#executionCtx) {\n      return this.#executionCtx;\n    } else {\n      throw Error(\"This context has no ExecutionContext\");\n    }\n  }\n  /**\n   * @see {@link https://hono.dev/docs/api/context#res}\n   * The Response object for the current request.\n   */\n  get res() {\n    return this.#res ||= createResponseInstance(null, {\n      headers: this.#preparedHeaders ??= new Headers()\n    });\n  }\n  /**\n   * Sets the Response object for the current request.\n   *\n   * @param _res - The Response object to set.\n   */\n  set res(_res) {\n    if (this.#res && _res) {\n      _res = createResponseInstance(_res.body, _res);\n      for (const [k, v] of this.#res.headers.entries()) {\n        if (k === \"content-type\") {\n          continue;\n        }\n        if (k === \"set-cookie\") {\n          const cookies = this.#res.headers.getSetCookie();\n          _res.headers.delete(\"set-cookie\");\n          for (const cookie of cookies) {\n            _res.headers.append(\"set-cookie\", cookie);\n          }\n        } else {\n          _res.headers.set(k, v);\n        }\n      }\n    }\n    this.#res = _res;\n    this.finalized = true;\n  }\n  /**\n   * `.render()` can create a response within a layout.\n   *\n   * @see {@link https://hono.dev/docs/api/context#render-setrenderer}\n   *\n   * @example\n   * ```ts\n   * app.get('/', (c) => {\n   *   return c.render('Hello!')\n   * })\n   * ```\n   */\n  render = (...args) => {\n    this.#renderer ??= (content) => this.html(content);\n    return this.#renderer(...args);\n  };\n  /**\n   * Sets the layout for the response.\n   *\n   * @param layout - The layout to set.\n   * @returns The layout function.\n   */\n  setLayout = (layout) => this.#layout = layout;\n  /**\n   * Gets the current layout for the response.\n   *\n   * @returns The current layout function.\n   */\n  getLayout = () => this.#layout;\n  /**\n   * `.setRenderer()` can set the layout in the custom middleware.\n   *\n   * @see {@link https://hono.dev/docs/api/context#render-setrenderer}\n   *\n   * @example\n   * ```tsx\n   * app.use('*', async (c, next) => {\n   *   c.setRenderer((content) => {\n   *     return c.html(\n   *       <html>\n   *         <body>\n   *           <p>{content}</p>\n   *         </body>\n   *       </html>\n   *     )\n   *   })\n   *   await next()\n   * })\n   * ```\n   */\n  setRenderer = (renderer) => {\n    this.#renderer = renderer;\n  };\n  /**\n   * `.header()` can set headers.\n   *\n   * @see {@link https://hono.dev/docs/api/context#header}\n   *\n   * @example\n   * ```ts\n   * app.get('/welcome', (c) => {\n   *   // Set headers\n   *   c.header('X-Message', 'Hello!')\n   *   c.header('Content-Type', 'text/plain')\n   *\n   *   return c.body('Thank you for coming')\n   * })\n   * ```\n   */\n  header = (name, value, options) => {\n    if (this.finalized) {\n      this.#res = createResponseInstance(this.#res.body, this.#res);\n    }\n    const headers = this.#res ? this.#res.headers : this.#preparedHeaders ??= new Headers();\n    if (value === void 0) {\n      headers.delete(name);\n    } else if (options?.append) {\n      headers.append(name, value);\n    } else {\n      headers.set(name, value);\n    }\n  };\n  status = (status) => {\n    this.#status = status;\n  };\n  /**\n   * `.set()` can set the value specified by the key.\n   *\n   * @see {@link https://hono.dev/docs/api/context#set-get}\n   *\n   * @example\n   * ```ts\n   * app.use('*', async (c, next) => {\n   *   c.set('message', 'Hono is hot!!')\n   *   await next()\n   * })\n   * ```\n   */\n  set = (key, value) => {\n    this.#var ??= /* @__PURE__ */ new Map();\n    this.#var.set(key, value);\n  };\n  /**\n   * `.get()` can use the value specified by the key.\n   *\n   * @see {@link https://hono.dev/docs/api/context#set-get}\n   *\n   * @example\n   * ```ts\n   * app.get('/', (c) => {\n   *   const message = c.get('message')\n   *   return c.text(`The message is \"${message}\"`)\n   * })\n   * ```\n   */\n  get = (key) => {\n    return this.#var ? this.#var.get(key) : void 0;\n  };\n  /**\n   * `.var` can access the value of a variable.\n   *\n   * @see {@link https://hono.dev/docs/api/context#var}\n   *\n   * @example\n   * ```ts\n   * const result = c.var.client.oneMethod()\n   * ```\n   */\n  // c.var.propName is a read-only\n  get var() {\n    if (!this.#var) {\n      return {};\n    }\n    return Object.fromEntries(this.#var);\n  }\n  #newResponse(data, arg, headers) {\n    const responseHeaders = this.#res ? new Headers(this.#res.headers) : this.#preparedHeaders ?? new Headers();\n    if (typeof arg === \"object\" && \"headers\" in arg) {\n      const argHeaders = arg.headers instanceof Headers ? arg.headers : new Headers(arg.headers);\n      for (const [key, value] of argHeaders) {\n        if (key.toLowerCase() === \"set-cookie\") {\n          responseHeaders.append(key, value);\n        } else {\n          responseHeaders.set(key, value);\n        }\n      }\n    }\n    if (headers) {\n      for (const [k, v] of Object.entries(headers)) {\n        if (typeof v === \"string\") {\n          responseHeaders.set(k, v);\n        } else {\n          responseHeaders.delete(k);\n          for (const v2 of v) {\n            responseHeaders.append(k, v2);\n          }\n        }\n      }\n    }\n    const status = typeof arg === \"number\" ? arg : arg?.status ?? this.#status;\n    return createResponseInstance(data, { status, headers: responseHeaders });\n  }\n  newResponse = (...args) => this.#newResponse(...args);\n  /**\n   * `.body()` can return the HTTP response.\n   * You can set headers with `.header()` and set HTTP status code with `.status`.\n   * This can also be set in `.text()`, `.json()` and so on.\n   *\n   * @see {@link https://hono.dev/docs/api/context#body}\n   *\n   * @example\n   * ```ts\n   * app.get('/welcome', (c) => {\n   *   // Set headers\n   *   c.header('X-Message', 'Hello!')\n   *   c.header('Content-Type', 'text/plain')\n   *   // Set HTTP status code\n   *   c.status(201)\n   *\n   *   // Return the response body\n   *   return c.body('Thank you for coming')\n   * })\n   * ```\n   */\n  body = (data, arg, headers) => this.#newResponse(data, arg, headers);\n  #useFastPath() {\n    return !this.#preparedHeaders && !this.#status && !this.finalized;\n  }\n  /**\n   * `.text()` can render text as `Content-Type:text/plain`.\n   *\n   * @see {@link https://hono.dev/docs/api/context#text}\n   *\n   * @example\n   * ```ts\n   * app.get('/say', (c) => {\n   *   return c.text('Hello!')\n   * })\n   * ```\n   */\n  text = (text, arg, headers) => {\n    return this.#useFastPath() && !arg && !headers ? createResponseInstance(text) : this.#newResponse(\n      text,\n      arg,\n      setDefaultContentType(TEXT_PLAIN, headers)\n    );\n  };\n  /**\n   * `.json()` can render JSON as `Content-Type:application/json`.\n   *\n   * @see {@link https://hono.dev/docs/api/context#json}\n   *\n   * @example\n   * ```ts\n   * app.get('/api', (c) => {\n   *   return c.json({ message: 'Hello!' })\n   * })\n   * ```\n   */\n  json = (object, arg, headers) => {\n    return this.#useFastPath() && !arg && !headers ? Response.json(object) : this.#newResponse(\n      JSON.stringify(object),\n      arg,\n      setDefaultContentType(\"application/json\", headers)\n    );\n  };\n  html = (html, arg, headers) => {\n    const res = (html2) => this.#newResponse(html2, arg, setDefaultContentType(\"text/html; charset=UTF-8\", headers));\n    return typeof html === \"object\" ? resolveCallback(html, HtmlEscapedCallbackPhase.Stringify, false, {}).then(res) : res(html);\n  };\n  /**\n   * `.redirect()` can Redirect, default status code is 302.\n   *\n   * @see {@link https://hono.dev/docs/api/context#redirect}\n   *\n   * @example\n   * ```ts\n   * app.get('/redirect', (c) => {\n   *   return c.redirect('/')\n   * })\n   * app.get('/redirect-permanently', (c) => {\n   *   return c.redirect('/', 301)\n   * })\n   * ```\n   */\n  redirect = (location, status) => {\n    const locationString = String(location);\n    this.header(\n      \"Location\",\n      // Multibyes should be encoded\n      // eslint-disable-next-line no-control-regex\n      !/[^\\x00-\\xFF]/.test(locationString) ? locationString : encodeURI(locationString)\n    );\n    return this.newResponse(null, status ?? 302);\n  };\n  /**\n   * `.notFound()` can return the Not Found Response.\n   *\n   * @see {@link https://hono.dev/docs/api/context#notfound}\n   *\n   * @example\n   * ```ts\n   * app.get('/notfound', (c) => {\n   *   return c.notFound()\n   * })\n   * ```\n   */\n  notFound = () => {\n    this.#notFoundHandler ??= () => createResponseInstance();\n    return this.#notFoundHandler(this);\n  };\n};\nexport {\n  Context,\n  TEXT_PLAIN\n};\n", "// src/router.ts\nvar METHOD_NAME_ALL = \"ALL\";\nvar METHOD_NAME_ALL_LOWERCASE = \"all\";\nvar METHODS = [\"get\", \"post\", \"put\", \"delete\", \"options\", \"patch\"];\nvar MESSAGE_MATCHER_IS_ALREADY_BUILT = \"Can not add a route since the matcher is already built.\";\nvar UnsupportedPathError = class extends Error {\n};\nexport {\n  MESSAGE_MATCHER_IS_ALREADY_BUILT,\n  METHODS,\n  METHOD_NAME_ALL,\n  METHOD_NAME_ALL_LOWERCASE,\n  UnsupportedPathError\n};\n", "// src/utils/constants.ts\nvar COMPOSED_HANDLER = \"__COMPOSED_HANDLER\";\nexport {\n  COMPOSED_HANDLER\n};\n", "// src/hono-base.ts\nimport { compose } from \"./compose.js\";\nimport { Context } from \"./context.js\";\nimport { METHODS, METHOD_NAME_ALL, METHOD_NAME_ALL_LOWERCASE } from \"./router.js\";\nimport { COMPOSED_HANDLER } from \"./utils/constants.js\";\nimport { getPath, getPathNoStrict, mergePath } from \"./utils/url.js\";\nvar notFoundHandler = (c) => {\n  return c.text(\"404 Not Found\", 404);\n};\nvar errorHandler = (err, c) => {\n  if (\"getResponse\" in err) {\n    const res = err.getResponse();\n    return c.newResponse(res.body, res);\n  }\n  console.error(err);\n  return c.text(\"Internal Server Error\", 500);\n};\nvar Hono = class _Hono {\n  get;\n  post;\n  put;\n  delete;\n  options;\n  patch;\n  all;\n  on;\n  use;\n  /*\n    This class is like an abstract class and does not have a router.\n    To use it, inherit the class and implement router in the constructor.\n  */\n  router;\n  getPath;\n  // Cannot use `#` because it requires visibility at JavaScript runtime.\n  _basePath = \"/\";\n  #path = \"/\";\n  routes = [];\n  constructor(options = {}) {\n    const allMethods = [...METHODS, METHOD_NAME_ALL_LOWERCASE];\n    allMethods.forEach((method) => {\n      this[method] = (args1, ...args) => {\n        if (typeof args1 === \"string\") {\n          this.#path = args1;\n        } else {\n          this.#addRoute(method, this.#path, args1);\n        }\n        args.forEach((handler) => {\n          this.#addRoute(method, this.#path, handler);\n        });\n        return this;\n      };\n    });\n    this.on = (method, path, ...handlers) => {\n      for (const p of [path].flat()) {\n        this.#path = p;\n        for (const m of [method].flat()) {\n          handlers.map((handler) => {\n            this.#addRoute(m.toUpperCase(), this.#path, handler);\n          });\n        }\n      }\n      return this;\n    };\n    this.use = (arg1, ...handlers) => {\n      if (typeof arg1 === \"string\") {\n        this.#path = arg1;\n      } else {\n        this.#path = \"*\";\n        handlers.unshift(arg1);\n      }\n      handlers.forEach((handler) => {\n        this.#addRoute(METHOD_NAME_ALL, this.#path, handler);\n      });\n      return this;\n    };\n    const { strict, ...optionsWithoutStrict } = options;\n    Object.assign(this, optionsWithoutStrict);\n    this.getPath = strict ?? true ? options.getPath ?? getPath : getPathNoStrict;\n  }\n  #clone() {\n    const clone = new _Hono({\n      router: this.router,\n      getPath: this.getPath\n    });\n    clone.errorHandler = this.errorHandler;\n    clone.#notFoundHandler = this.#notFoundHandler;\n    clone.routes = this.routes;\n    return clone;\n  }\n  #notFoundHandler = notFoundHandler;\n  // Cannot use `#` because it requires visibility at JavaScript runtime.\n  errorHandler = errorHandler;\n  /**\n   * `.route()` allows grouping other Hono instance in routes.\n   *\n   * @see {@link https://hono.dev/docs/api/routing#grouping}\n   *\n   * @param {string} path - base Path\n   * @param {Hono} app - other Hono instance\n   * @returns {Hono} routed Hono instance\n   *\n   * @example\n   * ```ts\n   * const app = new Hono()\n   * const app2 = new Hono()\n   *\n   * app2.get(\"/user\", (c) => c.text(\"user\"))\n   * app.route(\"/api\", app2) // GET /api/user\n   * ```\n   */\n  route(path, app) {\n    const subApp = this.basePath(path);\n    app.routes.map((r) => {\n      let handler;\n      if (app.errorHandler === errorHandler) {\n        handler = r.handler;\n      } else {\n        handler = async (c, next) => (await compose([], app.errorHandler)(c, () => r.handler(c, next))).res;\n        handler[COMPOSED_HANDLER] = r.handler;\n      }\n      subApp.#addRoute(r.method, r.path, handler);\n    });\n    return this;\n  }\n  /**\n   * `.basePath()` allows base paths to be specified.\n   *\n   * @see {@link https://hono.dev/docs/api/routing#base-path}\n   *\n   * @param {string} path - base Path\n   * @returns {Hono} changed Hono instance\n   *\n   * @example\n   * ```ts\n   * const api = new Hono().basePath('/api')\n   * ```\n   */\n  basePath(path) {\n    const subApp = this.#clone();\n    subApp._basePath = mergePath(this._basePath, path);\n    return subApp;\n  }\n  /**\n   * `.onError()` handles an error and returns a customized Response.\n   *\n   * @see {@link https://hono.dev/docs/api/hono#error-handling}\n   *\n   * @param {ErrorHandler} handler - request Handler for error\n   * @returns {Hono} changed Hono instance\n   *\n   * @example\n   * ```ts\n   * app.onError((err, c) => {\n   *   console.error(`${err}`)\n   *   return c.text('Custom Error Message', 500)\n   * })\n   * ```\n   */\n  onError = (handler) => {\n    this.errorHandler = handler;\n    return this;\n  };\n  /**\n   * `.notFound()` allows you to customize a Not Found Response.\n   *\n   * @see {@link https://hono.dev/docs/api/hono#not-found}\n   *\n   * @param {NotFoundHandler} handler - request handler for not-found\n   * @returns {Hono} changed Hono instance\n   *\n   * @example\n   * ```ts\n   * app.notFound((c) => {\n   *   return c.text('Custom 404 Message', 404)\n   * })\n   * ```\n   */\n  notFound = (handler) => {\n    this.#notFoundHandler = handler;\n    return this;\n  };\n  /**\n   * `.mount()` allows you to mount applications built with other frameworks into your Hono application.\n   *\n   * @see {@link https://hono.dev/docs/api/hono#mount}\n   *\n   * @param {string} path - base Path\n   * @param {Function} applicationHandler - other Request Handler\n   * @param {MountOptions} [options] - options of `.mount()`\n   * @returns {Hono} mounted Hono instance\n   *\n   * @example\n   * ```ts\n   * import { Router as IttyRouter } from 'itty-router'\n   * import { Hono } from 'hono'\n   * // Create itty-router application\n   * const ittyRouter = IttyRouter()\n   * // GET /itty-router/hello\n   * ittyRouter.get('/hello', () => new Response('Hello from itty-router'))\n   *\n   * const app = new Hono()\n   * app.mount('/itty-router', ittyRouter.handle)\n   * ```\n   *\n   * @example\n   * ```ts\n   * const app = new Hono()\n   * // Send the request to another application without modification.\n   * app.mount('/app', anotherApp, {\n   *   replaceRequest: (req) => req,\n   * })\n   * ```\n   */\n  mount(path, applicationHandler, options) {\n    let replaceRequest;\n    let optionHandler;\n    if (options) {\n      if (typeof options === \"function\") {\n        optionHandler = options;\n      } else {\n        optionHandler = options.optionHandler;\n        if (options.replaceRequest === false) {\n          replaceRequest = (request) => request;\n        } else {\n          replaceRequest = options.replaceRequest;\n        }\n      }\n    }\n    const getOptions = optionHandler ? (c) => {\n      const options2 = optionHandler(c);\n      return Array.isArray(options2) ? options2 : [options2];\n    } : (c) => {\n      let executionContext = void 0;\n      try {\n        executionContext = c.executionCtx;\n      } catch {\n      }\n      return [c.env, executionContext];\n    };\n    replaceRequest ||= (() => {\n      const mergedPath = mergePath(this._basePath, path);\n      const pathPrefixLength = mergedPath === \"/\" ? 0 : mergedPath.length;\n      return (request) => {\n        const url = new URL(request.url);\n        url.pathname = url.pathname.slice(pathPrefixLength) || \"/\";\n        return new Request(url, request);\n      };\n    })();\n    const handler = async (c, next) => {\n      const res = await applicationHandler(replaceRequest(c.req.raw), ...getOptions(c));\n      if (res) {\n        return res;\n      }\n      await next();\n    };\n    this.#addRoute(METHOD_NAME_ALL, mergePath(path, \"*\"), handler);\n    return this;\n  }\n  #addRoute(method, path, handler) {\n    method = method.toUpperCase();\n    path = mergePath(this._basePath, path);\n    const r = { basePath: this._basePath, path, method, handler };\n    this.router.add(method, path, [handler, r]);\n    this.routes.push(r);\n  }\n  #handleError(err, c) {\n    if (err instanceof Error) {\n      return this.errorHandler(err, c);\n    }\n    throw err;\n  }\n  #dispatch(request, executionCtx, env, method) {\n    if (method === \"HEAD\") {\n      return (async () => new Response(null, await this.#dispatch(request, executionCtx, env, \"GET\")))();\n    }\n    const path = this.getPath(request, { env });\n    const matchResult = this.router.match(method, path);\n    const c = new Context(request, {\n      path,\n      matchResult,\n      env,\n      executionCtx,\n      notFoundHandler: this.#notFoundHandler\n    });\n    if (matchResult[0].length === 1) {\n      let res;\n      try {\n        res = matchResult[0][0][0][0](c, async () => {\n          c.res = await this.#notFoundHandler(c);\n        });\n      } catch (err) {\n        return this.#handleError(err, c);\n      }\n      return res instanceof Promise ? res.then(\n        (resolved) => resolved || (c.finalized ? c.res : this.#notFoundHandler(c))\n      ).catch((err) => this.#handleError(err, c)) : res ?? this.#notFoundHandler(c);\n    }\n    const composed = compose(matchResult[0], this.errorHandler, this.#notFoundHandler);\n    return (async () => {\n      try {\n        const context = await composed(c);\n        if (!context.finalized) {\n          throw new Error(\n            \"Context is not finalized. Did you forget to return a Response object or `await next()`?\"\n          );\n        }\n        return context.res;\n      } catch (err) {\n        return this.#handleError(err, c);\n      }\n    })();\n  }\n  /**\n   * `.fetch()` will be entry point of your app.\n   *\n   * @see {@link https://hono.dev/docs/api/hono#fetch}\n   *\n   * @param {Request} request - request Object of request\n   * @param {Env} Env - env Object\n   * @param {ExecutionContext} - context of execution\n   * @returns {Response | Promise<Response>} response of request\n   *\n   */\n  fetch = (request, ...rest) => {\n    return this.#dispatch(request, rest[1], rest[0], request.method);\n  };\n  /**\n   * `.request()` is a useful method for testing.\n   * You can pass a URL or pathname to send a GET request.\n   * app will return a Response object.\n   * ```ts\n   * test('GET /hello is ok', async () => {\n   *   const res = await app.request('/hello')\n   *   expect(res.status).toBe(200)\n   * })\n   * ```\n   * @see https://hono.dev/docs/api/hono#request\n   */\n  request = (input, requestInit, Env, executionCtx) => {\n    if (input instanceof Request) {\n      return this.fetch(requestInit ? new Request(input, requestInit) : input, Env, executionCtx);\n    }\n    input = input.toString();\n    return this.fetch(\n      new Request(\n        /^https?:\\/\\//.test(input) ? input : `http://localhost${mergePath(\"/\", input)}`,\n        requestInit\n      ),\n      Env,\n      executionCtx\n    );\n  };\n  /**\n   * `.fire()` automatically adds a global fetch event listener.\n   * This can be useful for environments that adhere to the Service Worker API, such as non-ES module Cloudflare Workers.\n   * @deprecated\n   * Use `fire` from `hono/service-worker` instead.\n   * ```ts\n   * import { Hono } from 'hono'\n   * import { fire } from 'hono/service-worker'\n   *\n   * const app = new Hono()\n   * // ...\n   * fire(app)\n   * ```\n   * @see https://hono.dev/docs/api/hono#fire\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API\n   * @see https://developers.cloudflare.com/workers/reference/migrate-to-module-workers/\n   */\n  fire = () => {\n    addEventListener(\"fetch\", (event) => {\n      event.respondWith(this.#dispatch(event.request, event, void 0, event.request.method));\n    });\n  };\n};\nexport {\n  Hono as HonoBase\n};\n", "// src/router/reg-exp-router/matcher.ts\nimport { METHOD_NAME_ALL } from \"../../router.js\";\nvar emptyParam = [];\nfunction match(method, path) {\n  const matchers = this.buildAllMatchers();\n  const match2 = ((method2, path2) => {\n    const matcher = matchers[method2] || matchers[METHOD_NAME_ALL];\n    const staticMatch = matcher[2][path2];\n    if (staticMatch) {\n      return staticMatch;\n    }\n    const match3 = path2.match(matcher[0]);\n    if (!match3) {\n      return [[], emptyParam];\n    }\n    const index = match3.indexOf(\"\", 1);\n    return [matcher[1][index], match3];\n  });\n  this.match = match2;\n  return match2(method, path);\n}\nexport {\n  emptyParam,\n  match\n};\n", "// src/router/reg-exp-router/node.ts\nvar LABEL_REG_EXP_STR = \"[^/]+\";\nvar ONLY_WILDCARD_REG_EXP_STR = \".*\";\nvar TAIL_WILDCARD_REG_EXP_STR = \"(?:|/.*)\";\nvar PATH_ERROR = /* @__PURE__ */ Symbol();\nvar regExpMetaChars = new Set(\".\\\\+*[^]$()\");\nfunction compareKey(a, b) {\n  if (a.length === 1) {\n    return b.length === 1 ? a < b ? -1 : 1 : -1;\n  }\n  if (b.length === 1) {\n    return 1;\n  }\n  if (a === ONLY_WILDCARD_REG_EXP_STR || a === TAIL_WILDCARD_REG_EXP_STR) {\n    return 1;\n  } else if (b === ONLY_WILDCARD_REG_EXP_STR || b === TAIL_WILDCARD_REG_EXP_STR) {\n    return -1;\n  }\n  if (a === LABEL_REG_EXP_STR) {\n    return 1;\n  } else if (b === LABEL_REG_EXP_STR) {\n    return -1;\n  }\n  return a.length === b.length ? a < b ? -1 : 1 : b.length - a.length;\n}\nvar Node = class _Node {\n  #index;\n  #varIndex;\n  #children = /* @__PURE__ */ Object.create(null);\n  insert(tokens, index, paramMap, context, pathErrorCheckOnly) {\n    if (tokens.length === 0) {\n      if (this.#index !== void 0) {\n        throw PATH_ERROR;\n      }\n      if (pathErrorCheckOnly) {\n        return;\n      }\n      this.#index = index;\n      return;\n    }\n    const [token, ...restTokens] = tokens;\n    const pattern = token === \"*\" ? restTokens.length === 0 ? [\"\", \"\", ONLY_WILDCARD_REG_EXP_STR] : [\"\", \"\", LABEL_REG_EXP_STR] : token === \"/*\" ? [\"\", \"\", TAIL_WILDCARD_REG_EXP_STR] : token.match(/^\\:([^\\{\\}]+)(?:\\{(.+)\\})?$/);\n    let node;\n    if (pattern) {\n      const name = pattern[1];\n      let regexpStr = pattern[2] || LABEL_REG_EXP_STR;\n      if (name && pattern[2]) {\n        if (regexpStr === \".*\") {\n          throw PATH_ERROR;\n        }\n        regexpStr = regexpStr.replace(/^\\((?!\\?:)(?=[^)]+\\)$)/, \"(?:\");\n        if (/\\((?!\\?:)/.test(regexpStr)) {\n          throw PATH_ERROR;\n        }\n      }\n      node = this.#children[regexpStr];\n      if (!node) {\n        if (Object.keys(this.#children).some(\n          (k) => k !== ONLY_WILDCARD_REG_EXP_STR && k !== TAIL_WILDCARD_REG_EXP_STR\n        )) {\n          throw PATH_ERROR;\n        }\n        if (pathErrorCheckOnly) {\n          return;\n        }\n        node = this.#children[regexpStr] = new _Node();\n        if (name !== \"\") {\n          node.#varIndex = context.varIndex++;\n        }\n      }\n      if (!pathErrorCheckOnly && name !== \"\") {\n        paramMap.push([name, node.#varIndex]);\n      }\n    } else {\n      node = this.#children[token];\n      if (!node) {\n        if (Object.keys(this.#children).some(\n          (k) => k.length > 1 && k !== ONLY_WILDCARD_REG_EXP_STR && k !== TAIL_WILDCARD_REG_EXP_STR\n        )) {\n          throw PATH_ERROR;\n        }\n        if (pathErrorCheckOnly) {\n          return;\n        }\n        node = this.#children[token] = new _Node();\n      }\n    }\n    node.insert(restTokens, index, paramMap, context, pathErrorCheckOnly);\n  }\n  buildRegExpStr() {\n    const childKeys = Object.keys(this.#children).sort(compareKey);\n    const strList = childKeys.map((k) => {\n      const c = this.#children[k];\n      return (typeof c.#varIndex === \"number\" ? `(${k})@${c.#varIndex}` : regExpMetaChars.has(k) ? `\\\\${k}` : k) + c.buildRegExpStr();\n    });\n    if (typeof this.#index === \"number\") {\n      strList.unshift(`#${this.#index}`);\n    }\n    if (strList.length === 0) {\n      return \"\";\n    }\n    if (strList.length === 1) {\n      return strList[0];\n    }\n    return \"(?:\" + strList.join(\"|\") + \")\";\n  }\n};\nexport {\n  Node,\n  PATH_ERROR\n};\n", "// src/router/reg-exp-router/trie.ts\nimport { Node } from \"./node.js\";\nvar Trie = class {\n  #context = { varIndex: 0 };\n  #root = new Node();\n  insert(path, index, pathErrorCheckOnly) {\n    const paramAssoc = [];\n    const groups = [];\n    for (let i = 0; ; ) {\n      let replaced = false;\n      path = path.replace(/\\{[^}]+\\}/g, (m) => {\n        const mark = `@\\\\${i}`;\n        groups[i] = [mark, m];\n        i++;\n        replaced = true;\n        return mark;\n      });\n      if (!replaced) {\n        break;\n      }\n    }\n    const tokens = path.match(/(?::[^\\/]+)|(?:\\/\\*$)|./g) || [];\n    for (let i = groups.length - 1; i >= 0; i--) {\n      const [mark] = groups[i];\n      for (let j = tokens.length - 1; j >= 0; j--) {\n        if (tokens[j].indexOf(mark) !== -1) {\n          tokens[j] = tokens[j].replace(mark, groups[i][1]);\n          break;\n        }\n      }\n    }\n    this.#root.insert(tokens, index, paramAssoc, this.#context, pathErrorCheckOnly);\n    return paramAssoc;\n  }\n  buildRegExp() {\n    let regexp = this.#root.buildRegExpStr();\n    if (regexp === \"\") {\n      return [/^$/, [], []];\n    }\n    let captureIndex = 0;\n    const indexReplacementMap = [];\n    const paramReplacementMap = [];\n    regexp = regexp.replace(/#(\\d+)|@(\\d+)|\\.\\*\\$/g, (_, handlerIndex, paramIndex) => {\n      if (handlerIndex !== void 0) {\n        indexReplacementMap[++captureIndex] = Number(handlerIndex);\n        return \"$()\";\n      }\n      if (paramIndex !== void 0) {\n        paramReplacementMap[Number(paramIndex)] = ++captureIndex;\n        return \"\";\n      }\n      return \"\";\n    });\n    return [new RegExp(`^${regexp}`), indexReplacementMap, paramReplacementMap];\n  }\n};\nexport {\n  Trie\n};\n", "// src/router/reg-exp-router/router.ts\nimport {\n  MESSAGE_MATCHER_IS_ALREADY_BUILT,\n  METHOD_NAME_ALL,\n  UnsupportedPathError\n} from \"../../router.js\";\nimport { checkOptionalParameter } from \"../../utils/url.js\";\nimport { match, emptyParam } from \"./matcher.js\";\nimport { PATH_ERROR } from \"./node.js\";\nimport { Trie } from \"./trie.js\";\nvar nullMatcher = [/^$/, [], /* @__PURE__ */ Object.create(null)];\nvar wildcardRegExpCache = /* @__PURE__ */ Object.create(null);\nfunction buildWildcardRegExp(path) {\n  return wildcardRegExpCache[path] ??= new RegExp(\n    path === \"*\" ? \"\" : `^${path.replace(\n      /\\/\\*$|([.\\\\+*[^\\]$()])/g,\n      (_, metaChar) => metaChar ? `\\\\${metaChar}` : \"(?:|/.*)\"\n    )}$`\n  );\n}\nfunction clearWildcardRegExpCache() {\n  wildcardRegExpCache = /* @__PURE__ */ Object.create(null);\n}\nfunction buildMatcherFromPreprocessedRoutes(routes) {\n  const trie = new Trie();\n  const handlerData = [];\n  if (routes.length === 0) {\n    return nullMatcher;\n  }\n  const routesWithStaticPathFlag = routes.map(\n    (route) => [!/\\*|\\/:/.test(route[0]), ...route]\n  ).sort(\n    ([isStaticA, pathA], [isStaticB, pathB]) => isStaticA ? 1 : isStaticB ? -1 : pathA.length - pathB.length\n  );\n  const staticMap = /* @__PURE__ */ Object.create(null);\n  for (let i = 0, j = -1, len = routesWithStaticPathFlag.length; i < len; i++) {\n    const [pathErrorCheckOnly, path, handlers] = routesWithStaticPathFlag[i];\n    if (pathErrorCheckOnly) {\n      staticMap[path] = [handlers.map(([h]) => [h, /* @__PURE__ */ Object.create(null)]), emptyParam];\n    } else {\n      j++;\n    }\n    let paramAssoc;\n    try {\n      paramAssoc = trie.insert(path, j, pathErrorCheckOnly);\n    } catch (e) {\n      throw e === PATH_ERROR ? new UnsupportedPathError(path) : e;\n    }\n    if (pathErrorCheckOnly) {\n      continue;\n    }\n    handlerData[j] = handlers.map(([h, paramCount]) => {\n      const paramIndexMap = /* @__PURE__ */ Object.create(null);\n      paramCount -= 1;\n      for (; paramCount >= 0; paramCount--) {\n        const [key, value] = paramAssoc[paramCount];\n        paramIndexMap[key] = value;\n      }\n      return [h, paramIndexMap];\n    });\n  }\n  const [regexp, indexReplacementMap, paramReplacementMap] = trie.buildRegExp();\n  for (let i = 0, len = handlerData.length; i < len; i++) {\n    for (let j = 0, len2 = handlerData[i].length; j < len2; j++) {\n      const map = handlerData[i][j]?.[1];\n      if (!map) {\n        continue;\n      }\n      const keys = Object.keys(map);\n      for (let k = 0, len3 = keys.length; k < len3; k++) {\n        map[keys[k]] = paramReplacementMap[map[keys[k]]];\n      }\n    }\n  }\n  const handlerMap = [];\n  for (const i in indexReplacementMap) {\n    handlerMap[i] = handlerData[indexReplacementMap[i]];\n  }\n  return [regexp, handlerMap, staticMap];\n}\nfunction findMiddleware(middleware, path) {\n  if (!middleware) {\n    return void 0;\n  }\n  for (const k of Object.keys(middleware).sort((a, b) => b.length - a.length)) {\n    if (buildWildcardRegExp(k).test(path)) {\n      return [...middleware[k]];\n    }\n  }\n  return void 0;\n}\nvar RegExpRouter = class {\n  name = \"RegExpRouter\";\n  #middleware;\n  #routes;\n  constructor() {\n    this.#middleware = { [METHOD_NAME_ALL]: /* @__PURE__ */ Object.create(null) };\n    this.#routes = { [METHOD_NAME_ALL]: /* @__PURE__ */ Object.create(null) };\n  }\n  add(method, path, handler) {\n    const middleware = this.#middleware;\n    const routes = this.#routes;\n    if (!middleware || !routes) {\n      throw new Error(MESSAGE_MATCHER_IS_ALREADY_BUILT);\n    }\n    if (!middleware[method]) {\n      ;\n      [middleware, routes].forEach((handlerMap) => {\n        handlerMap[method] = /* @__PURE__ */ Object.create(null);\n        Object.keys(handlerMap[METHOD_NAME_ALL]).forEach((p) => {\n          handlerMap[method][p] = [...handlerMap[METHOD_NAME_ALL][p]];\n        });\n      });\n    }\n    if (path === \"/*\") {\n      path = \"*\";\n    }\n    const paramCount = (path.match(/\\/:/g) || []).length;\n    if (/\\*$/.test(path)) {\n      const re = buildWildcardRegExp(path);\n      if (method === METHOD_NAME_ALL) {\n        Object.keys(middleware).forEach((m) => {\n          middleware[m][path] ||= findMiddleware(middleware[m], path) || findMiddleware(middleware[METHOD_NAME_ALL], path) || [];\n        });\n      } else {\n        middleware[method][path] ||= findMiddleware(middleware[method], path) || findMiddleware(middleware[METHOD_NAME_ALL], path) || [];\n      }\n      Object.keys(middleware).forEach((m) => {\n        if (method === METHOD_NAME_ALL || method === m) {\n          Object.keys(middleware[m]).forEach((p) => {\n            re.test(p) && middleware[m][p].push([handler, paramCount]);\n          });\n        }\n      });\n      Object.keys(routes).forEach((m) => {\n        if (method === METHOD_NAME_ALL || method === m) {\n          Object.keys(routes[m]).forEach(\n            (p) => re.test(p) && routes[m][p].push([handler, paramCount])\n          );\n        }\n      });\n      return;\n    }\n    const paths = checkOptionalParameter(path) || [path];\n    for (let i = 0, len = paths.length; i < len; i++) {\n      const path2 = paths[i];\n      Object.keys(routes).forEach((m) => {\n        if (method === METHOD_NAME_ALL || method === m) {\n          routes[m][path2] ||= [\n            ...findMiddleware(middleware[m], path2) || findMiddleware(middleware[METHOD_NAME_ALL], path2) || []\n          ];\n          routes[m][path2].push([handler, paramCount - len + i + 1]);\n        }\n      });\n    }\n  }\n  match = match;\n  buildAllMatchers() {\n    const matchers = /* @__PURE__ */ Object.create(null);\n    Object.keys(this.#routes).concat(Object.keys(this.#middleware)).forEach((method) => {\n      matchers[method] ||= this.#buildMatcher(method);\n    });\n    this.#middleware = this.#routes = void 0;\n    clearWildcardRegExpCache();\n    return matchers;\n  }\n  #buildMatcher(method) {\n    const routes = [];\n    let hasOwnRoute = method === METHOD_NAME_ALL;\n    [this.#middleware, this.#routes].forEach((r) => {\n      const ownRoute = r[method] ? Object.keys(r[method]).map((path) => [path, r[method][path]]) : [];\n      if (ownRoute.length !== 0) {\n        hasOwnRoute ||= true;\n        routes.push(...ownRoute);\n      } else if (method !== METHOD_NAME_ALL) {\n        routes.push(\n          ...Object.keys(r[METHOD_NAME_ALL]).map((path) => [path, r[METHOD_NAME_ALL][path]])\n        );\n      }\n    });\n    if (!hasOwnRoute) {\n      return null;\n    } else {\n      return buildMatcherFromPreprocessedRoutes(routes);\n    }\n  }\n};\nexport {\n  RegExpRouter\n};\n", "// src/router/smart-router/router.ts\nimport { MESSAGE_MATCHER_IS_ALREADY_BUILT, UnsupportedPathError } from \"../../router.js\";\nvar SmartRouter = class {\n  name = \"SmartRouter\";\n  #routers = [];\n  #routes = [];\n  constructor(init) {\n    this.#routers = init.routers;\n  }\n  add(method, path, handler) {\n    if (!this.#routes) {\n      throw new Error(MESSAGE_MATCHER_IS_ALREADY_BUILT);\n    }\n    this.#routes.push([method, path, handler]);\n  }\n  match(method, path) {\n    if (!this.#routes) {\n      throw new Error(\"Fatal error\");\n    }\n    const routers = this.#routers;\n    const routes = this.#routes;\n    const len = routers.length;\n    let i = 0;\n    let res;\n    for (; i < len; i++) {\n      const router = routers[i];\n      try {\n        for (let i2 = 0, len2 = routes.length; i2 < len2; i2++) {\n          router.add(...routes[i2]);\n        }\n        res = router.match(method, path);\n      } catch (e) {\n        if (e instanceof UnsupportedPathError) {\n          continue;\n        }\n        throw e;\n      }\n      this.match = router.match.bind(router);\n      this.#routers = [router];\n      this.#routes = void 0;\n      break;\n    }\n    if (i === len) {\n      throw new Error(\"Fatal error\");\n    }\n    this.name = `SmartRouter + ${this.activeRouter.name}`;\n    return res;\n  }\n  get activeRouter() {\n    if (this.#routes || this.#routers.length !== 1) {\n      throw new Error(\"No active router has been determined yet.\");\n    }\n    return this.#routers[0];\n  }\n};\nexport {\n  SmartRouter\n};\n", "// src/router/trie-router/node.ts\nimport { METHOD_NAME_ALL } from \"../../router.js\";\nimport { getPattern, splitPath, splitRoutingPath } from \"../../utils/url.js\";\nvar emptyParams = /* @__PURE__ */ Object.create(null);\nvar hasChildren = (children) => {\n  for (const _ in children) {\n    return true;\n  }\n  return false;\n};\nvar Node = class _Node {\n  #methods;\n  #children;\n  #patterns;\n  #order = 0;\n  #params = emptyParams;\n  constructor(method, handler, children) {\n    this.#children = children || /* @__PURE__ */ Object.create(null);\n    this.#methods = [];\n    if (method && handler) {\n      const m = /* @__PURE__ */ Object.create(null);\n      m[method] = { handler, possibleKeys: [], score: 0 };\n      this.#methods = [m];\n    }\n    this.#patterns = [];\n  }\n  insert(method, path, handler) {\n    this.#order = ++this.#order;\n    let curNode = this;\n    const parts = splitRoutingPath(path);\n    const possibleKeys = [];\n    for (let i = 0, len = parts.length; i < len; i++) {\n      const p = parts[i];\n      const nextP = parts[i + 1];\n      const pattern = getPattern(p, nextP);\n      const key = Array.isArray(pattern) ? pattern[0] : p;\n      if (key in curNode.#children) {\n        curNode = curNode.#children[key];\n        if (pattern) {\n          possibleKeys.push(pattern[1]);\n        }\n        continue;\n      }\n      curNode.#children[key] = new _Node();\n      if (pattern) {\n        curNode.#patterns.push(pattern);\n        possibleKeys.push(pattern[1]);\n      }\n      curNode = curNode.#children[key];\n    }\n    curNode.#methods.push({\n      [method]: {\n        handler,\n        possibleKeys: possibleKeys.filter((v, i, a) => a.indexOf(v) === i),\n        score: this.#order\n      }\n    });\n    return curNode;\n  }\n  #pushHandlerSets(handlerSets, node, method, nodeParams, params) {\n    for (let i = 0, len = node.#methods.length; i < len; i++) {\n      const m = node.#methods[i];\n      const handlerSet = m[method] || m[METHOD_NAME_ALL];\n      const processedSet = {};\n      if (handlerSet !== void 0) {\n        handlerSet.params = /* @__PURE__ */ Object.create(null);\n        handlerSets.push(handlerSet);\n        if (nodeParams !== emptyParams || params && params !== emptyParams) {\n          for (let i2 = 0, len2 = handlerSet.possibleKeys.length; i2 < len2; i2++) {\n            const key = handlerSet.possibleKeys[i2];\n            const processed = processedSet[handlerSet.score];\n            handlerSet.params[key] = params?.[key] && !processed ? params[key] : nodeParams[key] ?? params?.[key];\n            processedSet[handlerSet.score] = true;\n          }\n        }\n      }\n    }\n  }\n  search(method, path) {\n    const handlerSets = [];\n    this.#params = emptyParams;\n    const curNode = this;\n    let curNodes = [curNode];\n    const parts = splitPath(path);\n    const curNodesQueue = [];\n    const len = parts.length;\n    let partOffsets = null;\n    for (let i = 0; i < len; i++) {\n      const part = parts[i];\n      const isLast = i === len - 1;\n      const tempNodes = [];\n      for (let j = 0, len2 = curNodes.length; j < len2; j++) {\n        const node = curNodes[j];\n        const nextNode = node.#children[part];\n        if (nextNode) {\n          nextNode.#params = node.#params;\n          if (isLast) {\n            if (nextNode.#children[\"*\"]) {\n              this.#pushHandlerSets(handlerSets, nextNode.#children[\"*\"], method, node.#params);\n            }\n            this.#pushHandlerSets(handlerSets, nextNode, method, node.#params);\n          } else {\n            tempNodes.push(nextNode);\n          }\n        }\n        for (let k = 0, len3 = node.#patterns.length; k < len3; k++) {\n          const pattern = node.#patterns[k];\n          const params = node.#params === emptyParams ? {} : { ...node.#params };\n          if (pattern === \"*\") {\n            const astNode = node.#children[\"*\"];\n            if (astNode) {\n              this.#pushHandlerSets(handlerSets, astNode, method, node.#params);\n              astNode.#params = params;\n              tempNodes.push(astNode);\n            }\n            continue;\n          }\n          const [key, name, matcher] = pattern;\n          if (!part && !(matcher instanceof RegExp)) {\n            continue;\n          }\n          const child = node.#children[key];\n          if (matcher instanceof RegExp) {\n            if (partOffsets === null) {\n              partOffsets = new Array(len);\n              let offset = path[0] === \"/\" ? 1 : 0;\n              for (let p = 0; p < len; p++) {\n                partOffsets[p] = offset;\n                offset += parts[p].length + 1;\n              }\n            }\n            const restPathString = path.substring(partOffsets[i]);\n            const m = matcher.exec(restPathString);\n            if (m) {\n              params[name] = m[0];\n              this.#pushHandlerSets(handlerSets, child, method, node.#params, params);\n              if (hasChildren(child.#children)) {\n                child.#params = params;\n                const componentCount = m[0].match(/\\//)?.length ?? 0;\n                const targetCurNodes = curNodesQueue[componentCount] ||= [];\n                targetCurNodes.push(child);\n              }\n              continue;\n            }\n          }\n          if (matcher === true || matcher.test(part)) {\n            params[name] = part;\n            if (isLast) {\n              this.#pushHandlerSets(handlerSets, child, method, params, node.#params);\n              if (child.#children[\"*\"]) {\n                this.#pushHandlerSets(\n                  handlerSets,\n                  child.#children[\"*\"],\n                  method,\n                  params,\n                  node.#params\n                );\n              }\n            } else {\n              child.#params = params;\n              tempNodes.push(child);\n            }\n          }\n        }\n      }\n      const shifted = curNodesQueue.shift();\n      curNodes = shifted ? tempNodes.concat(shifted) : tempNodes;\n    }\n    if (handlerSets.length > 1) {\n      handlerSets.sort((a, b) => {\n        return a.score - b.score;\n      });\n    }\n    return [handlerSets.map(({ handler, params }) => [handler, params])];\n  }\n};\nexport {\n  Node\n};\n", "// src/router/trie-router/router.ts\nimport { checkOptionalParameter } from \"../../utils/url.js\";\nimport { Node } from \"./node.js\";\nvar TrieRouter = class {\n  name = \"TrieRouter\";\n  #node;\n  constructor() {\n    this.#node = new Node();\n  }\n  add(method, path, handler) {\n    const results = checkOptionalParameter(path);\n    if (results) {\n      for (let i = 0, len = results.length; i < len; i++) {\n        this.#node.insert(method, results[i], handler);\n      }\n      return;\n    }\n    this.#node.insert(method, path, handler);\n  }\n  match(method, path) {\n    return this.#node.search(method, path);\n  }\n};\nexport {\n  TrieRouter\n};\n", "// src/hono.ts\nimport { HonoBase } from \"./hono-base.js\";\nimport { RegExpRouter } from \"./router/reg-exp-router/index.js\";\nimport { SmartRouter } from \"./router/smart-router/index.js\";\nimport { TrieRouter } from \"./router/trie-router/index.js\";\nvar Hono = class extends HonoBase {\n  /**\n   * Creates an instance of the Hono class.\n   *\n   * @param options - Optional configuration options for the Hono instance.\n   */\n  constructor(options = {}) {\n    super(options);\n    this.router = options.router ?? new SmartRouter({\n      routers: [new RegExpRouter(), new TrieRouter()]\n    });\n  }\n};\nexport {\n  Hono\n};\n", "// src/middleware/cors/index.ts\nvar cors = (options) => {\n  const defaults = {\n    origin: \"*\",\n    allowMethods: [\"GET\", \"HEAD\", \"PUT\", \"POST\", \"DELETE\", \"PATCH\"],\n    allowHeaders: [],\n    exposeHeaders: []\n  };\n  const opts = {\n    ...defaults,\n    ...options\n  };\n  const findAllowOrigin = ((optsOrigin) => {\n    if (typeof optsOrigin === \"string\") {\n      if (optsOrigin === \"*\") {\n        return () => optsOrigin;\n      } else {\n        return (origin) => optsOrigin === origin ? origin : null;\n      }\n    } else if (typeof optsOrigin === \"function\") {\n      return optsOrigin;\n    } else {\n      return (origin) => optsOrigin.includes(origin) ? origin : null;\n    }\n  })(opts.origin);\n  const findAllowMethods = ((optsAllowMethods) => {\n    if (typeof optsAllowMethods === \"function\") {\n      return optsAllowMethods;\n    } else if (Array.isArray(optsAllowMethods)) {\n      return () => optsAllowMethods;\n    } else {\n      return () => [];\n    }\n  })(opts.allowMethods);\n  return async function cors2(c, next) {\n    function set(key, value) {\n      c.res.headers.set(key, value);\n    }\n    const allowOrigin = await findAllowOrigin(c.req.header(\"origin\") || \"\", c);\n    if (allowOrigin) {\n      set(\"Access-Control-Allow-Origin\", allowOrigin);\n    }\n    if (opts.credentials) {\n      set(\"Access-Control-Allow-Credentials\", \"true\");\n    }\n    if (opts.exposeHeaders?.length) {\n      set(\"Access-Control-Expose-Headers\", opts.exposeHeaders.join(\",\"));\n    }\n    if (c.req.method === \"OPTIONS\") {\n      if (opts.origin !== \"*\") {\n        set(\"Vary\", \"Origin\");\n      }\n      if (opts.maxAge != null) {\n        set(\"Access-Control-Max-Age\", opts.maxAge.toString());\n      }\n      const allowMethods = await findAllowMethods(c.req.header(\"origin\") || \"\", c);\n      if (allowMethods.length) {\n        set(\"Access-Control-Allow-Methods\", allowMethods.join(\",\"));\n      }\n      let headers = opts.allowHeaders;\n      if (!headers?.length) {\n        const requestHeaders = c.req.header(\"Access-Control-Request-Headers\");\n        if (requestHeaders) {\n          headers = requestHeaders.split(/\\s*,\\s*/);\n        }\n      }\n      if (headers?.length) {\n        set(\"Access-Control-Allow-Headers\", headers.join(\",\"));\n        c.res.headers.append(\"Vary\", \"Access-Control-Request-Headers\");\n      }\n      c.res.headers.delete(\"Content-Length\");\n      c.res.headers.delete(\"Content-Type\");\n      return new Response(null, {\n        headers: c.res.headers,\n        status: 204,\n        statusText: \"No Content\"\n      });\n    }\n    await next();\n    if (opts.origin !== \"*\") {\n      c.header(\"Vary\", \"Origin\", { append: true });\n    }\n  };\n};\nexport {\n  cors\n};\n", "// src/utils/color.ts\nfunction getColorEnabled() {\n  const { process, Deno } = globalThis;\n  const isNoColor = typeof Deno?.noColor === \"boolean\" ? Deno.noColor : process !== void 0 ? (\n    // eslint-disable-next-line no-unsafe-optional-chaining\n    \"NO_COLOR\" in process?.env\n  ) : false;\n  return !isNoColor;\n}\nasync function getColorEnabledAsync() {\n  const { navigator } = globalThis;\n  const cfWorkers = \"cloudflare:workers\";\n  const isNoColor = navigator !== void 0 && navigator.userAgent === \"Cloudflare-Workers\" ? await (async () => {\n    try {\n      return \"NO_COLOR\" in ((await import(cfWorkers)).env ?? {});\n    } catch {\n      return false;\n    }\n  })() : !getColorEnabled();\n  return !isNoColor;\n}\nexport {\n  getColorEnabled,\n  getColorEnabledAsync\n};\n", "// src/middleware/logger/index.ts\nimport { getColorEnabledAsync } from \"../../utils/color.js\";\nvar humanize = (times) => {\n  const [delimiter, separator] = [\",\", \".\"];\n  const orderTimes = times.map((v) => v.replace(/(\\d)(?=(\\d\\d\\d)+(?!\\d))/g, \"$1\" + delimiter));\n  return orderTimes.join(separator);\n};\nvar time = (start) => {\n  const delta = Date.now() - start;\n  return humanize([delta < 1e3 ? delta + \"ms\" : Math.round(delta / 1e3) + \"s\"]);\n};\nvar colorStatus = async (status) => {\n  const colorEnabled = await getColorEnabledAsync();\n  if (colorEnabled) {\n    switch (status / 100 | 0) {\n      case 5:\n        return `\\x1B[31m${status}\\x1B[0m`;\n      case 4:\n        return `\\x1B[33m${status}\\x1B[0m`;\n      case 3:\n        return `\\x1B[36m${status}\\x1B[0m`;\n      case 2:\n        return `\\x1B[32m${status}\\x1B[0m`;\n    }\n  }\n  return `${status}`;\n};\nasync function log(fn, prefix, method, path, status = 0, elapsed) {\n  const out = prefix === \"<--\" /* Incoming */ ? `${prefix} ${method} ${path}` : `${prefix} ${method} ${path} ${await colorStatus(status)} ${elapsed}`;\n  fn(out);\n}\nvar logger = (fn = console.log) => {\n  return async function logger2(c, next) {\n    const { method, url } = c.req;\n    const path = url.slice(url.indexOf(\"/\", 8));\n    await log(fn, \"<--\" /* Incoming */, method, path);\n    const start = Date.now();\n    await next();\n    await log(fn, \"-->\" /* Outgoing */, method, path, c.res.status, time(start));\n  };\n};\nexport {\n  logger\n};\n", "// src/middleware/secure-headers/secure-headers.ts\nimport { encodeBase64 } from \"../../utils/encode.js\";\nvar HEADERS_MAP = {\n  crossOriginEmbedderPolicy: [\"Cross-Origin-Embedder-Policy\", \"require-corp\"],\n  crossOriginResourcePolicy: [\"Cross-Origin-Resource-Policy\", \"same-origin\"],\n  crossOriginOpenerPolicy: [\"Cross-Origin-Opener-Policy\", \"same-origin\"],\n  originAgentCluster: [\"Origin-Agent-Cluster\", \"?1\"],\n  referrerPolicy: [\"Referrer-Policy\", \"no-referrer\"],\n  strictTransportSecurity: [\"Strict-Transport-Security\", \"max-age=15552000; includeSubDomains\"],\n  xContentTypeOptions: [\"X-Content-Type-Options\", \"nosniff\"],\n  xDnsPrefetchControl: [\"X-DNS-Prefetch-Control\", \"off\"],\n  xDownloadOptions: [\"X-Download-Options\", \"noopen\"],\n  xFrameOptions: [\"X-Frame-Options\", \"SAMEORIGIN\"],\n  xPermittedCrossDomainPolicies: [\"X-Permitted-Cross-Domain-Policies\", \"none\"],\n  xXssProtection: [\"X-XSS-Protection\", \"0\"]\n};\nvar DEFAULT_OPTIONS = {\n  crossOriginEmbedderPolicy: false,\n  crossOriginResourcePolicy: true,\n  crossOriginOpenerPolicy: true,\n  originAgentCluster: true,\n  referrerPolicy: true,\n  strictTransportSecurity: true,\n  xContentTypeOptions: true,\n  xDnsPrefetchControl: true,\n  xDownloadOptions: true,\n  xFrameOptions: true,\n  xPermittedCrossDomainPolicies: true,\n  xXssProtection: true,\n  removePoweredBy: true,\n  permissionsPolicy: {}\n};\nvar generateNonce = () => {\n  const arrayBuffer = new Uint8Array(16);\n  crypto.getRandomValues(arrayBuffer);\n  return encodeBase64(arrayBuffer.buffer);\n};\nvar NONCE = (ctx) => {\n  const key = \"secureHeadersNonce\";\n  const init = ctx.get(key);\n  const nonce = init || generateNonce();\n  if (init == null) {\n    ctx.set(key, nonce);\n  }\n  return `'nonce-${nonce}'`;\n};\nvar secureHeaders = (customOptions) => {\n  const options = { ...DEFAULT_OPTIONS, ...customOptions };\n  const headersToSet = getFilteredHeaders(options);\n  const callbacks = [];\n  if (options.contentSecurityPolicy) {\n    const [callback, value] = getCSPDirectives(options.contentSecurityPolicy);\n    if (callback) {\n      callbacks.push(callback);\n    }\n    headersToSet.push([\"Content-Security-Policy\", value]);\n  }\n  if (options.contentSecurityPolicyReportOnly) {\n    const [callback, value] = getCSPDirectives(options.contentSecurityPolicyReportOnly);\n    if (callback) {\n      callbacks.push(callback);\n    }\n    headersToSet.push([\"Content-Security-Policy-Report-Only\", value]);\n  }\n  if (options.permissionsPolicy && Object.keys(options.permissionsPolicy).length > 0) {\n    headersToSet.push([\n      \"Permissions-Policy\",\n      getPermissionsPolicyDirectives(options.permissionsPolicy)\n    ]);\n  }\n  if (options.reportingEndpoints) {\n    headersToSet.push([\"Reporting-Endpoints\", getReportingEndpoints(options.reportingEndpoints)]);\n  }\n  if (options.reportTo) {\n    headersToSet.push([\"Report-To\", getReportToOptions(options.reportTo)]);\n  }\n  return async function secureHeaders2(ctx, next) {\n    const headersToSetForReq = callbacks.length === 0 ? headersToSet : callbacks.reduce((acc, cb) => cb(ctx, acc), headersToSet);\n    await next();\n    setHeaders(ctx, headersToSetForReq);\n    if (options?.removePoweredBy) {\n      ctx.res.headers.delete(\"X-Powered-By\");\n    }\n  };\n};\nfunction getFilteredHeaders(options) {\n  return Object.entries(HEADERS_MAP).filter(([key]) => options[key]).map(([key, defaultValue]) => {\n    const overrideValue = options[key];\n    return typeof overrideValue === \"string\" ? [defaultValue[0], overrideValue] : defaultValue;\n  });\n}\nfunction getCSPDirectives(contentSecurityPolicy) {\n  const callbacks = [];\n  const resultValues = [];\n  for (const [directive, value] of Object.entries(contentSecurityPolicy)) {\n    const valueArray = Array.isArray(value) ? value : [value];\n    valueArray.forEach((value2, i) => {\n      if (typeof value2 === \"function\") {\n        const index = i * 2 + 2 + resultValues.length;\n        callbacks.push((ctx, values) => {\n          values[index] = value2(ctx, directive);\n        });\n      }\n    });\n    resultValues.push(\n      directive.replace(\n        /[A-Z]+(?![a-z])|[A-Z]/g,\n        (match, offset) => offset ? \"-\" + match.toLowerCase() : match.toLowerCase()\n      ),\n      ...valueArray.flatMap((value2) => [\" \", value2]),\n      \"; \"\n    );\n  }\n  resultValues.pop();\n  return callbacks.length === 0 ? [void 0, resultValues.join(\"\")] : [\n    (ctx, headersToSet) => headersToSet.map((values) => {\n      if (values[0] === \"Content-Security-Policy\" || values[0] === \"Content-Security-Policy-Report-Only\") {\n        const clone = values[1].slice();\n        callbacks.forEach((cb) => {\n          cb(ctx, clone);\n        });\n        return [values[0], clone.join(\"\")];\n      } else {\n        return values;\n      }\n    }),\n    resultValues\n  ];\n}\nfunction getPermissionsPolicyDirectives(policy) {\n  return Object.entries(policy).map(([directive, value]) => {\n    const kebabDirective = camelToKebab(directive);\n    if (typeof value === \"boolean\") {\n      return `${kebabDirective}=${value ? \"*\" : \"none\"}`;\n    }\n    if (Array.isArray(value)) {\n      if (value.length === 0) {\n        return `${kebabDirective}=()`;\n      }\n      if (value.length === 1 && (value[0] === \"*\" || value[0] === \"none\")) {\n        return `${kebabDirective}=${value[0]}`;\n      }\n      const allowlist = value.map((item) => [\"self\", \"src\"].includes(item) ? item : `\"${item}\"`);\n      return `${kebabDirective}=(${allowlist.join(\" \")})`;\n    }\n    return \"\";\n  }).filter(Boolean).join(\", \");\n}\nfunction camelToKebab(str) {\n  return str.replace(/([a-z\\d])([A-Z])/g, \"$1-$2\").toLowerCase();\n}\nfunction getReportingEndpoints(reportingEndpoints = []) {\n  return reportingEndpoints.map((endpoint) => `${endpoint.name}=\"${endpoint.url}\"`).join(\", \");\n}\nfunction getReportToOptions(reportTo = []) {\n  return reportTo.map((option) => JSON.stringify(option)).join(\", \");\n}\nfunction setHeaders(ctx, headersToSet) {\n  headersToSet.forEach(([header, value]) => {\n    ctx.res.headers.set(header, value);\n  });\n}\nexport {\n  NONCE,\n  secureHeaders\n};\n", "{\r\n  \"version\": 2,\r\n  \"generated_at\": \"2026-02-23T00:00:00Z\",\r\n  \"lenders\": [\r\n    {\r\n      \"code\": \"cba\",\r\n      \"name\": \"CBA\",\r\n      \"canonical_bank_name\": \"Commonwealth Bank of Australia\",\r\n      \"register_brand_name\": \"Commonwealth Bank of Australia\",\r\n      \"products_endpoint\": \"https://api.commbank.com.au/public/cds-au/v1/banking/products\",\r\n      \"seed_rate_urls\": [\r\n        \"https://www.commbank.com.au/home-loans/rates-and-fees.html\"\r\n      ]\r\n    },\r\n    {\r\n      \"code\": \"westpac\",\r\n      \"name\": \"Westpac\",\r\n      \"canonical_bank_name\": \"Westpac Banking Corporation\",\r\n      \"register_brand_name\": \"Westpac\",\r\n      \"products_endpoint\": \"https://digital-api.westpac.com.au/cds-au/v1/banking/products\",\r\n      \"seed_rate_urls\": [\r\n        \"https://www.westpac.com.au/personal-banking/home-loans/interest-rates/\"\r\n      ]\r\n    },\r\n    {\r\n      \"code\": \"nab\",\r\n      \"name\": \"NAB\",\r\n      \"canonical_bank_name\": \"National Australia Bank\",\r\n      \"register_brand_name\": \"NAB\",\r\n      \"products_endpoint\": \"https://openbank.api.nab.com.au/cds-au/v1/banking/products\",\r\n      \"seed_rate_urls\": [\r\n        \"https://www.nab.com.au/personal/home-loans/interest-rates\"\r\n      ]\r\n    },\r\n    {\r\n      \"code\": \"anz\",\r\n      \"name\": \"ANZ\",\r\n      \"canonical_bank_name\": \"ANZ\",\r\n      \"register_brand_name\": \"ANZ\",\r\n      \"products_endpoint\": \"https://api.anz/cds-au/v1/banking/products\",\r\n      \"seed_rate_urls\": [\r\n        \"https://www.anz.com.au/personal/home-loans/interest-rates/\"\r\n      ]\r\n    },\r\n    {\r\n      \"code\": \"macquarie\",\r\n      \"name\": \"Macquarie\",\r\n      \"canonical_bank_name\": \"Macquarie Bank\",\r\n      \"register_brand_name\": \"Macquarie Bank\",\r\n      \"products_endpoint\": \"https://api.macquariebank.io/cds-au/v1/banking/products\",\r\n      \"seed_rate_urls\": [\r\n        \"https://www.macquarie.com.au/home-loans/interest-rates.html\"\r\n      ]\r\n    },\r\n    {\r\n      \"code\": \"bendigo_adelaide\",\r\n      \"name\": \"Bendigo & Adelaide\",\r\n      \"canonical_bank_name\": \"Bendigo and Adelaide Bank\",\r\n      \"register_brand_name\": \"Bendigo and Adelaide Bank\",\r\n      \"products_endpoint\": \"https://api.cdr.bendigobank.com.au/cds-au/v1/banking/products\",\r\n      \"seed_rate_urls\": [\r\n        \"https://www.bendigobank.com.au/personal/home-loans/interest-rates/\"\r\n      ]\r\n    },\r\n    {\r\n      \"code\": \"suncorp\",\r\n      \"name\": \"Suncorp\",\r\n      \"canonical_bank_name\": \"Suncorp Bank\",\r\n      \"register_brand_name\": \"Suncorp Bank\",\r\n      \"products_endpoint\": \"https://id-ob.suncorpbank.com.au/cds-au/v1/banking/products\",\r\n      \"seed_rate_urls\": [\r\n        \"https://www.suncorpbank.com.au/home-loans/rates\"\r\n      ]\r\n    },\r\n    {\r\n      \"code\": \"bankwest\",\r\n      \"name\": \"Bankwest\",\r\n      \"canonical_bank_name\": \"Bankwest\",\r\n      \"register_brand_name\": \"Bankwest\",\r\n      \"products_endpoint\": \"https://open-api.bankwest.com.au/bwpublic/cds-au/v1/banking/products\",\r\n      \"seed_rate_urls\": [\r\n        \"https://www.bankwest.com.au/personal/home-buying/home-loan-rates\"\r\n      ]\r\n    },\r\n    {\r\n      \"code\": \"ing\",\r\n      \"name\": \"ING\",\r\n      \"canonical_bank_name\": \"ING\",\r\n      \"register_brand_name\": \"ING\",\r\n      \"products_endpoint\": \"https://id.ob.ing.com.au/cds-au/v1/banking/products\",\r\n      \"seed_rate_urls\": [\r\n        \"https://www.ing.com.au/home-loans/rates-and-fees.html\"\r\n      ]\r\n    },\r\n    {\r\n      \"code\": \"amp\",\r\n      \"name\": \"AMP\",\r\n      \"canonical_bank_name\": \"AMP Bank\",\r\n      \"register_brand_name\": \"AMP Bank\",\r\n      \"products_endpoint\": \"https://pub.cdr-sme.amp.com.au/api/cds-au/v1/banking/products\",\r\n      \"seed_rate_urls\": [\r\n        \"https://www.amp.com.au/home-loans/rates-and-fees\"\r\n      ]\r\n    },\r\n    {\r\n      \"code\": \"hsbc\",\r\n      \"name\": \"HSBC\",\r\n      \"canonical_bank_name\": \"HSBC Australia\",\r\n      \"register_brand_name\": \"HSBC Bank Australia Limited\",\r\n      \"products_endpoint\": \"https://public.ob.hsbc.com.au/cds-au/v1/banking/products\",\r\n      \"seed_rate_urls\": [\r\n        \"https://www.hsbc.com.au/home-loans/products/rates/\"\r\n      ]\r\n    },\r\n    {\r\n      \"code\": \"ubank\",\r\n      \"name\": \"UBank\",\r\n      \"canonical_bank_name\": \"UBank\",\r\n      \"register_brand_name\": \"ubank\",\r\n      \"products_endpoint\": \"https://public.cdr-api.86400.com.au/cds-au/v1/banking/products\",\r\n      \"seed_rate_urls\": [\r\n        \"https://www.ubank.com.au/home-loans/interest-rates-and-fees\"\r\n      ]\r\n    },\r\n    {\r\n      \"code\": \"stgeorge\",\r\n      \"name\": \"St. George\",\r\n      \"canonical_bank_name\": \"St. George Bank\",\r\n      \"register_brand_name\": \"St.George Bank\",\r\n      \"products_endpoint\": \"https://digital-api.stgeorge.com.au/cds-au/v1/banking/products\",\r\n      \"seed_rate_urls\": [\r\n        \"https://www.stgeorge.com.au/personal/home-loans/our-home-loans/rates\"\r\n      ]\r\n    },\r\n    {\r\n      \"code\": \"bankofmelbourne\",\r\n      \"name\": \"Bank of Melbourne\",\r\n      \"canonical_bank_name\": \"Bank of Melbourne\",\r\n      \"register_brand_name\": \"Bank of Melbourne\",\r\n      \"products_endpoint\": \"https://digital-api.bankofmelbourne.com.au/cds-au/v1/banking/products\",\r\n      \"seed_rate_urls\": [\r\n        \"https://www.bankofmelbourne.com.au/personal/home-loans/our-home-loans/rates\"\r\n      ]\r\n    },\r\n    {\r\n      \"code\": \"boq\",\r\n      \"name\": \"BOQ\",\r\n      \"canonical_bank_name\": \"Bank of Queensland\",\r\n      \"register_brand_name\": \"Bank of Queensland\",\r\n      \"seed_rate_urls\": [\r\n        \"https://www.boq.com.au/personal/home-loans/home-loan-interest-rates\"\r\n      ]\r\n    },\r\n    {\r\n      \"code\": \"great_southern\",\r\n      \"name\": \"Great Southern Bank\",\r\n      \"canonical_bank_name\": \"Great Southern Bank\",\r\n      \"register_brand_name\": \"Great Southern Bank\",\r\n      \"seed_rate_urls\": [\r\n        \"https://www.greatsouthernbank.com.au/home-loans/rates\"\r\n      ]\r\n    }\r\n  ]\r\n}", "import lendersConfigRaw from '../config/lenders.json'\r\nimport type {\r\n  FeatureSet,\r\n  InterestPayment,\r\n  LenderConfigFile,\r\n  LvrTier,\r\n  RateStructure,\r\n  RepaymentType,\r\n  SavingsAccountType,\r\n  SavingsRateType,\r\n  SecurityPurpose,\r\n} from './types'\r\n\r\nexport const API_BASE_PATH = '/api/home-loan-rates'\r\nexport const SAVINGS_API_BASE_PATH = '/api/savings-rates'\r\nexport const TD_API_BASE_PATH = '/api/term-deposit-rates'\r\nexport const MELBOURNE_TIMEZONE = 'Australia/Melbourne'\r\nexport const MELBOURNE_TARGET_HOUR = 6\r\nexport const DEFAULT_PUBLIC_CACHE_SECONDS = 120\r\nexport const DEFAULT_LOCK_TTL_SECONDS = 7200\r\nexport const DEFAULT_MAX_QUEUE_ATTEMPTS = 6\r\n\r\nexport const SECURITY_PURPOSES: SecurityPurpose[] = ['owner_occupied', 'investment']\r\nexport const REPAYMENT_TYPES: RepaymentType[] = ['principal_and_interest', 'interest_only']\r\nexport const RATE_STRUCTURES: RateStructure[] = [\r\n  'variable',\r\n  'fixed_1yr',\r\n  'fixed_2yr',\r\n  'fixed_3yr',\r\n  'fixed_4yr',\r\n  'fixed_5yr',\r\n]\r\nexport const LVR_TIERS: LvrTier[] = ['lvr_=60%', 'lvr_60-70%', 'lvr_70-80%', 'lvr_80-85%', 'lvr_85-90%', 'lvr_90-95%']\r\nexport const FEATURE_SETS: FeatureSet[] = ['basic', 'premium']\r\n\r\nexport const SAVINGS_ACCOUNT_TYPES: SavingsAccountType[] = ['savings', 'transaction', 'at_call']\r\nexport const SAVINGS_RATE_TYPES: SavingsRateType[] = ['base', 'bonus', 'introductory', 'bundle', 'total']\r\nexport const INTEREST_PAYMENTS: InterestPayment[] = ['at_maturity', 'monthly', 'quarterly', 'annually']\r\n\r\nconst lendersConfig = lendersConfigRaw as LenderConfigFile\r\nexport const TARGET_LENDERS = lendersConfig.lenders\r\nexport const CDR_REGISTER_DISCOVERY_URL = 'https://consumerdatastandardsaustralia.github.io/register/'", "import type { MelbourneParts } from '../types'\r\nimport { MELBOURNE_TIMEZONE } from '../constants'\r\n\r\nfunction parseIntlParts(date: Date, timeZone: string): MelbourneParts {\r\n  const formatter = new Intl.DateTimeFormat('en-CA', {\r\n    timeZone,\r\n    year: 'numeric',\r\n    month: '2-digit',\r\n    day: '2-digit',\r\n    hour: '2-digit',\r\n    minute: '2-digit',\r\n    second: '2-digit',\r\n    hour12: false,\r\n  })\r\n\r\n  const raw = formatter.formatToParts(date)\r\n  const mapped = Object.fromEntries(raw.map((part) => [part.type, part.value])) as Record<string, string>\r\n\r\n  return {\r\n    date: `${mapped.year}-${mapped.month}-${mapped.day}`,\r\n    hour: Number(mapped.hour),\r\n    minute: Number(mapped.minute),\r\n    second: Number(mapped.second),\r\n    timeZone,\r\n    iso: date.toISOString(),\r\n  }\r\n}\r\n\r\nexport function nowIso(): string {\r\n  return new Date().toISOString()\r\n}\r\n\r\nexport function getMelbourneNowParts(date = new Date(), timeZone = MELBOURNE_TIMEZONE): MelbourneParts {\r\n  return parseIntlParts(date, timeZone)\r\n}\r\n\r\nexport function parseIntegerEnv(value: string | undefined, fallback: number): number {\r\n  const parsed = Number.parseInt(String(value ?? ''), 10)\r\n  return Number.isFinite(parsed) ? parsed : fallback\r\n}\r\n\r\nexport function isDateOnly(value: string): boolean {\r\n  return /^\\d{4}-\\d{2}-\\d{2}$/.test(value)\r\n}\r\n\r\nexport function currentMonthCursor(parts: MelbourneParts): string {\r\n  return parts.date.slice(0, 7)\r\n}", "import { nowIso } from '../utils/time'\r\nimport type { EnvBindings } from '../types'\r\n\r\ntype LockRecord = {\r\n  key: string\r\n  owner: string\r\n  acquiredAt: string\r\n  expiresAt: number\r\n}\r\n\r\ntype LockAction = 'acquire' | 'release' | 'status'\r\n\r\ntype LockRequest = {\r\n  action: LockAction\r\n  key: string\r\n  owner?: string\r\n  ttlSeconds?: number\r\n}\r\n\r\ntype LockResponse = {\r\n  ok: boolean\r\n  action: LockAction\r\n  key: string\r\n  locked: boolean\r\n  acquired?: boolean\r\n  released?: boolean\r\n  owner?: string\r\n  acquiredAt?: string\r\n  expiresAt?: number\r\n  reason?: string\r\n}\r\n\r\nconst STORAGE_KEY = 'lock-record'\r\nconst MIN_TTL_SECONDS = 30\r\nconst MAX_TTL_SECONDS = 24 * 60 * 60\r\n\r\nfunction clampTtl(ttlSeconds: number | undefined): number {\r\n  const parsed = Number(ttlSeconds)\r\n  if (!Number.isFinite(parsed)) {\r\n    return 7200\r\n  }\r\n  return Math.min(MAX_TTL_SECONDS, Math.max(MIN_TTL_SECONDS, Math.floor(parsed)))\r\n}\r\n\r\nexport class RunLockDO {\r\n  constructor(private readonly state: DurableObjectState) {}\r\n\r\n  async fetch(request: Request): Promise<Response> {\r\n    let payload: LockRequest | null = null\r\n\r\n    if (request.method === 'POST') {\r\n      payload = await request.json<LockRequest>().catch(() => null)\r\n    } else {\r\n      const url = new URL(request.url)\r\n      const action = String(url.searchParams.get('action') || '') as LockAction\r\n      const key = String(url.searchParams.get('key') || '')\r\n      const owner = String(url.searchParams.get('owner') || '') || undefined\r\n      const ttlSeconds = Number(url.searchParams.get('ttlSeconds') || '') || undefined\r\n      payload = { action, key, owner, ttlSeconds }\r\n    }\r\n\r\n    if (!payload || !payload.action || !payload.key) {\r\n      return Response.json(\r\n        {\r\n          ok: false,\r\n          action: payload?.action || 'status',\r\n          key: payload?.key || '',\r\n          locked: false,\r\n          reason: 'invalid_lock_request',\r\n        } satisfies LockResponse,\r\n        { status: 400 },\r\n      )\r\n    }\r\n\r\n    if (payload.action === 'acquire') {\r\n      return this.handleAcquire(payload)\r\n    }\r\n    if (payload.action === 'release') {\r\n      return this.handleRelease(payload)\r\n    }\r\n    if (payload.action === 'status') {\r\n      return this.handleStatus(payload)\r\n    }\r\n\r\n    return Response.json(\r\n      {\r\n        ok: false,\r\n        action: payload.action,\r\n        key: payload.key,\r\n        locked: false,\r\n        reason: 'unsupported_action',\r\n      } satisfies LockResponse,\r\n      { status: 400 },\r\n    )\r\n  }\r\n\r\n  private async readRecord(): Promise<LockRecord | null> {\r\n    const record = await this.state.storage.get<LockRecord>(STORAGE_KEY)\r\n    if (!record) {\r\n      return null\r\n    }\r\n    if (record.expiresAt <= Date.now()) {\r\n      await this.state.storage.delete(STORAGE_KEY)\r\n      return null\r\n    }\r\n    return record\r\n  }\r\n\r\n  private async handleAcquire(payload: LockRequest): Promise<Response> {\r\n    const owner = String(payload.owner || 'unknown')\r\n    const ttlSeconds = clampTtl(payload.ttlSeconds)\r\n    const now = Date.now()\r\n    const existing = await this.readRecord()\r\n\r\n    if (existing) {\r\n      return Response.json({\r\n        ok: true,\r\n        action: 'acquire',\r\n        key: payload.key,\r\n        locked: true,\r\n        acquired: false,\r\n        owner: existing.owner,\r\n        acquiredAt: existing.acquiredAt,\r\n        expiresAt: existing.expiresAt,\r\n      } satisfies LockResponse)\r\n    }\r\n\r\n    const record: LockRecord = {\r\n      key: payload.key,\r\n      owner,\r\n      acquiredAt: nowIso(),\r\n      expiresAt: now + ttlSeconds * 1000,\r\n    }\r\n\r\n    await this.state.storage.put(STORAGE_KEY, record)\r\n\r\n    return Response.json({\r\n      ok: true,\r\n      action: 'acquire',\r\n      key: payload.key,\r\n      locked: true,\r\n      acquired: true,\r\n      owner: record.owner,\r\n      acquiredAt: record.acquiredAt,\r\n      expiresAt: record.expiresAt,\r\n    } satisfies LockResponse)\r\n  }\r\n\r\n  private async handleRelease(payload: LockRequest): Promise<Response> {\r\n    const existing = await this.readRecord()\r\n    if (!existing) {\r\n      return Response.json({\r\n        ok: true,\r\n        action: 'release',\r\n        key: payload.key,\r\n        locked: false,\r\n        released: false,\r\n        reason: 'lock_not_found',\r\n      } satisfies LockResponse)\r\n    }\r\n\r\n    if (payload.owner && payload.owner !== existing.owner) {\r\n      return Response.json({\r\n        ok: false,\r\n        action: 'release',\r\n        key: payload.key,\r\n        locked: true,\r\n        released: false,\r\n        owner: existing.owner,\r\n        reason: 'owner_mismatch',\r\n      } satisfies LockResponse, { status: 409 })\r\n    }\r\n\r\n    await this.state.storage.delete(STORAGE_KEY)\r\n\r\n    return Response.json({\r\n      ok: true,\r\n      action: 'release',\r\n      key: payload.key,\r\n      locked: false,\r\n      released: true,\r\n    } satisfies LockResponse)\r\n  }\r\n\r\n  private async handleStatus(payload: LockRequest): Promise<Response> {\r\n    const existing = await this.readRecord()\r\n    if (!existing) {\r\n      return Response.json({\r\n        ok: true,\r\n        action: 'status',\r\n        key: payload.key,\r\n        locked: false,\r\n      } satisfies LockResponse)\r\n    }\r\n\r\n    return Response.json({\r\n      ok: true,\r\n      action: 'status',\r\n      key: payload.key,\r\n      locked: true,\r\n      owner: existing.owner,\r\n      acquiredAt: existing.acquiredAt,\r\n      expiresAt: existing.expiresAt,\r\n    } satisfies LockResponse)\r\n  }\r\n}\r\n\r\ntype LockEnv = Pick<EnvBindings, 'RUN_LOCK_DO'>\r\n\r\nasync function callLock(env: LockEnv, key: string, payload: Omit<LockRequest, 'key'>): Promise<LockResponse> {\r\n  const id = env.RUN_LOCK_DO.idFromName(key)\r\n  const stub = env.RUN_LOCK_DO.get(id)\r\n  const response = await stub.fetch('https://run-lock.internal', {\r\n    method: 'POST',\r\n    headers: {\r\n      'content-type': 'application/json',\r\n    },\r\n    body: JSON.stringify({ ...payload, key }),\r\n  })\r\n\r\n  if (!response.ok) {\r\n    return {\r\n      ok: false,\r\n      action: payload.action,\r\n      key,\r\n      locked: false,\r\n      reason: `lock_request_failed_${response.status}`,\r\n    }\r\n  }\r\n\r\n  const data = await response.json<LockResponse>()\r\n  return data\r\n}\r\n\r\nexport async function acquireRunLock(\r\n  env: LockEnv,\r\n  params: { key: string; owner: string; ttlSeconds: number },\r\n): Promise<LockResponse> {\r\n  return callLock(env, params.key, {\r\n    action: 'acquire',\r\n    owner: params.owner,\r\n    ttlSeconds: params.ttlSeconds,\r\n  })\r\n}\r\n\r\nexport async function releaseRunLock(env: LockEnv, params: { key: string; owner?: string }): Promise<LockResponse> {\r\n  return callLock(env, params.key, {\r\n    action: 'release',\r\n    owner: params.owner,\r\n  })\r\n}\r\n\r\nexport async function getRunLockStatus(env: LockEnv, key: string): Promise<LockResponse> {\r\n  return callLock(env, key, { action: 'status' })\r\n}", "const APP_CONFIG_TABLE = 'app_config'\r\n\r\n/** Get a single app_config value by key. Returns null if missing. */\r\nexport async function getAppConfig(db: D1Database, key: string): Promise<string | null> {\r\n  const row = await db\r\n    .prepare(`SELECT value FROM ${APP_CONFIG_TABLE} WHERE key = ?`)\r\n    .bind(key)\r\n    .first<{ value: string }>()\r\n  return row?.value ?? null\r\n}\r\n\r\n/** Set (upsert) a single app_config value. */\r\nexport async function setAppConfig(db: D1Database, key: string, value: string): Promise<void> {\r\n  const now = new Date().toISOString()\r\n  await db\r\n    .prepare(\r\n      `INSERT INTO ${APP_CONFIG_TABLE} (key, value, updated_at) VALUES (?, ?, ?)\r\n       ON CONFLICT(key) DO UPDATE SET value = excluded.value, updated_at = excluded.updated_at`,\r\n    )\r\n    .bind(key, value, now)\r\n    .run()\r\n}\r\n", "import type { FeatureSet, LvrTier, RateStructure, RepaymentType, RunSource, SecurityPurpose } from '../types'\r\n\r\nexport type NormalizedRateRow = {\r\n  bankName: string\r\n  collectionDate: string\r\n  productId: string\r\n  productName: string\r\n  securityPurpose: SecurityPurpose\r\n  repaymentType: RepaymentType\r\n  rateStructure: RateStructure\r\n  lvrTier: LvrTier\r\n  featureSet: FeatureSet\r\n  interestRate: number\r\n  comparisonRate: number | null\r\n  annualFee: number | null\r\n  sourceUrl: string\r\n  dataQualityFlag: string\r\n  confidenceScore: number\r\n  runId?: string\r\n  runSource?: RunSource\r\n}\r\n\r\nexport const MIN_RATE_PERCENT = 0.5\r\nexport const MAX_RATE_PERCENT = 25\r\nexport const MIN_COMPARISON_RATE_PERCENT = 0.5\r\nexport const MAX_COMPARISON_RATE_PERCENT = 30\r\nexport const MAX_ANNUAL_FEE = 10000\r\n\r\nfunction asText(value: unknown): string {\r\n  if (value == null) {\r\n    return ''\r\n  }\r\n  return String(value).trim()\r\n}\r\n\r\nfunction lower(value: unknown): string {\r\n  return asText(value).toLowerCase()\r\n}\r\n\r\nfunction parseSingleNumberToken(value: unknown): number | null {\r\n  if (value == null || value === '') {\r\n    return null\r\n  }\r\n  if (typeof value === 'number') {\r\n    return Number.isFinite(value) ? value : null\r\n  }\r\n  const text = String(value)\r\n  const matches = text.match(/-?\\d+(?:\\.\\d+)?/g) ?? []\r\n  if (matches.length !== 1) {\r\n    return null\r\n  }\r\n  const n = Number(matches[0])\r\n  return Number.isFinite(n) ? n : null\r\n}\r\n\r\nfunction normalizePercentValue(value: unknown): number | null {\r\n  const n = parseSingleNumberToken(value)\r\n  if (n == null) return null\r\n\r\n  const text = String(value ?? '')\r\n  const hasPercent = text.includes('%')\r\n\r\n  // CDR commonly uses decimal fractions such as 0.0594 for 5.94%.\r\n  if (!hasPercent && n > 0 && n < 1) {\r\n    return Number((n * 100).toFixed(4))\r\n  }\r\n\r\n  return n\r\n}\r\n\r\nfunction parseYears(text: string): number | null {\r\n  const m = text.match(/([1-5])\\s*(?:year|yr)/i)\r\n  if (!m) {\r\n    return null\r\n  }\r\n  const years = Number(m[1])\r\n  return Number.isFinite(years) ? years : null\r\n}\r\n\r\nexport function normalizeBankName(input: string, fallback: string): string {\r\n  const v = asText(input)\r\n  return v || fallback\r\n}\r\n\r\nexport function normalizeProductName(input: string): string {\r\n  return asText(input).replace(/\\s+/g, ' ').trim()\r\n}\r\n\r\nexport function normalizeSecurityPurpose(text: string): SecurityPurpose {\r\n  const t = lower(text)\r\n  if (t.includes('invest')) {\r\n    return 'investment'\r\n  }\r\n  return 'owner_occupied'\r\n}\r\n\r\nexport function normalizeRepaymentType(text: string): RepaymentType {\r\n  const t = lower(text)\r\n  if (\r\n    t.includes('interest only') ||\r\n    t.includes('interest_only') ||\r\n    t.includes('interestonly') ||\r\n    /\\binterest[_\\s]*only[_\\s]*(?:fixed|variable)?\\b/.test(t)\r\n  ) {\r\n    return 'interest_only'\r\n  }\r\n  return 'principal_and_interest'\r\n}\r\n\r\nexport function normalizeRateStructure(input: string): RateStructure {\r\n  const t = lower(input)\r\n  if (t.includes('variable')) {\r\n    return 'variable'\r\n  }\r\n  if (t.includes('fixed')) {\r\n    const years = parseYears(t)\r\n    if (years === 1) return 'fixed_1yr'\r\n    if (years === 2) return 'fixed_2yr'\r\n    if (years === 3) return 'fixed_3yr'\r\n    if (years === 4) return 'fixed_4yr'\r\n    if (years === 5) return 'fixed_5yr'\r\n    return 'fixed_1yr'\r\n  }\r\n  return 'variable'\r\n}\r\n\r\nfunction tierForBoundary(percent: number): LvrTier {\r\n  if (percent <= 60) return 'lvr_=60%'\r\n  if (percent <= 70) return 'lvr_60-70%'\r\n  if (percent <= 80) return 'lvr_70-80%'\r\n  if (percent <= 85) return 'lvr_80-85%'\r\n  if (percent <= 90) return 'lvr_85-90%'\r\n  return 'lvr_90-95%'\r\n}\r\n\r\nexport type LvrTierResult = { tier: LvrTier; wasDefault: boolean }\r\n\r\nexport function normalizeLvrTier(text: string, minLvr?: number | null, maxLvr?: number | null): LvrTierResult {\r\n  if (Number.isFinite(minLvr as number) || Number.isFinite(maxLvr as number)) {\r\n    const hi = Number.isFinite(maxLvr as number) ? (maxLvr as number) : (minLvr as number)\r\n    return { tier: tierForBoundary(hi), wasDefault: false }\r\n  }\r\n\r\n  const t = lower(text)\r\n  const range = t.match(/(\\d{1,2}(?:\\.\\d+)?)\\s*(?:-|to)\\s*(\\d{1,2}(?:\\.\\d+)?)\\s*%/)\r\n  if (range) {\r\n    const hi = Number(range[2])\r\n    if (Number.isFinite(hi)) {\r\n      return { tier: tierForBoundary(hi), wasDefault: false }\r\n    }\r\n  }\r\n\r\n  const le = t.match(/(?:<=|\u2264|under|up to|maximum|max)\\s*(\\d{1,2}(?:\\.\\d+)?)\\s*%/)\r\n  if (le) {\r\n    const hi = Number(le[1])\r\n    if (Number.isFinite(hi)) {\r\n      return { tier: tierForBoundary(hi), wasDefault: false }\r\n    }\r\n  }\r\n\r\n  const anyPercent = t.match(/(\\d{1,2}(?:\\.\\d+)?)\\s*%/)\r\n  if (anyPercent) {\r\n    const hi = Number(anyPercent[1])\r\n    if (Number.isFinite(hi)) {\r\n      return { tier: tierForBoundary(hi), wasDefault: false }\r\n    }\r\n  }\r\n\r\n  return { tier: 'lvr_80-85%', wasDefault: true }\r\n}\r\n\r\nexport function normalizeFeatureSet(text: string, annualFee: number | null): FeatureSet {\r\n  const t = lower(text)\r\n  if (\r\n    t.includes('package') ||\r\n    t.includes('advantage') ||\r\n    t.includes('premium') ||\r\n    t.includes('offset') ||\r\n    (annualFee != null && annualFee > 0)\r\n  ) {\r\n    return 'premium'\r\n  }\r\n  return 'basic'\r\n}\r\n\r\nexport function parseInterestRate(value: unknown): number | null {\r\n  const text = lower(value)\r\n  if (text.includes('lvr') || text.includes('loan to value') || text.includes('ltv')) {\r\n    return null\r\n  }\r\n  const rate = normalizePercentValue(value)\r\n  if (rate == null) return null\r\n  if (rate < MIN_RATE_PERCENT || rate > MAX_RATE_PERCENT) return null\r\n  return rate\r\n}\r\n\r\nexport function parseComparisonRate(value: unknown): number | null {\r\n  const text = lower(value)\r\n  if (text.includes('lvr') || text.includes('loan to value') || text.includes('ltv')) {\r\n    return null\r\n  }\r\n  const rate = normalizePercentValue(value)\r\n  if (rate == null) return null\r\n  if (rate < MIN_COMPARISON_RATE_PERCENT || rate > MAX_COMPARISON_RATE_PERCENT) return null\r\n  return rate\r\n}\r\n\r\nexport function parseAnnualFee(value: unknown): number | null {\r\n  const n = parseSingleNumberToken(value)\r\n  if (n == null) return null\r\n  if (n < 0 || n > MAX_ANNUAL_FEE) return null\r\n  return n\r\n}\r\n\r\nexport function minConfidenceForFlag(flag: string): number {\r\n  const f = lower(flag)\r\n  if (f.startsWith('cdr_')) return 0.9\r\n  if (f.startsWith('parsed_from_wayback')) return 0.82\r\n  if (f.startsWith('scraped_fallback')) return 0.95\r\n  return 0.85\r\n}\r\n\r\nexport function isProductNameLikelyRateProduct(name: string): boolean {\r\n  const normalized = lower(name)\r\n  if (normalized.length < 6) return false\r\n  const blocked = [\r\n    'disclaimer',\r\n    'warning',\r\n    'example',\r\n    'cashback',\r\n    'copyright',\r\n    'privacy',\r\n    'terms and conditions',\r\n    'loan to value ratio',\r\n    'lvr ',\r\n    'tooltip',\r\n  ]\r\n  if (blocked.some((x) => normalized.includes(x))) return false\r\n\r\n  const helpfulTokens = ['home', 'loan', 'variable', 'fixed', 'owner', 'invest', 'rate', 'offset', 'package']\r\n  return helpfulTokens.some((x) => normalized.includes(x))\r\n}\r\n\r\nexport function validateNormalizedRow(row: NormalizedRateRow): { ok: true } | { ok: false; reason: string } {\r\n  const productName = normalizeProductName(row.productName)\r\n  if (!productName) {\r\n    return { ok: false, reason: 'missing_product_name' }\r\n  }\r\n  if (!isProductNameLikelyRateProduct(productName)) {\r\n    return { ok: false, reason: 'product_name_not_rate_like' }\r\n  }\r\n  if (!row.productId || !row.productId.trim()) {\r\n    return { ok: false, reason: 'missing_product_id' }\r\n  }\r\n  if (!row.sourceUrl || !row.sourceUrl.trim()) {\r\n    return { ok: false, reason: 'missing_source_url' }\r\n  }\r\n  if (!Number.isFinite(row.interestRate) || row.interestRate < MIN_RATE_PERCENT || row.interestRate > MAX_RATE_PERCENT) {\r\n    return { ok: false, reason: 'interest_rate_out_of_bounds' }\r\n  }\r\n  if (\r\n    row.comparisonRate != null &&\r\n    (!Number.isFinite(row.comparisonRate) ||\r\n      row.comparisonRate < MIN_COMPARISON_RATE_PERCENT ||\r\n      row.comparisonRate > MAX_COMPARISON_RATE_PERCENT)\r\n  ) {\r\n    return { ok: false, reason: 'comparison_rate_out_of_bounds' }\r\n  }\r\n  if (row.comparisonRate != null && row.comparisonRate + 0.01 < row.interestRate) {\r\n    return { ok: false, reason: 'comparison_rate_below_interest_rate' }\r\n  }\r\n  if (row.annualFee != null && (!Number.isFinite(row.annualFee) || row.annualFee < 0 || row.annualFee > MAX_ANNUAL_FEE)) {\r\n    return { ok: false, reason: 'annual_fee_out_of_bounds' }\r\n  }\r\n  const minConfidence = minConfidenceForFlag(row.dataQualityFlag)\r\n  if (!Number.isFinite(row.confidenceScore) || row.confidenceScore < minConfidence || row.confidenceScore > 1) {\r\n    return { ok: false, reason: 'confidence_out_of_bounds' }\r\n  }\r\n\r\n  return { ok: true }\r\n}\r\n", "import type { LenderConfig } from '../types'\r\n\r\nexport type LenderPlaybook = {\r\n  code: string\r\n  cdrVersions: number[]\r\n  minRatePercent: number\r\n  maxRatePercent: number\r\n  dailyMinConfidence: number\r\n  historicalMinConfidence: number\r\n  includeKeywords: string[]\r\n  excludeKeywords: string[]\r\n}\r\n\r\nconst COMMON_INCLUDE = ['home', 'loan', 'fixed', 'variable', 'owner', 'invest']\r\nconst COMMON_EXCLUDE = [\r\n  'disclaimer',\r\n  'warning',\r\n  'tooltip',\r\n  'cashback',\r\n  'lvr',\r\n  'loan to value',\r\n  'terms and conditions',\r\n  'privacy',\r\n  'copyright',\r\n  'example',\r\n]\r\n\r\nconst PLAYBOOKS: Record<string, LenderPlaybook> = {\r\n  cba: {\r\n    code: 'cba',\r\n    cdrVersions: [3, 4, 5, 6, 2, 1],\r\n    minRatePercent: 0.5,\r\n    maxRatePercent: 20,\r\n    dailyMinConfidence: 0.92,\r\n    historicalMinConfidence: 0.84,\r\n    includeKeywords: [...COMMON_INCLUDE, 'commbank'],\r\n    excludeKeywords: COMMON_EXCLUDE,\r\n  },\r\n  westpac: {\r\n    code: 'westpac',\r\n    cdrVersions: [3, 4, 5, 6, 2, 1],\r\n    minRatePercent: 0.5,\r\n    maxRatePercent: 20,\r\n    dailyMinConfidence: 0.92,\r\n    historicalMinConfidence: 0.84,\r\n    includeKeywords: [...COMMON_INCLUDE, 'westpac', 'rocket', 'flexi'],\r\n    excludeKeywords: COMMON_EXCLUDE,\r\n  },\r\n  nab: {\r\n    code: 'nab',\r\n    cdrVersions: [3, 4, 5, 6, 2, 1],\r\n    minRatePercent: 0.5,\r\n    maxRatePercent: 20,\r\n    dailyMinConfidence: 0.92,\r\n    historicalMinConfidence: 0.84,\r\n    includeKeywords: [...COMMON_INCLUDE, 'nab'],\r\n    excludeKeywords: COMMON_EXCLUDE,\r\n  },\r\n  anz: {\r\n    code: 'anz',\r\n    cdrVersions: [3, 4, 5, 6, 2, 1],\r\n    minRatePercent: 0.5,\r\n    maxRatePercent: 20,\r\n    dailyMinConfidence: 0.93,\r\n    historicalMinConfidence: 0.85,\r\n    includeKeywords: [...COMMON_INCLUDE, 'anz'],\r\n    excludeKeywords: [...COMMON_EXCLUDE, 'estimated'],\r\n  },\r\n  macquarie: {\r\n    code: 'macquarie',\r\n    cdrVersions: [3, 4, 5, 6, 2, 1],\r\n    minRatePercent: 0.5,\r\n    maxRatePercent: 20,\r\n    dailyMinConfidence: 0.92,\r\n    historicalMinConfidence: 0.84,\r\n    includeKeywords: [...COMMON_INCLUDE, 'macquarie'],\r\n    excludeKeywords: COMMON_EXCLUDE,\r\n  },\r\n  bendigo_adelaide: {\r\n    code: 'bendigo_adelaide',\r\n    cdrVersions: [3, 4, 5, 6, 2, 1],\r\n    minRatePercent: 0.5,\r\n    maxRatePercent: 20,\r\n    dailyMinConfidence: 0.92,\r\n    historicalMinConfidence: 0.84,\r\n    includeKeywords: [...COMMON_INCLUDE, 'bendigo', 'adelaide'],\r\n    excludeKeywords: COMMON_EXCLUDE,\r\n  },\r\n  suncorp: {\r\n    code: 'suncorp',\r\n    cdrVersions: [3, 4, 5, 6, 2, 1],\r\n    minRatePercent: 0.5,\r\n    maxRatePercent: 20,\r\n    dailyMinConfidence: 0.92,\r\n    historicalMinConfidence: 0.84,\r\n    includeKeywords: [...COMMON_INCLUDE, 'suncorp'],\r\n    excludeKeywords: COMMON_EXCLUDE,\r\n  },\r\n  bankwest: {\r\n    code: 'bankwest',\r\n    cdrVersions: [3, 4, 5, 6, 2, 1],\r\n    minRatePercent: 0.5,\r\n    maxRatePercent: 20,\r\n    dailyMinConfidence: 0.92,\r\n    historicalMinConfidence: 0.84,\r\n    includeKeywords: [...COMMON_INCLUDE, 'bankwest'],\r\n    excludeKeywords: COMMON_EXCLUDE,\r\n  },\r\n  ing: {\r\n    code: 'ing',\r\n    cdrVersions: [3, 4, 5, 6, 2, 1],\r\n    minRatePercent: 0.5,\r\n    maxRatePercent: 20,\r\n    dailyMinConfidence: 0.92,\r\n    historicalMinConfidence: 0.84,\r\n    includeKeywords: [...COMMON_INCLUDE, 'ing'],\r\n    excludeKeywords: COMMON_EXCLUDE,\r\n  },\r\n  amp: {\r\n    code: 'amp',\r\n    cdrVersions: [3, 4, 5, 6, 2, 1],\r\n    minRatePercent: 0.5,\r\n    maxRatePercent: 20,\r\n    dailyMinConfidence: 0.92,\r\n    historicalMinConfidence: 0.84,\r\n    includeKeywords: [...COMMON_INCLUDE, 'amp'],\r\n    excludeKeywords: COMMON_EXCLUDE,\r\n  },\r\n  hsbc: {\r\n    code: 'hsbc',\r\n    cdrVersions: [3, 4, 5, 6, 2, 1],\r\n    minRatePercent: 0.5,\r\n    maxRatePercent: 20,\r\n    dailyMinConfidence: 0.92,\r\n    historicalMinConfidence: 0.84,\r\n    includeKeywords: [...COMMON_INCLUDE, 'hsbc'],\r\n    excludeKeywords: COMMON_EXCLUDE,\r\n  },\r\n  ubank: {\r\n    code: 'ubank',\r\n    cdrVersions: [3, 4, 5, 6, 2, 1],\r\n    minRatePercent: 0.5,\r\n    maxRatePercent: 20,\r\n    dailyMinConfidence: 0.92,\r\n    historicalMinConfidence: 0.84,\r\n    includeKeywords: [...COMMON_INCLUDE, 'ubank', '86400'],\r\n    excludeKeywords: COMMON_EXCLUDE,\r\n  },\r\n  stgeorge: {\r\n    code: 'stgeorge',\r\n    cdrVersions: [3, 4, 5, 6, 2, 1],\r\n    minRatePercent: 0.5,\r\n    maxRatePercent: 20,\r\n    dailyMinConfidence: 0.92,\r\n    historicalMinConfidence: 0.84,\r\n    includeKeywords: [...COMMON_INCLUDE, 'st george', 'st.george'],\r\n    excludeKeywords: COMMON_EXCLUDE,\r\n  },\r\n  bankofmelbourne: {\r\n    code: 'bankofmelbourne',\r\n    cdrVersions: [3, 4, 5, 6, 2, 1],\r\n    minRatePercent: 0.5,\r\n    maxRatePercent: 20,\r\n    dailyMinConfidence: 0.92,\r\n    historicalMinConfidence: 0.84,\r\n    includeKeywords: [...COMMON_INCLUDE, 'bank of melbourne'],\r\n    excludeKeywords: COMMON_EXCLUDE,\r\n  },\r\n  boq: {\r\n    code: 'boq',\r\n    cdrVersions: [3, 4, 5, 6, 2, 1],\r\n    minRatePercent: 0.5,\r\n    maxRatePercent: 20,\r\n    dailyMinConfidence: 0.92,\r\n    historicalMinConfidence: 0.84,\r\n    includeKeywords: [...COMMON_INCLUDE, 'boq', 'queensland'],\r\n    excludeKeywords: COMMON_EXCLUDE,\r\n  },\r\n  great_southern: {\r\n    code: 'great_southern',\r\n    cdrVersions: [3, 4, 5, 6, 2, 1],\r\n    minRatePercent: 0.5,\r\n    maxRatePercent: 20,\r\n    dailyMinConfidence: 0.92,\r\n    historicalMinConfidence: 0.84,\r\n    includeKeywords: [...COMMON_INCLUDE, 'great southern'],\r\n    excludeKeywords: COMMON_EXCLUDE,\r\n  },\r\n}\r\n\r\nconst DEFAULT_PLAYBOOK: LenderPlaybook = {\r\n  code: 'default',\r\n  cdrVersions: [3, 4, 5, 6, 2, 1],\r\n  minRatePercent: 0.5,\r\n  maxRatePercent: 20,\r\n  dailyMinConfidence: 0.92,\r\n  historicalMinConfidence: 0.84,\r\n  includeKeywords: COMMON_INCLUDE,\r\n  excludeKeywords: COMMON_EXCLUDE,\r\n}\r\n\r\nexport function getLenderPlaybook(lender: Pick<LenderConfig, 'code'>): LenderPlaybook {\r\n  return PLAYBOOKS[lender.code] || DEFAULT_PLAYBOOK\r\n}\r\n", "import {\r\n  normalizeBankName,\r\n  normalizeFeatureSet,\r\n  normalizeLvrTier,\r\n  normalizeProductName,\r\n  normalizeRateStructure,\r\n  normalizeRepaymentType,\r\n  normalizeSecurityPurpose,\r\n  parseAnnualFee,\r\n  parseComparisonRate,\r\n  parseInterestRate,\r\n  isProductNameLikelyRateProduct,\r\n  type NormalizedRateRow,\r\n} from './normalize'\r\nimport { getLenderPlaybook } from './lender-playbooks'\r\nimport type { LenderConfig } from '../types'\r\nimport { nowIso } from '../utils/time'\r\n\r\nexport type JsonRecord = Record<string, unknown>\r\n\r\ntype FetchJsonResult = {\r\n  ok: boolean\r\n  status: number\r\n  url: string\r\n  data: unknown\r\n  text: string\r\n}\r\n\r\nexport function isRecord(v: unknown): v is JsonRecord {\r\n  return !!v && typeof v === 'object' && !Array.isArray(v)\r\n}\r\n\r\nexport function asArray<T = unknown>(v: unknown): T[] {\r\n  return Array.isArray(v) ? (v as T[]) : []\r\n}\r\n\r\nexport function getText(v: unknown): string {\r\n  if (v == null) return ''\r\n  return String(v).trim()\r\n}\r\n\r\nexport function pickText(obj: JsonRecord, keys: string[]): string {\r\n  for (const key of keys) {\r\n    const v = obj[key]\r\n    const text = getText(v)\r\n    if (text) return text\r\n  }\r\n  return ''\r\n}\r\n\r\nfunction safeUrl(value: string): string {\r\n  return value.replace(/\\/+$/, '')\r\n}\r\n\r\nasync function fetchTextWithRetries(\r\n  url: string,\r\n  retries = 2,\r\n  headers: Record<string, string> = { accept: 'application/json' },\r\n): Promise<{ ok: boolean; status: number; text: string }> {\r\n  let lastStatus = 0\r\n  let lastText = ''\r\n  for (let i = 0; i <= retries; i += 1) {\r\n    try {\r\n      const res = await fetch(url, {\r\n        headers,\r\n      })\r\n      const text = await res.text()\r\n      lastStatus = res.status\r\n      lastText = text\r\n      if (res.ok) {\r\n        return { ok: true, status: res.status, text }\r\n      }\r\n    } catch (error) {\r\n      lastText = (error as Error)?.message || String(error)\r\n    }\r\n  }\r\n  return { ok: false, status: lastStatus || 500, text: lastText }\r\n}\r\n\r\nfunction parseJsonSafe(text: string): unknown {\r\n  try {\r\n    return JSON.parse(text)\r\n  } catch {\r\n    return null\r\n  }\r\n}\r\n\r\nexport async function fetchJson(url: string): Promise<FetchJsonResult> {\r\n  const response = await fetchTextWithRetries(url, 2, { accept: 'application/json' })\r\n  const data = parseJsonSafe(response.text)\r\n  return {\r\n    ok: response.ok && data != null,\r\n    status: response.status,\r\n    url,\r\n    data,\r\n    text: response.text,\r\n  }\r\n}\r\n\r\nfunction parseSupportedVersions(body: string): number[] {\r\n  const m = body.match(/Versions available:\\s*([0-9,\\s]+)/i)\r\n  if (!m) return []\r\n  return m[1]\r\n    .split(',')\r\n    .map((x) => Number(x.trim()))\r\n    .filter((x) => Number.isFinite(x))\r\n}\r\n\r\nexport async function fetchCdrJson(url: string, versions: number[]): Promise<FetchJsonResult> {\r\n  const tried = new Set<number>()\r\n  const queue = [...versions]\r\n  while (queue.length > 0) {\r\n    const version = Number(queue.shift())\r\n    if (!Number.isFinite(version) || tried.has(version)) continue\r\n    tried.add(version)\r\n\r\n    try {\r\n      const res = await fetch(url, {\r\n        headers: {\r\n          accept: 'application/json',\r\n          'x-v': String(version),\r\n          'x-min-v': '1',\r\n        },\r\n      })\r\n      const text = await res.text()\r\n      const data = parseJsonSafe(text)\r\n      if (res.ok && data != null) {\r\n        return {\r\n          ok: true,\r\n          status: res.status,\r\n          url,\r\n          data,\r\n          text,\r\n        }\r\n      }\r\n      if (res.status === 406) {\r\n        const advertised = parseSupportedVersions(text)\r\n        for (const x of advertised) {\r\n          if (!tried.has(x)) queue.push(x)\r\n        }\r\n      }\r\n    } catch {\r\n      // keep trying alternate versions\r\n    }\r\n  }\r\n\r\n  for (const fallbackVersion of [1, 2, 3, 4, 5, 6]) {\r\n    if (tried.has(fallbackVersion)) continue\r\n    try {\r\n      const res = await fetch(url, {\r\n        headers: {\r\n          accept: 'application/json',\r\n          'x-v': String(fallbackVersion),\r\n          'x-min-v': '1',\r\n        },\r\n      })\r\n      const text = await res.text()\r\n      const data = parseJsonSafe(text)\r\n      if (res.ok && data != null) {\r\n        return {\r\n          ok: true,\r\n          status: res.status,\r\n          url,\r\n          data,\r\n          text,\r\n        }\r\n      }\r\n    } catch {\r\n      // continue\r\n    }\r\n  }\r\n\r\n  return fetchJson(url)\r\n}\r\n\r\ntype RegisterBrand = {\r\n  brandName: string\r\n  legalEntityName: string\r\n  endpointUrl: string\r\n}\r\n\r\nfunction extractBrands(payload: unknown): RegisterBrand[] {\r\n  const out: RegisterBrand[] = []\r\n  const dataArray = isRecord(payload) ? asArray((payload as JsonRecord).data) : asArray(payload)\r\n  for (const item of dataArray) {\r\n    if (!isRecord(item)) continue\r\n    const brandName = pickText(item, ['brandName', 'dataHolderBrandName'])\r\n    const legalEntityName = isRecord(item.legalEntity) ? pickText(item.legalEntity as JsonRecord, ['legalEntityName']) : ''\r\n    const endpointDetail = isRecord(item.endpointDetail) ? (item.endpointDetail as JsonRecord) : {}\r\n    const endpointUrlRaw =\r\n      pickText(endpointDetail, ['productReferenceDataApi']) ||\r\n      pickText(endpointDetail, ['publicBaseUri']) ||\r\n      pickText(endpointDetail, ['resourceBaseUri']) ||\r\n      pickText(item, ['publicBaseUri']) ||\r\n      pickText(item, ['resourceBaseUri'])\r\n    if (!endpointUrlRaw) continue\r\n    const endpointUrl = endpointUrlRaw.includes('/cds-au/v1/banking/products')\r\n      ? endpointUrlRaw\r\n      : `${safeUrl(endpointUrlRaw)}/cds-au/v1/banking/products`\r\n    out.push({\r\n      brandName,\r\n      legalEntityName,\r\n      endpointUrl,\r\n    })\r\n  }\r\n  return out\r\n}\r\n\r\nfunction lenderMatchesBrand(lender: LenderConfig, brand: RegisterBrand): boolean {\r\n  const haystack = `${brand.brandName} ${brand.legalEntityName}`.toLowerCase()\r\n  const needles = [lender.register_brand_name, lender.canonical_bank_name, lender.name]\r\n  for (const needle of needles) {\r\n    const n = getText(needle).toLowerCase()\r\n    if (n && haystack.includes(n)) {\r\n      return true\r\n    }\r\n  }\r\n  return false\r\n}\r\n\r\nexport async function discoverProductsEndpoint(\r\n  lender: LenderConfig,\r\n): Promise<{ endpointUrl: string; sourceUrl: string; status: number; notes: string } | null> {\r\n  const registerUrls = [\r\n    'https://api.cdr.gov.au/cdr-register/v1/all/data-holders/brands/summary',\r\n    'https://api.cdr.gov.au/cdr-register/v1/banking/data-holders/brands',\r\n    'https://api.cdr.gov.au/cdr-register/v1/banking/register',\r\n  ]\r\n\r\n  for (const registerUrl of registerUrls) {\r\n    const fetched = registerUrl.includes('/all/data-holders/brands/summary')\r\n      ? await fetchCdrJson(registerUrl, [1, 2, 3, 4, 5, 6])\r\n      : await fetchJson(registerUrl)\r\n    if (!fetched.ok) {\r\n      continue\r\n    }\r\n    const brands = extractBrands(fetched.data)\r\n    const hit = brands.find((brand) => lenderMatchesBrand(lender, brand))\r\n    if (hit) {\r\n      return {\r\n        endpointUrl: hit.endpointUrl,\r\n        sourceUrl: registerUrl,\r\n        status: fetched.status,\r\n        notes: `matched_brand:${hit.brandName || lender.name}`,\r\n      }\r\n    }\r\n  }\r\n\r\n  if (lender.products_endpoint) {\r\n    return {\r\n      endpointUrl: lender.products_endpoint,\r\n      sourceUrl: 'lenders.json',\r\n      status: 200,\r\n      notes: 'configured_products_endpoint',\r\n    }\r\n  }\r\n\r\n  return null\r\n}\r\n\r\nexport function extractProducts(payload: unknown): JsonRecord[] {\r\n  if (!isRecord(payload)) return []\r\n  const data = isRecord(payload.data) ? asArray((payload.data as JsonRecord).products) : asArray(payload.data)\r\n  return data.filter(isRecord)\r\n}\r\n\r\nexport function nextLink(payload: unknown): string | null {\r\n  if (!isRecord(payload)) return null\r\n  const links = isRecord(payload.links) ? (payload.links as JsonRecord) : null\r\n  const next = links ? getText(links.next) : ''\r\n  return next || null\r\n}\r\n\r\nfunction isResidentialMortgage(product: JsonRecord): boolean {\r\n  const category = pickText(product, ['productCategory', 'category', 'type']).toUpperCase()\r\n  const name = pickText(product, ['name', 'productName']).toUpperCase()\r\n  return category.includes('MORTGAGE') || name.includes('MORTGAGE') || name.includes('HOME LOAN')\r\n}\r\n\r\nfunction extractRatesArray(detail: JsonRecord): JsonRecord[] {\r\n  const arrays = [detail.lendingRates, detail.rates, detail.rateTiers, detail.rate]\r\n  for (const candidate of arrays) {\r\n    const arr = asArray(candidate).filter(isRecord)\r\n    if (arr.length > 0) return arr\r\n  }\r\n  return []\r\n}\r\n\r\nfunction collectConstraintText(rate: JsonRecord, detail: JsonRecord): string {\r\n  const fromRate = [pickText(rate, ['additionalInfo', 'additionalValue', 'name', 'lendingRateType'])]\r\n  const constraints = asArray(rate.constraints).filter(isRecord)\r\n  for (const c of constraints) {\r\n    fromRate.push(JSON.stringify(c))\r\n  }\r\n  const detailHints = [pickText(detail, ['description', 'name', 'productName'])]\r\n  return [...fromRate, ...detailHints].filter(Boolean).join(' | ')\r\n}\r\n\r\nfunction parseLvrFromText(text: string): { min: number | null; max: number | null } | null {\r\n  const t = text.toLowerCase()\r\n  if (!t.includes('lvr') && !t.includes('loan to value') && !t.includes('ltv')) return null\r\n\r\n  const range = t.match(/(\\d{1,3}(?:\\.\\d+)?)\\s*(?:%\\s*)?(?:-|to)\\s*(\\d{1,3}(?:\\.\\d+)?)\\s*%?/)\r\n  if (range) {\r\n    const lo = Number(range[1])\r\n    const hi = Number(range[2])\r\n    if (Number.isFinite(lo) && Number.isFinite(hi)) return { min: lo, max: hi }\r\n  }\r\n\r\n  const le = t.match(/(?:<=|\u2264|under|up to|maximum|max|below)\\s*(\\d{1,3}(?:\\.\\d+)?)\\s*%?/)\r\n  if (le) {\r\n    const hi = Number(le[1])\r\n    if (Number.isFinite(hi)) return { min: null, max: hi }\r\n  }\r\n\r\n  const ge = t.match(/(?:>=|\u2265|over|above|from|greater than)\\s*(\\d{1,3}(?:\\.\\d+)?)\\s*%?/)\r\n  if (ge) {\r\n    const lo = Number(ge[1])\r\n    if (Number.isFinite(lo)) return { min: lo, max: null }\r\n  }\r\n\r\n  const single = t.match(/(\\d{1,3}(?:\\.\\d+)?)\\s*%/)\r\n  if (single) {\r\n    const n = Number(single[1])\r\n    if (Number.isFinite(n) && n <= 100) return { min: null, max: n }\r\n  }\r\n\r\n  return null\r\n}\r\n\r\nfunction parseLvrBounds(rate: JsonRecord): { min: number | null; max: number | null } {\r\n  const constraints = asArray(rate.constraints).filter(isRecord)\r\n  for (const c of constraints) {\r\n    const t = pickText(c, ['constraintType']).toLowerCase()\r\n    if (!t.includes('lvr')) continue\r\n    const min = Number.isFinite(Number(c.minValue)) ? Number(c.minValue) : null\r\n    const max = Number.isFinite(Number(c.maxValue)) ? Number(c.maxValue) : null\r\n    if (min != null || max != null) return { min, max }\r\n  }\r\n\r\n  const tiers = asArray(rate.tiers).filter(isRecord)\r\n  for (const tier of tiers) {\r\n    const tierName = pickText(tier, ['name', 'unitOfMeasure', 'rateApplicationMethod']).toLowerCase()\r\n    if (!tierName.includes('lvr') && !tierName.includes('loan to value')) continue\r\n    const min = Number.isFinite(Number(tier.minimumValue)) ? Number(tier.minimumValue) : null\r\n    const max = Number.isFinite(Number(tier.maximumValue)) ? Number(tier.maximumValue) : null\r\n    if (min != null || max != null) return { min, max }\r\n  }\r\n\r\n  const additionalValue = getText(rate.additionalValue)\r\n  if (additionalValue) {\r\n    const fromAdditional = parseLvrFromText(additionalValue)\r\n    if (fromAdditional) return fromAdditional\r\n  }\r\n\r\n  const additionalInfo = getText(rate.additionalInfo)\r\n  if (additionalInfo) {\r\n    const fromInfo = parseLvrFromText(additionalInfo)\r\n    if (fromInfo) return fromInfo\r\n  }\r\n\r\n  return { min: null, max: null }\r\n}\r\n\r\nfunction parseAnnualFeeFromDetail(detail: JsonRecord): number | null {\r\n  const fees = asArray(detail.fees).filter(isRecord)\r\n  for (const fee of fees) {\r\n    const feeType = pickText(fee, ['feeType', 'name']).toLowerCase()\r\n    if (!feeType.includes('annual') && !feeType.includes('package')) {\r\n      continue\r\n    }\r\n    const fixedAmount = isRecord(fee.fixedAmount) ? fee.fixedAmount : null\r\n    const amount =\r\n      parseAnnualFee(fee.amount) ??\r\n      parseAnnualFee(fee.additionalValue) ??\r\n      parseAnnualFee(fixedAmount ? fixedAmount.amount : null)\r\n    if (amount != null) {\r\n      return amount\r\n    }\r\n  }\r\n  return null\r\n}\r\n\r\nfunction parseRatesFromDetail(input: {\r\n  lender: LenderConfig\r\n  detail: JsonRecord\r\n  sourceUrl: string\r\n  collectionDate: string\r\n}): NormalizedRateRow[] {\r\n  const detail = input.detail\r\n  const productId = pickText(detail, ['productId', 'id'])\r\n  const productName = normalizeProductName(pickText(detail, ['name', 'productName']))\r\n  if (!productId || !productName || !isProductNameLikelyRateProduct(productName)) {\r\n    return []\r\n  }\r\n  const rates = extractRatesArray(detail)\r\n  const annualFee = parseAnnualFeeFromDetail(detail)\r\n  const result: NormalizedRateRow[] = []\r\n  const playbook = getLenderPlaybook(input.lender)\r\n\r\n  for (const rate of rates) {\r\n    const rawInterestValue = rate.rate ?? rate.interestRate ?? rate.value\r\n    const interestRate = parseInterestRate(rawInterestValue)\r\n    if (interestRate == null) {\r\n      continue\r\n    }\r\n    if (interestRate < playbook.minRatePercent || interestRate > playbook.maxRatePercent) {\r\n      continue\r\n    }\r\n    const comparisonRate = parseComparisonRate(rate.comparisonRate ?? rate.comparison ?? rate.comparison_value)\r\n    const contextText = collectConstraintText(rate, detail)\r\n    const lvr = parseLvrBounds(rate)\r\n    const contextLower = contextText.toLowerCase()\r\n    if (playbook.excludeKeywords.some((x) => contextLower.includes(x))) {\r\n      continue\r\n    }\r\n\r\n    const lvrResult = normalizeLvrTier(contextText, lvr.min, lvr.max)\r\n\r\n    let confidence = 0.95\r\n    if (!comparisonRate) confidence -= 0.04\r\n    if (lvrResult.wasDefault) confidence -= 0.05\r\n    if (!contextLower.includes('loan')) confidence -= 0.02\r\n\r\n    const lendingRateType = pickText(rate, ['lendingRateType'])\r\n    const repaymentText = `${lendingRateType} ${pickText(rate, ['repaymentType'])} ${pickText(detail, ['repaymentType'])} ${contextText}`\r\n    const rateStructureText = `${lendingRateType} ${pickText(rate, ['name'])} ${pickText(detail, ['name'])} ${contextText}`\r\n\r\n    const rawPurpose = `${pickText(rate, ['loanPurpose'])} ${pickText(detail, ['loanPurpose'])}`.toLowerCase()\r\n    const isBothPurpose = rawPurpose.includes('both')\r\n    const purposes: Array<'owner_occupied' | 'investment'> = isBothPurpose\r\n      ? ['owner_occupied', 'investment']\r\n      : [normalizeSecurityPurpose(`${rawPurpose} ${contextText}`)]\r\n\r\n    for (const securityPurpose of purposes) {\r\n      const row: NormalizedRateRow = {\r\n        bankName: normalizeBankName(input.lender.canonical_bank_name, input.lender.name),\r\n        collectionDate: input.collectionDate,\r\n        productId,\r\n        productName,\r\n        securityPurpose,\r\n        repaymentType: normalizeRepaymentType(repaymentText),\r\n        rateStructure: normalizeRateStructure(rateStructureText),\r\n        lvrTier: lvrResult.tier,\r\n        featureSet: normalizeFeatureSet(`${productName} ${contextText}`, annualFee),\r\n        interestRate,\r\n        comparisonRate,\r\n        annualFee,\r\n        sourceUrl: input.sourceUrl,\r\n        dataQualityFlag: 'cdr_live',\r\n        confidenceScore: Number(Math.max(0.6, Math.min(0.99, confidence)).toFixed(3)),\r\n      }\r\n      result.push(row)\r\n    }\r\n  }\r\n\r\n  return result\r\n}\r\n\r\ntype ProductListFetchResult = {\r\n  productIds: string[]\r\n  rawPayloads: Array<{ sourceUrl: string; status: number; body: string }>\r\n}\r\n\r\nexport async function fetchResidentialMortgageProductIds(\r\n  endpointUrl: string,\r\n  pageLimit = 20,\r\n  options?: { cdrVersions?: number[] },\r\n): Promise<ProductListFetchResult> {\r\n  const ids = new Set<string>()\r\n  const payloads: Array<{ sourceUrl: string; status: number; body: string }> = []\r\n  let url: string | null = endpointUrl\r\n  let pages = 0\r\n  const versions = options?.cdrVersions && options.cdrVersions.length > 0 ? options.cdrVersions : [6, 5, 4, 3]\r\n\r\n  while (url && pages < pageLimit) {\r\n    pages += 1\r\n    const response = await fetchCdrJson(url, versions)\r\n    payloads.push({\r\n      sourceUrl: url,\r\n      status: response.status,\r\n      body: response.text,\r\n    })\r\n    if (!response.ok || !response.data) {\r\n      break\r\n    }\r\n\r\n    const products = extractProducts(response.data)\r\n    for (const product of products) {\r\n      if (!isResidentialMortgage(product)) continue\r\n      const id = pickText(product, ['productId', 'id'])\r\n      if (id) ids.add(id)\r\n    }\r\n    url = nextLink(response.data)\r\n  }\r\n\r\n  return {\r\n    productIds: Array.from(ids),\r\n    rawPayloads: payloads,\r\n  }\r\n}\r\n\r\nexport async function fetchProductDetailRows(input: {\r\n  lender: LenderConfig\r\n  endpointUrl: string\r\n  productId: string\r\n  collectionDate: string\r\n  cdrVersions?: number[]\r\n}): Promise<{ rows: NormalizedRateRow[]; rawPayload: { sourceUrl: string; status: number; body: string } }> {\r\n  const detailUrl = `${safeUrl(input.endpointUrl)}/${encodeURIComponent(input.productId)}`\r\n  const versions = input.cdrVersions && input.cdrVersions.length > 0 ? input.cdrVersions : [6, 5, 4, 3]\r\n  const fetched = await fetchCdrJson(detailUrl, versions)\r\n  const rawPayload = {\r\n    sourceUrl: detailUrl,\r\n    status: fetched.status,\r\n    body: fetched.text,\r\n  }\r\n\r\n  if (!fetched.ok || !isRecord(fetched.data)) {\r\n    return { rows: [], rawPayload }\r\n  }\r\n\r\n  const detail = isRecord((fetched.data as JsonRecord).data)\r\n    ? ((fetched.data as JsonRecord).data as JsonRecord)\r\n    : (fetched.data as JsonRecord)\r\n\r\n  return {\r\n    rows: parseRatesFromDetail({\r\n      lender: input.lender,\r\n      detail,\r\n      sourceUrl: detailUrl,\r\n      collectionDate: input.collectionDate,\r\n    }),\r\n    rawPayload,\r\n  }\r\n}\r\n\r\nexport function backfillSeedProductRows(input: {\r\n  lender: LenderConfig\r\n  collectionDate: string\r\n  sourceUrl: string\r\n  productName: string\r\n  rate: number\r\n}): NormalizedRateRow {\r\n  const productId = `${input.lender.code}-seed-${Math.abs(hashString(input.productName))}`\r\n  return {\r\n    bankName: normalizeBankName(input.lender.canonical_bank_name, input.lender.name),\r\n    collectionDate: input.collectionDate,\r\n    productId,\r\n    productName: input.productName,\r\n    securityPurpose: 'owner_occupied',\r\n    repaymentType: 'principal_and_interest',\r\n    rateStructure: 'variable',\r\n    lvrTier: 'lvr_80-85%',\r\n    featureSet: normalizeFeatureSet(input.productName, null),\r\n    interestRate: input.rate,\r\n    comparisonRate: null,\r\n    annualFee: null,\r\n    sourceUrl: input.sourceUrl,\r\n    dataQualityFlag: 'parsed_from_wayback',\r\n    confidenceScore: 0.6,\r\n  }\r\n}\r\n\r\nfunction hashString(input: string): number {\r\n  let h = 0\r\n  for (let i = 0; i < input.length; i += 1) {\r\n    h = (Math.imul(31, h) + input.charCodeAt(i)) | 0\r\n  }\r\n  return h\r\n}\r\n\r\nexport function buildBackfillCursorKey(lenderCode: string, monthCursor: string, seedUrl: string): string {\r\n  return `${lenderCode}|${monthCursor}|${seedUrl}`\r\n}\r\n\r\nexport function cdrCollectionNotes(productCount: number, rowCount: number): string {\r\n  return `cdr_collection products=${productCount} rows=${rowCount} at=${nowIso()}`\r\n}\r\n", "import { CDR_REGISTER_DISCOVERY_URL } from '../constants'\r\nimport { discoverProductsEndpoint } from '../ingest/cdr'\r\nimport type { LenderConfig } from '../types'\r\nimport { nowIso } from '../utils/time'\r\n\r\nexport async function getCachedEndpoint(\r\n  db: D1Database,\r\n  lenderCode: string,\r\n  now = nowIso(),\r\n): Promise<{ endpointUrl: string; expiresAt: string } | null> {\r\n  const row = await db\r\n    .prepare(\r\n      `SELECT endpoint_url, expires_at\r\n       FROM lender_endpoint_cache\r\n       WHERE lender_code = ?1\r\n       LIMIT 1`,\r\n    )\r\n    .bind(lenderCode)\r\n    .first<{ endpoint_url: string; expires_at: string }>()\r\n\r\n  if (!row) {\r\n    return null\r\n  }\r\n\r\n  if (row.expires_at <= now) {\r\n    return null\r\n  }\r\n\r\n  return {\r\n    endpointUrl: row.endpoint_url,\r\n    expiresAt: row.expires_at,\r\n  }\r\n}\r\n\r\nexport async function upsertEndpointCache(\r\n  db: D1Database,\r\n  input: {\r\n    lenderCode: string\r\n    endpointUrl: string\r\n    expiresAt: string\r\n    sourceUrl?: string\r\n    httpStatus?: number\r\n    notes?: string\r\n  },\r\n): Promise<void> {\r\n  await db\r\n    .prepare(\r\n      `INSERT INTO lender_endpoint_cache (\r\n         lender_code,\r\n         endpoint_url,\r\n         fetched_at,\r\n         expires_at,\r\n         source_url,\r\n         http_status,\r\n         notes\r\n       ) VALUES (?1, ?2, ?3, ?4, ?5, ?6, ?7)\r\n       ON CONFLICT(lender_code) DO UPDATE SET\r\n         endpoint_url = excluded.endpoint_url,\r\n         fetched_at = excluded.fetched_at,\r\n         expires_at = excluded.expires_at,\r\n         source_url = excluded.source_url,\r\n         http_status = excluded.http_status,\r\n         notes = excluded.notes`,\r\n    )\r\n    .bind(\r\n      input.lenderCode,\r\n      input.endpointUrl,\r\n      nowIso(),\r\n      input.expiresAt,\r\n      input.sourceUrl ?? null,\r\n      input.httpStatus ?? null,\r\n      input.notes ?? null,\r\n    )\r\n    .run()\r\n}\r\n\r\nexport async function refreshEndpointCache(\r\n  db: D1Database,\r\n  lenders: LenderConfig[],\r\n  ttlHours = 24,\r\n): Promise<{ refreshed: number; failed: string[] }> {\r\n  const now = Date.now()\r\n  const expiresAt = new Date(now + ttlHours * 3600 * 1000).toISOString()\r\n  const failed: string[] = []\r\n  let refreshed = 0\r\n\r\n  for (const lender of lenders) {\r\n    const discovered = await discoverProductsEndpoint(lender)\r\n    if (!discovered) {\r\n      failed.push(lender.code)\r\n      continue\r\n    }\r\n    await upsertEndpointCache(db, {\r\n      lenderCode: lender.code,\r\n      endpointUrl: discovered.endpointUrl,\r\n      expiresAt,\r\n      sourceUrl: discovered.sourceUrl || CDR_REGISTER_DISCOVERY_URL,\r\n      httpStatus: discovered.status,\r\n      notes: discovered.notes,\r\n    })\r\n    refreshed += 1\r\n  }\r\n\r\n  return { refreshed, failed }\r\n}", "import type { RunReportRow, RunSource, RunStatus, RunType } from '../types'\r\nimport { nowIso } from '../utils/time'\r\n\r\ntype LenderProgress = {\r\n  enqueued: number\r\n  processed: number\r\n  failed: number\r\n  last_error?: string\r\n  updated_at: string\r\n}\r\n\r\ntype PerLenderSummary = {\r\n  _meta: {\r\n    enqueued_total: number\r\n    processed_total: number\r\n    failed_total: number\r\n    updated_at: string\r\n  }\r\n  [lenderCode: string]: unknown\r\n}\r\n\r\nfunction parseJson<T>(raw: string | null | undefined, fallback: T): T {\r\n  try {\r\n    if (!raw) {\r\n      return fallback\r\n    }\r\n    return JSON.parse(raw) as T\r\n  } catch {\r\n    return fallback\r\n  }\r\n}\r\n\r\nfunction asPerLenderSummary(input: unknown): PerLenderSummary {\r\n  const now = nowIso()\r\n  if (!input || typeof input !== 'object') {\r\n    return {\r\n      _meta: {\r\n        enqueued_total: 0,\r\n        processed_total: 0,\r\n        failed_total: 0,\r\n        updated_at: now,\r\n      },\r\n    }\r\n  }\r\n\r\n  const raw = input as Record<string, unknown>\r\n  const rawMeta = (raw._meta as Record<string, unknown> | undefined) || {}\r\n\r\n  return {\r\n    ...raw,\r\n    _meta: {\r\n      enqueued_total: Number(rawMeta.enqueued_total) || 0,\r\n      processed_total: Number(rawMeta.processed_total) || 0,\r\n      failed_total: Number(rawMeta.failed_total) || 0,\r\n      updated_at: String(rawMeta.updated_at || now),\r\n    },\r\n  }\r\n}\r\n\r\nfunction asLenderProgress(input: unknown): LenderProgress {\r\n  const now = nowIso()\r\n  if (!input || typeof input !== 'object') {\r\n    return {\r\n      enqueued: 0,\r\n      processed: 0,\r\n      failed: 0,\r\n      updated_at: now,\r\n    }\r\n  }\r\n  const raw = input as Record<string, unknown>\r\n  return {\r\n    enqueued: Number(raw.enqueued) || 0,\r\n    processed: Number(raw.processed) || 0,\r\n    failed: Number(raw.failed) || 0,\r\n    last_error: raw.last_error == null ? undefined : String(raw.last_error),\r\n    updated_at: String(raw.updated_at || now),\r\n  }\r\n}\r\n\r\nexport function buildInitialPerLenderSummary(perLenderEnqueued: Record<string, number>): PerLenderSummary {\r\n  const now = nowIso()\r\n  const entries = Object.entries(perLenderEnqueued)\r\n  const summary: PerLenderSummary = {\r\n    _meta: {\r\n      enqueued_total: entries.reduce((sum, [, count]) => sum + count, 0),\r\n      processed_total: 0,\r\n      failed_total: 0,\r\n      updated_at: now,\r\n    },\r\n  }\r\n\r\n  for (const [lenderCode, count] of entries) {\r\n    summary[lenderCode] = {\r\n      enqueued: count,\r\n      processed: 0,\r\n      failed: 0,\r\n      updated_at: now,\r\n    } satisfies LenderProgress\r\n  }\r\n\r\n  return summary\r\n}\r\n\r\nexport async function getRunReport(db: D1Database, runId: string): Promise<RunReportRow | null> {\r\n  const row = await db\r\n    .prepare(\r\n      `SELECT run_id, run_type, run_source, started_at, finished_at, status, per_lender_json, errors_json\r\n       FROM run_reports\r\n       WHERE run_id = ?1`,\r\n    )\r\n    .bind(runId)\r\n    .first<RunReportRow>()\r\n\r\n  return row ?? null\r\n}\r\n\r\nexport async function listRunReports(db: D1Database, limit = 25): Promise<RunReportRow[]> {\r\n  const safeLimit = Math.min(100, Math.max(1, Math.floor(limit)))\r\n  const rows = await db\r\n    .prepare(\r\n      `SELECT run_id, run_type, run_source, started_at, finished_at, status, per_lender_json, errors_json\r\n       FROM run_reports\r\n       ORDER BY started_at DESC\r\n       LIMIT ?1`,\r\n    )\r\n    .bind(safeLimit)\r\n    .all<RunReportRow>()\r\n\r\n  return rows.results ?? []\r\n}\r\n\r\nexport async function createRunReport(\r\n  db: D1Database,\r\n  input: {\r\n    runId: string\r\n    runType: RunType\r\n    runSource?: RunSource\r\n    startedAt?: string\r\n    perLenderSummary?: Record<string, unknown>\r\n  },\r\n): Promise<{ created: boolean; row: RunReportRow }> {\r\n  const startedAt = input.startedAt || nowIso()\r\n  const runSource = input.runSource ?? 'scheduled'\r\n  const perLenderJson = JSON.stringify(\r\n    asPerLenderSummary(input.perLenderSummary || {\r\n      _meta: {\r\n        enqueued_total: 0,\r\n        processed_total: 0,\r\n        failed_total: 0,\r\n        updated_at: startedAt,\r\n      },\r\n    }),\r\n  )\r\n\r\n  const insert = await db\r\n    .prepare(\r\n      `INSERT INTO run_reports (run_id, run_type, run_source, started_at, status, per_lender_json, errors_json)\r\n       VALUES (?1, ?2, ?3, ?4, 'running', ?5, '[]')\r\n       ON CONFLICT(run_id) DO NOTHING`,\r\n    )\r\n    .bind(input.runId, input.runType, runSource, startedAt, perLenderJson)\r\n    .run()\r\n\r\n  const row = await getRunReport(db, input.runId)\r\n  if (!row) {\r\n    throw new Error(`Failed to load run report after create: ${input.runId}`)\r\n  }\r\n\r\n  return {\r\n    created: Number(insert.meta?.changes || 0) > 0,\r\n    row,\r\n  }\r\n}\r\n\r\nexport async function setRunEnqueuedSummary(\r\n  db: D1Database,\r\n  runId: string,\r\n  perLenderSummary: Record<string, unknown>,\r\n): Promise<RunReportRow | null> {\r\n  const summary = asPerLenderSummary(perLenderSummary)\r\n  summary._meta.updated_at = nowIso()\r\n\r\n  await db\r\n    .prepare(\r\n      `UPDATE run_reports\r\n       SET per_lender_json = ?1,\r\n           status = 'running',\r\n           finished_at = NULL\r\n       WHERE run_id = ?2`,\r\n    )\r\n    .bind(JSON.stringify(summary), runId)\r\n    .run()\r\n\r\n  return getRunReport(db, runId)\r\n}\r\n\r\nexport async function markRunFailed(db: D1Database, runId: string, errorMessage: string): Promise<RunReportRow | null> {\r\n  const row = await getRunReport(db, runId)\r\n  if (!row) {\r\n    return null\r\n  }\r\n\r\n  const errors = parseJson<string[]>(row.errors_json, [])\r\n  errors.push(`[${nowIso()}] ${errorMessage}`)\r\n\r\n  await db\r\n    .prepare(\r\n      `UPDATE run_reports\r\n       SET status = 'failed',\r\n           finished_at = ?1,\r\n           errors_json = ?2\r\n       WHERE run_id = ?3`,\r\n    )\r\n    .bind(nowIso(), JSON.stringify(errors.slice(-200)), runId)\r\n    .run()\r\n\r\n  return getRunReport(db, runId)\r\n}\r\n\r\nexport async function recordRunQueueOutcome(\r\n  db: D1Database,\r\n  input: { runId: string; lenderCode: string; success: boolean; errorMessage?: string },\r\n): Promise<RunReportRow | null> {\r\n  const row = await getRunReport(db, input.runId)\r\n  if (!row) {\r\n    return null\r\n  }\r\n\r\n  const summary = asPerLenderSummary(parseJson<Record<string, unknown>>(row.per_lender_json, {}))\r\n  const errors = parseJson<string[]>(row.errors_json, [])\r\n  const now = nowIso()\r\n\r\n  const lenderCode = input.lenderCode || '_unknown'\r\n  const progress = asLenderProgress(summary[lenderCode])\r\n\r\n  if (input.success) {\r\n    progress.processed += 1\r\n    summary._meta.processed_total += 1\r\n  } else {\r\n    progress.failed += 1\r\n    summary._meta.failed_total += 1\r\n    if (input.errorMessage) {\r\n      progress.last_error = input.errorMessage\r\n      errors.push(`[${now}] ${lenderCode}: ${input.errorMessage}`)\r\n    }\r\n  }\r\n\r\n  progress.updated_at = now\r\n  summary[lenderCode] = progress\r\n  summary._meta.updated_at = now\r\n\r\n  const completedTotal = summary._meta.processed_total + summary._meta.failed_total\r\n  const enqueuedTotal = summary._meta.enqueued_total\r\n\r\n  let nextStatus = row.status as RunStatus\r\n  let finishedAt: string | null = row.finished_at\r\n\r\n  if (enqueuedTotal > 0 && completedTotal >= enqueuedTotal) {\r\n    nextStatus = summary._meta.failed_total > 0 ? 'partial' : 'ok'\r\n    finishedAt = now\r\n  } else if (!input.success && enqueuedTotal === 0) {\r\n    nextStatus = 'partial'\r\n  }\r\n\r\n  await db\r\n    .prepare(\r\n      `UPDATE run_reports\r\n       SET per_lender_json = ?1,\r\n           errors_json = ?2,\r\n           status = ?3,\r\n           finished_at = ?4\r\n       WHERE run_id = ?5`,\r\n    )\r\n    .bind(JSON.stringify(summary), JSON.stringify(errors.slice(-200)), nextStatus, finishedAt, input.runId)\r\n    .run()\r\n\r\n  return getRunReport(db, input.runId)\r\n}\r\n\r\nexport async function getLastManualRunStartedAt(db: D1Database): Promise<string | null> {\r\n  const row = await db\r\n    .prepare(\r\n      `SELECT started_at FROM run_reports\r\n       WHERE run_source = 'manual' AND run_type = 'daily'\r\n       ORDER BY started_at DESC\r\n       LIMIT 1`,\r\n    )\r\n    .first<{ started_at: string }>()\r\n\r\n  return row?.started_at ?? null\r\n}", "export async function upsertRbaCashRate(\r\n  db: D1Database,\r\n  input: {\r\n    collectionDate: string\r\n    cashRate: number\r\n    effectiveDate: string\r\n    sourceUrl: string\r\n  },\r\n): Promise<void> {\r\n  await db\r\n    .prepare(\r\n      `INSERT INTO rba_cash_rates (\r\n        collection_date,\r\n        cash_rate,\r\n        effective_date,\r\n        source_url,\r\n        fetched_at\r\n      ) VALUES (?1, ?2, ?3, ?4, CURRENT_TIMESTAMP)\r\n      ON CONFLICT(collection_date) DO UPDATE SET\r\n        cash_rate = excluded.cash_rate,\r\n        effective_date = excluded.effective_date,\r\n        source_url = excluded.source_url,\r\n        fetched_at = CURRENT_TIMESTAMP`,\r\n    )\r\n    .bind(input.collectionDate, input.cashRate, input.effectiveDate, input.sourceUrl)\r\n    .run()\r\n}\r\n\r\nexport async function getNearestRbaCashRate(db: D1Database, collectionDate: string): Promise<number | null> {\r\n  const row = await db\r\n    .prepare(\r\n      `SELECT cash_rate\r\n       FROM rba_cash_rates\r\n       WHERE collection_date <= ?1\r\n       ORDER BY collection_date DESC\r\n       LIMIT 1`,\r\n    )\r\n    .bind(collectionDate)\r\n    .first<{ cash_rate: number }>()\r\n\r\n  if (!row) return null\r\n  return Number.isFinite(Number(row.cash_rate)) ? Number(row.cash_rate) : null\r\n}\r\n", "import { upsertRbaCashRate } from '../db/rba-cash-rate'\r\n\r\nconst RBA_F1_DATA_URL = 'https://www.rba.gov.au/statistics/tables/csv/f1-data.csv'\r\n\r\ntype RbaPoint = {\r\n  date: string\r\n  cashRate: number\r\n}\r\n\r\nconst MONTHS: Record<string, string> = {\r\n  jan: '01',\r\n  feb: '02',\r\n  mar: '03',\r\n  apr: '04',\r\n  may: '05',\r\n  jun: '06',\r\n  jul: '07',\r\n  aug: '08',\r\n  sep: '09',\r\n  oct: '10',\r\n  nov: '11',\r\n  dec: '12',\r\n}\r\n\r\nfunction toIsoDate(value: string): string | null {\r\n  const m = value.trim().match(/^(\\d{2})-([A-Za-z]{3})-(\\d{4})$/)\r\n  if (!m) return null\r\n  const month = MONTHS[m[2].toLowerCase()]\r\n  if (!month) return null\r\n  return `${m[3]}-${month}-${m[1]}`\r\n}\r\n\r\nfunction parseCsvLines(csv: string): RbaPoint[] {\r\n  const lines = csv.split(/\\r?\\n/)\r\n  const points: RbaPoint[] = []\r\n  for (const line of lines) {\r\n    const trimmed = line.trim()\r\n    if (!trimmed) continue\r\n    const parts = trimmed.split(',')\r\n    if (parts.length < 2) continue\r\n    const isoDate = toIsoDate(parts[0])\r\n    if (!isoDate) continue\r\n    const cashRate = Number(parts[1])\r\n    if (!Number.isFinite(cashRate)) continue\r\n    points.push({\r\n      date: isoDate,\r\n      cashRate,\r\n    })\r\n  }\r\n  return points\r\n}\r\n\r\nfunction latestPointOnOrBefore(points: RbaPoint[], collectionDate: string): RbaPoint | null {\r\n  let best: RbaPoint | null = null\r\n  for (const p of points) {\r\n    if (p.date > collectionDate) continue\r\n    if (!best || p.date > best.date) {\r\n      best = p\r\n    }\r\n  }\r\n  return best\r\n}\r\n\r\nexport async function collectRbaCashRateForDate(\r\n  db: D1Database,\r\n  collectionDate: string,\r\n): Promise<{ ok: boolean; cashRate: number | null; effectiveDate: string | null; sourceUrl: string }> {\r\n  try {\r\n    const response = await fetch(RBA_F1_DATA_URL)\r\n    const csv = await response.text()\r\n    if (!response.ok) {\r\n      return { ok: false, cashRate: null, effectiveDate: null, sourceUrl: RBA_F1_DATA_URL }\r\n    }\r\n    const points = parseCsvLines(csv)\r\n    const nearest = latestPointOnOrBefore(points, collectionDate)\r\n    if (!nearest) {\r\n      return { ok: false, cashRate: null, effectiveDate: null, sourceUrl: RBA_F1_DATA_URL }\r\n    }\r\n\r\n    await upsertRbaCashRate(db, {\r\n      collectionDate,\r\n      cashRate: nearest.cashRate,\r\n      effectiveDate: nearest.date,\r\n      sourceUrl: RBA_F1_DATA_URL,\r\n    })\r\n\r\n    return {\r\n      ok: true,\r\n      cashRate: nearest.cashRate,\r\n      effectiveDate: nearest.date,\r\n      sourceUrl: RBA_F1_DATA_URL,\r\n    }\r\n  } catch {\r\n    return { ok: false, cashRate: null, effectiveDate: null, sourceUrl: RBA_F1_DATA_URL }\r\n  }\r\n}\r\n", "import type { SourceType } from '../types'\r\n\r\nfunction normalizeKeyPart(value: string): string {\r\n  return value\r\n    .toLowerCase()\r\n    .replace(/[^a-z0-9]+/g, '-')\r\n    .replace(/-+/g, '-')\r\n    .replace(/^-|-$/g, '')\r\n    .slice(0, 64)\r\n}\r\n\r\nexport function buildDailyRunId(collectionDate: string): string {\r\n  return `daily:${collectionDate}`\r\n}\r\n\r\n/** Unique run id for interval-based scheduled runs (one per invocation). */\r\nexport function buildScheduledRunId(collectionDate: string): string {\r\n  return `daily:${collectionDate}:${new Date().toISOString()}`\r\n}\r\n\r\nexport function buildBackfillRunId(monthCursor: string): string {\r\n  return `backfill:${monthCursor}:${crypto.randomUUID()}`\r\n}\r\n\r\nexport function buildRunLockKey(runType: 'daily' | 'backfill', dateOrMonth: string): string {\r\n  return `${runType}:${dateOrMonth}`\r\n}\r\n\r\nexport function buildDailyLenderIdempotencyKey(runId: string, lenderCode: string): string {\r\n  return `daily:${normalizeKeyPart(runId)}:${normalizeKeyPart(lenderCode)}`\r\n}\r\n\r\nexport function buildProductDetailIdempotencyKey(runId: string, lenderCode: string, productId: string): string {\r\n  return `product:${normalizeKeyPart(runId)}:${normalizeKeyPart(lenderCode)}:${normalizeKeyPart(productId)}`\r\n}\r\n\r\nexport function buildBackfillIdempotencyKey(runId: string, lenderCode: string, seedUrl: string, monthCursor: string): string {\r\n  return [\r\n    'backfill',\r\n    normalizeKeyPart(runId),\r\n    normalizeKeyPart(lenderCode),\r\n    normalizeKeyPart(seedUrl),\r\n    normalizeKeyPart(monthCursor),\r\n  ].join(':')\r\n}\r\n\r\nfunction extensionForSource(sourceType: SourceType): string {\r\n  return sourceType === 'wayback_html' ? 'html' : 'json'\r\n}\r\n\r\nexport function buildRawR2Key(sourceType: SourceType, fetchedAtIso: string, contentHash: string): string {\r\n  const [datePart] = fetchedAtIso.split('T')\r\n  const [year, month = '00', day = '00'] = (datePart || '1970-01-01').split('-')\r\n  const ext = extensionForSource(sourceType)\r\n  return `raw/${sourceType}/${year}/${month}/${day}/${contentHash}.${ext}`\r\n}", "import type { BackfillSnapshotJob, DailyLenderJob, DailySavingsLenderJob, EnvBindings, IngestMessage, LenderConfig, ProductDetailJob, RunSource } from '../types'\r\nimport {\r\n  buildBackfillIdempotencyKey,\r\n  buildDailyLenderIdempotencyKey,\r\n  buildProductDetailIdempotencyKey,\r\n} from '../utils/idempotency'\r\n\r\ntype QueueEnv = Pick<EnvBindings, 'INGEST_QUEUE'>\r\n\r\nfunction asQueueBatch(messages: IngestMessage[]) {\r\n  return messages.map((message) => ({ body: message }))\r\n}\r\n\r\nexport async function enqueueDailyLenderJobs(\r\n  env: QueueEnv,\r\n  input: {\r\n    runId: string\r\n    runSource?: RunSource\r\n    collectionDate: string\r\n    lenders: LenderConfig[]\r\n  },\r\n): Promise<{ enqueued: number; perLender: Record<string, number> }> {\r\n  const runSource = input.runSource ?? 'scheduled'\r\n  const jobs: DailyLenderJob[] = input.lenders.map((lender) => ({\r\n    kind: 'daily_lender_fetch',\r\n    runId: input.runId,\r\n    runSource,\r\n    lenderCode: lender.code,\r\n    collectionDate: input.collectionDate,\r\n    attempt: 0,\r\n    idempotencyKey: buildDailyLenderIdempotencyKey(input.runId, lender.code),\r\n  }))\r\n\r\n  if (jobs.length > 0) {\r\n    await env.INGEST_QUEUE.sendBatch(asQueueBatch(jobs))\r\n  }\r\n\r\n  return {\r\n    enqueued: jobs.length,\r\n    perLender: Object.fromEntries(jobs.map((job) => [job.lenderCode, 1])),\r\n  }\r\n}\r\n\r\nexport async function enqueueProductDetailJobs(\r\n  env: QueueEnv,\r\n  input: {\r\n    runId: string\r\n    runSource?: RunSource\r\n    lenderCode: string\r\n    collectionDate: string\r\n    productIds: string[]\r\n  },\r\n): Promise<{ enqueued: number }> {\r\n  const productIds = Array.from(new Set(input.productIds)).filter(Boolean)\r\n  const runSource = input.runSource ?? 'scheduled'\r\n  const jobs: ProductDetailJob[] = productIds.map((productId) => ({\r\n    kind: 'product_detail_fetch',\r\n    runId: input.runId,\r\n    runSource,\r\n    lenderCode: input.lenderCode,\r\n    productId,\r\n    collectionDate: input.collectionDate,\r\n    attempt: 0,\r\n    idempotencyKey: buildProductDetailIdempotencyKey(input.runId, input.lenderCode, productId),\r\n  }))\r\n\r\n  if (jobs.length > 0) {\r\n    await env.INGEST_QUEUE.sendBatch(asQueueBatch(jobs))\r\n  }\r\n\r\n  return {\r\n    enqueued: jobs.length,\r\n  }\r\n}\r\n\r\nexport async function enqueueDailySavingsLenderJobs(\r\n  env: QueueEnv,\r\n  input: {\r\n    runId: string\r\n    runSource?: RunSource\r\n    collectionDate: string\r\n    lenders: LenderConfig[]\r\n  },\r\n): Promise<{ enqueued: number; perLender: Record<string, number> }> {\r\n  const runSource = input.runSource ?? 'scheduled'\r\n  const jobs: DailySavingsLenderJob[] = input.lenders.map((lender) => ({\r\n    kind: 'daily_savings_lender_fetch',\r\n    runId: input.runId,\r\n    runSource,\r\n    lenderCode: lender.code,\r\n    collectionDate: input.collectionDate,\r\n    attempt: 0,\r\n    idempotencyKey: `${input.runId}:savings:${lender.code}`,\r\n  }))\r\n\r\n  if (jobs.length > 0) {\r\n    await env.INGEST_QUEUE.sendBatch(asQueueBatch(jobs))\r\n  }\r\n\r\n  return {\r\n    enqueued: jobs.length,\r\n    perLender: Object.fromEntries(jobs.map((job) => [job.lenderCode, 1])),\r\n  }\r\n}\r\n\r\nexport async function enqueueBackfillJobs(\r\n  env: QueueEnv,\r\n  input: {\r\n    runId: string\r\n    runSource?: RunSource\r\n    jobs: Array<{ lenderCode: string; seedUrl: string; monthCursor: string }>\r\n  },\r\n): Promise<{ enqueued: number; perLender: Record<string, number> }> {\r\n  const runSource = input.runSource ?? 'scheduled'\r\n  const jobs: BackfillSnapshotJob[] = input.jobs.map((job) => ({\r\n    kind: 'backfill_snapshot_fetch',\r\n    runId: input.runId,\r\n    runSource,\r\n    lenderCode: job.lenderCode,\r\n    seedUrl: job.seedUrl,\r\n    monthCursor: job.monthCursor,\r\n    attempt: 0,\r\n    idempotencyKey: buildBackfillIdempotencyKey(input.runId, job.lenderCode, job.seedUrl, job.monthCursor),\r\n  }))\r\n\r\n  if (jobs.length > 0) {\r\n    await env.INGEST_QUEUE.sendBatch(asQueueBatch(jobs))\r\n  }\r\n\r\n  const perLender: Record<string, number> = {}\r\n  for (const job of jobs) {\r\n    perLender[job.lenderCode] = (perLender[job.lenderCode] || 0) + 1\r\n  }\r\n\r\n  return {\r\n    enqueued: jobs.length,\r\n    perLender,\r\n  }\r\n}", "export type LogLevel = 'debug' | 'info' | 'warn' | 'error'\r\n\r\nexport type LogEntry = {\r\n  level: LogLevel\r\n  source: string\r\n  message: string\r\n  context?: string\r\n  runId?: string\r\n  lenderCode?: string\r\n}\r\n\r\nlet _db: D1Database | null = null\r\nconst _buffer: LogEntry[] = []\r\nconst _pendingWrites = new Set<Promise<void>>()\r\nconst MAX_BUFFER = 200\r\n\r\nexport function initLogger(db: D1Database): void {\r\n  _db = db\r\n}\r\n\r\nfunction formatConsole(entry: LogEntry): string {\r\n  const parts = [`[${entry.level.toUpperCase()}] [${entry.source}]`, entry.message]\r\n  if (entry.runId) parts.push(`run=${entry.runId}`)\r\n  if (entry.lenderCode) parts.push(`lender=${entry.lenderCode}`)\r\n  if (entry.context) parts.push(entry.context)\r\n  return parts.join(' ')\r\n}\r\n\r\nasync function persist(entry: LogEntry): Promise<void> {\r\n  if (!_db) return\r\n  try {\r\n    await _db\r\n      .prepare(\r\n        `INSERT INTO global_log (level, source, message, context, run_id, lender_code)\r\n         VALUES (?1, ?2, ?3, ?4, ?5, ?6)`,\r\n      )\r\n      .bind(\r\n        entry.level,\r\n        entry.source,\r\n        entry.message.slice(0, 2000),\r\n        entry.context ? entry.context.slice(0, 4000) : null,\r\n        entry.runId ?? null,\r\n        entry.lenderCode ?? null,\r\n      )\r\n      .run()\r\n  } catch {\r\n    // avoid recursive logging failures\r\n  }\r\n}\r\n\r\nfunction emit(entry: LogEntry): void {\r\n  const line = formatConsole(entry)\r\n  if (entry.level === 'error') {\r\n    console.error(line)\r\n  } else if (entry.level === 'warn') {\r\n    console.warn(line)\r\n  } else {\r\n    console.log(line)\r\n  }\r\n\r\n  if (_db) {\r\n    const p = persist(entry)\r\n    _pendingWrites.add(p)\r\n    p.finally(() => _pendingWrites.delete(p))\r\n  } else {\r\n    if (_buffer.length < MAX_BUFFER) _buffer.push(entry)\r\n  }\r\n}\r\n\r\nexport async function flushBufferedLogs(): Promise<void> {\r\n  if (!_db) return\r\n  await Promise.all([..._pendingWrites])\r\n  if (_buffer.length === 0) return\r\n  const entries = _buffer.splice(0, _buffer.length)\r\n  await Promise.all(entries.map((entry) => persist(entry)))\r\n}\r\n\r\nexport const log = {\r\n  debug(source: string, message: string, ctx?: Partial<Omit<LogEntry, 'level' | 'source' | 'message'>>): void {\r\n    emit({ level: 'debug', source, message, ...ctx })\r\n  },\r\n  info(source: string, message: string, ctx?: Partial<Omit<LogEntry, 'level' | 'source' | 'message'>>): void {\r\n    emit({ level: 'info', source, message, ...ctx })\r\n  },\r\n  warn(source: string, message: string, ctx?: Partial<Omit<LogEntry, 'level' | 'source' | 'message'>>): void {\r\n    emit({ level: 'warn', source, message, ...ctx })\r\n  },\r\n  error(source: string, message: string, ctx?: Partial<Omit<LogEntry, 'level' | 'source' | 'message'>>): void {\r\n    emit({ level: 'error', source, message, ...ctx })\r\n  },\r\n}\r\n\r\nexport async function queryLogs(\r\n  db: D1Database,\r\n  opts: { level?: LogLevel; source?: string; limit?: number; offset?: number } = {},\r\n): Promise<{ entries: Array<Record<string, unknown>>; total: number }> {\r\n  const where: string[] = []\r\n  const binds: Array<string | number> = []\r\n\r\n  if (opts.level) {\r\n    where.push('level = ?')\r\n    binds.push(opts.level)\r\n  }\r\n  if (opts.source) {\r\n    where.push('source = ?')\r\n    binds.push(opts.source)\r\n  }\r\n\r\n  const whereClause = where.length ? `WHERE ${where.join(' AND ')}` : ''\r\n  const limit = Math.min(Math.max(1, opts.limit ?? 1000), 10000)\r\n  const offset = Math.max(0, opts.offset ?? 0)\r\n\r\n  const countSql = `SELECT COUNT(*) AS total FROM global_log ${whereClause}`\r\n  const countResult = await db\r\n    .prepare(countSql)\r\n    .bind(...binds)\r\n    .first<{ total: number }>()\r\n  const total = Number(countResult?.total ?? 0)\r\n\r\n  const dataSql = `SELECT id, ts, level, source, message, context, run_id, lender_code FROM global_log ${whereClause} ORDER BY ts DESC LIMIT ? OFFSET ?`\r\n  const dataResult = await db\r\n    .prepare(dataSql)\r\n    .bind(...binds, limit, offset)\r\n    .all<Record<string, unknown>>()\r\n\r\n  return { entries: dataResult.results ?? [], total }\r\n}\r\n\r\nexport async function getLogStats(db: D1Database): Promise<{ count: number; latest_ts: string | null }> {\r\n  const result = await db\r\n    .prepare('SELECT COUNT(*) AS cnt, MAX(ts) AS latest_ts FROM global_log')\r\n    .first<{ cnt: number; latest_ts: string | null }>()\r\n  return {\r\n    count: Number(result?.cnt ?? 0),\r\n    latest_ts: result?.latest_ts ?? null,\r\n  }\r\n}\r\n", "import {\r\n  DEFAULT_LOCK_TTL_SECONDS,\r\n  MELBOURNE_TIMEZONE,\r\n  TARGET_LENDERS,\r\n} from '../constants'\r\nimport { refreshEndpointCache } from '../db/endpoint-cache'\r\nimport {\r\n  buildInitialPerLenderSummary,\r\n  createRunReport,\r\n  markRunFailed,\r\n  setRunEnqueuedSummary,\r\n} from '../db/run-reports'\r\nimport { collectRbaCashRateForDate } from '../ingest/rba'\r\nimport { acquireRunLock, releaseRunLock } from '../durable/run-lock'\r\nimport { enqueueBackfillJobs, enqueueDailyLenderJobs, enqueueDailySavingsLenderJobs } from '../queue/producer'\r\nimport type { EnvBindings, LenderConfig } from '../types'\r\nimport { buildBackfillRunId, buildDailyRunId, buildRunLockKey } from '../utils/idempotency'\r\nimport { log } from '../utils/logger'\r\nimport { currentMonthCursor, getMelbourneNowParts, parseIntegerEnv } from '../utils/time'\r\n\r\ntype DailyRunOptions = {\r\n  source: 'scheduled' | 'manual'\r\n  force?: boolean\r\n  /** When set, use this as runId (e.g. for interval-based runs so each run is unique). */\r\n  runIdOverride?: string\r\n}\r\n\r\ntype BackfillRunRequest = {\r\n  lenderCodes?: string[]\r\n  monthCursor?: string\r\n  maxSnapshotsPerMonth?: number\r\n}\r\n\r\nfunction filterLenders(codes?: string[]): LenderConfig[] {\r\n  if (!codes || codes.length === 0) {\r\n    return TARGET_LENDERS\r\n  }\r\n  const selected = new Set(codes.map((code) => code.toLowerCase().trim()))\r\n  return TARGET_LENDERS.filter((lender) => selected.has(lender.code.toLowerCase()))\r\n}\r\n\r\nfunction isMonthCursor(value: string | undefined): value is string {\r\n  return !!value && /^\\d{4}-\\d{2}$/.test(value)\r\n}\r\n\r\nexport async function triggerDailyRun(env: EnvBindings, options: DailyRunOptions) {\r\n  const melbourneParts = getMelbourneNowParts(new Date(), env.MELBOURNE_TIMEZONE || MELBOURNE_TIMEZONE)\r\n  const collectionDate = melbourneParts.date\r\n  const baseRunId = buildDailyRunId(collectionDate)\r\n  const runId =\r\n    options.runIdOverride ??\r\n    (options.force ? `${baseRunId}:force:${crypto.randomUUID()}` : baseRunId)\r\n\r\n  const lockKey = buildRunLockKey('daily', collectionDate)\r\n  const lockTtlSeconds = parseIntegerEnv(env.LOCK_TTL_SECONDS, DEFAULT_LOCK_TTL_SECONDS)\r\n\r\n  let lockAcquired = false\r\n  if (!options.force) {\r\n    const lock = await acquireRunLock(env, {\r\n      key: lockKey,\r\n      owner: runId,\r\n      ttlSeconds: lockTtlSeconds,\r\n    })\r\n\r\n    if (!lock.ok) {\r\n      return {\r\n        ok: false,\r\n        skipped: true,\r\n        reason: lock.reason || 'lock_unavailable',\r\n        runId,\r\n        collectionDate,\r\n      }\r\n    }\r\n\r\n    if (!lock.acquired) {\r\n      return {\r\n        ok: true,\r\n        skipped: true,\r\n        reason: 'daily_run_locked',\r\n        runId,\r\n        collectionDate,\r\n      }\r\n    }\r\n\r\n    lockAcquired = true\r\n  }\r\n\r\n  const created = await createRunReport(env.DB, {\r\n    runId,\r\n    runType: 'daily',\r\n    runSource: options.source,\r\n  })\r\n\r\n  if (!created.created && !options.force) {\r\n    if (lockAcquired) {\r\n      await releaseRunLock(env, { key: lockKey, owner: runId })\r\n    }\r\n\r\n    return {\r\n      ok: true,\r\n      skipped: true,\r\n      reason: 'run_already_exists',\r\n      runId,\r\n      collectionDate,\r\n    }\r\n  }\r\n\r\n  try {\r\n    log.info('pipeline', `Daily run ${runId} starting: collecting RBA rate and refreshing endpoints`, { runId })\r\n    const rbaCollection = await collectRbaCashRateForDate(env.DB, collectionDate)\r\n    const endpointRefresh = await refreshEndpointCache(env.DB, TARGET_LENDERS)\r\n\r\n    const enqueue = await enqueueDailyLenderJobs(env, {\r\n      runId,\r\n      runSource: options.source,\r\n      collectionDate,\r\n      lenders: TARGET_LENDERS,\r\n    })\r\n\r\n    const savingsEnqueue = await enqueueDailySavingsLenderJobs(env, {\r\n      runId,\r\n      runSource: options.source,\r\n      collectionDate,\r\n      lenders: TARGET_LENDERS,\r\n    })\r\n\r\n    const summary = buildInitialPerLenderSummary(enqueue.perLender)\r\n    await setRunEnqueuedSummary(env.DB, runId, summary)\r\n    const totalEnqueued = enqueue.enqueued + savingsEnqueue.enqueued\r\n    log.info('pipeline', `Daily run ${runId} enqueued ${totalEnqueued} jobs (${enqueue.enqueued} loan + ${savingsEnqueue.enqueued} savings/td) for ${collectionDate}`, { runId })\r\n\r\n    if (lockAcquired) {\r\n      await releaseRunLock(env, { key: lockKey, owner: runId })\r\n    }\r\n\r\n    return {\r\n      ok: true,\r\n      skipped: false,\r\n      runId,\r\n      collectionDate,\r\n      enqueued: totalEnqueued,\r\n      endpoint_refresh: endpointRefresh,\r\n      rba_collection: rbaCollection,\r\n      source: options.source,\r\n    }\r\n  } catch (error) {\r\n    log.error('pipeline', `Daily run ${runId} failed: ${(error as Error)?.message || String(error)}`, { runId })\r\n    await markRunFailed(env.DB, runId, `daily_run_enqueue_failed: ${(error as Error)?.message || String(error)}`)\r\n    throw error\r\n  }\r\n}\r\n\r\nexport async function triggerBackfillRun(env: EnvBindings, input: BackfillRunRequest) {\r\n  const melbourneParts = getMelbourneNowParts(new Date(), env.MELBOURNE_TIMEZONE || MELBOURNE_TIMEZONE)\r\n  const monthCursor = isMonthCursor(input.monthCursor) ? input.monthCursor : currentMonthCursor(melbourneParts)\r\n  const maxSnapshotsPerMonth = Math.min(3, Math.max(1, Number(input.maxSnapshotsPerMonth) || 3))\r\n\r\n  const lenders = filterLenders(input.lenderCodes)\r\n  const runId = buildBackfillRunId(monthCursor)\r\n\r\n  await createRunReport(env.DB, {\r\n    runId,\r\n    runType: 'backfill',\r\n    runSource: 'manual',\r\n  })\r\n\r\n  const jobs: Array<{ lenderCode: string; seedUrl: string; monthCursor: string }> = []\r\n  for (const lender of lenders) {\r\n    for (const seedUrl of lender.seed_rate_urls.slice(0, maxSnapshotsPerMonth)) {\r\n      jobs.push({\r\n        lenderCode: lender.code,\r\n        seedUrl,\r\n        monthCursor,\r\n      })\r\n    }\r\n  }\r\n\r\n  try {\r\n    log.info('pipeline', `Backfill run ${runId} starting for month=${monthCursor} lenders=${lenders.length}`, { runId })\r\n    const enqueue = await enqueueBackfillJobs(env, {\r\n      runId,\r\n      runSource: 'manual',\r\n      jobs,\r\n    })\r\n\r\n    await setRunEnqueuedSummary(env.DB, runId, buildInitialPerLenderSummary(enqueue.perLender))\r\n    log.info('pipeline', `Backfill run ${runId} enqueued ${enqueue.enqueued} jobs`, { runId })\r\n\r\n    return {\r\n      ok: true,\r\n      runId,\r\n      monthCursor,\r\n      selectedLenders: lenders.map((l) => l.code),\r\n      maxSnapshotsPerMonth,\r\n      enqueued: enqueue.enqueued,\r\n    }\r\n  } catch (error) {\r\n    log.error('pipeline', `Backfill run ${runId} failed: ${(error as Error)?.message || String(error)}`, { runId })\r\n    await markRunFailed(env.DB, runId, `backfill_enqueue_failed: ${(error as Error)?.message || String(error)}`)\r\n    throw error\r\n  }\r\n}", "import { getAppConfig, setAppConfig } from '../db/app-config'\r\nimport { triggerDailyRun } from './bootstrap-jobs'\r\nimport type { EnvBindings } from '../types'\r\nimport { buildScheduledRunId } from '../utils/idempotency'\r\nimport { log } from '../utils/logger'\r\nimport { getMelbourneNowParts } from '../utils/time'\r\n\r\nconst RATE_CHECK_INTERVAL_KEY = 'rate_check_interval_minutes'\r\nconst RATE_CHECK_LAST_RUN_KEY = 'rate_check_last_run_iso'\r\nconst DEFAULT_INTERVAL_MINUTES = 1\r\n\r\nexport function shouldRunScheduledAtTargetHour(hour: number, targetHour: number): boolean {\r\n  return hour === targetHour\r\n}\r\n\r\nexport async function handleScheduledDaily(_event: ScheduledController, env: EnvBindings) {\r\n  const melbourneParts = getMelbourneNowParts(new Date(), env.MELBOURNE_TIMEZONE || 'Australia/Melbourne')\r\n  const collectionDate = melbourneParts.date\r\n\r\n  const intervalRaw = await getAppConfig(env.DB, RATE_CHECK_INTERVAL_KEY)\r\n  const intervalMinutes = Math.max(1, parseInt(intervalRaw ?? String(DEFAULT_INTERVAL_MINUTES), 10) || DEFAULT_INTERVAL_MINUTES)\r\n\r\n  const lastRunIso = await getAppConfig(env.DB, RATE_CHECK_LAST_RUN_KEY)\r\n  const now = Date.now()\r\n  const lastRunMs = lastRunIso ? new Date(lastRunIso).getTime() : 0\r\n  const elapsedMinutes = (now - lastRunMs) / (60 * 1000)\r\n\r\n  if (lastRunIso && elapsedMinutes < intervalMinutes) {\r\n    log.info('scheduler', `Skipping: interval not elapsed (${Math.round(elapsedMinutes)}m < ${intervalMinutes}m)`)\r\n    return {\r\n      ok: true,\r\n      skipped: true,\r\n      reason: 'interval_not_elapsed',\r\n      elapsedMinutes: Math.round(elapsedMinutes * 10) / 10,\r\n      intervalMinutes,\r\n    }\r\n  }\r\n\r\n  log.info('scheduler', `Triggering rate check run (interval=${intervalMinutes}m, collectionDate=${collectionDate})`)\r\n  const runIdOverride = buildScheduledRunId(collectionDate)\r\n  const result = await triggerDailyRun(env, {\r\n    source: 'scheduled',\r\n    runIdOverride,\r\n  })\r\n  log.info('scheduler', `Rate check run result`, { context: JSON.stringify(result) })\r\n\r\n  if (result.ok && !result.skipped) {\r\n    await setAppConfig(env.DB, RATE_CHECK_LAST_RUN_KEY, new Date().toISOString())\r\n  }\r\n\r\n  return {\r\n    ...result,\r\n    melbourne: melbourneParts,\r\n    intervalMinutes,\r\n  }\r\n}\r\n", "import { type NormalizedRateRow, validateNormalizedRow } from '../ingest/normalize'\r\nimport { log } from '../utils/logger'\r\n\r\nexport async function upsertHistoricalRateRow(db: D1Database, row: NormalizedRateRow): Promise<void> {\r\n  const verdict = validateNormalizedRow(row)\r\n  if (!verdict.ok) {\r\n    throw new Error(`invalid_normalized_rate_row:${verdict.reason}`)\r\n  }\r\n\r\n  await db\r\n    .prepare(\r\n      `INSERT INTO historical_loan_rates (\r\n        bank_name,\r\n        collection_date,\r\n        product_id,\r\n        product_name,\r\n        security_purpose,\r\n        repayment_type,\r\n        rate_structure,\r\n        lvr_tier,\r\n        feature_set,\r\n        interest_rate,\r\n        comparison_rate,\r\n        annual_fee,\r\n        source_url,\r\n        data_quality_flag,\r\n        confidence_score,\r\n        parsed_at,\r\n        run_id,\r\n        run_source\r\n      ) VALUES (?1, ?2, ?3, ?4, ?5, ?6, ?7, ?8, ?9, ?10, ?11, ?12, ?13, ?14, ?15, CURRENT_TIMESTAMP, ?16, ?17)\r\n      ON CONFLICT(bank_name, collection_date, product_id, lvr_tier, rate_structure, security_purpose, repayment_type, run_source) DO UPDATE SET\r\n        product_name = excluded.product_name,\r\n        feature_set = excluded.feature_set,\r\n        interest_rate = excluded.interest_rate,\r\n        comparison_rate = excluded.comparison_rate,\r\n        annual_fee = excluded.annual_fee,\r\n        source_url = excluded.source_url,\r\n        data_quality_flag = excluded.data_quality_flag,\r\n        confidence_score = excluded.confidence_score,\r\n        parsed_at = CURRENT_TIMESTAMP,\r\n        run_id = excluded.run_id`,\r\n    )\r\n    .bind(\r\n      row.bankName,\r\n      row.collectionDate,\r\n      row.productId,\r\n      row.productName,\r\n      row.securityPurpose,\r\n      row.repaymentType,\r\n      row.rateStructure,\r\n      row.lvrTier,\r\n      row.featureSet,\r\n      row.interestRate,\r\n      row.comparisonRate,\r\n      row.annualFee,\r\n      row.sourceUrl,\r\n      row.dataQualityFlag,\r\n      row.confidenceScore,\r\n      row.runId ?? null,\r\n      row.runSource ?? 'scheduled',\r\n    )\r\n    .run()\r\n}\r\n\r\nexport async function upsertHistoricalRateRows(db: D1Database, rows: NormalizedRateRow[]): Promise<number> {\r\n  let written = 0\r\n  for (const row of rows) {\r\n    try {\r\n      await upsertHistoricalRateRow(db, row)\r\n      written += 1\r\n    } catch (error) {\r\n      log.error('db', `upsert_failed product=${row.productId} bank=${row.bankName} date=${row.collectionDate}`, {\r\n        context: (error as Error)?.message || String(error),\r\n        lenderCode: row.bankName,\r\n      })\r\n    }\r\n  }\r\n  return written\r\n}\r\n", "import type { InterestPayment, RunSource, SavingsAccountType, SavingsRateType } from '../types'\r\n\r\nexport type NormalizedSavingsRow = {\r\n  bankName: string\r\n  collectionDate: string\r\n  productId: string\r\n  productName: string\r\n  accountType: SavingsAccountType\r\n  rateType: SavingsRateType\r\n  interestRate: number\r\n  depositTier: string\r\n  minBalance: number | null\r\n  maxBalance: number | null\r\n  conditions: string | null\r\n  monthlyFee: number | null\r\n  sourceUrl: string\r\n  dataQualityFlag: string\r\n  confidenceScore: number\r\n  runId?: string\r\n  runSource?: RunSource\r\n}\r\n\r\nexport type NormalizedTdRow = {\r\n  bankName: string\r\n  collectionDate: string\r\n  productId: string\r\n  productName: string\r\n  termMonths: number\r\n  interestRate: number\r\n  depositTier: string\r\n  minDeposit: number | null\r\n  maxDeposit: number | null\r\n  interestPayment: InterestPayment\r\n  sourceUrl: string\r\n  dataQualityFlag: string\r\n  confidenceScore: number\r\n  runId?: string\r\n  runSource?: RunSource\r\n}\r\n\r\nexport const MIN_SAVINGS_RATE = 0\r\nexport const MAX_SAVINGS_RATE = 15\r\nexport const MAX_MONTHLY_FEE = 50\r\n\r\nfunction asText(value: unknown): string {\r\n  if (value == null) return ''\r\n  return String(value).trim()\r\n}\r\n\r\nfunction lower(value: unknown): string {\r\n  return asText(value).toLowerCase()\r\n}\r\n\r\nexport function normalizeAccountType(text: string): SavingsAccountType {\r\n  const t = lower(text)\r\n  if (t.includes('transaction') || t.includes('everyday') || t.includes('spending')) return 'transaction'\r\n  if (t.includes('at call') || t.includes('at_call')) return 'at_call'\r\n  return 'savings'\r\n}\r\n\r\nexport function normalizeDepositRateType(depositRateType: string): SavingsRateType {\r\n  const t = lower(depositRateType)\r\n  if (t.includes('bonus')) return 'bonus'\r\n  if (t.includes('introductory') || t.includes('intro')) return 'introductory'\r\n  if (t.includes('bundle') || t.includes('bundled')) return 'bundle'\r\n  if (t === 'fixed' || t === 'variable' || t === 'floating' || t === 'market_linked') return 'base'\r\n  return 'base'\r\n}\r\n\r\nexport function normalizeDepositTier(\r\n  minBalance: number | null,\r\n  maxBalance: number | null,\r\n): string {\r\n  if (minBalance == null && maxBalance == null) return 'all'\r\n  const fmt = (n: number) => {\r\n    if (n >= 1_000_000) return `$${(n / 1_000_000).toFixed(n % 1_000_000 === 0 ? 0 : 1)}m`\r\n    if (n >= 1_000) return `$${(n / 1_000).toFixed(n % 1_000 === 0 ? 0 : 1)}k`\r\n    return `$${n}`\r\n  }\r\n  if (minBalance != null && maxBalance != null) return `${fmt(minBalance)}-${fmt(maxBalance)}`\r\n  if (minBalance != null) return `${fmt(minBalance)}+`\r\n  if (maxBalance != null) return `up to ${fmt(maxBalance)}`\r\n  return 'all'\r\n}\r\n\r\nexport function parseTermMonths(duration: string): number | null {\r\n  const t = asText(duration).toUpperCase()\r\n  const isoMatch = t.match(/^P(\\d+)([DMYW])$/)\r\n  if (isoMatch) {\r\n    const n = Number(isoMatch[1])\r\n    const unit = isoMatch[2]\r\n    if (unit === 'M') return n\r\n    if (unit === 'D') return Math.round(n / 30)\r\n    if (unit === 'Y' || unit === 'W') return unit === 'Y' ? n * 12 : Math.round((n * 7) / 30)\r\n  }\r\n  const monthMatch = t.match(/(\\d+)\\s*(?:month|mth|mo)/i)\r\n  if (monthMatch) return Number(monthMatch[1])\r\n  const dayMatch = t.match(/(\\d+)\\s*day/i)\r\n  if (dayMatch) return Math.round(Number(dayMatch[1]) / 30)\r\n  const yearMatch = t.match(/(\\d+)\\s*year/i)\r\n  if (yearMatch) return Number(yearMatch[1]) * 12\r\n  const n = Number(t)\r\n  if (Number.isFinite(n) && n > 0 && n <= 120) return n\r\n  return null\r\n}\r\n\r\nexport function normalizeInterestPayment(text: string): InterestPayment {\r\n  const t = lower(text)\r\n  if (t.includes('monthly')) return 'monthly'\r\n  if (t.includes('quarterly') || t.includes('quarter')) return 'quarterly'\r\n  if (t.includes('annual') || t.includes('yearly')) return 'annually'\r\n  return 'at_maturity'\r\n}\r\n\r\nexport function parseSavingsInterestRate(value: unknown): number | null {\r\n  if (value == null || value === '') return null\r\n  let n: number\r\n  if (typeof value === 'number') {\r\n    n = value\r\n  } else {\r\n    const text = String(value)\r\n    const matches = text.match(/-?\\d+(?:\\.\\d+)?/g) ?? []\r\n    if (matches.length !== 1) return null\r\n    n = Number(matches[0])\r\n  }\r\n  if (!Number.isFinite(n)) return null\r\n  if (n > 0 && n < 1) n = Number((n * 100).toFixed(4))\r\n  if (n < MIN_SAVINGS_RATE || n > MAX_SAVINGS_RATE) return null\r\n  return n\r\n}\r\n\r\nexport function validateNormalizedSavingsRow(\r\n  row: NormalizedSavingsRow,\r\n): { ok: true } | { ok: false; reason: string } {\r\n  if (!row.productId?.trim()) return { ok: false, reason: 'missing_product_id' }\r\n  if (!row.productName?.trim()) return { ok: false, reason: 'missing_product_name' }\r\n  if (!row.sourceUrl?.trim()) return { ok: false, reason: 'missing_source_url' }\r\n  if (!Number.isFinite(row.interestRate) || row.interestRate < MIN_SAVINGS_RATE || row.interestRate > MAX_SAVINGS_RATE) {\r\n    return { ok: false, reason: 'interest_rate_out_of_bounds' }\r\n  }\r\n  if (!Number.isFinite(row.confidenceScore) || row.confidenceScore < 0 || row.confidenceScore > 1) {\r\n    return { ok: false, reason: 'confidence_out_of_bounds' }\r\n  }\r\n  return { ok: true }\r\n}\r\n\r\nexport function validateNormalizedTdRow(\r\n  row: NormalizedTdRow,\r\n): { ok: true } | { ok: false; reason: string } {\r\n  if (!row.productId?.trim()) return { ok: false, reason: 'missing_product_id' }\r\n  if (!row.productName?.trim()) return { ok: false, reason: 'missing_product_name' }\r\n  if (!row.sourceUrl?.trim()) return { ok: false, reason: 'missing_source_url' }\r\n  if (!Number.isFinite(row.interestRate) || row.interestRate < MIN_SAVINGS_RATE || row.interestRate > MAX_SAVINGS_RATE) {\r\n    return { ok: false, reason: 'interest_rate_out_of_bounds' }\r\n  }\r\n  if (!Number.isFinite(row.termMonths) || row.termMonths < 1 || row.termMonths > 120) {\r\n    return { ok: false, reason: 'term_months_out_of_bounds' }\r\n  }\r\n  if (!Number.isFinite(row.confidenceScore) || row.confidenceScore < 0 || row.confidenceScore > 1) {\r\n    return { ok: false, reason: 'confidence_out_of_bounds' }\r\n  }\r\n  return { ok: true }\r\n}\r\n", "import { type NormalizedSavingsRow, validateNormalizedSavingsRow } from '../ingest/normalize-savings'\r\nimport { log } from '../utils/logger'\r\n\r\nexport async function upsertSavingsRateRow(db: D1Database, row: NormalizedSavingsRow): Promise<void> {\r\n  const verdict = validateNormalizedSavingsRow(row)\r\n  if (!verdict.ok) {\r\n    throw new Error(`invalid_savings_row:${verdict.reason}`)\r\n  }\r\n\r\n  await db\r\n    .prepare(\r\n      `INSERT INTO historical_savings_rates (\r\n        bank_name, collection_date, product_id, product_name,\r\n        account_type, rate_type, interest_rate, deposit_tier,\r\n        min_balance, max_balance, conditions, monthly_fee,\r\n        source_url, data_quality_flag, confidence_score,\r\n        parsed_at, run_id, run_source\r\n      ) VALUES (?1,?2,?3,?4,?5,?6,?7,?8,?9,?10,?11,?12,?13,?14,?15,CURRENT_TIMESTAMP,?16,?17)\r\n      ON CONFLICT(bank_name, collection_date, product_id, rate_type, deposit_tier, run_source) DO UPDATE SET\r\n        product_name = excluded.product_name,\r\n        account_type = excluded.account_type,\r\n        interest_rate = excluded.interest_rate,\r\n        min_balance = excluded.min_balance,\r\n        max_balance = excluded.max_balance,\r\n        conditions = excluded.conditions,\r\n        monthly_fee = excluded.monthly_fee,\r\n        source_url = excluded.source_url,\r\n        data_quality_flag = excluded.data_quality_flag,\r\n        confidence_score = excluded.confidence_score,\r\n        parsed_at = CURRENT_TIMESTAMP,\r\n        run_id = excluded.run_id`,\r\n    )\r\n    .bind(\r\n      row.bankName,\r\n      row.collectionDate,\r\n      row.productId,\r\n      row.productName,\r\n      row.accountType,\r\n      row.rateType,\r\n      row.interestRate,\r\n      row.depositTier,\r\n      row.minBalance,\r\n      row.maxBalance,\r\n      row.conditions,\r\n      row.monthlyFee,\r\n      row.sourceUrl,\r\n      row.dataQualityFlag,\r\n      row.confidenceScore,\r\n      row.runId ?? null,\r\n      row.runSource ?? 'scheduled',\r\n    )\r\n    .run()\r\n}\r\n\r\nexport async function upsertSavingsRateRows(db: D1Database, rows: NormalizedSavingsRow[]): Promise<number> {\r\n  let written = 0\r\n  for (const row of rows) {\r\n    try {\r\n      await upsertSavingsRateRow(db, row)\r\n      written += 1\r\n    } catch (error) {\r\n      log.error('db', `savings_upsert_failed product=${row.productId} bank=${row.bankName}`, {\r\n        context: (error as Error)?.message || String(error),\r\n        lenderCode: row.bankName,\r\n      })\r\n    }\r\n  }\r\n  return written\r\n}\r\n", "import { type NormalizedTdRow, validateNormalizedTdRow } from '../ingest/normalize-savings'\r\nimport { log } from '../utils/logger'\r\n\r\nexport async function upsertTdRateRow(db: D1Database, row: NormalizedTdRow): Promise<void> {\r\n  const verdict = validateNormalizedTdRow(row)\r\n  if (!verdict.ok) {\r\n    throw new Error(`invalid_td_row:${verdict.reason}`)\r\n  }\r\n\r\n  await db\r\n    .prepare(\r\n      `INSERT INTO historical_term_deposit_rates (\r\n        bank_name, collection_date, product_id, product_name,\r\n        term_months, interest_rate, deposit_tier,\r\n        min_deposit, max_deposit, interest_payment,\r\n        source_url, data_quality_flag, confidence_score,\r\n        parsed_at, run_id, run_source\r\n      ) VALUES (?1,?2,?3,?4,?5,?6,?7,?8,?9,?10,?11,?12,?13,CURRENT_TIMESTAMP,?14,?15)\r\n      ON CONFLICT(bank_name, collection_date, product_id, term_months, deposit_tier, run_source) DO UPDATE SET\r\n        product_name = excluded.product_name,\r\n        interest_rate = excluded.interest_rate,\r\n        min_deposit = excluded.min_deposit,\r\n        max_deposit = excluded.max_deposit,\r\n        interest_payment = excluded.interest_payment,\r\n        source_url = excluded.source_url,\r\n        data_quality_flag = excluded.data_quality_flag,\r\n        confidence_score = excluded.confidence_score,\r\n        parsed_at = CURRENT_TIMESTAMP,\r\n        run_id = excluded.run_id`,\r\n    )\r\n    .bind(\r\n      row.bankName,\r\n      row.collectionDate,\r\n      row.productId,\r\n      row.productName,\r\n      row.termMonths,\r\n      row.interestRate,\r\n      row.depositTier,\r\n      row.minDeposit,\r\n      row.maxDeposit,\r\n      row.interestPayment,\r\n      row.sourceUrl,\r\n      row.dataQualityFlag,\r\n      row.confidenceScore,\r\n      row.runId ?? null,\r\n      row.runSource ?? 'scheduled',\r\n    )\r\n    .run()\r\n}\r\n\r\nexport async function upsertTdRateRows(db: D1Database, rows: NormalizedTdRow[]): Promise<number> {\r\n  let written = 0\r\n  for (const row of rows) {\r\n    try {\r\n      await upsertTdRateRow(db, row)\r\n      written += 1\r\n    } catch (error) {\r\n      log.error('db', `td_upsert_failed product=${row.productId} bank=${row.bankName}`, {\r\n        context: (error as Error)?.message || String(error),\r\n        lenderCode: row.bankName,\r\n      })\r\n    }\r\n  }\r\n  return written\r\n}\r\n", "function toHex(buffer: ArrayBuffer): string {\r\n  const bytes = new Uint8Array(buffer)\r\n  return Array.from(bytes)\r\n    .map((byte) => byte.toString(16).padStart(2, '0'))\r\n    .join('')\r\n}\r\n\r\nexport async function sha256HexFromBytes(bytes: ArrayBuffer | Uint8Array): Promise<string> {\r\n  const source = bytes instanceof Uint8Array ? bytes : new Uint8Array(bytes)\r\n  const input = new Uint8Array(source.byteLength)\r\n  input.set(source)\r\n  const digest = await crypto.subtle.digest('SHA-256', input)\r\n  return toHex(digest)\r\n}\r\n\r\nexport async function sha256HexFromText(text: string): Promise<string> {\r\n  const encoded = new TextEncoder().encode(text)\r\n  return sha256HexFromBytes(encoded)\r\n}\r\n\r\nfunction stableSortObject(value: unknown): unknown {\r\n  if (Array.isArray(value)) {\r\n    return value.map(stableSortObject)\r\n  }\r\n  if (value && typeof value === 'object') {\r\n    const entries = Object.entries(value as Record<string, unknown>)\r\n      .sort(([a], [b]) => a.localeCompare(b))\r\n      .map(([k, v]) => [k, stableSortObject(v)])\r\n    return Object.fromEntries(entries)\r\n  }\r\n  return value\r\n}\r\n\r\nexport function stableStringify(value: unknown): string {\r\n  return JSON.stringify(stableSortObject(value))\r\n}\r\n\r\nexport async function sha256HexFromJson(value: unknown): Promise<string> {\r\n  return sha256HexFromText(stableStringify(value))\r\n}\r\n", "import type { SourceType } from '../types'\r\nimport { buildRawR2Key } from '../utils/idempotency'\r\nimport { sha256HexFromBytes } from '../utils/hash'\r\nimport { nowIso } from '../utils/time'\r\n\r\ntype RawPayloadInput = {\r\n  sourceType: SourceType\r\n  sourceUrl: string\r\n  payload: unknown\r\n  fetchedAtIso?: string\r\n  httpStatus?: number | null\r\n  notes?: string | null\r\n}\r\n\r\ntype RawPayloadResult = {\r\n  inserted: boolean\r\n  id: number | null\r\n  contentHash: string\r\n  r2Key: string\r\n}\r\n\r\ntype RawEnv = {\r\n  DB: D1Database\r\n  RAW_BUCKET: R2Bucket\r\n}\r\n\r\nfunction contentTypeForSource(sourceType: SourceType): string {\r\n  return sourceType === 'wayback_html' ? 'text/html; charset=utf-8' : 'application/json; charset=utf-8'\r\n}\r\n\r\nfunction serializePayload(payload: unknown): string {\r\n  if (typeof payload === 'string') {\r\n    return payload\r\n  }\r\n  if (payload instanceof Uint8Array) {\r\n    return new TextDecoder().decode(payload)\r\n  }\r\n  if (payload instanceof ArrayBuffer) {\r\n    return new TextDecoder().decode(new Uint8Array(payload))\r\n  }\r\n\r\n  try {\r\n    return JSON.stringify(payload ?? null, null, 2)\r\n  } catch {\r\n    return JSON.stringify({ fallback: String(payload) })\r\n  }\r\n}\r\n\r\nexport async function persistRawPayload(env: RawEnv, input: RawPayloadInput): Promise<RawPayloadResult> {\r\n  const fetchedAtIso = input.fetchedAtIso || nowIso()\r\n  const payloadText = serializePayload(input.payload)\r\n  const payloadBytes = new TextEncoder().encode(payloadText)\r\n  const contentHash = await sha256HexFromBytes(payloadBytes)\r\n\r\n  const existing = await env.DB.prepare(\r\n    `SELECT id, r2_key\r\n     FROM raw_payloads\r\n     WHERE source_type = ?1\r\n       AND source_url = ?2\r\n       AND content_hash = ?3\r\n     LIMIT 1`,\r\n  )\r\n    .bind(input.sourceType, input.sourceUrl, contentHash)\r\n    .first<{ id: number; r2_key: string }>()\r\n\r\n  if (existing) {\r\n    return {\r\n      inserted: false,\r\n      id: Number(existing.id),\r\n      contentHash,\r\n      r2Key: existing.r2_key,\r\n    }\r\n  }\r\n\r\n  const r2Key = buildRawR2Key(input.sourceType, fetchedAtIso, contentHash)\r\n  await env.RAW_BUCKET.put(r2Key, payloadText, {\r\n    httpMetadata: {\r\n      contentType: contentTypeForSource(input.sourceType),\r\n    },\r\n    customMetadata: {\r\n      source_type: input.sourceType,\r\n      source_url: input.sourceUrl,\r\n      content_hash: contentHash,\r\n    },\r\n  })\r\n\r\n  const inserted = await env.DB.prepare(\r\n    `INSERT INTO raw_payloads (\r\n      source_type,\r\n      fetched_at,\r\n      source_url,\r\n      content_hash,\r\n      r2_key,\r\n      http_status,\r\n      notes\r\n    ) VALUES (?1, ?2, ?3, ?4, ?5, ?6, ?7)`,\r\n  )\r\n    .bind(\r\n      input.sourceType,\r\n      fetchedAtIso,\r\n      input.sourceUrl,\r\n      contentHash,\r\n      r2Key,\r\n      input.httpStatus == null ? null : Math.floor(input.httpStatus),\r\n      input.notes ?? null,\r\n    )\r\n    .run()\r\n\r\n  return {\r\n    inserted: Number(inserted.meta?.changes || 0) > 0,\r\n    id: Number(inserted.meta?.last_row_id || 0) || null,\r\n    contentHash,\r\n    r2Key,\r\n  }\r\n}", "import { normalizeBankName, normalizeProductName } from './normalize'\r\nimport {\r\n  normalizeAccountType,\r\n  normalizeDepositRateType,\r\n  normalizeDepositTier,\r\n  normalizeInterestPayment,\r\n  parseSavingsInterestRate,\r\n  parseTermMonths,\r\n  type NormalizedSavingsRow,\r\n  type NormalizedTdRow,\r\n} from './normalize-savings'\r\nimport {\r\n  asArray,\r\n  extractProducts,\r\n  fetchCdrJson,\r\n  getText,\r\n  isRecord,\r\n  nextLink,\r\n  pickText,\r\n  type JsonRecord,\r\n} from './cdr'\r\nimport type { LenderConfig } from '../types'\r\n\r\nexport function isSavingsAccount(product: JsonRecord): boolean {\r\n  const category = pickText(product, ['productCategory', 'category', 'type']).toUpperCase()\r\n  const name = pickText(product, ['name', 'productName']).toUpperCase()\r\n  if (category.includes('TRANS_AND_SAVINGS') || category.includes('SAVINGS')) return true\r\n  if (name.includes('SAVINGS') || name.includes('SAVER') || name.includes('AT CALL')) return true\r\n  return false\r\n}\r\n\r\nexport function isTermDeposit(product: JsonRecord): boolean {\r\n  const category = pickText(product, ['productCategory', 'category', 'type']).toUpperCase()\r\n  const name = pickText(product, ['name', 'productName']).toUpperCase()\r\n  if (category.includes('TERM_DEPOSIT')) return true\r\n  if (name.includes('TERM DEPOSIT') || name.includes('FIXED DEPOSIT')) return true\r\n  return false\r\n}\r\n\r\nfunction extractDepositRatesArray(detail: JsonRecord): JsonRecord[] {\r\n  const arrays = [detail.depositRates, detail.rates, detail.rateTiers, detail.rate]\r\n  for (const candidate of arrays) {\r\n    const arr = asArray(candidate).filter(isRecord)\r\n    if (arr.length > 0) return arr\r\n  }\r\n  return []\r\n}\r\n\r\nfunction parseTierBounds(rate: JsonRecord): { min: number | null; max: number | null } {\r\n  const tiers = asArray(rate.tiers).filter(isRecord)\r\n  for (const tier of tiers) {\r\n    const unitOfMeasure = getText(tier.unitOfMeasure).toUpperCase()\r\n    if (unitOfMeasure && unitOfMeasure !== 'DOLLAR' && unitOfMeasure !== 'AMOUNT') continue\r\n    const min = Number.isFinite(Number(tier.minimumValue)) ? Number(tier.minimumValue) : null\r\n    const max = Number.isFinite(Number(tier.maximumValue)) ? Number(tier.maximumValue) : null\r\n    if (min != null || max != null) return { min, max }\r\n  }\r\n  return { min: null, max: null }\r\n}\r\n\r\nfunction collectConditionsText(rate: JsonRecord, detail: JsonRecord): string {\r\n  const parts: string[] = []\r\n  const info = getText(rate.additionalInfo)\r\n  if (info) parts.push(info)\r\n  const value = getText(rate.additionalValue)\r\n  if (value && !value.match(/^P\\d+[DMYW]$/)) parts.push(value)\r\n  const desc = getText(detail.description)\r\n  if (desc && desc.length < 300) parts.push(desc)\r\n  return parts.filter(Boolean).join(' | ')\r\n}\r\n\r\nfunction parseMonthlyFeeFromDetail(detail: JsonRecord): number | null {\r\n  const fees = asArray(detail.fees).filter(isRecord)\r\n  for (const fee of fees) {\r\n    const feeType = pickText(fee, ['feeType', 'name']).toLowerCase()\r\n    if (!feeType.includes('monthly') && !feeType.includes('service')) continue\r\n    const amount = Number(fee.amount ?? fee.additionalValue)\r\n    if (Number.isFinite(amount) && amount >= 0 && amount <= 50) return amount\r\n  }\r\n  return null\r\n}\r\n\r\nexport function parseSavingsRatesFromDetail(input: {\r\n  lender: LenderConfig\r\n  detail: JsonRecord\r\n  sourceUrl: string\r\n  collectionDate: string\r\n}): NormalizedSavingsRow[] {\r\n  const { detail, lender, sourceUrl, collectionDate } = input\r\n  const productId = pickText(detail, ['productId', 'id'])\r\n  const productName = normalizeProductName(pickText(detail, ['name', 'productName']))\r\n  if (!productId || !productName) return []\r\n\r\n  const rates = extractDepositRatesArray(detail)\r\n  if (rates.length === 0) return []\r\n\r\n  const monthlyFee = parseMonthlyFeeFromDetail(detail)\r\n  const result: NormalizedSavingsRow[] = []\r\n  const accountType = normalizeAccountType(`${productName} ${pickText(detail, ['description', 'productCategory'])}`)\r\n\r\n  for (const rate of rates) {\r\n    const depositRateType = getText(rate.depositRateType || rate.rateType || rate.type)\r\n    const rateType = normalizeDepositRateType(depositRateType)\r\n    const interestRate = parseSavingsInterestRate(rate.rate ?? rate.interestRate ?? rate.value)\r\n    if (interestRate == null) continue\r\n\r\n    const bounds = parseTierBounds(rate)\r\n    const depositTier = normalizeDepositTier(bounds.min, bounds.max)\r\n    const conditions = collectConditionsText(rate, detail)\r\n\r\n    let confidence = 0.93\r\n    if (!conditions) confidence -= 0.03\r\n\r\n    result.push({\r\n      bankName: normalizeBankName(lender.canonical_bank_name, lender.name),\r\n      collectionDate,\r\n      productId,\r\n      productName,\r\n      accountType,\r\n      rateType,\r\n      interestRate,\r\n      depositTier,\r\n      minBalance: bounds.min,\r\n      maxBalance: bounds.max,\r\n      conditions: conditions || null,\r\n      monthlyFee,\r\n      sourceUrl,\r\n      dataQualityFlag: 'cdr_live',\r\n      confidenceScore: Number(Math.max(0.6, Math.min(0.99, confidence)).toFixed(3)),\r\n    })\r\n  }\r\n\r\n  return result\r\n}\r\n\r\nexport function parseTermDepositRatesFromDetail(input: {\r\n  lender: LenderConfig\r\n  detail: JsonRecord\r\n  sourceUrl: string\r\n  collectionDate: string\r\n}): NormalizedTdRow[] {\r\n  const { detail, lender, sourceUrl, collectionDate } = input\r\n  const productId = pickText(detail, ['productId', 'id'])\r\n  const productName = normalizeProductName(pickText(detail, ['name', 'productName']))\r\n  if (!productId || !productName) return []\r\n\r\n  const rates = extractDepositRatesArray(detail)\r\n  if (rates.length === 0) return []\r\n\r\n  const result: NormalizedTdRow[] = []\r\n\r\n  for (const rate of rates) {\r\n    const interestRate = parseSavingsInterestRate(rate.rate ?? rate.interestRate ?? rate.value)\r\n    if (interestRate == null) continue\r\n\r\n    const additionalValue = getText(rate.additionalValue)\r\n    const termMonths = parseTermMonths(additionalValue) ?? parseTermMonths(getText(rate.name)) ?? parseTermMonths(productName)\r\n    if (termMonths == null || termMonths < 1) continue\r\n\r\n    const bounds = parseTierBounds(rate)\r\n    const depositTier = normalizeDepositTier(bounds.min, bounds.max)\r\n    const paymentText = `${getText(rate.applicationFrequency)} ${getText(rate.additionalInfo)}`\r\n    const interestPayment = normalizeInterestPayment(paymentText)\r\n\r\n    let confidence = 0.93\r\n    if (!additionalValue) confidence -= 0.03\r\n\r\n    result.push({\r\n      bankName: normalizeBankName(lender.canonical_bank_name, lender.name),\r\n      collectionDate,\r\n      productId,\r\n      productName,\r\n      termMonths,\r\n      interestRate,\r\n      depositTier,\r\n      minDeposit: bounds.min,\r\n      maxDeposit: bounds.max,\r\n      interestPayment,\r\n      sourceUrl,\r\n      dataQualityFlag: 'cdr_live',\r\n      confidenceScore: Number(Math.max(0.6, Math.min(0.99, confidence)).toFixed(3)),\r\n    })\r\n  }\r\n\r\n  return result\r\n}\r\n\r\ntype ProductListFetchResult = {\r\n  productIds: string[]\r\n  rawPayloads: Array<{ sourceUrl: string; status: number; body: string }>\r\n}\r\n\r\nexport async function fetchSavingsProductIds(\r\n  endpointUrl: string,\r\n  pageLimit = 20,\r\n  options?: { cdrVersions?: number[] },\r\n): Promise<ProductListFetchResult> {\r\n  const ids = new Set<string>()\r\n  const payloads: Array<{ sourceUrl: string; status: number; body: string }> = []\r\n  let url: string | null = endpointUrl\r\n  let pages = 0\r\n  const versions = options?.cdrVersions?.length ? options.cdrVersions : [6, 5, 4, 3]\r\n\r\n  while (url && pages < pageLimit) {\r\n    pages += 1\r\n    const response = await fetchCdrJson(url, versions)\r\n    payloads.push({ sourceUrl: url, status: response.status, body: response.text })\r\n    if (!response.ok || !response.data) break\r\n\r\n    const products = extractProducts(response.data)\r\n    for (const product of products) {\r\n      if (!isSavingsAccount(product)) continue\r\n      const id = pickText(product, ['productId', 'id'])\r\n      if (id) ids.add(id)\r\n    }\r\n    url = nextLink(response.data)\r\n  }\r\n\r\n  return { productIds: Array.from(ids), rawPayloads: payloads }\r\n}\r\n\r\nexport async function fetchTermDepositProductIds(\r\n  endpointUrl: string,\r\n  pageLimit = 20,\r\n  options?: { cdrVersions?: number[] },\r\n): Promise<ProductListFetchResult> {\r\n  const ids = new Set<string>()\r\n  const payloads: Array<{ sourceUrl: string; status: number; body: string }> = []\r\n  let url: string | null = endpointUrl\r\n  let pages = 0\r\n  const versions = options?.cdrVersions?.length ? options.cdrVersions : [6, 5, 4, 3]\r\n\r\n  while (url && pages < pageLimit) {\r\n    pages += 1\r\n    const response = await fetchCdrJson(url, versions)\r\n    payloads.push({ sourceUrl: url, status: response.status, body: response.text })\r\n    if (!response.ok || !response.data) break\r\n\r\n    const products = extractProducts(response.data)\r\n    for (const product of products) {\r\n      if (!isTermDeposit(product)) continue\r\n      const id = pickText(product, ['productId', 'id'])\r\n      if (id) ids.add(id)\r\n    }\r\n    url = nextLink(response.data)\r\n  }\r\n\r\n  return { productIds: Array.from(ids), rawPayloads: payloads }\r\n}\r\n\r\nexport async function fetchSavingsProductDetailRows(input: {\r\n  lender: LenderConfig\r\n  endpointUrl: string\r\n  productId: string\r\n  collectionDate: string\r\n  cdrVersions?: number[]\r\n}): Promise<{ savingsRows: NormalizedSavingsRow[]; rawPayload: { sourceUrl: string; status: number; body: string } }> {\r\n  const detailUrl = `${input.endpointUrl.replace(/\\/+$/, '')}/${encodeURIComponent(input.productId)}`\r\n  const versions = input.cdrVersions?.length ? input.cdrVersions : [6, 5, 4, 3]\r\n  const fetched = await fetchCdrJson(detailUrl, versions)\r\n  const rawPayload = { sourceUrl: detailUrl, status: fetched.status, body: fetched.text }\r\n\r\n  if (!fetched.ok || !isRecord(fetched.data)) return { savingsRows: [], rawPayload }\r\n\r\n  const detail = isRecord((fetched.data as JsonRecord).data)\r\n    ? ((fetched.data as JsonRecord).data as JsonRecord)\r\n    : (fetched.data as JsonRecord)\r\n\r\n  return {\r\n    savingsRows: parseSavingsRatesFromDetail({\r\n      lender: input.lender,\r\n      detail,\r\n      sourceUrl: detailUrl,\r\n      collectionDate: input.collectionDate,\r\n    }),\r\n    rawPayload,\r\n  }\r\n}\r\n\r\nexport async function fetchTdProductDetailRows(input: {\r\n  lender: LenderConfig\r\n  endpointUrl: string\r\n  productId: string\r\n  collectionDate: string\r\n  cdrVersions?: number[]\r\n}): Promise<{ tdRows: NormalizedTdRow[]; rawPayload: { sourceUrl: string; status: number; body: string } }> {\r\n  const detailUrl = `${input.endpointUrl.replace(/\\/+$/, '')}/${encodeURIComponent(input.productId)}`\r\n  const versions = input.cdrVersions?.length ? input.cdrVersions : [6, 5, 4, 3]\r\n  const fetched = await fetchCdrJson(detailUrl, versions)\r\n  const rawPayload = { sourceUrl: detailUrl, status: fetched.status, body: fetched.text }\r\n\r\n  if (!fetched.ok || !isRecord(fetched.data)) return { tdRows: [], rawPayload }\r\n\r\n  const detail = isRecord((fetched.data as JsonRecord).data)\r\n    ? ((fetched.data as JsonRecord).data as JsonRecord)\r\n    : (fetched.data as JsonRecord)\r\n\r\n  return {\r\n    tdRows: parseTermDepositRatesFromDetail({\r\n      lender: input.lender,\r\n      detail,\r\n      sourceUrl: detailUrl,\r\n      collectionDate: input.collectionDate,\r\n    }),\r\n    rawPayload,\r\n  }\r\n}\r\n", "import type { LenderConfig } from '../types'\r\nimport { getLenderPlaybook } from './lender-playbooks'\r\nimport {\r\n  normalizeBankName,\r\n  normalizeFeatureSet,\r\n  normalizeLvrTier,\r\n  normalizeProductName,\r\n  normalizeRateStructure,\r\n  normalizeRepaymentType,\r\n  normalizeSecurityPurpose,\r\n  parseComparisonRate,\r\n  parseInterestRate,\r\n  isProductNameLikelyRateProduct,\r\n  type NormalizedRateRow,\r\n} from './normalize'\r\n\r\ntype ParseMode = 'daily' | 'historical'\r\n\r\nexport type HtmlParseResult = {\r\n  rows: NormalizedRateRow[]\r\n  inspected: number\r\n  dropped: number\r\n}\r\n\r\nfunction hashString(input: string): number {\r\n  let h = 0\r\n  for (let i = 0; i < input.length; i += 1) {\r\n    h = (Math.imul(31, h) + input.charCodeAt(i)) | 0\r\n  }\r\n  return h\r\n}\r\n\r\nfunction cleanHtmlToLines(html: string): string[] {\r\n  const marked = html\r\n    .replace(/<script[\\s\\S]*?<\\/script>/gi, ' ')\r\n    .replace(/<style[\\s\\S]*?<\\/style>/gi, ' ')\r\n    .replace(/<(tr|li|p|br|div|td|th|h[1-6])\\b[^>]*>/gi, '\\n')\r\n    .replace(/<\\/(tr|li|p|div|td|th|h[1-6])>/gi, '\\n')\r\n    .replace(/<[^>]+>/g, ' ')\r\n    .replace(/&nbsp;/gi, ' ')\r\n    .replace(/\\u00a0/g, ' ')\r\n\r\n  return marked\r\n    .split(/\\n+/)\r\n    .map((line) => line.replace(/\\s+/g, ' ').trim())\r\n    .filter((line) => line.length >= 4)\r\n}\r\n\r\nfunction parseRatesFromText(text: string): { rates: number[]; comparisonRate: number | null } {\r\n  const numericTokens = Array.from(text.matchAll(/\\b(\\d{1,2}(?:\\.\\d{1,3})?)\\s*%/g)).map((m) => m[1])\r\n  const parsed = numericTokens\r\n    .map((token) => parseInterestRate(`${token}%`))\r\n    .filter((x): x is number => x != null)\r\n\r\n  if (parsed.length === 0) {\r\n    return { rates: [], comparisonRate: null }\r\n  }\r\n\r\n  // Comparison rate is often explicitly labeled and appears as a second percentage.\r\n  const hasComparisonLabel = /comparison\\s+rate/i.test(text)\r\n  const comparisonRate = hasComparisonLabel && parsed.length > 1 ? parseComparisonRate(`${parsed[1]}%`) : null\r\n  return {\r\n    rates: [parsed[0]],\r\n    comparisonRate,\r\n  }\r\n}\r\n\r\nfunction isExcluded(text: string, excludes: string[]): boolean {\r\n  const t = text.toLowerCase()\r\n  return excludes.some((x) => t.includes(x))\r\n}\r\n\r\nfunction hasIncludeSignal(text: string, includes: string[]): boolean {\r\n  const t = text.toLowerCase()\r\n  if (includes.some((x) => t.includes(x))) return true\r\n  return t.includes('rate')\r\n}\r\n\r\nfunction buildProductName(currentLine: string, previousLine: string): string {\r\n  const stripped = currentLine\r\n    .replace(/\\b\\d{1,2}(?:\\.\\d{1,3})?\\s*%/g, ' ')\r\n    .replace(/comparison\\s+rate/gi, ' ')\r\n    .replace(/\\s+/g, ' ')\r\n    .trim()\r\n  const primary = normalizeProductName(stripped)\r\n  if (isProductNameLikelyRateProduct(primary)) {\r\n    return primary\r\n  }\r\n  return normalizeProductName(`${previousLine} ${primary}`)\r\n}\r\n\r\nexport function extractLenderRatesFromHtml(input: {\r\n  lender: LenderConfig\r\n  html: string\r\n  sourceUrl: string\r\n  collectionDate: string\r\n  mode: ParseMode\r\n  qualityFlag: string\r\n}): HtmlParseResult {\r\n  const playbook = getLenderPlaybook(input.lender)\r\n  const lines = cleanHtmlToLines(input.html)\r\n  const rows: NormalizedRateRow[] = []\r\n  const seen = new Set<string>()\r\n  let dropped = 0\r\n  let inspected = 0\r\n\r\n  for (let i = 0; i < lines.length; i += 1) {\r\n    const previous = i > 0 ? lines[i - 1] : ''\r\n    const current = lines[i]\r\n    const context = `${previous} ${current}`.trim()\r\n\r\n    if (!hasIncludeSignal(context, playbook.includeKeywords)) continue\r\n    if (isExcluded(context, playbook.excludeKeywords)) continue\r\n\r\n    inspected += 1\r\n    const parsed = parseRatesFromText(context)\r\n    if (parsed.rates.length === 0) {\r\n      dropped += 1\r\n      continue\r\n    }\r\n\r\n    const interestRate = parsed.rates[0]\r\n    if (interestRate < playbook.minRatePercent || interestRate > playbook.maxRatePercent) {\r\n      dropped += 1\r\n      continue\r\n    }\r\n\r\n    const productName = buildProductName(current, previous)\r\n    if (!isProductNameLikelyRateProduct(productName)) {\r\n      dropped += 1\r\n      continue\r\n    }\r\n\r\n    let confidence = input.mode === 'daily' ? 0.94 : 0.86\r\n    if (!/rate/i.test(context)) confidence -= 0.05\r\n    if (/comparison\\s+rate/i.test(context)) confidence += 0.01\r\n    if (!playbook.includeKeywords.some((x) => context.toLowerCase().includes(x))) confidence -= 0.08\r\n\r\n    const minConfidence = input.mode === 'daily' ? playbook.dailyMinConfidence : playbook.historicalMinConfidence\r\n    if (confidence < minConfidence) {\r\n      dropped += 1\r\n      continue\r\n    }\r\n\r\n    const securityPurpose = normalizeSecurityPurpose(context)\r\n    const repaymentType = normalizeRepaymentType(context)\r\n    const rateStructure = normalizeRateStructure(context)\r\n    const lvrResult = normalizeLvrTier(context)\r\n    if (lvrResult.wasDefault) confidence -= 0.03\r\n    const featureSet = normalizeFeatureSet(productName, null)\r\n    const productId = `${input.lender.code}-html-${Math.abs(hashString(`${productName}|${rateStructure}|${lvrResult.tier}`))}`\r\n    const rowKey = `${productId}|${input.collectionDate}|${interestRate}`\r\n    if (seen.has(rowKey)) continue\r\n    seen.add(rowKey)\r\n\r\n    rows.push({\r\n      bankName: normalizeBankName(input.lender.canonical_bank_name, input.lender.name),\r\n      collectionDate: input.collectionDate,\r\n      productId,\r\n      productName,\r\n      securityPurpose,\r\n      repaymentType,\r\n      rateStructure,\r\n      lvrTier: lvrResult.tier,\r\n      featureSet,\r\n      interestRate,\r\n      comparisonRate: parsed.comparisonRate,\r\n      annualFee: null,\r\n      sourceUrl: input.sourceUrl,\r\n      dataQualityFlag: input.qualityFlag,\r\n      confidenceScore: Number(confidence.toFixed(3)),\r\n    })\r\n  }\r\n\r\n  return { rows, inspected, dropped }\r\n}\r\n", "import { DEFAULT_MAX_QUEUE_ATTEMPTS, TARGET_LENDERS } from '../constants'\r\nimport { upsertHistoricalRateRows } from '../db/historical-rates'\r\nimport { upsertSavingsRateRows } from '../db/savings-rates'\r\nimport { upsertTdRateRows } from '../db/td-rates'\r\nimport { getCachedEndpoint } from '../db/endpoint-cache'\r\nimport { persistRawPayload } from '../db/raw-payloads'\r\nimport { recordRunQueueOutcome } from '../db/run-reports'\r\nimport {\r\n  buildBackfillCursorKey,\r\n  cdrCollectionNotes,\r\n  discoverProductsEndpoint,\r\n  fetchProductDetailRows,\r\n  fetchResidentialMortgageProductIds,\r\n} from '../ingest/cdr'\r\nimport {\r\n  fetchSavingsProductIds,\r\n  fetchSavingsProductDetailRows,\r\n  fetchTermDepositProductIds,\r\n  fetchTdProductDetailRows,\r\n} from '../ingest/cdr-savings'\r\nimport { validateNormalizedSavingsRow, type NormalizedSavingsRow } from '../ingest/normalize-savings'\r\nimport { validateNormalizedTdRow, type NormalizedTdRow } from '../ingest/normalize-savings'\r\nimport { extractLenderRatesFromHtml } from '../ingest/html-rate-parser'\r\nimport { getLenderPlaybook } from '../ingest/lender-playbooks'\r\nimport { type NormalizedRateRow, validateNormalizedRow } from '../ingest/normalize'\r\nimport type { BackfillSnapshotJob, DailyLenderJob, DailySavingsLenderJob, EnvBindings, IngestMessage, ProductDetailJob } from '../types'\r\nimport { log } from '../utils/logger'\r\nimport { nowIso, parseIntegerEnv } from '../utils/time'\r\n\r\nexport function calculateRetryDelaySeconds(attempts: number): number {\r\n  const safeAttempt = Math.max(1, Math.floor(attempts))\r\n  return Math.min(900, 15 * Math.pow(2, safeAttempt - 1))\r\n}\r\n\r\nfunction isObject(value: unknown): value is Record<string, unknown> {\r\n  return !!value && typeof value === 'object'\r\n}\r\n\r\nfunction isIngestMessage(value: unknown): value is IngestMessage {\r\n  if (!isObject(value) || typeof value.kind !== 'string') {\r\n    return false\r\n  }\r\n\r\n  if (value.kind === 'daily_lender_fetch') {\r\n    return typeof value.runId === 'string' && typeof value.lenderCode === 'string' && typeof value.collectionDate === 'string'\r\n  }\r\n\r\n  if (value.kind === 'product_detail_fetch') {\r\n    return (\r\n      typeof value.runId === 'string' &&\r\n      typeof value.lenderCode === 'string' &&\r\n      typeof value.productId === 'string' &&\r\n      typeof value.collectionDate === 'string'\r\n    )\r\n  }\r\n\r\n  if (value.kind === 'backfill_snapshot_fetch') {\r\n    return (\r\n      typeof value.runId === 'string' &&\r\n      typeof value.lenderCode === 'string' &&\r\n      typeof value.seedUrl === 'string' &&\r\n      typeof value.monthCursor === 'string'\r\n    )\r\n  }\r\n\r\n  if (value.kind === 'daily_savings_lender_fetch') {\r\n    return typeof value.runId === 'string' && typeof value.lenderCode === 'string' && typeof value.collectionDate === 'string'\r\n  }\r\n\r\n  return false\r\n}\r\n\r\nfunction extractRunContext(body: unknown): { runId: string | null; lenderCode: string | null } {\r\n  if (!isObject(body)) {\r\n    return { runId: null, lenderCode: null }\r\n  }\r\n\r\n  const runId = typeof body.runId === 'string' ? body.runId : null\r\n  const lenderCode = typeof body.lenderCode === 'string' ? body.lenderCode : null\r\n  return { runId, lenderCode }\r\n}\r\n\r\nfunction splitValidatedRows(rows: NormalizedRateRow[]): {\r\n  accepted: NormalizedRateRow[]\r\n  dropped: Array<{ reason: string; productId: string }>\r\n} {\r\n  const accepted: NormalizedRateRow[] = []\r\n  const dropped: Array<{ reason: string; productId: string }> = []\r\n  for (const row of rows) {\r\n    const verdict = validateNormalizedRow(row)\r\n    if (verdict.ok) {\r\n      accepted.push(row)\r\n    } else {\r\n      dropped.push({\r\n        reason: verdict.reason,\r\n        productId: row.productId,\r\n      })\r\n    }\r\n  }\r\n  return { accepted, dropped }\r\n}\r\n\r\nfunction splitValidatedSavingsRows(rows: NormalizedSavingsRow[]) {\r\n  const accepted: NormalizedSavingsRow[] = []\r\n  const dropped: Array<{ reason: string; productId: string }> = []\r\n  for (const row of rows) {\r\n    const verdict = validateNormalizedSavingsRow(row)\r\n    if (verdict.ok) accepted.push(row)\r\n    else dropped.push({ reason: verdict.reason, productId: row.productId })\r\n  }\r\n  return { accepted, dropped }\r\n}\r\n\r\nfunction splitValidatedTdRows(rows: NormalizedTdRow[]) {\r\n  const accepted: NormalizedTdRow[] = []\r\n  const dropped: Array<{ reason: string; productId: string }> = []\r\n  for (const row of rows) {\r\n    const verdict = validateNormalizedTdRow(row)\r\n    if (verdict.ok) accepted.push(row)\r\n    else dropped.push({ reason: verdict.reason, productId: row.productId })\r\n  }\r\n  return { accepted, dropped }\r\n}\r\n\r\nasync function handleDailyLenderJob(env: EnvBindings, job: DailyLenderJob): Promise<void> {\r\n  const lender = TARGET_LENDERS.find((x) => x.code === job.lenderCode)\r\n  if (!lender) {\r\n    throw new Error(`unknown_lender_code:${job.lenderCode}`)\r\n  }\r\n  log.info('consumer', `daily_lender_fetch started`, { runId: job.runId, lenderCode: job.lenderCode })\r\n\r\n  const playbook = getLenderPlaybook(lender)\r\n  const endpoint = await getCachedEndpoint(env.DB, job.lenderCode)\r\n  let sourceUrl = ''\r\n  const endpointCandidates: string[] = []\r\n  if (endpoint?.endpointUrl) endpointCandidates.push(endpoint.endpointUrl)\r\n  if (lender.products_endpoint) endpointCandidates.push(lender.products_endpoint)\r\n  const discovered = await discoverProductsEndpoint(lender)\r\n  if (discovered?.endpointUrl) endpointCandidates.push(discovered.endpointUrl)\r\n  const uniqueCandidates = Array.from(new Set(endpointCandidates.filter(Boolean)))\r\n\r\n  const collectedRows: NormalizedRateRow[] = []\r\n  let inspectedHtml = 0\r\n  let droppedByParser = 0\r\n\r\n  for (const candidateEndpoint of uniqueCandidates) {\r\n    const products = await fetchResidentialMortgageProductIds(candidateEndpoint, 20, { cdrVersions: playbook.cdrVersions })\r\n    for (const payload of products.rawPayloads) {\r\n      await persistRawPayload(env, {\r\n        sourceType: 'cdr_products',\r\n        sourceUrl: payload.sourceUrl,\r\n        payload: payload.body,\r\n        httpStatus: payload.status,\r\n        notes: `daily_product_index lender=${job.lenderCode}`,\r\n      })\r\n    }\r\n\r\n    const productIds = products.productIds.slice(0, 250)\r\n    for (const productId of productIds) {\r\n      const details = await fetchProductDetailRows({\r\n        lender,\r\n        endpointUrl: candidateEndpoint,\r\n        productId,\r\n        collectionDate: job.collectionDate,\r\n        cdrVersions: playbook.cdrVersions,\r\n      })\r\n\r\n      await persistRawPayload(env, {\r\n        sourceType: 'cdr_product_detail',\r\n        sourceUrl: details.rawPayload.sourceUrl,\r\n        payload: details.rawPayload.body,\r\n        httpStatus: details.rawPayload.status,\r\n        notes: `daily_product_detail lender=${job.lenderCode} product=${productId}`,\r\n      })\r\n\r\n      for (const row of details.rows) {\r\n        collectedRows.push(row)\r\n      }\r\n    }\r\n    if (collectedRows.length > 0) {\r\n      sourceUrl = candidateEndpoint\r\n      break\r\n    }\r\n  }\r\n\r\n  if (collectedRows.length === 0) {\r\n    for (const seedUrl of lender.seed_rate_urls.slice(0, 2)) {\r\n      const response = await fetch(seedUrl)\r\n      const html = await response.text()\r\n      await persistRawPayload(env, {\r\n        sourceType: 'wayback_html',\r\n        sourceUrl: seedUrl,\r\n        payload: html,\r\n        httpStatus: response.status,\r\n        notes: `fallback_scrape lender=${job.lenderCode}`,\r\n      })\r\n      const parsed = extractLenderRatesFromHtml({\r\n        lender,\r\n        html,\r\n        sourceUrl: seedUrl,\r\n        collectionDate: job.collectionDate,\r\n        mode: 'daily',\r\n        qualityFlag: 'scraped_fallback_strict',\r\n      })\r\n      inspectedHtml += parsed.inspected\r\n      droppedByParser += parsed.dropped\r\n      for (const row of parsed.rows) {\r\n        collectedRows.push(row)\r\n      }\r\n    }\r\n  }\r\n\r\n  const { accepted, dropped } = splitValidatedRows(collectedRows)\r\n  for (const row of accepted) {\r\n    row.runId = job.runId\r\n    row.runSource = job.runSource ?? 'scheduled'\r\n  }\r\n  if (accepted.length === 0) {\r\n    await persistRawPayload(env, {\r\n      sourceType: 'cdr_products',\r\n      sourceUrl: sourceUrl || `fallback://${job.lenderCode}`,\r\n      payload: {\r\n        lenderCode: job.lenderCode,\r\n        runId: job.runId,\r\n        collectionDate: job.collectionDate,\r\n        fetchedAt: nowIso(),\r\n        acceptedRows: 0,\r\n        rejectedRows: dropped.length,\r\n        inspectedHtml,\r\n        droppedByParser,\r\n      },\r\n      httpStatus: 422,\r\n      notes: `daily_quality_rejected lender=${job.lenderCode}`,\r\n    })\r\n    log.warn('consumer', `daily_ingest_no_valid_rows`, { runId: job.runId, lenderCode: job.lenderCode })\r\n    throw new Error(`daily_ingest_no_valid_rows:${job.lenderCode}`)\r\n  }\r\n\r\n  const written = await upsertHistoricalRateRows(env.DB, accepted)\r\n  log.info('consumer', `daily_lender_fetch completed: ${written} written, ${dropped.length} dropped`, {\r\n    runId: job.runId,\r\n    lenderCode: job.lenderCode,\r\n    context: `collected=${collectedRows.length} accepted=${accepted.length} dropped=${dropped.length}`,\r\n  })\r\n\r\n  await persistRawPayload(env, {\r\n    sourceType: 'cdr_products',\r\n    sourceUrl: sourceUrl || `fallback://${job.lenderCode}`,\r\n    payload: {\r\n      lenderCode: job.lenderCode,\r\n      runId: job.runId,\r\n      collectionDate: job.collectionDate,\r\n      fetchedAt: nowIso(),\r\n      productsRows: collectedRows.length,\r\n      acceptedRows: accepted.length,\r\n      rejectedRows: dropped.length,\r\n      inspectedHtml,\r\n      droppedByParser,\r\n    },\r\n    httpStatus: 200,\r\n    notes: cdrCollectionNotes(collectedRows.length, accepted.length),\r\n  })\r\n}\r\n\r\nasync function handleProductDetailJob(env: EnvBindings, job: ProductDetailJob): Promise<void> {\r\n  const endpoint = await getCachedEndpoint(env.DB, job.lenderCode)\r\n  const lender = TARGET_LENDERS.find((x) => x.code === job.lenderCode)\r\n  if (!endpoint || !lender) {\r\n    log.warn('consumer', `product_detail_fetch skipped: missing endpoint or lender`, { runId: job.runId, lenderCode: job.lenderCode })\r\n    return\r\n  }\r\n  log.info('consumer', `product_detail_fetch started for ${job.productId}`, { runId: job.runId, lenderCode: job.lenderCode })\r\n\r\n  const details = await fetchProductDetailRows({\r\n    lender,\r\n    endpointUrl: endpoint.endpointUrl,\r\n    productId: job.productId,\r\n    collectionDate: job.collectionDate,\r\n    cdrVersions: getLenderPlaybook(lender).cdrVersions,\r\n  })\r\n\r\n  await persistRawPayload(env, {\r\n    sourceType: 'cdr_product_detail',\r\n    sourceUrl: details.rawPayload.sourceUrl,\r\n    payload: details.rawPayload.body,\r\n    httpStatus: details.rawPayload.status,\r\n    notes: `direct_product_detail lender=${job.lenderCode} product=${job.productId}`,\r\n  })\r\n  const { accepted } = splitValidatedRows(details.rows)\r\n  for (const row of accepted) {\r\n    row.runId = job.runId\r\n    row.runSource = job.runSource ?? 'scheduled'\r\n  }\r\n  if (accepted.length > 0) {\r\n    await upsertHistoricalRateRows(env.DB, accepted)\r\n  }\r\n}\r\n\r\nasync function handleBackfillSnapshotJob(env: EnvBindings, job: BackfillSnapshotJob): Promise<void> {\r\n  const lender = TARGET_LENDERS.find((x) => x.code === job.lenderCode)\r\n  if (!lender) {\r\n    throw new Error(`unknown_lender_code:${job.lenderCode}`)\r\n  }\r\n  log.info('consumer', `backfill_snapshot_fetch started month=${job.monthCursor}`, { runId: job.runId, lenderCode: job.lenderCode })\r\n\r\n  const [year, month] = job.monthCursor.split('-')\r\n  const from = `${year}${month}01`\r\n  const to = `${year}${month}31`\r\n  const cdxUrl = `https://web.archive.org/cdx/search/cdx?url=${encodeURIComponent(\r\n    job.seedUrl,\r\n  )}&from=${from}&to=${to}&output=json&fl=timestamp,original,statuscode,mimetype,digest&filter=statuscode:200&collapse=digest&limit=8`\r\n  const cdxResponse = await fetch(cdxUrl)\r\n  const cdxBody = await cdxResponse.text()\r\n\r\n  await persistRawPayload(env, {\r\n    sourceType: 'wayback_html',\r\n    sourceUrl: cdxUrl,\r\n    payload: cdxBody,\r\n    httpStatus: cdxResponse.status,\r\n    notes: `wayback_cdx lender=${job.lenderCode} month=${job.monthCursor}`,\r\n  })\r\n\r\n  const rows: Array<Array<string>> = []\r\n  try {\r\n    const parsed = JSON.parse(cdxBody)\r\n    if (Array.isArray(parsed)) {\r\n      for (let i = 1; i < parsed.length; i += 1) {\r\n        if (Array.isArray(parsed[i])) rows.push((parsed[i] as unknown[]).map((x: unknown) => String(x)))\r\n      }\r\n    }\r\n  } catch {\r\n    // keep rows empty\r\n  }\r\n\r\n  let writtenRows = 0\r\n  let inspectedTotal = 0\r\n  let droppedTotal = 0\r\n  for (const entry of rows.slice(0, 5)) {\r\n    const timestamp = entry[0]\r\n    const original = entry[1] || job.seedUrl\r\n    if (!timestamp) continue\r\n    const snapshotUrl = `https://web.archive.org/web/${timestamp}/${original}`\r\n    const snapshotResponse = await fetch(snapshotUrl)\r\n    const html = await snapshotResponse.text()\r\n\r\n    await persistRawPayload(env, {\r\n      sourceType: 'wayback_html',\r\n      sourceUrl: snapshotUrl,\r\n      payload: html,\r\n      httpStatus: snapshotResponse.status,\r\n      notes: `wayback_snapshot lender=${job.lenderCode}`,\r\n    })\r\n\r\n    const collectionDate = `${timestamp.slice(0, 4)}-${timestamp.slice(4, 6)}-${timestamp.slice(6, 8)}`\r\n    const parsed = extractLenderRatesFromHtml({\r\n      lender,\r\n      html,\r\n      sourceUrl: snapshotUrl,\r\n      collectionDate,\r\n      mode: 'historical',\r\n      qualityFlag: 'parsed_from_wayback_strict',\r\n    })\r\n    inspectedTotal += parsed.inspected\r\n    droppedTotal += parsed.dropped\r\n    const { accepted, dropped } = splitValidatedRows(parsed.rows)\r\n    for (const row of accepted) {\r\n      row.runId = job.runId\r\n      row.runSource = job.runSource ?? 'scheduled'\r\n    }\r\n    droppedTotal += dropped.length\r\n    if (accepted.length > 0) {\r\n      writtenRows += await upsertHistoricalRateRows(env.DB, accepted)\r\n    }\r\n  }\r\n\r\n  await persistRawPayload(env, {\r\n    sourceType: 'wayback_html',\r\n    sourceUrl: job.seedUrl,\r\n    payload: {\r\n      runId: job.runId,\r\n      lenderCode: job.lenderCode,\r\n      monthCursor: job.monthCursor,\r\n      writtenRows,\r\n      inspectedTotal,\r\n      droppedTotal,\r\n      capturedAt: nowIso(),\r\n    },\r\n    httpStatus: 200,\r\n    notes: `wayback_backfill_summary lender=${job.lenderCode} month=${job.monthCursor}`,\r\n  })\r\n\r\n  const cursorKey = buildBackfillCursorKey(job.lenderCode, job.monthCursor, job.seedUrl)\r\n  await env.DB.prepare(\r\n    `INSERT INTO backfill_cursors (\r\n      cursor_key,\r\n      run_id,\r\n      lender_code,\r\n      seed_url,\r\n      month_cursor,\r\n      last_snapshot_at,\r\n      updated_at,\r\n      status\r\n    ) VALUES (?1, ?2, ?3, ?4, ?5, ?6, ?7, ?8)\r\n    ON CONFLICT(cursor_key) DO UPDATE SET\r\n      run_id = excluded.run_id,\r\n      lender_code = excluded.lender_code,\r\n      seed_url = excluded.seed_url,\r\n      month_cursor = excluded.month_cursor,\r\n      last_snapshot_at = excluded.last_snapshot_at,\r\n      updated_at = excluded.updated_at,\r\n      status = excluded.status`,\r\n  )\r\n    .bind(\r\n      cursorKey,\r\n      job.runId,\r\n      job.lenderCode,\r\n      job.seedUrl,\r\n      job.monthCursor,\r\n      nowIso(),\r\n      nowIso(),\r\n      writtenRows > 0 ? 'completed' : inspectedTotal > 0 ? 'quality_rejected' : 'empty',\r\n    )\r\n    .run()\r\n}\r\n\r\nasync function handleDailySavingsLenderJob(env: EnvBindings, job: DailySavingsLenderJob): Promise<void> {\r\n  const lender = TARGET_LENDERS.find((x) => x.code === job.lenderCode)\r\n  if (!lender) throw new Error(`unknown_lender_code:${job.lenderCode}`)\r\n  log.info('consumer', `daily_savings_lender_fetch started`, { runId: job.runId, lenderCode: job.lenderCode })\r\n\r\n  const playbook = getLenderPlaybook(lender)\r\n  const endpoint = await getCachedEndpoint(env.DB, job.lenderCode)\r\n  const endpointCandidates: string[] = []\r\n  if (endpoint?.endpointUrl) endpointCandidates.push(endpoint.endpointUrl)\r\n  if (lender.products_endpoint) endpointCandidates.push(lender.products_endpoint)\r\n  const discovered = await discoverProductsEndpoint(lender)\r\n  if (discovered?.endpointUrl) endpointCandidates.push(discovered.endpointUrl)\r\n  const uniqueCandidates = Array.from(new Set(endpointCandidates.filter(Boolean)))\r\n\r\n  const savingsRows: NormalizedSavingsRow[] = []\r\n  const tdRows: NormalizedTdRow[] = []\r\n\r\n  for (const candidateEndpoint of uniqueCandidates) {\r\n    const [savingsProducts, tdProducts] = await Promise.all([\r\n      fetchSavingsProductIds(candidateEndpoint, 20, { cdrVersions: playbook.cdrVersions }),\r\n      fetchTermDepositProductIds(candidateEndpoint, 20, { cdrVersions: playbook.cdrVersions }),\r\n    ])\r\n\r\n    for (const payload of [...savingsProducts.rawPayloads, ...tdProducts.rawPayloads]) {\r\n      await persistRawPayload(env, {\r\n        sourceType: 'cdr_products',\r\n        sourceUrl: payload.sourceUrl,\r\n        payload: payload.body,\r\n        httpStatus: payload.status,\r\n        notes: `savings_td_product_index lender=${job.lenderCode}`,\r\n      })\r\n    }\r\n\r\n    for (const productId of savingsProducts.productIds.slice(0, 250)) {\r\n      const details = await fetchSavingsProductDetailRows({\r\n        lender,\r\n        endpointUrl: candidateEndpoint,\r\n        productId,\r\n        collectionDate: job.collectionDate,\r\n        cdrVersions: playbook.cdrVersions,\r\n      })\r\n      await persistRawPayload(env, {\r\n        sourceType: 'cdr_product_detail',\r\n        sourceUrl: details.rawPayload.sourceUrl,\r\n        payload: details.rawPayload.body,\r\n        httpStatus: details.rawPayload.status,\r\n        notes: `savings_product_detail lender=${job.lenderCode} product=${productId}`,\r\n      })\r\n      for (const row of details.savingsRows) savingsRows.push(row)\r\n    }\r\n\r\n    for (const productId of tdProducts.productIds.slice(0, 250)) {\r\n      const details = await fetchTdProductDetailRows({\r\n        lender,\r\n        endpointUrl: candidateEndpoint,\r\n        productId,\r\n        collectionDate: job.collectionDate,\r\n        cdrVersions: playbook.cdrVersions,\r\n      })\r\n      await persistRawPayload(env, {\r\n        sourceType: 'cdr_product_detail',\r\n        sourceUrl: details.rawPayload.sourceUrl,\r\n        payload: details.rawPayload.body,\r\n        httpStatus: details.rawPayload.status,\r\n        notes: `td_product_detail lender=${job.lenderCode} product=${productId}`,\r\n      })\r\n      for (const row of details.tdRows) tdRows.push(row)\r\n    }\r\n\r\n    if (savingsRows.length > 0 || tdRows.length > 0) break\r\n  }\r\n\r\n  const { accepted: savingsAccepted } = splitValidatedSavingsRows(savingsRows)\r\n  for (const row of savingsAccepted) {\r\n    row.runId = job.runId\r\n    row.runSource = job.runSource ?? 'scheduled'\r\n  }\r\n  if (savingsAccepted.length > 0) {\r\n    const written = await upsertSavingsRateRows(env.DB, savingsAccepted)\r\n    log.info('consumer', `savings_lender_fetch: ${written} savings rows written`, {\r\n      runId: job.runId,\r\n      lenderCode: job.lenderCode,\r\n    })\r\n  }\r\n\r\n  const { accepted: tdAccepted } = splitValidatedTdRows(tdRows)\r\n  for (const row of tdAccepted) {\r\n    row.runId = job.runId\r\n    row.runSource = job.runSource ?? 'scheduled'\r\n  }\r\n  if (tdAccepted.length > 0) {\r\n    const written = await upsertTdRateRows(env.DB, tdAccepted)\r\n    log.info('consumer', `savings_lender_fetch: ${written} td rows written`, {\r\n      runId: job.runId,\r\n      lenderCode: job.lenderCode,\r\n    })\r\n  }\r\n\r\n  log.info('consumer', `daily_savings_lender_fetch completed`, {\r\n    runId: job.runId,\r\n    lenderCode: job.lenderCode,\r\n    context: `savings=${savingsAccepted.length} td=${tdAccepted.length}`,\r\n  })\r\n}\r\n\r\nasync function processMessage(env: EnvBindings, message: IngestMessage): Promise<void> {\r\n  if (message.kind === 'daily_lender_fetch') {\r\n    return handleDailyLenderJob(env, message)\r\n  }\r\n  if (message.kind === 'product_detail_fetch') {\r\n    return handleProductDetailJob(env, message)\r\n  }\r\n  if (message.kind === 'backfill_snapshot_fetch') {\r\n    return handleBackfillSnapshotJob(env, message)\r\n  }\r\n  if (message.kind === 'daily_savings_lender_fetch') {\r\n    return handleDailySavingsLenderJob(env, message)\r\n  }\r\n\r\n  throw new Error(`Unsupported message kind: ${String((message as Record<string, unknown>).kind)}`)\r\n}\r\n\r\nexport async function consumeIngestQueue(batch: MessageBatch<IngestMessage>, env: EnvBindings): Promise<void> {\r\n  const maxAttempts = parseIntegerEnv(env.MAX_QUEUE_ATTEMPTS, DEFAULT_MAX_QUEUE_ATTEMPTS)\r\n  log.info('consumer', `queue_batch received ${batch.messages.length} messages`)\r\n\r\n  for (const msg of batch.messages) {\r\n    const attempts = Number(msg.attempts || 1)\r\n    const body = msg.body\r\n    const context = extractRunContext(body)\r\n\r\n    try {\r\n      if (!isIngestMessage(body)) {\r\n        log.error('consumer', 'invalid_queue_message_shape', { context: JSON.stringify(body) })\r\n        throw new Error('invalid_queue_message_shape')\r\n      }\r\n\r\n      await processMessage(env, body)\r\n\r\n      if (context.runId && context.lenderCode) {\r\n        await recordRunQueueOutcome(env.DB, {\r\n          runId: context.runId,\r\n          lenderCode: context.lenderCode,\r\n          success: true,\r\n        })\r\n      }\r\n\r\n      msg.ack()\r\n    } catch (error) {\r\n      const errorMessage = (error as Error)?.message || String(error)\r\n      log.error('consumer', `queue_message_failed attempt=${attempts}/${maxAttempts}: ${errorMessage}`, {\r\n        runId: context.runId ?? undefined,\r\n        lenderCode: context.lenderCode ?? undefined,\r\n      })\r\n\r\n      if (attempts >= maxAttempts) {\r\n        log.error('consumer', `queue_message_exhausted max_attempts=${maxAttempts}`, {\r\n          runId: context.runId ?? undefined,\r\n          lenderCode: context.lenderCode ?? undefined,\r\n          context: errorMessage,\r\n        })\r\n        if (context.runId && context.lenderCode) {\r\n          await recordRunQueueOutcome(env.DB, {\r\n            runId: context.runId,\r\n            lenderCode: context.lenderCode,\r\n            success: false,\r\n            errorMessage,\r\n          })\r\n        }\r\n        msg.ack()\r\n        continue\r\n      }\r\n\r\n      msg.retry({\r\n        delaySeconds: calculateRetryDelaySeconds(attempts),\r\n      })\r\n    }\r\n  }\r\n}", "import type { Context } from 'hono'\r\nimport type { ContentfulStatusCode } from 'hono/utils/http-status'\r\n\r\nexport function withNoStore(c: Context): void {\r\n  c.header('Cache-Control', 'no-store, no-cache, must-revalidate, max-age=0')\r\n  c.header('Pragma', 'no-cache')\r\n  c.header('Expires', '0')\r\n}\r\n\r\nexport function withPublicCache(c: Context, seconds = 120): void {\r\n  const sMaxAge = Math.max(1, Math.floor(seconds))\r\n  const stale = Math.max(sMaxAge * 2, 120)\r\n  c.header('Cache-Control', `public, s-maxage=${sMaxAge}, stale-while-revalidate=${stale}`)\r\n}\r\n\r\nexport function jsonError(c: Context, status: ContentfulStatusCode, code: string, message: string, details?: unknown) {\r\n  return c.json(\r\n    {\r\n      ok: false,\r\n      error: {\r\n        code,\r\n        message,\r\n        ...(details === undefined ? {} : { details }),\r\n      },\r\n    },\r\n    status,\r\n  )\r\n}\r\n", "export default crypto;\nexport const isCryptoKey = (key) => key instanceof CryptoKey;\n", "import digest from '../runtime/digest.js';\nexport const encoder = new TextEncoder();\nexport const decoder = new TextDecoder();\nconst MAX_INT32 = 2 ** 32;\nexport function concat(...buffers) {\n    const size = buffers.reduce((acc, { length }) => acc + length, 0);\n    const buf = new Uint8Array(size);\n    let i = 0;\n    for (const buffer of buffers) {\n        buf.set(buffer, i);\n        i += buffer.length;\n    }\n    return buf;\n}\nexport function p2s(alg, p2sInput) {\n    return concat(encoder.encode(alg), new Uint8Array([0]), p2sInput);\n}\nfunction writeUInt32BE(buf, value, offset) {\n    if (value < 0 || value >= MAX_INT32) {\n        throw new RangeError(`value must be >= 0 and <= ${MAX_INT32 - 1}. Received ${value}`);\n    }\n    buf.set([value >>> 24, value >>> 16, value >>> 8, value & 0xff], offset);\n}\nexport function uint64be(value) {\n    const high = Math.floor(value / MAX_INT32);\n    const low = value % MAX_INT32;\n    const buf = new Uint8Array(8);\n    writeUInt32BE(buf, high, 0);\n    writeUInt32BE(buf, low, 4);\n    return buf;\n}\nexport function uint32be(value) {\n    const buf = new Uint8Array(4);\n    writeUInt32BE(buf, value);\n    return buf;\n}\nexport function lengthAndInput(input) {\n    return concat(uint32be(input.length), input);\n}\nexport async function concatKdf(secret, bits, value) {\n    const iterations = Math.ceil((bits >> 3) / 32);\n    const res = new Uint8Array(iterations * 32);\n    for (let iter = 0; iter < iterations; iter++) {\n        const buf = new Uint8Array(4 + secret.length + value.length);\n        buf.set(uint32be(iter + 1));\n        buf.set(secret, 4);\n        buf.set(value, 4 + secret.length);\n        res.set(await digest('sha256', buf), iter * 32);\n    }\n    return res.slice(0, bits >> 3);\n}\n", "import { encoder, decoder } from '../lib/buffer_utils.js';\nexport const encodeBase64 = (input) => {\n    let unencoded = input;\n    if (typeof unencoded === 'string') {\n        unencoded = encoder.encode(unencoded);\n    }\n    const CHUNK_SIZE = 0x8000;\n    const arr = [];\n    for (let i = 0; i < unencoded.length; i += CHUNK_SIZE) {\n        arr.push(String.fromCharCode.apply(null, unencoded.subarray(i, i + CHUNK_SIZE)));\n    }\n    return btoa(arr.join(''));\n};\nexport const encode = (input) => {\n    return encodeBase64(input).replace(/=/g, '').replace(/\\+/g, '-').replace(/\\//g, '_');\n};\nexport const decodeBase64 = (encoded) => {\n    const binary = atob(encoded);\n    const bytes = new Uint8Array(binary.length);\n    for (let i = 0; i < binary.length; i++) {\n        bytes[i] = binary.charCodeAt(i);\n    }\n    return bytes;\n};\nexport const decode = (input) => {\n    let encoded = input;\n    if (encoded instanceof Uint8Array) {\n        encoded = decoder.decode(encoded);\n    }\n    encoded = encoded.replace(/-/g, '+').replace(/_/g, '/').replace(/\\s/g, '');\n    try {\n        return decodeBase64(encoded);\n    }\n    catch {\n        throw new TypeError('The input to be decoded is not correctly encoded.');\n    }\n};\n", "export class JOSEError extends Error {\n    constructor(message, options) {\n        super(message, options);\n        this.code = 'ERR_JOSE_GENERIC';\n        this.name = this.constructor.name;\n        Error.captureStackTrace?.(this, this.constructor);\n    }\n}\nJOSEError.code = 'ERR_JOSE_GENERIC';\nexport class JWTClaimValidationFailed extends JOSEError {\n    constructor(message, payload, claim = 'unspecified', reason = 'unspecified') {\n        super(message, { cause: { claim, reason, payload } });\n        this.code = 'ERR_JWT_CLAIM_VALIDATION_FAILED';\n        this.claim = claim;\n        this.reason = reason;\n        this.payload = payload;\n    }\n}\nJWTClaimValidationFailed.code = 'ERR_JWT_CLAIM_VALIDATION_FAILED';\nexport class JWTExpired extends JOSEError {\n    constructor(message, payload, claim = 'unspecified', reason = 'unspecified') {\n        super(message, { cause: { claim, reason, payload } });\n        this.code = 'ERR_JWT_EXPIRED';\n        this.claim = claim;\n        this.reason = reason;\n        this.payload = payload;\n    }\n}\nJWTExpired.code = 'ERR_JWT_EXPIRED';\nexport class JOSEAlgNotAllowed extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JOSE_ALG_NOT_ALLOWED';\n    }\n}\nJOSEAlgNotAllowed.code = 'ERR_JOSE_ALG_NOT_ALLOWED';\nexport class JOSENotSupported extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JOSE_NOT_SUPPORTED';\n    }\n}\nJOSENotSupported.code = 'ERR_JOSE_NOT_SUPPORTED';\nexport class JWEDecryptionFailed extends JOSEError {\n    constructor(message = 'decryption operation failed', options) {\n        super(message, options);\n        this.code = 'ERR_JWE_DECRYPTION_FAILED';\n    }\n}\nJWEDecryptionFailed.code = 'ERR_JWE_DECRYPTION_FAILED';\nexport class JWEInvalid extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JWE_INVALID';\n    }\n}\nJWEInvalid.code = 'ERR_JWE_INVALID';\nexport class JWSInvalid extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JWS_INVALID';\n    }\n}\nJWSInvalid.code = 'ERR_JWS_INVALID';\nexport class JWTInvalid extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JWT_INVALID';\n    }\n}\nJWTInvalid.code = 'ERR_JWT_INVALID';\nexport class JWKInvalid extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JWK_INVALID';\n    }\n}\nJWKInvalid.code = 'ERR_JWK_INVALID';\nexport class JWKSInvalid extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JWKS_INVALID';\n    }\n}\nJWKSInvalid.code = 'ERR_JWKS_INVALID';\nexport class JWKSNoMatchingKey extends JOSEError {\n    constructor(message = 'no applicable key found in the JSON Web Key Set', options) {\n        super(message, options);\n        this.code = 'ERR_JWKS_NO_MATCHING_KEY';\n    }\n}\nJWKSNoMatchingKey.code = 'ERR_JWKS_NO_MATCHING_KEY';\nexport class JWKSMultipleMatchingKeys extends JOSEError {\n    constructor(message = 'multiple matching keys found in the JSON Web Key Set', options) {\n        super(message, options);\n        this.code = 'ERR_JWKS_MULTIPLE_MATCHING_KEYS';\n    }\n}\nSymbol.asyncIterator;\nJWKSMultipleMatchingKeys.code = 'ERR_JWKS_MULTIPLE_MATCHING_KEYS';\nexport class JWKSTimeout extends JOSEError {\n    constructor(message = 'request timed out', options) {\n        super(message, options);\n        this.code = 'ERR_JWKS_TIMEOUT';\n    }\n}\nJWKSTimeout.code = 'ERR_JWKS_TIMEOUT';\nexport class JWSSignatureVerificationFailed extends JOSEError {\n    constructor(message = 'signature verification failed', options) {\n        super(message, options);\n        this.code = 'ERR_JWS_SIGNATURE_VERIFICATION_FAILED';\n    }\n}\nJWSSignatureVerificationFailed.code = 'ERR_JWS_SIGNATURE_VERIFICATION_FAILED';\n", "function unusable(name, prop = 'algorithm.name') {\n    return new TypeError(`CryptoKey does not support this operation, its ${prop} must be ${name}`);\n}\nfunction isAlgorithm(algorithm, name) {\n    return algorithm.name === name;\n}\nfunction getHashLength(hash) {\n    return parseInt(hash.name.slice(4), 10);\n}\nfunction getNamedCurve(alg) {\n    switch (alg) {\n        case 'ES256':\n            return 'P-256';\n        case 'ES384':\n            return 'P-384';\n        case 'ES512':\n            return 'P-521';\n        default:\n            throw new Error('unreachable');\n    }\n}\nfunction checkUsage(key, usages) {\n    if (usages.length && !usages.some((expected) => key.usages.includes(expected))) {\n        let msg = 'CryptoKey does not support this operation, its usages must include ';\n        if (usages.length > 2) {\n            const last = usages.pop();\n            msg += `one of ${usages.join(', ')}, or ${last}.`;\n        }\n        else if (usages.length === 2) {\n            msg += `one of ${usages[0]} or ${usages[1]}.`;\n        }\n        else {\n            msg += `${usages[0]}.`;\n        }\n        throw new TypeError(msg);\n    }\n}\nexport function checkSigCryptoKey(key, alg, ...usages) {\n    switch (alg) {\n        case 'HS256':\n        case 'HS384':\n        case 'HS512': {\n            if (!isAlgorithm(key.algorithm, 'HMAC'))\n                throw unusable('HMAC');\n            const expected = parseInt(alg.slice(2), 10);\n            const actual = getHashLength(key.algorithm.hash);\n            if (actual !== expected)\n                throw unusable(`SHA-${expected}`, 'algorithm.hash');\n            break;\n        }\n        case 'RS256':\n        case 'RS384':\n        case 'RS512': {\n            if (!isAlgorithm(key.algorithm, 'RSASSA-PKCS1-v1_5'))\n                throw unusable('RSASSA-PKCS1-v1_5');\n            const expected = parseInt(alg.slice(2), 10);\n            const actual = getHashLength(key.algorithm.hash);\n            if (actual !== expected)\n                throw unusable(`SHA-${expected}`, 'algorithm.hash');\n            break;\n        }\n        case 'PS256':\n        case 'PS384':\n        case 'PS512': {\n            if (!isAlgorithm(key.algorithm, 'RSA-PSS'))\n                throw unusable('RSA-PSS');\n            const expected = parseInt(alg.slice(2), 10);\n            const actual = getHashLength(key.algorithm.hash);\n            if (actual !== expected)\n                throw unusable(`SHA-${expected}`, 'algorithm.hash');\n            break;\n        }\n        case 'EdDSA': {\n            if (key.algorithm.name !== 'Ed25519' && key.algorithm.name !== 'Ed448') {\n                throw unusable('Ed25519 or Ed448');\n            }\n            break;\n        }\n        case 'Ed25519': {\n            if (!isAlgorithm(key.algorithm, 'Ed25519'))\n                throw unusable('Ed25519');\n            break;\n        }\n        case 'ES256':\n        case 'ES384':\n        case 'ES512': {\n            if (!isAlgorithm(key.algorithm, 'ECDSA'))\n                throw unusable('ECDSA');\n            const expected = getNamedCurve(alg);\n            const actual = key.algorithm.namedCurve;\n            if (actual !== expected)\n                throw unusable(expected, 'algorithm.namedCurve');\n            break;\n        }\n        default:\n            throw new TypeError('CryptoKey does not support this operation');\n    }\n    checkUsage(key, usages);\n}\nexport function checkEncCryptoKey(key, alg, ...usages) {\n    switch (alg) {\n        case 'A128GCM':\n        case 'A192GCM':\n        case 'A256GCM': {\n            if (!isAlgorithm(key.algorithm, 'AES-GCM'))\n                throw unusable('AES-GCM');\n            const expected = parseInt(alg.slice(1, 4), 10);\n            const actual = key.algorithm.length;\n            if (actual !== expected)\n                throw unusable(expected, 'algorithm.length');\n            break;\n        }\n        case 'A128KW':\n        case 'A192KW':\n        case 'A256KW': {\n            if (!isAlgorithm(key.algorithm, 'AES-KW'))\n                throw unusable('AES-KW');\n            const expected = parseInt(alg.slice(1, 4), 10);\n            const actual = key.algorithm.length;\n            if (actual !== expected)\n                throw unusable(expected, 'algorithm.length');\n            break;\n        }\n        case 'ECDH': {\n            switch (key.algorithm.name) {\n                case 'ECDH':\n                case 'X25519':\n                case 'X448':\n                    break;\n                default:\n                    throw unusable('ECDH, X25519, or X448');\n            }\n            break;\n        }\n        case 'PBES2-HS256+A128KW':\n        case 'PBES2-HS384+A192KW':\n        case 'PBES2-HS512+A256KW':\n            if (!isAlgorithm(key.algorithm, 'PBKDF2'))\n                throw unusable('PBKDF2');\n            break;\n        case 'RSA-OAEP':\n        case 'RSA-OAEP-256':\n        case 'RSA-OAEP-384':\n        case 'RSA-OAEP-512': {\n            if (!isAlgorithm(key.algorithm, 'RSA-OAEP'))\n                throw unusable('RSA-OAEP');\n            const expected = parseInt(alg.slice(9), 10) || 1;\n            const actual = getHashLength(key.algorithm.hash);\n            if (actual !== expected)\n                throw unusable(`SHA-${expected}`, 'algorithm.hash');\n            break;\n        }\n        default:\n            throw new TypeError('CryptoKey does not support this operation');\n    }\n    checkUsage(key, usages);\n}\n", "function message(msg, actual, ...types) {\n    types = types.filter(Boolean);\n    if (types.length > 2) {\n        const last = types.pop();\n        msg += `one of type ${types.join(', ')}, or ${last}.`;\n    }\n    else if (types.length === 2) {\n        msg += `one of type ${types[0]} or ${types[1]}.`;\n    }\n    else {\n        msg += `of type ${types[0]}.`;\n    }\n    if (actual == null) {\n        msg += ` Received ${actual}`;\n    }\n    else if (typeof actual === 'function' && actual.name) {\n        msg += ` Received function ${actual.name}`;\n    }\n    else if (typeof actual === 'object' && actual != null) {\n        if (actual.constructor?.name) {\n            msg += ` Received an instance of ${actual.constructor.name}`;\n        }\n    }\n    return msg;\n}\nexport default (actual, ...types) => {\n    return message('Key must be ', actual, ...types);\n};\nexport function withAlg(alg, actual, ...types) {\n    return message(`Key for the ${alg} algorithm must be `, actual, ...types);\n}\n", "import { isCryptoKey } from './webcrypto.js';\nexport default (key) => {\n    if (isCryptoKey(key)) {\n        return true;\n    }\n    return key?.[Symbol.toStringTag] === 'KeyObject';\n};\nexport const types = ['CryptoKey'];\n", "const isDisjoint = (...headers) => {\n    const sources = headers.filter(Boolean);\n    if (sources.length === 0 || sources.length === 1) {\n        return true;\n    }\n    let acc;\n    for (const header of sources) {\n        const parameters = Object.keys(header);\n        if (!acc || acc.size === 0) {\n            acc = new Set(parameters);\n            continue;\n        }\n        for (const parameter of parameters) {\n            if (acc.has(parameter)) {\n                return false;\n            }\n            acc.add(parameter);\n        }\n    }\n    return true;\n};\nexport default isDisjoint;\n", "function isObjectLike(value) {\n    return typeof value === 'object' && value !== null;\n}\nexport default function isObject(input) {\n    if (!isObjectLike(input) || Object.prototype.toString.call(input) !== '[object Object]') {\n        return false;\n    }\n    if (Object.getPrototypeOf(input) === null) {\n        return true;\n    }\n    let proto = input;\n    while (Object.getPrototypeOf(proto) !== null) {\n        proto = Object.getPrototypeOf(proto);\n    }\n    return Object.getPrototypeOf(input) === proto;\n}\n", "export default (alg, key) => {\n    if (alg.startsWith('RS') || alg.startsWith('PS')) {\n        const { modulusLength } = key.algorithm;\n        if (typeof modulusLength !== 'number' || modulusLength < 2048) {\n            throw new TypeError(`${alg} requires key modulusLength to be 2048 bits or larger`);\n        }\n    }\n};\n", "import isObject from './is_object.js';\nexport function isJWK(key) {\n    return isObject(key) && typeof key.kty === 'string';\n}\nexport function isPrivateJWK(key) {\n    return key.kty !== 'oct' && typeof key.d === 'string';\n}\nexport function isPublicJWK(key) {\n    return key.kty !== 'oct' && typeof key.d === 'undefined';\n}\nexport function isSecretJWK(key) {\n    return isJWK(key) && key.kty === 'oct' && typeof key.k === 'string';\n}\n", "import crypto from './webcrypto.js';\nimport { JOSENotSupported } from '../util/errors.js';\nfunction subtleMapping(jwk) {\n    let algorithm;\n    let keyUsages;\n    switch (jwk.kty) {\n        case 'RSA': {\n            switch (jwk.alg) {\n                case 'PS256':\n                case 'PS384':\n                case 'PS512':\n                    algorithm = { name: 'RSA-PSS', hash: `SHA-${jwk.alg.slice(-3)}` };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case 'RS256':\n                case 'RS384':\n                case 'RS512':\n                    algorithm = { name: 'RSASSA-PKCS1-v1_5', hash: `SHA-${jwk.alg.slice(-3)}` };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case 'RSA-OAEP':\n                case 'RSA-OAEP-256':\n                case 'RSA-OAEP-384':\n                case 'RSA-OAEP-512':\n                    algorithm = {\n                        name: 'RSA-OAEP',\n                        hash: `SHA-${parseInt(jwk.alg.slice(-3), 10) || 1}`,\n                    };\n                    keyUsages = jwk.d ? ['decrypt', 'unwrapKey'] : ['encrypt', 'wrapKey'];\n                    break;\n                default:\n                    throw new JOSENotSupported('Invalid or unsupported JWK \"alg\" (Algorithm) Parameter value');\n            }\n            break;\n        }\n        case 'EC': {\n            switch (jwk.alg) {\n                case 'ES256':\n                    algorithm = { name: 'ECDSA', namedCurve: 'P-256' };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case 'ES384':\n                    algorithm = { name: 'ECDSA', namedCurve: 'P-384' };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case 'ES512':\n                    algorithm = { name: 'ECDSA', namedCurve: 'P-521' };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case 'ECDH-ES':\n                case 'ECDH-ES+A128KW':\n                case 'ECDH-ES+A192KW':\n                case 'ECDH-ES+A256KW':\n                    algorithm = { name: 'ECDH', namedCurve: jwk.crv };\n                    keyUsages = jwk.d ? ['deriveBits'] : [];\n                    break;\n                default:\n                    throw new JOSENotSupported('Invalid or unsupported JWK \"alg\" (Algorithm) Parameter value');\n            }\n            break;\n        }\n        case 'OKP': {\n            switch (jwk.alg) {\n                case 'Ed25519':\n                    algorithm = { name: 'Ed25519' };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case 'EdDSA':\n                    algorithm = { name: jwk.crv };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case 'ECDH-ES':\n                case 'ECDH-ES+A128KW':\n                case 'ECDH-ES+A192KW':\n                case 'ECDH-ES+A256KW':\n                    algorithm = { name: jwk.crv };\n                    keyUsages = jwk.d ? ['deriveBits'] : [];\n                    break;\n                default:\n                    throw new JOSENotSupported('Invalid or unsupported JWK \"alg\" (Algorithm) Parameter value');\n            }\n            break;\n        }\n        default:\n            throw new JOSENotSupported('Invalid or unsupported JWK \"kty\" (Key Type) Parameter value');\n    }\n    return { algorithm, keyUsages };\n}\nconst parse = async (jwk) => {\n    if (!jwk.alg) {\n        throw new TypeError('\"alg\" argument is required when \"jwk.alg\" is not present');\n    }\n    const { algorithm, keyUsages } = subtleMapping(jwk);\n    const rest = [\n        algorithm,\n        jwk.ext ?? false,\n        jwk.key_ops ?? keyUsages,\n    ];\n    const keyData = { ...jwk };\n    delete keyData.alg;\n    delete keyData.use;\n    return crypto.subtle.importKey('jwk', keyData, ...rest);\n};\nexport default parse;\n", "import { isJWK } from '../lib/is_jwk.js';\nimport { decode } from './base64url.js';\nimport importJWK from './jwk_to_key.js';\nconst exportKeyValue = (k) => decode(k);\nlet privCache;\nlet pubCache;\nconst isKeyObject = (key) => {\n    return key?.[Symbol.toStringTag] === 'KeyObject';\n};\nconst importAndCache = async (cache, key, jwk, alg, freeze = false) => {\n    let cached = cache.get(key);\n    if (cached?.[alg]) {\n        return cached[alg];\n    }\n    const cryptoKey = await importJWK({ ...jwk, alg });\n    if (freeze)\n        Object.freeze(key);\n    if (!cached) {\n        cache.set(key, { [alg]: cryptoKey });\n    }\n    else {\n        cached[alg] = cryptoKey;\n    }\n    return cryptoKey;\n};\nconst normalizePublicKey = (key, alg) => {\n    if (isKeyObject(key)) {\n        let jwk = key.export({ format: 'jwk' });\n        delete jwk.d;\n        delete jwk.dp;\n        delete jwk.dq;\n        delete jwk.p;\n        delete jwk.q;\n        delete jwk.qi;\n        if (jwk.k) {\n            return exportKeyValue(jwk.k);\n        }\n        pubCache || (pubCache = new WeakMap());\n        return importAndCache(pubCache, key, jwk, alg);\n    }\n    if (isJWK(key)) {\n        if (key.k)\n            return decode(key.k);\n        pubCache || (pubCache = new WeakMap());\n        const cryptoKey = importAndCache(pubCache, key, key, alg, true);\n        return cryptoKey;\n    }\n    return key;\n};\nconst normalizePrivateKey = (key, alg) => {\n    if (isKeyObject(key)) {\n        let jwk = key.export({ format: 'jwk' });\n        if (jwk.k) {\n            return exportKeyValue(jwk.k);\n        }\n        privCache || (privCache = new WeakMap());\n        return importAndCache(privCache, key, jwk, alg);\n    }\n    if (isJWK(key)) {\n        if (key.k)\n            return decode(key.k);\n        privCache || (privCache = new WeakMap());\n        const cryptoKey = importAndCache(privCache, key, key, alg, true);\n        return cryptoKey;\n    }\n    return key;\n};\nexport default { normalizePublicKey, normalizePrivateKey };\n", "import { decode as decodeBase64URL } from '../runtime/base64url.js';\nimport { fromSPKI, fromPKCS8, fromX509 } from '../runtime/asn1.js';\nimport asKeyObject from '../runtime/jwk_to_key.js';\nimport { JOSENotSupported } from '../util/errors.js';\nimport isObject from '../lib/is_object.js';\nexport async function importSPKI(spki, alg, options) {\n    if (typeof spki !== 'string' || spki.indexOf('-----BEGIN PUBLIC KEY-----') !== 0) {\n        throw new TypeError('\"spki\" must be SPKI formatted string');\n    }\n    return fromSPKI(spki, alg, options);\n}\nexport async function importX509(x509, alg, options) {\n    if (typeof x509 !== 'string' || x509.indexOf('-----BEGIN CERTIFICATE-----') !== 0) {\n        throw new TypeError('\"x509\" must be X.509 formatted string');\n    }\n    return fromX509(x509, alg, options);\n}\nexport async function importPKCS8(pkcs8, alg, options) {\n    if (typeof pkcs8 !== 'string' || pkcs8.indexOf('-----BEGIN PRIVATE KEY-----') !== 0) {\n        throw new TypeError('\"pkcs8\" must be PKCS#8 formatted string');\n    }\n    return fromPKCS8(pkcs8, alg, options);\n}\nexport async function importJWK(jwk, alg) {\n    if (!isObject(jwk)) {\n        throw new TypeError('JWK must be an object');\n    }\n    alg || (alg = jwk.alg);\n    switch (jwk.kty) {\n        case 'oct':\n            if (typeof jwk.k !== 'string' || !jwk.k) {\n                throw new TypeError('missing \"k\" (Key Value) Parameter value');\n            }\n            return decodeBase64URL(jwk.k);\n        case 'RSA':\n            if ('oth' in jwk && jwk.oth !== undefined) {\n                throw new JOSENotSupported('RSA JWK \"oth\" (Other Primes Info) Parameter value is not supported');\n            }\n        case 'EC':\n        case 'OKP':\n            return asKeyObject({ ...jwk, alg });\n        default:\n            throw new JOSENotSupported('Unsupported \"kty\" (Key Type) Parameter value');\n    }\n}\n", "import { withAlg as invalidKeyInput } from './invalid_key_input.js';\nimport isKeyLike, { types } from '../runtime/is_key_like.js';\nimport * as jwk from './is_jwk.js';\nconst tag = (key) => key?.[Symbol.toStringTag];\nconst jwkMatchesOp = (alg, key, usage) => {\n    if (key.use !== undefined && key.use !== 'sig') {\n        throw new TypeError('Invalid key for this operation, when present its use must be sig');\n    }\n    if (key.key_ops !== undefined && key.key_ops.includes?.(usage) !== true) {\n        throw new TypeError(`Invalid key for this operation, when present its key_ops must include ${usage}`);\n    }\n    if (key.alg !== undefined && key.alg !== alg) {\n        throw new TypeError(`Invalid key for this operation, when present its alg must be ${alg}`);\n    }\n    return true;\n};\nconst symmetricTypeCheck = (alg, key, usage, allowJwk) => {\n    if (key instanceof Uint8Array)\n        return;\n    if (allowJwk && jwk.isJWK(key)) {\n        if (jwk.isSecretJWK(key) && jwkMatchesOp(alg, key, usage))\n            return;\n        throw new TypeError(`JSON Web Key for symmetric algorithms must have JWK \"kty\" (Key Type) equal to \"oct\" and the JWK \"k\" (Key Value) present`);\n    }\n    if (!isKeyLike(key)) {\n        throw new TypeError(invalidKeyInput(alg, key, ...types, 'Uint8Array', allowJwk ? 'JSON Web Key' : null));\n    }\n    if (key.type !== 'secret') {\n        throw new TypeError(`${tag(key)} instances for symmetric algorithms must be of type \"secret\"`);\n    }\n};\nconst asymmetricTypeCheck = (alg, key, usage, allowJwk) => {\n    if (allowJwk && jwk.isJWK(key)) {\n        switch (usage) {\n            case 'sign':\n                if (jwk.isPrivateJWK(key) && jwkMatchesOp(alg, key, usage))\n                    return;\n                throw new TypeError(`JSON Web Key for this operation be a private JWK`);\n            case 'verify':\n                if (jwk.isPublicJWK(key) && jwkMatchesOp(alg, key, usage))\n                    return;\n                throw new TypeError(`JSON Web Key for this operation be a public JWK`);\n        }\n    }\n    if (!isKeyLike(key)) {\n        throw new TypeError(invalidKeyInput(alg, key, ...types, allowJwk ? 'JSON Web Key' : null));\n    }\n    if (key.type === 'secret') {\n        throw new TypeError(`${tag(key)} instances for asymmetric algorithms must not be of type \"secret\"`);\n    }\n    if (usage === 'sign' && key.type === 'public') {\n        throw new TypeError(`${tag(key)} instances for asymmetric algorithm signing must be of type \"private\"`);\n    }\n    if (usage === 'decrypt' && key.type === 'public') {\n        throw new TypeError(`${tag(key)} instances for asymmetric algorithm decryption must be of type \"private\"`);\n    }\n    if (key.algorithm && usage === 'verify' && key.type === 'private') {\n        throw new TypeError(`${tag(key)} instances for asymmetric algorithm verifying must be of type \"public\"`);\n    }\n    if (key.algorithm && usage === 'encrypt' && key.type === 'private') {\n        throw new TypeError(`${tag(key)} instances for asymmetric algorithm encryption must be of type \"public\"`);\n    }\n};\nfunction checkKeyType(allowJwk, alg, key, usage) {\n    const symmetric = alg.startsWith('HS') ||\n        alg === 'dir' ||\n        alg.startsWith('PBES2') ||\n        /^A\\d{3}(?:GCM)?KW$/.test(alg);\n    if (symmetric) {\n        symmetricTypeCheck(alg, key, usage, allowJwk);\n    }\n    else {\n        asymmetricTypeCheck(alg, key, usage, allowJwk);\n    }\n}\nexport default checkKeyType.bind(undefined, false);\nexport const checkKeyTypeWithJwk = checkKeyType.bind(undefined, true);\n", "import { JOSENotSupported } from '../util/errors.js';\nfunction validateCrit(Err, recognizedDefault, recognizedOption, protectedHeader, joseHeader) {\n    if (joseHeader.crit !== undefined && protectedHeader?.crit === undefined) {\n        throw new Err('\"crit\" (Critical) Header Parameter MUST be integrity protected');\n    }\n    if (!protectedHeader || protectedHeader.crit === undefined) {\n        return new Set();\n    }\n    if (!Array.isArray(protectedHeader.crit) ||\n        protectedHeader.crit.length === 0 ||\n        protectedHeader.crit.some((input) => typeof input !== 'string' || input.length === 0)) {\n        throw new Err('\"crit\" (Critical) Header Parameter MUST be an array of non-empty strings when present');\n    }\n    let recognized;\n    if (recognizedOption !== undefined) {\n        recognized = new Map([...Object.entries(recognizedOption), ...recognizedDefault.entries()]);\n    }\n    else {\n        recognized = recognizedDefault;\n    }\n    for (const parameter of protectedHeader.crit) {\n        if (!recognized.has(parameter)) {\n            throw new JOSENotSupported(`Extension Header Parameter \"${parameter}\" is not recognized`);\n        }\n        if (joseHeader[parameter] === undefined) {\n            throw new Err(`Extension Header Parameter \"${parameter}\" is missing`);\n        }\n        if (recognized.get(parameter) && protectedHeader[parameter] === undefined) {\n            throw new Err(`Extension Header Parameter \"${parameter}\" MUST be integrity protected`);\n        }\n    }\n    return new Set(protectedHeader.crit);\n}\nexport default validateCrit;\n", "const validateAlgorithms = (option, algorithms) => {\n    if (algorithms !== undefined &&\n        (!Array.isArray(algorithms) || algorithms.some((s) => typeof s !== 'string'))) {\n        throw new TypeError(`\"${option}\" option must be an array of strings`);\n    }\n    if (!algorithms) {\n        return undefined;\n    }\n    return new Set(algorithms);\n};\nexport default validateAlgorithms;\n", "import { JOSENotSupported } from '../util/errors.js';\nexport default function subtleDsa(alg, algorithm) {\n    const hash = `SHA-${alg.slice(-3)}`;\n    switch (alg) {\n        case 'HS256':\n        case 'HS384':\n        case 'HS512':\n            return { hash, name: 'HMAC' };\n        case 'PS256':\n        case 'PS384':\n        case 'PS512':\n            return { hash, name: 'RSA-PSS', saltLength: alg.slice(-3) >> 3 };\n        case 'RS256':\n        case 'RS384':\n        case 'RS512':\n            return { hash, name: 'RSASSA-PKCS1-v1_5' };\n        case 'ES256':\n        case 'ES384':\n        case 'ES512':\n            return { hash, name: 'ECDSA', namedCurve: algorithm.namedCurve };\n        case 'Ed25519':\n            return { name: 'Ed25519' };\n        case 'EdDSA':\n            return { name: algorithm.name };\n        default:\n            throw new JOSENotSupported(`alg ${alg} is not supported either by JOSE or your javascript runtime`);\n    }\n}\n", "import crypto, { isCryptoKey } from './webcrypto.js';\nimport { checkSigCryptoKey } from '../lib/crypto_key.js';\nimport invalidKeyInput from '../lib/invalid_key_input.js';\nimport { types } from './is_key_like.js';\nimport normalize from './normalize_key.js';\nexport default async function getCryptoKey(alg, key, usage) {\n    if (usage === 'sign') {\n        key = await normalize.normalizePrivateKey(key, alg);\n    }\n    if (usage === 'verify') {\n        key = await normalize.normalizePublicKey(key, alg);\n    }\n    if (isCryptoKey(key)) {\n        checkSigCryptoKey(key, alg, usage);\n        return key;\n    }\n    if (key instanceof Uint8Array) {\n        if (!alg.startsWith('HS')) {\n            throw new TypeError(invalidKeyInput(key, ...types));\n        }\n        return crypto.subtle.importKey('raw', key, { hash: `SHA-${alg.slice(-3)}`, name: 'HMAC' }, false, [usage]);\n    }\n    throw new TypeError(invalidKeyInput(key, ...types, 'Uint8Array', 'JSON Web Key'));\n}\n", "import subtleAlgorithm from './subtle_dsa.js';\nimport crypto from './webcrypto.js';\nimport checkKeyLength from './check_key_length.js';\nimport getVerifyKey from './get_sign_verify_key.js';\nconst verify = async (alg, key, signature, data) => {\n    const cryptoKey = await getVerifyKey(alg, key, 'verify');\n    checkKeyLength(alg, cryptoKey);\n    const algorithm = subtleAlgorithm(alg, cryptoKey.algorithm);\n    try {\n        return await crypto.subtle.verify(algorithm, cryptoKey, signature, data);\n    }\n    catch {\n        return false;\n    }\n};\nexport default verify;\n", "import { decode as base64url } from '../../runtime/base64url.js';\nimport verify from '../../runtime/verify.js';\nimport { JOSEAlgNotAllowed, JWSInvalid, JWSSignatureVerificationFailed } from '../../util/errors.js';\nimport { concat, encoder, decoder } from '../../lib/buffer_utils.js';\nimport isDisjoint from '../../lib/is_disjoint.js';\nimport isObject from '../../lib/is_object.js';\nimport { checkKeyTypeWithJwk } from '../../lib/check_key_type.js';\nimport validateCrit from '../../lib/validate_crit.js';\nimport validateAlgorithms from '../../lib/validate_algorithms.js';\nimport { isJWK } from '../../lib/is_jwk.js';\nimport { importJWK } from '../../key/import.js';\nexport async function flattenedVerify(jws, key, options) {\n    if (!isObject(jws)) {\n        throw new JWSInvalid('Flattened JWS must be an object');\n    }\n    if (jws.protected === undefined && jws.header === undefined) {\n        throw new JWSInvalid('Flattened JWS must have either of the \"protected\" or \"header\" members');\n    }\n    if (jws.protected !== undefined && typeof jws.protected !== 'string') {\n        throw new JWSInvalid('JWS Protected Header incorrect type');\n    }\n    if (jws.payload === undefined) {\n        throw new JWSInvalid('JWS Payload missing');\n    }\n    if (typeof jws.signature !== 'string') {\n        throw new JWSInvalid('JWS Signature missing or incorrect type');\n    }\n    if (jws.header !== undefined && !isObject(jws.header)) {\n        throw new JWSInvalid('JWS Unprotected Header incorrect type');\n    }\n    let parsedProt = {};\n    if (jws.protected) {\n        try {\n            const protectedHeader = base64url(jws.protected);\n            parsedProt = JSON.parse(decoder.decode(protectedHeader));\n        }\n        catch {\n            throw new JWSInvalid('JWS Protected Header is invalid');\n        }\n    }\n    if (!isDisjoint(parsedProt, jws.header)) {\n        throw new JWSInvalid('JWS Protected and JWS Unprotected Header Parameter names must be disjoint');\n    }\n    const joseHeader = {\n        ...parsedProt,\n        ...jws.header,\n    };\n    const extensions = validateCrit(JWSInvalid, new Map([['b64', true]]), options?.crit, parsedProt, joseHeader);\n    let b64 = true;\n    if (extensions.has('b64')) {\n        b64 = parsedProt.b64;\n        if (typeof b64 !== 'boolean') {\n            throw new JWSInvalid('The \"b64\" (base64url-encode payload) Header Parameter must be a boolean');\n        }\n    }\n    const { alg } = joseHeader;\n    if (typeof alg !== 'string' || !alg) {\n        throw new JWSInvalid('JWS \"alg\" (Algorithm) Header Parameter missing or invalid');\n    }\n    const algorithms = options && validateAlgorithms('algorithms', options.algorithms);\n    if (algorithms && !algorithms.has(alg)) {\n        throw new JOSEAlgNotAllowed('\"alg\" (Algorithm) Header Parameter value not allowed');\n    }\n    if (b64) {\n        if (typeof jws.payload !== 'string') {\n            throw new JWSInvalid('JWS Payload must be a string');\n        }\n    }\n    else if (typeof jws.payload !== 'string' && !(jws.payload instanceof Uint8Array)) {\n        throw new JWSInvalid('JWS Payload must be a string or an Uint8Array instance');\n    }\n    let resolvedKey = false;\n    if (typeof key === 'function') {\n        key = await key(parsedProt, jws);\n        resolvedKey = true;\n        checkKeyTypeWithJwk(alg, key, 'verify');\n        if (isJWK(key)) {\n            key = await importJWK(key, alg);\n        }\n    }\n    else {\n        checkKeyTypeWithJwk(alg, key, 'verify');\n    }\n    const data = concat(encoder.encode(jws.protected ?? ''), encoder.encode('.'), typeof jws.payload === 'string' ? encoder.encode(jws.payload) : jws.payload);\n    let signature;\n    try {\n        signature = base64url(jws.signature);\n    }\n    catch {\n        throw new JWSInvalid('Failed to base64url decode the signature');\n    }\n    const verified = await verify(alg, key, signature, data);\n    if (!verified) {\n        throw new JWSSignatureVerificationFailed();\n    }\n    let payload;\n    if (b64) {\n        try {\n            payload = base64url(jws.payload);\n        }\n        catch {\n            throw new JWSInvalid('Failed to base64url decode the payload');\n        }\n    }\n    else if (typeof jws.payload === 'string') {\n        payload = encoder.encode(jws.payload);\n    }\n    else {\n        payload = jws.payload;\n    }\n    const result = { payload };\n    if (jws.protected !== undefined) {\n        result.protectedHeader = parsedProt;\n    }\n    if (jws.header !== undefined) {\n        result.unprotectedHeader = jws.header;\n    }\n    if (resolvedKey) {\n        return { ...result, key };\n    }\n    return result;\n}\n", "import { flattenedVerify } from '../flattened/verify.js';\nimport { JWSInvalid } from '../../util/errors.js';\nimport { decoder } from '../../lib/buffer_utils.js';\nexport async function compactVerify(jws, key, options) {\n    if (jws instanceof Uint8Array) {\n        jws = decoder.decode(jws);\n    }\n    if (typeof jws !== 'string') {\n        throw new JWSInvalid('Compact JWS must be a string or Uint8Array');\n    }\n    const { 0: protectedHeader, 1: payload, 2: signature, length } = jws.split('.');\n    if (length !== 3) {\n        throw new JWSInvalid('Invalid Compact JWS');\n    }\n    const verified = await flattenedVerify({ payload, protected: protectedHeader, signature }, key, options);\n    const result = { payload: verified.payload, protectedHeader: verified.protectedHeader };\n    if (typeof key === 'function') {\n        return { ...result, key: verified.key };\n    }\n    return result;\n}\n", "export default (date) => Math.floor(date.getTime() / 1000);\n", "const minute = 60;\nconst hour = minute * 60;\nconst day = hour * 24;\nconst week = day * 7;\nconst year = day * 365.25;\nconst REGEX = /^(\\+|\\-)? ?(\\d+|\\d+\\.\\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i;\nexport default (str) => {\n    const matched = REGEX.exec(str);\n    if (!matched || (matched[4] && matched[1])) {\n        throw new TypeError('Invalid time period format');\n    }\n    const value = parseFloat(matched[2]);\n    const unit = matched[3].toLowerCase();\n    let numericDate;\n    switch (unit) {\n        case 'sec':\n        case 'secs':\n        case 'second':\n        case 'seconds':\n        case 's':\n            numericDate = Math.round(value);\n            break;\n        case 'minute':\n        case 'minutes':\n        case 'min':\n        case 'mins':\n        case 'm':\n            numericDate = Math.round(value * minute);\n            break;\n        case 'hour':\n        case 'hours':\n        case 'hr':\n        case 'hrs':\n        case 'h':\n            numericDate = Math.round(value * hour);\n            break;\n        case 'day':\n        case 'days':\n        case 'd':\n            numericDate = Math.round(value * day);\n            break;\n        case 'week':\n        case 'weeks':\n        case 'w':\n            numericDate = Math.round(value * week);\n            break;\n        default:\n            numericDate = Math.round(value * year);\n            break;\n    }\n    if (matched[1] === '-' || matched[4] === 'ago') {\n        return -numericDate;\n    }\n    return numericDate;\n};\n", "import { JWTClaimValidationFailed, JWTExpired, JWTInvalid } from '../util/errors.js';\nimport { decoder } from './buffer_utils.js';\nimport epoch from './epoch.js';\nimport secs from './secs.js';\nimport isObject from './is_object.js';\nconst normalizeTyp = (value) => value.toLowerCase().replace(/^application\\//, '');\nconst checkAudiencePresence = (audPayload, audOption) => {\n    if (typeof audPayload === 'string') {\n        return audOption.includes(audPayload);\n    }\n    if (Array.isArray(audPayload)) {\n        return audOption.some(Set.prototype.has.bind(new Set(audPayload)));\n    }\n    return false;\n};\nexport default (protectedHeader, encodedPayload, options = {}) => {\n    let payload;\n    try {\n        payload = JSON.parse(decoder.decode(encodedPayload));\n    }\n    catch {\n    }\n    if (!isObject(payload)) {\n        throw new JWTInvalid('JWT Claims Set must be a top-level JSON object');\n    }\n    const { typ } = options;\n    if (typ &&\n        (typeof protectedHeader.typ !== 'string' ||\n            normalizeTyp(protectedHeader.typ) !== normalizeTyp(typ))) {\n        throw new JWTClaimValidationFailed('unexpected \"typ\" JWT header value', payload, 'typ', 'check_failed');\n    }\n    const { requiredClaims = [], issuer, subject, audience, maxTokenAge } = options;\n    const presenceCheck = [...requiredClaims];\n    if (maxTokenAge !== undefined)\n        presenceCheck.push('iat');\n    if (audience !== undefined)\n        presenceCheck.push('aud');\n    if (subject !== undefined)\n        presenceCheck.push('sub');\n    if (issuer !== undefined)\n        presenceCheck.push('iss');\n    for (const claim of new Set(presenceCheck.reverse())) {\n        if (!(claim in payload)) {\n            throw new JWTClaimValidationFailed(`missing required \"${claim}\" claim`, payload, claim, 'missing');\n        }\n    }\n    if (issuer &&\n        !(Array.isArray(issuer) ? issuer : [issuer]).includes(payload.iss)) {\n        throw new JWTClaimValidationFailed('unexpected \"iss\" claim value', payload, 'iss', 'check_failed');\n    }\n    if (subject && payload.sub !== subject) {\n        throw new JWTClaimValidationFailed('unexpected \"sub\" claim value', payload, 'sub', 'check_failed');\n    }\n    if (audience &&\n        !checkAudiencePresence(payload.aud, typeof audience === 'string' ? [audience] : audience)) {\n        throw new JWTClaimValidationFailed('unexpected \"aud\" claim value', payload, 'aud', 'check_failed');\n    }\n    let tolerance;\n    switch (typeof options.clockTolerance) {\n        case 'string':\n            tolerance = secs(options.clockTolerance);\n            break;\n        case 'number':\n            tolerance = options.clockTolerance;\n            break;\n        case 'undefined':\n            tolerance = 0;\n            break;\n        default:\n            throw new TypeError('Invalid clockTolerance option type');\n    }\n    const { currentDate } = options;\n    const now = epoch(currentDate || new Date());\n    if ((payload.iat !== undefined || maxTokenAge) && typeof payload.iat !== 'number') {\n        throw new JWTClaimValidationFailed('\"iat\" claim must be a number', payload, 'iat', 'invalid');\n    }\n    if (payload.nbf !== undefined) {\n        if (typeof payload.nbf !== 'number') {\n            throw new JWTClaimValidationFailed('\"nbf\" claim must be a number', payload, 'nbf', 'invalid');\n        }\n        if (payload.nbf > now + tolerance) {\n            throw new JWTClaimValidationFailed('\"nbf\" claim timestamp check failed', payload, 'nbf', 'check_failed');\n        }\n    }\n    if (payload.exp !== undefined) {\n        if (typeof payload.exp !== 'number') {\n            throw new JWTClaimValidationFailed('\"exp\" claim must be a number', payload, 'exp', 'invalid');\n        }\n        if (payload.exp <= now - tolerance) {\n            throw new JWTExpired('\"exp\" claim timestamp check failed', payload, 'exp', 'check_failed');\n        }\n    }\n    if (maxTokenAge) {\n        const age = now - payload.iat;\n        const max = typeof maxTokenAge === 'number' ? maxTokenAge : secs(maxTokenAge);\n        if (age - tolerance > max) {\n            throw new JWTExpired('\"iat\" claim timestamp check failed (too far in the past)', payload, 'iat', 'check_failed');\n        }\n        if (age < 0 - tolerance) {\n            throw new JWTClaimValidationFailed('\"iat\" claim timestamp check failed (it should be in the past)', payload, 'iat', 'check_failed');\n        }\n    }\n    return payload;\n};\n", "import { compactVerify } from '../jws/compact/verify.js';\nimport jwtPayload from '../lib/jwt_claims_set.js';\nimport { JWTInvalid } from '../util/errors.js';\nexport async function jwtVerify(jwt, key, options) {\n    const verified = await compactVerify(jwt, key, options);\n    if (verified.protectedHeader.crit?.includes('b64') && verified.protectedHeader.b64 === false) {\n        throw new JWTInvalid('JWTs MUST NOT use unencoded payload');\n    }\n    const payload = jwtPayload(verified.protectedHeader, verified.payload, options);\n    const result = { payload, protectedHeader: verified.protectedHeader };\n    if (typeof key === 'function') {\n        return { ...result, key: verified.key };\n    }\n    return result;\n}\n", "import { importJWK } from '../key/import.js';\nimport { JWKSInvalid, JOSENotSupported, JWKSNoMatchingKey, JWKSMultipleMatchingKeys, } from '../util/errors.js';\nimport isObject from '../lib/is_object.js';\nfunction getKtyFromAlg(alg) {\n    switch (typeof alg === 'string' && alg.slice(0, 2)) {\n        case 'RS':\n        case 'PS':\n            return 'RSA';\n        case 'ES':\n            return 'EC';\n        case 'Ed':\n            return 'OKP';\n        default:\n            throw new JOSENotSupported('Unsupported \"alg\" value for a JSON Web Key Set');\n    }\n}\nfunction isJWKSLike(jwks) {\n    return (jwks &&\n        typeof jwks === 'object' &&\n        Array.isArray(jwks.keys) &&\n        jwks.keys.every(isJWKLike));\n}\nfunction isJWKLike(key) {\n    return isObject(key);\n}\nfunction clone(obj) {\n    if (typeof structuredClone === 'function') {\n        return structuredClone(obj);\n    }\n    return JSON.parse(JSON.stringify(obj));\n}\nclass LocalJWKSet {\n    constructor(jwks) {\n        this._cached = new WeakMap();\n        if (!isJWKSLike(jwks)) {\n            throw new JWKSInvalid('JSON Web Key Set malformed');\n        }\n        this._jwks = clone(jwks);\n    }\n    async getKey(protectedHeader, token) {\n        const { alg, kid } = { ...protectedHeader, ...token?.header };\n        const kty = getKtyFromAlg(alg);\n        const candidates = this._jwks.keys.filter((jwk) => {\n            let candidate = kty === jwk.kty;\n            if (candidate && typeof kid === 'string') {\n                candidate = kid === jwk.kid;\n            }\n            if (candidate && typeof jwk.alg === 'string') {\n                candidate = alg === jwk.alg;\n            }\n            if (candidate && typeof jwk.use === 'string') {\n                candidate = jwk.use === 'sig';\n            }\n            if (candidate && Array.isArray(jwk.key_ops)) {\n                candidate = jwk.key_ops.includes('verify');\n            }\n            if (candidate) {\n                switch (alg) {\n                    case 'ES256':\n                        candidate = jwk.crv === 'P-256';\n                        break;\n                    case 'ES256K':\n                        candidate = jwk.crv === 'secp256k1';\n                        break;\n                    case 'ES384':\n                        candidate = jwk.crv === 'P-384';\n                        break;\n                    case 'ES512':\n                        candidate = jwk.crv === 'P-521';\n                        break;\n                    case 'Ed25519':\n                        candidate = jwk.crv === 'Ed25519';\n                        break;\n                    case 'EdDSA':\n                        candidate = jwk.crv === 'Ed25519' || jwk.crv === 'Ed448';\n                        break;\n                }\n            }\n            return candidate;\n        });\n        const { 0: jwk, length } = candidates;\n        if (length === 0) {\n            throw new JWKSNoMatchingKey();\n        }\n        if (length !== 1) {\n            const error = new JWKSMultipleMatchingKeys();\n            const { _cached } = this;\n            error[Symbol.asyncIterator] = async function* () {\n                for (const jwk of candidates) {\n                    try {\n                        yield await importWithAlgCache(_cached, jwk, alg);\n                    }\n                    catch { }\n                }\n            };\n            throw error;\n        }\n        return importWithAlgCache(this._cached, jwk, alg);\n    }\n}\nasync function importWithAlgCache(cache, jwk, alg) {\n    const cached = cache.get(jwk) || cache.set(jwk, {}).get(jwk);\n    if (cached[alg] === undefined) {\n        const key = await importJWK({ ...jwk, ext: true }, alg);\n        if (key instanceof Uint8Array || key.type !== 'public') {\n            throw new JWKSInvalid('JSON Web Key Set members must be public keys');\n        }\n        cached[alg] = key;\n    }\n    return cached[alg];\n}\nexport function createLocalJWKSet(jwks) {\n    const set = new LocalJWKSet(jwks);\n    const localJWKSet = async (protectedHeader, token) => set.getKey(protectedHeader, token);\n    Object.defineProperties(localJWKSet, {\n        jwks: {\n            value: () => clone(set._jwks),\n            enumerable: true,\n            configurable: false,\n            writable: false,\n        },\n    });\n    return localJWKSet;\n}\n", "import { JOSEError, JWKSTimeout } from '../util/errors.js';\nconst fetchJwks = async (url, timeout, options) => {\n    let controller;\n    let id;\n    let timedOut = false;\n    if (typeof AbortController === 'function') {\n        controller = new AbortController();\n        id = setTimeout(() => {\n            timedOut = true;\n            controller.abort();\n        }, timeout);\n    }\n    const response = await fetch(url.href, {\n        signal: controller ? controller.signal : undefined,\n        redirect: 'manual',\n        headers: options.headers,\n    }).catch((err) => {\n        if (timedOut)\n            throw new JWKSTimeout();\n        throw err;\n    });\n    if (id !== undefined)\n        clearTimeout(id);\n    if (response.status !== 200) {\n        throw new JOSEError('Expected 200 OK from the JSON Web Key Set HTTP response');\n    }\n    try {\n        return await response.json();\n    }\n    catch {\n        throw new JOSEError('Failed to parse the JSON Web Key Set HTTP response as JSON');\n    }\n};\nexport default fetchJwks;\n", "import fetchJwks from '../runtime/fetch_jwks.js';\nimport { JWKSNoMatchingKey } from '../util/errors.js';\nimport { createLocalJWKSet } from './local.js';\nimport isObject from '../lib/is_object.js';\nfunction isCloudflareWorkers() {\n    return (typeof WebSocketPair !== 'undefined' ||\n        (typeof navigator !== 'undefined' && navigator.userAgent === 'Cloudflare-Workers') ||\n        (typeof EdgeRuntime !== 'undefined' && EdgeRuntime === 'vercel'));\n}\nlet USER_AGENT;\nif (typeof navigator === 'undefined' || !navigator.userAgent?.startsWith?.('Mozilla/5.0 ')) {\n    const NAME = 'jose';\n    const VERSION = 'v5.10.0';\n    USER_AGENT = `${NAME}/${VERSION}`;\n}\nexport const jwksCache = Symbol();\nfunction isFreshJwksCache(input, cacheMaxAge) {\n    if (typeof input !== 'object' || input === null) {\n        return false;\n    }\n    if (!('uat' in input) || typeof input.uat !== 'number' || Date.now() - input.uat >= cacheMaxAge) {\n        return false;\n    }\n    if (!('jwks' in input) ||\n        !isObject(input.jwks) ||\n        !Array.isArray(input.jwks.keys) ||\n        !Array.prototype.every.call(input.jwks.keys, isObject)) {\n        return false;\n    }\n    return true;\n}\nclass RemoteJWKSet {\n    constructor(url, options) {\n        if (!(url instanceof URL)) {\n            throw new TypeError('url must be an instance of URL');\n        }\n        this._url = new URL(url.href);\n        this._options = { agent: options?.agent, headers: options?.headers };\n        this._timeoutDuration =\n            typeof options?.timeoutDuration === 'number' ? options?.timeoutDuration : 5000;\n        this._cooldownDuration =\n            typeof options?.cooldownDuration === 'number' ? options?.cooldownDuration : 30000;\n        this._cacheMaxAge = typeof options?.cacheMaxAge === 'number' ? options?.cacheMaxAge : 600000;\n        if (options?.[jwksCache] !== undefined) {\n            this._cache = options?.[jwksCache];\n            if (isFreshJwksCache(options?.[jwksCache], this._cacheMaxAge)) {\n                this._jwksTimestamp = this._cache.uat;\n                this._local = createLocalJWKSet(this._cache.jwks);\n            }\n        }\n    }\n    coolingDown() {\n        return typeof this._jwksTimestamp === 'number'\n            ? Date.now() < this._jwksTimestamp + this._cooldownDuration\n            : false;\n    }\n    fresh() {\n        return typeof this._jwksTimestamp === 'number'\n            ? Date.now() < this._jwksTimestamp + this._cacheMaxAge\n            : false;\n    }\n    async getKey(protectedHeader, token) {\n        if (!this._local || !this.fresh()) {\n            await this.reload();\n        }\n        try {\n            return await this._local(protectedHeader, token);\n        }\n        catch (err) {\n            if (err instanceof JWKSNoMatchingKey) {\n                if (this.coolingDown() === false) {\n                    await this.reload();\n                    return this._local(protectedHeader, token);\n                }\n            }\n            throw err;\n        }\n    }\n    async reload() {\n        if (this._pendingFetch && isCloudflareWorkers()) {\n            this._pendingFetch = undefined;\n        }\n        const headers = new Headers(this._options.headers);\n        if (USER_AGENT && !headers.has('User-Agent')) {\n            headers.set('User-Agent', USER_AGENT);\n            this._options.headers = Object.fromEntries(headers.entries());\n        }\n        this._pendingFetch || (this._pendingFetch = fetchJwks(this._url, this._timeoutDuration, this._options)\n            .then((json) => {\n            this._local = createLocalJWKSet(json);\n            if (this._cache) {\n                this._cache.uat = Date.now();\n                this._cache.jwks = json;\n            }\n            this._jwksTimestamp = Date.now();\n            this._pendingFetch = undefined;\n        })\n            .catch((err) => {\n            this._pendingFetch = undefined;\n            throw err;\n        }));\n        await this._pendingFetch;\n    }\n}\nexport function createRemoteJWKSet(url, options) {\n    const set = new RemoteJWKSet(url, options);\n    const remoteJWKSet = async (protectedHeader, token) => set.getKey(protectedHeader, token);\n    Object.defineProperties(remoteJWKSet, {\n        coolingDown: {\n            get: () => set.coolingDown(),\n            enumerable: true,\n            configurable: false,\n        },\n        fresh: {\n            get: () => set.fresh(),\n            enumerable: true,\n            configurable: false,\n        },\n        reload: {\n            value: () => set.reload(),\n            enumerable: true,\n            configurable: false,\n            writable: false,\n        },\n        reloading: {\n            get: () => !!set._pendingFetch,\n            enumerable: true,\n            configurable: false,\n        },\n        jwks: {\n            value: () => set._local?.jwks(),\n            enumerable: true,\n            configurable: false,\n            writable: false,\n        },\n    });\n    return remoteJWKSet;\n}\nexport const experimental_jwksCache = jwksCache;\n", "import type { JWTPayload } from 'jose'\r\nimport { createRemoteJWKSet, jwtVerify } from 'jose'\r\n\r\ntype AccessJwtValidationResult = {\r\n  ok: boolean\r\n  reason?: string\r\n  payload?: JWTPayload\r\n}\r\n\r\nconst jwksCache = new Map<string, ReturnType<typeof createRemoteJWKSet>>()\r\n\r\nfunction normalizeTeamDomain(teamDomain: string): string {\r\n  return teamDomain.replace(/^https?:\\/\\//i, '').replace(/\\/+$/g, '')\r\n}\r\n\r\nfunction getRemoteJwks(teamDomain: string) {\r\n  const normalized = normalizeTeamDomain(teamDomain)\r\n  const cached = jwksCache.get(normalized)\r\n  if (cached) {\r\n    return cached\r\n  }\r\n  const jwks = createRemoteJWKSet(new URL(`https://${normalized}/cdn-cgi/access/certs`))\r\n  jwksCache.set(normalized, jwks)\r\n  return jwks\r\n}\r\n\r\nexport async function verifyAccessJwtToken(\r\n  token: string,\r\n  params: { teamDomain?: string; audience?: string },\r\n): Promise<AccessJwtValidationResult> {\r\n  if (!token) {\r\n    return { ok: false, reason: 'missing_access_jwt' }\r\n  }\r\n\r\n  const teamDomain = String(params.teamDomain ?? '').trim()\r\n  const audience = String(params.audience ?? '').trim()\r\n\r\n  if (!teamDomain || !audience) {\r\n    return { ok: false, reason: 'access_not_configured' }\r\n  }\r\n\r\n  const issuer = `https://${normalizeTeamDomain(teamDomain)}`\r\n  const jwks = getRemoteJwks(teamDomain)\r\n\r\n  try {\r\n    const verified = await jwtVerify(token, jwks, {\r\n      issuer,\r\n      audience,\r\n    })\r\n    return {\r\n      ok: true,\r\n      payload: verified.payload,\r\n    }\r\n  } catch (error) {\r\n    return {\r\n      ok: false,\r\n      reason: (error as Error)?.message || 'invalid_access_jwt',\r\n    }\r\n  }\r\n}", "import type { MiddlewareHandler } from 'hono'\r\nimport type { AdminAuthState, AppContext } from '../types'\r\nimport { jsonError, withNoStore } from '../utils/http'\r\nimport { verifyAccessJwtToken } from './access-jwt'\r\n\r\nexport function parseBearerToken(value: string | null | undefined): string | null {\r\n  if (!value) {\r\n    return null\r\n  }\r\n  const match = /^Bearer\\s+(.+)$/i.exec(value.trim())\r\n  if (!match) {\r\n    return null\r\n  }\r\n  const token = match[1].trim()\r\n  return token || null\r\n}\r\n\r\nexport function isBearerTokenAuthorized(providedToken: string | null, expectedToken: string | undefined): boolean {\r\n  const expected = String(expectedToken ?? '').trim()\r\n  if (!providedToken || !expected) {\r\n    return false\r\n  }\r\n  if (providedToken.length !== expected.length) {\r\n    return false\r\n  }\r\n  const encoder = new TextEncoder()\r\n  const a = encoder.encode(providedToken)\r\n  const b = encoder.encode(expected)\r\n  if (a.byteLength !== b.byteLength) {\r\n    return false\r\n  }\r\n  let mismatch = 0\r\n  for (let i = 0; i < a.byteLength; i++) {\r\n    mismatch |= a[i] ^ b[i]\r\n  }\r\n  return mismatch === 0\r\n}\r\n\r\nexport async function evaluateAdminAuth(c: Parameters<MiddlewareHandler<AppContext>>[0]): Promise<AdminAuthState> {\r\n  const bearerToken = parseBearerToken(c.req.header('Authorization'))\r\n  const expectedToken = c.env.ADMIN_API_TOKEN\r\n\r\n  if (isBearerTokenAuthorized(bearerToken, expectedToken)) {\r\n    return {\r\n      ok: true,\r\n      mode: 'bearer',\r\n      subject: 'admin-token',\r\n    }\r\n  }\r\n\r\n  const accessAssertion = c.req.header('Cf-Access-Jwt-Assertion')\r\n  if (accessAssertion) {\r\n    const accessResult = await verifyAccessJwtToken(accessAssertion, {\r\n      teamDomain: c.env.CF_ACCESS_TEAM_DOMAIN,\r\n      audience: c.env.CF_ACCESS_AUD,\r\n    })\r\n\r\n    if (accessResult.ok) {\r\n      return {\r\n        ok: true,\r\n        mode: 'access',\r\n        subject: String(accessResult.payload?.sub || 'access-user'),\r\n        jwtPayload: accessResult.payload,\r\n      }\r\n    }\r\n\r\n    return {\r\n      ok: false,\r\n      mode: null,\r\n      reason: accessResult.reason || 'invalid_access_jwt',\r\n    }\r\n  }\r\n\r\n  if (bearerToken && !isBearerTokenAuthorized(bearerToken, expectedToken)) {\r\n    return {\r\n      ok: false,\r\n      mode: null,\r\n      reason: 'invalid_bearer_token',\r\n    }\r\n  }\r\n\r\n  return {\r\n    ok: false,\r\n    mode: null,\r\n    reason: 'admin_token_or_access_jwt_required',\r\n  }\r\n}\r\n\r\nexport function requireAdmin(): MiddlewareHandler<AppContext> {\r\n  return async (c, next) => {\r\n    withNoStore(c)\r\n\r\n    const authState = await evaluateAdminAuth(c)\r\n    c.set('adminAuthState', authState)\r\n\r\n    if (!authState.ok) {\r\n      return jsonError(c, 401, 'UNAUTHORIZED', 'Admin authentication failed.', {\r\n        reason: authState.reason,\r\n      })\r\n    }\r\n\r\n    await next()\r\n  }\r\n}", "import { Hono } from 'hono'\r\nimport type { AppContext, EnvBindings } from '../types'\r\nimport { jsonError } from '../utils/http'\r\n\r\nconst APP_CONFIG_TABLE = 'app_config'\r\n\r\n/** Safe env keys to expose read-only in admin (no secrets). */\r\nconst SAFE_ENV_KEYS = [\r\n  'WORKER_VERSION',\r\n  'PUBLIC_API_BASE_PATH',\r\n  'MELBOURNE_TIMEZONE',\r\n  'MELBOURNE_TARGET_HOUR',\r\n  'MANUAL_RUN_COOLDOWN_SECONDS',\r\n  'LOCK_TTL_SECONDS',\r\n  'MAX_QUEUE_ATTEMPTS',\r\n  'FEATURE_PROSPECTIVE_ENABLED',\r\n  'FEATURE_BACKFILL_ENABLED',\r\n  'CF_ACCESS_TEAM_DOMAIN',\r\n  'CF_ACCESS_AUD',\r\n] as const\r\n\r\nexport const adminConfigRoutes = new Hono<AppContext>()\r\n\r\n/** GET /admin/config - return all app_config rows */\r\nadminConfigRoutes.get('/config', async (c) => {\r\n  const db = c.env.DB\r\n  const stmt = db.prepare(`SELECT key, value, updated_at FROM ${APP_CONFIG_TABLE} ORDER BY key`)\r\n  const result = await stmt.all<{ key: string; value: string; updated_at: string }>()\r\n  const rows = result.results || []\r\n  return c.json({\r\n    ok: true,\r\n    auth_mode: c.get('adminAuthState')?.mode ?? null,\r\n    config: rows,\r\n  })\r\n})\r\n\r\n/** PUT /admin/config - upsert one key */\r\nadminConfigRoutes.put('/config', async (c) => {\r\n  const body = await c.req.json<{ key: string; value: string }>().catch(() => null)\r\n  if (!body || typeof body.key !== 'string' || body.key.trim() === '') {\r\n    return jsonError(c, 400, 'BAD_REQUEST', 'Missing or invalid key')\r\n  }\r\n  const key = String(body.key).trim()\r\n  const value = typeof body.value === 'string' ? body.value : String(body.value ?? '')\r\n\r\n  const db = c.env.DB\r\n  const now = new Date().toISOString()\r\n  await db\r\n    .prepare(\r\n      `INSERT INTO ${APP_CONFIG_TABLE} (key, value, updated_at) VALUES (?, ?, ?)\r\n       ON CONFLICT(key) DO UPDATE SET value = excluded.value, updated_at = excluded.updated_at`,\r\n    )\r\n    .bind(key, value, now)\r\n    .run()\r\n\r\n  const row = await db\r\n    .prepare(`SELECT key, value, updated_at FROM ${APP_CONFIG_TABLE} WHERE key = ?`)\r\n    .bind(key)\r\n    .first<{ key: string; value: string; updated_at: string }>()\r\n\r\n  return c.json({\r\n    ok: true,\r\n    auth_mode: c.get('adminAuthState')?.mode ?? null,\r\n    row: row ?? { key, value, updated_at: now },\r\n  })\r\n})\r\n\r\n/** DELETE /admin/config - remove one key (reset to env default) */\r\nadminConfigRoutes.delete('/config', async (c) => {\r\n  const body = await c.req.json<{ key: string }>().catch(() => null)\r\n  if (!body || typeof body.key !== 'string' || body.key.trim() === '') {\r\n    return jsonError(c, 400, 'BAD_REQUEST', 'Missing or invalid key')\r\n  }\r\n  const key = String(body.key).trim()\r\n  const db = c.env.DB\r\n  const result = await db.prepare(`DELETE FROM ${APP_CONFIG_TABLE} WHERE key = ?`).bind(key).run()\r\n  return c.json({\r\n    ok: true,\r\n    auth_mode: c.get('adminAuthState')?.mode ?? null,\r\n    deleted: (result.meta.changes ?? 0) > 0,\r\n  })\r\n})\r\n\r\n/** GET /admin/env - read-only safe env vars (no secrets) */\r\nadminConfigRoutes.get('/env', async (c) => {\r\n  const env = c.env as Record<string, unknown>\r\n  const out: Record<string, string> = {}\r\n  for (const k of SAFE_ENV_KEYS) {\r\n    const v = env[k]\r\n    if (v !== undefined && v !== null) out[k] = String(v)\r\n  }\r\n  return c.json({\r\n    ok: true,\r\n    auth_mode: c.get('adminAuthState')?.mode ?? null,\r\n    env: out,\r\n  })\r\n})\r\n", "/**\r\n * Admin DB routes: list tables, schema, paginated rows, get by key, insert, update, delete.\r\n * All table names are allowlisted; key columns for update/delete are defined per table.\r\n */\r\n\r\nimport { Hono } from 'hono'\r\nimport type { AppContext } from '../types'\r\nimport { jsonError } from '../utils/http'\r\n\r\nconst ADMIN_DB_TABLES = [\r\n  'historical_loan_rates',\r\n  'historical_savings_rates',\r\n  'historical_term_deposit_rates',\r\n  'raw_payloads',\r\n  'run_reports',\r\n  'lender_endpoint_cache',\r\n  'brand_normalization_map',\r\n  'backfill_cursors',\r\n  'rba_cash_rates',\r\n  'global_log',\r\n] as const\r\n\r\ntype TableName = (typeof ADMIN_DB_TABLES)[number]\r\n\r\nfunction isAllowedTable(name: string): name is TableName {\r\n  return ADMIN_DB_TABLES.includes(name as TableName)\r\n}\r\n\r\n/** Key columns for each table (for UPDATE/DELETE and get-by-key). */\r\nconst TABLE_KEY_COLUMNS: Record<TableName, string[]> = {\r\n  historical_loan_rates: [\r\n    'bank_name',\r\n    'collection_date',\r\n    'product_id',\r\n    'lvr_tier',\r\n    'rate_structure',\r\n    'security_purpose',\r\n    'repayment_type',\r\n    'run_source',\r\n  ],\r\n  historical_savings_rates: [\r\n    'bank_name',\r\n    'collection_date',\r\n    'product_id',\r\n    'rate_type',\r\n    'deposit_tier',\r\n    'run_source',\r\n  ],\r\n  historical_term_deposit_rates: [\r\n    'bank_name',\r\n    'collection_date',\r\n    'product_id',\r\n    'term_months',\r\n    'deposit_tier',\r\n    'run_source',\r\n  ],\r\n  raw_payloads: ['id'],\r\n  run_reports: ['run_id'],\r\n  lender_endpoint_cache: ['lender_code'],\r\n  brand_normalization_map: ['id'],\r\n  backfill_cursors: ['cursor_key'],\r\n  rba_cash_rates: ['collection_date'],\r\n  global_log: ['id'],\r\n}\r\n\r\nexport const adminDbRoutes = new Hono<AppContext>()\r\n\r\n/** GET /admin/db/tables - list allowlisted tables with optional row counts */\r\nadminDbRoutes.get('/db/tables', async (c) => {\r\n  const db = c.env.DB\r\n  const withCounts = c.req.query('counts') === 'true'\r\n  const tables: { name: string; count?: number }[] = []\r\n\r\n  for (const name of ADMIN_DB_TABLES) {\r\n    if (!withCounts) {\r\n      tables.push({ name })\r\n      continue\r\n    }\r\n    try {\r\n      const r = await db.prepare(`SELECT count(*) as n FROM ${name}`).first<{ n: number }>()\r\n      tables.push({ name, count: r?.n ?? 0 })\r\n    } catch {\r\n      tables.push({ name, count: 0 })\r\n    }\r\n  }\r\n\r\n  return c.json({\r\n    ok: true,\r\n    auth_mode: c.get('adminAuthState')?.mode ?? null,\r\n    tables,\r\n  })\r\n})\r\n\r\n/** GET /admin/db/tables/:tableName/schema - column info + key columns */\r\nadminDbRoutes.get('/db/tables/:tableName/schema', async (c) => {\r\n  const tableName = c.req.param('tableName')\r\n  if (!isAllowedTable(tableName)) {\r\n    return jsonError(c, 400, 'BAD_REQUEST', `Table not allowed: ${tableName}`)\r\n  }\r\n\r\n  const db = c.env.DB\r\n  const pragma = await db.prepare(`PRAGMA table_info(${tableName})`).all()\r\n  const results = (pragma.results ?? []) as Array<{\r\n    cid: number\r\n    name: string\r\n    type: string\r\n    notnull: number\r\n    dflt_value: string | null\r\n    pk: number\r\n  }>\r\n\r\n  const columns = results.map((r) => ({\r\n    name: r.name,\r\n    type: r.type || 'TEXT',\r\n    notnull: r.notnull === 1,\r\n    pk: r.pk === 1,\r\n    dflt_value: r.dflt_value ?? undefined,\r\n  }))\r\n\r\n  const keyCols = TABLE_KEY_COLUMNS[tableName]\r\n  const hasAutoPk =\r\n    columns.some((col) => col.name === 'id' && col.pk) && keyCols.length === 1 && keyCols[0] === 'id'\r\n\r\n  return c.json({\r\n    ok: true,\r\n    auth_mode: c.get('adminAuthState')?.mode ?? null,\r\n    table: tableName,\r\n    columns,\r\n    key_columns: keyCols,\r\n    has_auto_increment_pk: hasAutoPk,\r\n  })\r\n})\r\n\r\n/** GET /admin/db/tables/:tableName/rows - paginated list */\r\nadminDbRoutes.get('/db/tables/:tableName/rows', async (c) => {\r\n  const tableName = c.req.param('tableName')\r\n  if (!isAllowedTable(tableName)) {\r\n    return jsonError(c, 400, 'BAD_REQUEST', `Table not allowed: ${tableName}`)\r\n  }\r\n\r\n  const limit = Math.min(Math.max(1, Number(c.req.query('limit')) || 50), 500)\r\n  const offset = Math.max(0, Number(c.req.query('offset')) || 0)\r\n  const sortCol = (c.req.query('sort') || '').trim() || null\r\n  const sortDir = (c.req.query('dir') || 'asc').toLowerCase() === 'desc' ? 'DESC' : 'ASC'\r\n\r\n  const db = c.env.DB\r\n  const pragma = await db.prepare(`PRAGMA table_info(${tableName})`).all()\r\n  const colNames = ((pragma.results ?? []) as Array<{ name: string }>).map((r) => r.name)\r\n  const orderCol = sortCol && colNames.includes(sortCol) ? sortCol : colNames[0] ?? '1'\r\n  const orderBy = `ORDER BY ${orderCol} ${sortDir}`\r\n\r\n  const countResult = await db.prepare(`SELECT count(*) as n FROM ${tableName}`).first<{ n: number }>()\r\n  const total = countResult?.n ?? 0\r\n\r\n  const rowsStmt = `SELECT * FROM ${tableName} ${orderBy} LIMIT ? OFFSET ?`\r\n  const rowsResult = await db.prepare(rowsStmt).bind(limit, offset).all()\r\n  const rows = (rowsResult.results ?? []) as Record<string, unknown>[]\r\n\r\n  return c.json({\r\n    ok: true,\r\n    auth_mode: c.get('adminAuthState')?.mode ?? null,\r\n    rows,\r\n    total,\r\n    limit,\r\n    offset,\r\n  })\r\n})\r\n\r\n/** POST /admin/db/tables/:tableName/rows/by-key - get single row by key (body: key object) */\r\nadminDbRoutes.post('/db/tables/:tableName/rows/by-key', async (c) => {\r\n  const tableName = c.req.param('tableName')\r\n  if (!isAllowedTable(tableName)) {\r\n    return jsonError(c, 400, 'BAD_REQUEST', `Table not allowed: ${tableName}`)\r\n  }\r\n\r\n  const body = (await c.req.json<Record<string, unknown>>().catch(() => ({}))) as Record<string, unknown>\r\n  const keyCols = TABLE_KEY_COLUMNS[tableName]\r\n  const whereParts: string[] = []\r\n  const values: unknown[] = []\r\n  for (const col of keyCols) {\r\n    const v = body[col]\r\n    if (v === undefined || v === null) {\r\n      return jsonError(c, 400, 'BAD_REQUEST', `Missing key column: ${col}`)\r\n    }\r\n    whereParts.push(`${col} = ?`)\r\n    values.push(v)\r\n  }\r\n  const where = whereParts.join(' AND ')\r\n  const db = c.env.DB\r\n  const row = await db\r\n    .prepare(`SELECT * FROM ${tableName} WHERE ${where}`)\r\n    .bind(...values)\r\n    .first<Record<string, unknown>>()\r\n\r\n  if (!row) {\r\n    return jsonError(c, 404, 'NOT_FOUND', 'Row not found')\r\n  }\r\n  return c.json({ ok: true, auth_mode: c.get('adminAuthState')?.mode ?? null, row })\r\n})\r\n\r\n/** POST /admin/db/tables/:tableName/rows - insert row */\r\nadminDbRoutes.post('/db/tables/:tableName/rows', async (c) => {\r\n  const tableName = c.req.param('tableName')\r\n  if (!isAllowedTable(tableName)) {\r\n    return jsonError(c, 400, 'BAD_REQUEST', `Table not allowed: ${tableName}`)\r\n  }\r\n\r\n  const body = (await c.req.json<Record<string, unknown>>().catch(() => ({}))) as Record<string, unknown>\r\n  const db = c.env.DB\r\n  const pragma = await db.prepare(`PRAGMA table_info(${tableName})`).all()\r\n  const colInfos = (pragma.results ?? []) as Array<{ name: string; pk: number }>\r\n  const colNames = colInfos.map((r) => r.name).filter((n) => body[n] !== undefined)\r\n\r\n  if (colNames.length === 0) {\r\n    return jsonError(c, 400, 'BAD_REQUEST', 'No columns provided')\r\n  }\r\n\r\n  const placeholders = colNames.map(() => '?').join(', ')\r\n  const cols = colNames.join(', ')\r\n  const values = colNames.map((n) => body[n])\r\n\r\n  try {\r\n    await db.prepare(`INSERT INTO ${tableName} (${cols}) VALUES (${placeholders})`).bind(...values).run()\r\n  } catch (e) {\r\n    const msg = (e as Error)?.message ?? String(e)\r\n    return jsonError(c, 400, 'CONSTRAINT_VIOLATION', msg, { details: msg })\r\n  }\r\n\r\n  const keyCols = TABLE_KEY_COLUMNS[tableName]\r\n  if (keyCols.length === 1 && body[keyCols[0]] !== undefined) {\r\n    const keyVal = body[keyCols[0]]\r\n    const row = await db\r\n      .prepare(`SELECT * FROM ${tableName} WHERE ${keyCols[0]} = ?`)\r\n      .bind(keyVal)\r\n      .first<Record<string, unknown>>()\r\n    return c.json({ ok: true, auth_mode: c.get('adminAuthState')?.mode ?? null, row: row ?? body })\r\n  }\r\n  return c.json({ ok: true, auth_mode: c.get('adminAuthState')?.mode ?? null, row: body })\r\n})\r\n\r\n/** PUT /admin/db/tables/:tableName/rows - update row (body must include key columns + updated fields) */\r\nadminDbRoutes.put('/db/tables/:tableName/rows', async (c) => {\r\n  const tableName = c.req.param('tableName')\r\n  if (!isAllowedTable(tableName)) {\r\n    return jsonError(c, 400, 'BAD_REQUEST', `Table not allowed: ${tableName}`)\r\n  }\r\n\r\n  const body = (await c.req.json<Record<string, unknown>>().catch(() => ({}))) as Record<string, unknown>\r\n  const keyCols = TABLE_KEY_COLUMNS[tableName]\r\n  const db = c.env.DB\r\n  const pragma = await db.prepare(`PRAGMA table_info(${tableName})`).all()\r\n  const allCols = ((pragma.results ?? []) as Array<{ name: string }>).map((r) => r.name)\r\n\r\n  const setCols = allCols.filter((col) => !keyCols.includes(col) && body[col] !== undefined)\r\n  if (setCols.length === 0) {\r\n    return jsonError(c, 400, 'BAD_REQUEST', 'No non-key columns to update')\r\n  }\r\n\r\n  const whereParts: string[] = []\r\n  const bindValues: unknown[] = []\r\n  for (const col of keyCols) {\r\n    const v = body[col]\r\n    if (v === undefined || v === null) {\r\n      return jsonError(c, 400, 'BAD_REQUEST', `Missing key column: ${col}`)\r\n    }\r\n    whereParts.push(`${col} = ?`)\r\n    bindValues.push(v)\r\n  }\r\n  const setParts = setCols.map((col) => `${col} = ?`)\r\n  for (const col of setCols) {\r\n    bindValues.push(body[col])\r\n  }\r\n  const setClause = setParts.join(', ')\r\n  const where = whereParts.join(' AND ')\r\n\r\n  try {\r\n    const result = await db\r\n      .prepare(`UPDATE ${tableName} SET ${setClause} WHERE ${where}`)\r\n      .bind(...bindValues)\r\n      .run()\r\n    if ((result.meta.changes ?? 0) === 0) {\r\n      return jsonError(c, 404, 'NOT_FOUND', 'No row matched the key')\r\n    }\r\n  } catch (e) {\r\n    const msg = (e as Error)?.message ?? String(e)\r\n    return jsonError(c, 400, 'CONSTRAINT_VIOLATION', msg, { details: msg })\r\n  }\r\n\r\n  const row = await db\r\n    .prepare(`SELECT * FROM ${tableName} WHERE ${where}`)\r\n    .bind(...keyCols.map((col) => body[col]))\r\n    .first<Record<string, unknown>>()\r\n  return c.json({ ok: true, auth_mode: c.get('adminAuthState')?.mode ?? null, row: row ?? body })\r\n})\r\n\r\n/** DELETE /admin/db/tables/:tableName/rows - delete row (body: key columns only) */\r\nadminDbRoutes.delete('/db/tables/:tableName/rows', async (c) => {\r\n  const tableName = c.req.param('tableName')\r\n  if (!isAllowedTable(tableName)) {\r\n    return jsonError(c, 400, 'BAD_REQUEST', `Table not allowed: ${tableName}`)\r\n  }\r\n\r\n  const body = (await c.req.json<Record<string, unknown>>().catch(() => ({}))) as Record<string, unknown>\r\n  const keyCols = TABLE_KEY_COLUMNS[tableName]\r\n  const whereParts: string[] = []\r\n  const values: unknown[] = []\r\n  for (const col of keyCols) {\r\n    const v = body[col]\r\n    if (v === undefined || v === null) {\r\n      return jsonError(c, 400, 'BAD_REQUEST', `Missing key column: ${col}`)\r\n    }\r\n    whereParts.push(`${col} = ?`)\r\n    values.push(v)\r\n  }\r\n  const where = whereParts.join(' AND ')\r\n  const db = c.env.DB\r\n  const result = await db.prepare(`DELETE FROM ${tableName} WHERE ${where}`).bind(...values).run()\r\n  if ((result.meta.changes ?? 0) === 0) {\r\n    return jsonError(c, 404, 'NOT_FOUND', 'No row matched the key')\r\n  }\r\n  return c.json({ ok: true, auth_mode: c.get('adminAuthState')?.mode ?? null, deleted: true })\r\n})\r\n", "import { Hono } from 'hono'\r\nimport { requireAdmin } from '../auth/admin'\r\nimport { getRunReport, listRunReports } from '../db/run-reports'\r\nimport { triggerBackfillRun, triggerDailyRun } from '../pipeline/bootstrap-jobs'\r\nimport { adminConfigRoutes } from './admin-config'\r\nimport { adminDbRoutes } from './admin-db'\r\nimport type { AppContext } from '../types'\r\nimport { jsonError, withNoStore } from '../utils/http'\r\nimport { log } from '../utils/logger'\r\n\r\nexport const adminRoutes = new Hono<AppContext>()\r\n\r\nadminRoutes.use('*', async (c, next) => {\r\n  withNoStore(c)\r\n  await next()\r\n})\r\n\r\nadminRoutes.use('*', requireAdmin())\r\n\r\nadminRoutes.route('/', adminConfigRoutes)\r\nadminRoutes.route('/', adminDbRoutes)\r\n\r\nadminRoutes.get('/runs', async (c) => {\r\n  const limit = Number(c.req.query('limit') || 25)\r\n  const runs = await listRunReports(c.env.DB, limit)\r\n\r\n  return c.json({\r\n    ok: true,\r\n    count: runs.length,\r\n    auth_mode: c.get('adminAuthState')?.mode || null,\r\n    runs,\r\n  })\r\n})\r\n\r\nadminRoutes.get('/runs/:runId', async (c) => {\r\n  const runId = c.req.param('runId')\r\n  const run = await getRunReport(c.env.DB, runId)\r\n\r\n  if (!run) {\r\n    return jsonError(c, 404, 'NOT_FOUND', `Run report not found: ${runId}`)\r\n  }\r\n\r\n  return c.json({\r\n    ok: true,\r\n    auth_mode: c.get('adminAuthState')?.mode || null,\r\n    run,\r\n  })\r\n})\r\n\r\nadminRoutes.post('/runs/daily', async (c) => {\r\n  log.info('admin', 'Manual daily run triggered')\r\n  const body = (await c.req.json<Record<string, unknown>>().catch(() => ({}))) as Record<string, unknown>\r\n  const force = Boolean(body.force)\r\n\r\n  const result = await triggerDailyRun(c.env, {\r\n    source: 'manual',\r\n    force,\r\n  })\r\n\r\n  return c.json({\r\n    ok: true,\r\n    auth_mode: c.get('adminAuthState')?.mode || null,\r\n    result,\r\n  })\r\n})\r\n\r\nadminRoutes.post('/runs/backfill', async (c) => {\r\n  log.info('admin', 'Manual backfill run triggered')\r\n  const body = (await c.req.json<Record<string, unknown>>().catch(() => ({}))) as Record<string, unknown>\r\n\r\n  const rawLenderCodes = body.lenderCodes\r\n  const lenderCodes = Array.isArray(rawLenderCodes)\r\n    ? rawLenderCodes.map((x: unknown) => String(x || '').trim()).filter(Boolean)\r\n    : undefined\r\n\r\n  const monthCursor = typeof body.monthCursor === 'string' ? body.monthCursor : undefined\r\n  const maxSnapshotsPerMonth = Number(body.maxSnapshotsPerMonth || 3)\r\n\r\n  const result = await triggerBackfillRun(c.env, {\r\n    lenderCodes,\r\n    monthCursor,\r\n    maxSnapshotsPerMonth,\r\n  })\r\n\r\n  return c.json({\r\n    ok: true,\r\n    auth_mode: c.get('adminAuthState')?.mode || null,\r\n    result,\r\n  })\r\n})\r\n", "import {\r\n  FEATURE_SETS,\r\n  LVR_TIERS,\r\n  RATE_STRUCTURES,\r\n  REPAYMENT_TYPES,\r\n  SECURITY_PURPOSES,\r\n} from '../constants'\r\n\r\ntype LatestFilters = {\r\n  bank?: string\r\n  securityPurpose?: string\r\n  repaymentType?: string\r\n  rateStructure?: string\r\n  lvrTier?: string\r\n  featureSet?: string\r\n  mode?: 'all' | 'daily' | 'historical'\r\n  limit?: number\r\n  orderBy?: 'default' | 'rate_asc' | 'rate_desc'\r\n}\r\n\r\nconst VALID_ORDER_BY: Record<string, string> = {\r\n  default: 'v.collection_date DESC, v.bank_name ASC, v.product_name ASC, v.lvr_tier ASC, v.rate_structure ASC',\r\n  rate_asc: 'v.interest_rate ASC, v.bank_name ASC, v.product_name ASC',\r\n  rate_desc: 'v.interest_rate DESC, v.bank_name ASC, v.product_name ASC',\r\n}\r\n\r\nconst MIN_PUBLIC_RATE = 0.5\r\nconst MAX_PUBLIC_RATE = 25\r\nconst MIN_CONFIDENCE_ALL = 0.85\r\nconst MIN_CONFIDENCE_DAILY = 0.9\r\nconst MIN_CONFIDENCE_HISTORICAL = 0.82\r\n\r\nfunction safeLimit(limit: number | undefined, fallback: number, max = 500): number {\r\n  if (!Number.isFinite(limit)) {\r\n    return fallback\r\n  }\r\n  return Math.min(max, Math.max(1, Math.floor(limit as number)))\r\n}\r\n\r\nfunction rows<T>(result: D1Result<T>): T[] {\r\n  return result.results ?? []\r\n}\r\n\r\nexport async function getFilters(db: D1Database) {\r\n  const [banks, securityPurposes, repaymentTypes, rateStructures, lvrTiers, featureSets] = await Promise.all([\r\n    db.prepare('SELECT DISTINCT bank_name AS value FROM historical_loan_rates ORDER BY bank_name ASC').all<{ value: string }>(),\r\n    db\r\n      .prepare('SELECT DISTINCT security_purpose AS value FROM historical_loan_rates ORDER BY security_purpose ASC')\r\n      .all<{ value: string }>(),\r\n    db\r\n      .prepare('SELECT DISTINCT repayment_type AS value FROM historical_loan_rates ORDER BY repayment_type ASC')\r\n      .all<{ value: string }>(),\r\n    db\r\n      .prepare('SELECT DISTINCT rate_structure AS value FROM historical_loan_rates ORDER BY rate_structure ASC')\r\n      .all<{ value: string }>(),\r\n    db.prepare('SELECT DISTINCT lvr_tier AS value FROM historical_loan_rates ORDER BY lvr_tier ASC').all<{ value: string }>(),\r\n    db\r\n      .prepare('SELECT DISTINCT feature_set AS value FROM historical_loan_rates ORDER BY feature_set ASC')\r\n      .all<{ value: string }>(),\r\n  ])\r\n\r\n  const fallbackIfEmpty = (values: string[], fallback: string[]) => (values.length > 0 ? values : fallback)\r\n\r\n  return {\r\n    banks: rows(banks).map((x) => x.value),\r\n    security_purposes: fallbackIfEmpty(\r\n      rows(securityPurposes).map((x) => x.value),\r\n      SECURITY_PURPOSES,\r\n    ),\r\n    repayment_types: fallbackIfEmpty(\r\n      rows(repaymentTypes).map((x) => x.value),\r\n      REPAYMENT_TYPES,\r\n    ),\r\n    rate_structures: fallbackIfEmpty(\r\n      rows(rateStructures).map((x) => x.value),\r\n      RATE_STRUCTURES,\r\n    ),\r\n    lvr_tiers: fallbackIfEmpty(\r\n      rows(lvrTiers).map((x) => x.value),\r\n      LVR_TIERS,\r\n    ),\r\n    feature_sets: fallbackIfEmpty(\r\n      rows(featureSets).map((x) => x.value),\r\n      FEATURE_SETS,\r\n    ),\r\n  }\r\n}\r\n\r\nexport async function queryLatestRates(db: D1Database, filters: LatestFilters) {\r\n  const where: string[] = []\r\n  const binds: Array<string | number> = []\r\n\r\n  where.push('v.interest_rate BETWEEN ? AND ?')\r\n  binds.push(MIN_PUBLIC_RATE, MAX_PUBLIC_RATE)\r\n\r\n  if (filters.bank) {\r\n    where.push('v.bank_name = ?')\r\n    binds.push(filters.bank)\r\n  }\r\n  if (filters.securityPurpose) {\r\n    where.push('v.security_purpose = ?')\r\n    binds.push(filters.securityPurpose)\r\n  }\r\n  if (filters.repaymentType) {\r\n    where.push('v.repayment_type = ?')\r\n    binds.push(filters.repaymentType)\r\n  }\r\n  if (filters.rateStructure) {\r\n    where.push('v.rate_structure = ?')\r\n    binds.push(filters.rateStructure)\r\n  }\r\n  if (filters.lvrTier) {\r\n    where.push('v.lvr_tier = ?')\r\n    binds.push(filters.lvrTier)\r\n  }\r\n  if (filters.featureSet) {\r\n    where.push('v.feature_set = ?')\r\n    binds.push(filters.featureSet)\r\n  }\r\n  if (filters.mode === 'daily') {\r\n    where.push(\"v.data_quality_flag NOT LIKE 'parsed_from_wayback%'\")\r\n    where.push('v.confidence_score >= ?')\r\n    binds.push(MIN_CONFIDENCE_DAILY)\r\n  } else if (filters.mode === 'historical') {\r\n    where.push(\"v.data_quality_flag LIKE 'parsed_from_wayback%'\")\r\n    where.push('v.confidence_score >= ?')\r\n    binds.push(MIN_CONFIDENCE_HISTORICAL)\r\n  } else {\r\n    where.push('v.confidence_score >= ?')\r\n    binds.push(MIN_CONFIDENCE_ALL)\r\n  }\r\n\r\n  const limit = safeLimit(filters.limit, 200, 1000)\r\n  binds.push(limit)\r\n\r\n  const sql = `\r\n    SELECT\r\n      v.bank_name,\r\n      v.collection_date,\r\n      v.product_id,\r\n      v.product_name,\r\n      v.security_purpose,\r\n      v.repayment_type,\r\n      v.rate_structure,\r\n      v.lvr_tier,\r\n      v.feature_set,\r\n      v.interest_rate,\r\n      v.comparison_rate,\r\n      v.annual_fee,\r\n      v.source_url,\r\n      v.data_quality_flag,\r\n      v.confidence_score,\r\n      v.parsed_at,\r\n      v.product_key,\r\n      r.cash_rate AS rba_cash_rate\r\n    FROM vw_latest_rates v\r\n    LEFT JOIN rba_cash_rates r\r\n      ON r.collection_date = v.collection_date\r\n    ${where.length ? `WHERE ${where.join(' AND ')}` : ''}\r\n    ORDER BY ${VALID_ORDER_BY[filters.orderBy ?? 'default'] ?? VALID_ORDER_BY.default}\r\n    LIMIT ?\r\n  `\r\n\r\n  const result = await db.prepare(sql).bind(...binds).all<Record<string, unknown>>()\r\n  return rows(result)\r\n}\r\n\r\nexport async function queryTimeseries(\r\n  db: D1Database,\r\n  input: {\r\n    bank?: string\r\n    productKey?: string\r\n    securityPurpose?: string\r\n    repaymentType?: string\r\n    featureSet?: string\r\n    mode?: 'all' | 'daily' | 'historical'\r\n    startDate?: string\r\n    endDate?: string\r\n    limit?: number\r\n  },\r\n) {\r\n  const where: string[] = []\r\n  const binds: Array<string | number> = []\r\n\r\n  where.push('t.interest_rate BETWEEN ? AND ?')\r\n  binds.push(MIN_PUBLIC_RATE, MAX_PUBLIC_RATE)\r\n\r\n  if (input.bank) {\r\n    where.push('t.bank_name = ?')\r\n    binds.push(input.bank)\r\n  }\r\n  if (input.productKey) {\r\n    where.push('t.product_key = ?')\r\n    binds.push(input.productKey)\r\n  }\r\n  if (input.securityPurpose) {\r\n    where.push('t.security_purpose = ?')\r\n    binds.push(input.securityPurpose)\r\n  }\r\n  if (input.repaymentType) {\r\n    where.push('t.repayment_type = ?')\r\n    binds.push(input.repaymentType)\r\n  }\r\n  if (input.featureSet) {\r\n    where.push('t.feature_set = ?')\r\n    binds.push(input.featureSet)\r\n  }\r\n  if (input.startDate) {\r\n    where.push('t.collection_date >= ?')\r\n    binds.push(input.startDate)\r\n  }\r\n  if (input.endDate) {\r\n    where.push('t.collection_date <= ?')\r\n    binds.push(input.endDate)\r\n  }\r\n  if (input.mode === 'daily') {\r\n    where.push(\"t.data_quality_flag NOT LIKE 'parsed_from_wayback%'\")\r\n    where.push('t.confidence_score >= ?')\r\n    binds.push(MIN_CONFIDENCE_DAILY)\r\n  } else if (input.mode === 'historical') {\r\n    where.push(\"t.data_quality_flag LIKE 'parsed_from_wayback%'\")\r\n    where.push('t.confidence_score >= ?')\r\n    binds.push(MIN_CONFIDENCE_HISTORICAL)\r\n  } else {\r\n    where.push('t.confidence_score >= ?')\r\n    binds.push(MIN_CONFIDENCE_ALL)\r\n  }\r\n\r\n  const limit = safeLimit(input.limit, 500, 5000)\r\n  binds.push(limit)\r\n\r\n  const sql = `\r\n    SELECT\r\n      t.collection_date,\r\n      t.bank_name,\r\n      t.product_id,\r\n      t.product_name,\r\n      t.security_purpose,\r\n      t.repayment_type,\r\n      t.lvr_tier,\r\n      t.rate_structure,\r\n      t.feature_set,\r\n      t.interest_rate,\r\n      t.comparison_rate,\r\n      t.annual_fee,\r\n      t.data_quality_flag,\r\n      t.confidence_score,\r\n      t.source_url,\r\n      t.product_key,\r\n      r.cash_rate AS rba_cash_rate\r\n    FROM vw_rate_timeseries t\r\n    LEFT JOIN rba_cash_rates r\r\n      ON r.collection_date = t.collection_date\r\n    ${where.length ? `WHERE ${where.join(' AND ')}` : ''}\r\n    ORDER BY t.collection_date ASC\r\n    LIMIT ?\r\n  `\r\n\r\n  const result = await db.prepare(sql).bind(...binds).all<Record<string, unknown>>()\r\n  return rows(result)\r\n}\r\n\r\ntype RatesPaginatedFilters = {\r\n  page?: number\r\n  size?: number\r\n  startDate?: string\r\n  endDate?: string\r\n  bank?: string\r\n  securityPurpose?: string\r\n  repaymentType?: string\r\n  rateStructure?: string\r\n  lvrTier?: string\r\n  featureSet?: string\r\n  sort?: string\r\n  dir?: 'asc' | 'desc'\r\n  includeManual?: boolean\r\n}\r\n\r\nconst PAGINATED_SORT_COLUMNS: Record<string, string> = {\r\n  collection_date: 'h.collection_date',\r\n  bank_name: 'h.bank_name',\r\n  product_name: 'h.product_name',\r\n  security_purpose: 'h.security_purpose',\r\n  repayment_type: 'h.repayment_type',\r\n  rate_structure: 'h.rate_structure',\r\n  lvr_tier: 'h.lvr_tier',\r\n  feature_set: 'h.feature_set',\r\n  interest_rate: 'h.interest_rate',\r\n  comparison_rate: 'h.comparison_rate',\r\n  annual_fee: 'h.annual_fee',\r\n  rba_cash_rate: 'rba_cash_rate',\r\n  parsed_at: 'h.parsed_at',\r\n  run_source: 'h.run_source',\r\n  source_url: 'h.source_url',\r\n}\r\n\r\nexport async function queryRatesPaginated(db: D1Database, filters: RatesPaginatedFilters) {\r\n  const where: string[] = []\r\n  const binds: Array<string | number> = []\r\n\r\n  where.push('h.interest_rate BETWEEN ? AND ?')\r\n  binds.push(MIN_PUBLIC_RATE, MAX_PUBLIC_RATE)\r\n\r\n  where.push('h.confidence_score >= ?')\r\n  binds.push(MIN_CONFIDENCE_ALL)\r\n\r\n  if (!filters.includeManual) {\r\n    where.push(\"(h.run_source IS NULL OR h.run_source != 'manual')\")\r\n  }\r\n\r\n  if (filters.bank) {\r\n    where.push('h.bank_name = ?')\r\n    binds.push(filters.bank)\r\n  }\r\n  if (filters.securityPurpose) {\r\n    where.push('h.security_purpose = ?')\r\n    binds.push(filters.securityPurpose)\r\n  }\r\n  if (filters.repaymentType) {\r\n    where.push('h.repayment_type = ?')\r\n    binds.push(filters.repaymentType)\r\n  }\r\n  if (filters.rateStructure) {\r\n    where.push('h.rate_structure = ?')\r\n    binds.push(filters.rateStructure)\r\n  }\r\n  if (filters.lvrTier) {\r\n    where.push('h.lvr_tier = ?')\r\n    binds.push(filters.lvrTier)\r\n  }\r\n  if (filters.featureSet) {\r\n    where.push('h.feature_set = ?')\r\n    binds.push(filters.featureSet)\r\n  }\r\n  if (filters.startDate) {\r\n    where.push('h.collection_date >= ?')\r\n    binds.push(filters.startDate)\r\n  }\r\n  if (filters.endDate) {\r\n    where.push('h.collection_date <= ?')\r\n    binds.push(filters.endDate)\r\n  }\r\n\r\n  const whereClause = where.length ? `WHERE ${where.join(' AND ')}` : ''\r\n\r\n  const sortCol = PAGINATED_SORT_COLUMNS[filters.sort ?? ''] ?? 'h.collection_date'\r\n  const sortDir = filters.dir === 'desc' ? 'DESC' : 'ASC'\r\n  const orderClause = `ORDER BY ${sortCol} ${sortDir}, h.bank_name ASC, h.product_name ASC`\r\n\r\n  const page = Math.max(1, Math.floor(Number(filters.page) || 1))\r\n  const size = Math.min(500, Math.max(1, Math.floor(Number(filters.size) || 50)))\r\n  const offset = (page - 1) * size\r\n\r\n  // product_key is the canonical longitudinal identity for the same product across collection dates\r\n  const countSql = `SELECT COUNT(*) AS total FROM historical_loan_rates h ${whereClause}`\r\n  const dataSql = `\r\n    SELECT\r\n      h.bank_name,\r\n      h.collection_date,\r\n      h.product_id,\r\n      h.product_name,\r\n      h.security_purpose,\r\n      h.repayment_type,\r\n      h.rate_structure,\r\n      h.lvr_tier,\r\n      h.feature_set,\r\n      h.interest_rate,\r\n      h.comparison_rate,\r\n      h.annual_fee,\r\n      h.source_url,\r\n      h.data_quality_flag,\r\n      h.confidence_score,\r\n      h.parsed_at,\r\n      h.run_id,\r\n      h.run_source,\r\n      h.bank_name || '|' || h.product_id || '|' || h.security_purpose || '|' || h.repayment_type || '|' || h.lvr_tier || '|' || h.rate_structure AS product_key,\r\n      r.cash_rate AS rba_cash_rate\r\n    FROM historical_loan_rates h\r\n    LEFT JOIN rba_cash_rates r\r\n      ON r.collection_date = h.collection_date\r\n    ${whereClause}\r\n    ${orderClause}\r\n    LIMIT ? OFFSET ?\r\n  `\r\n\r\n  const dataBinds = [...binds, size, offset]\r\n\r\n  const [countResult, dataResult] = await Promise.all([\r\n    db.prepare(countSql).bind(...binds).first<{ total: number }>(),\r\n    db.prepare(dataSql).bind(...dataBinds).all<Record<string, unknown>>(),\r\n  ])\r\n\r\n  const total = Number(countResult?.total ?? 0)\r\n  const lastPage = Math.max(1, Math.ceil(total / size))\r\n\r\n  return {\r\n    last_page: lastPage,\r\n    total,\r\n    data: rows(dataResult),\r\n  }\r\n}\r\n\r\nconst EXPORT_MAX_ROWS = 10000\r\n\r\nexport type RatesExportFilters = Omit<RatesPaginatedFilters, 'page' | 'size'> & { limit?: number }\r\n\r\nexport async function queryRatesForExport(\r\n  db: D1Database,\r\n  filters: RatesExportFilters,\r\n  maxRows: number = EXPORT_MAX_ROWS,\r\n): Promise<{ data: Array<Record<string, unknown>>; total: number }> {\r\n  const where: string[] = []\r\n  const binds: Array<string | number> = []\r\n\r\n  where.push('h.interest_rate BETWEEN ? AND ?')\r\n  binds.push(MIN_PUBLIC_RATE, MAX_PUBLIC_RATE)\r\n\r\n  where.push('h.confidence_score >= ?')\r\n  binds.push(MIN_CONFIDENCE_ALL)\r\n\r\n  if (!filters.includeManual) {\r\n    where.push(\"(h.run_source IS NULL OR h.run_source != 'manual')\")\r\n  }\r\n\r\n  if (filters.bank) {\r\n    where.push('h.bank_name = ?')\r\n    binds.push(filters.bank)\r\n  }\r\n  if (filters.securityPurpose) {\r\n    where.push('h.security_purpose = ?')\r\n    binds.push(filters.securityPurpose)\r\n  }\r\n  if (filters.repaymentType) {\r\n    where.push('h.repayment_type = ?')\r\n    binds.push(filters.repaymentType)\r\n  }\r\n  if (filters.rateStructure) {\r\n    where.push('h.rate_structure = ?')\r\n    binds.push(filters.rateStructure)\r\n  }\r\n  if (filters.lvrTier) {\r\n    where.push('h.lvr_tier = ?')\r\n    binds.push(filters.lvrTier)\r\n  }\r\n  if (filters.featureSet) {\r\n    where.push('h.feature_set = ?')\r\n    binds.push(filters.featureSet)\r\n  }\r\n  if (filters.startDate) {\r\n    where.push('h.collection_date >= ?')\r\n    binds.push(filters.startDate)\r\n  }\r\n  if (filters.endDate) {\r\n    where.push('h.collection_date <= ?')\r\n    binds.push(filters.endDate)\r\n  }\r\n\r\n  const whereClause = where.length ? `WHERE ${where.join(' AND ')}` : ''\r\n  const sortCol = PAGINATED_SORT_COLUMNS[filters.sort ?? ''] ?? 'h.collection_date'\r\n  const sortDir = filters.dir === 'desc' ? 'DESC' : 'ASC'\r\n  const orderClause = `ORDER BY ${sortCol} ${sortDir}, h.bank_name ASC, h.product_name ASC`\r\n  const limit = Math.min(maxRows, Math.max(1, Math.floor(Number(filters.limit) || maxRows)))\r\n\r\n  const countSql = `SELECT COUNT(*) AS total FROM historical_loan_rates h ${whereClause}`\r\n  const dataSql = `\r\n    SELECT\r\n      h.bank_name,\r\n      h.collection_date,\r\n      h.product_id,\r\n      h.product_name,\r\n      h.security_purpose,\r\n      h.repayment_type,\r\n      h.rate_structure,\r\n      h.lvr_tier,\r\n      h.feature_set,\r\n      h.interest_rate,\r\n      h.comparison_rate,\r\n      h.annual_fee,\r\n      h.source_url,\r\n      h.data_quality_flag,\r\n      h.confidence_score,\r\n      h.parsed_at,\r\n      h.run_id,\r\n      h.run_source,\r\n      h.bank_name || '|' || h.product_id || '|' || h.security_purpose || '|' || h.repayment_type || '|' || h.lvr_tier || '|' || h.rate_structure AS product_key,\r\n      r.cash_rate AS rba_cash_rate\r\n    FROM historical_loan_rates h\r\n    LEFT JOIN rba_cash_rates r\r\n      ON r.collection_date = h.collection_date\r\n    ${whereClause}\r\n    ${orderClause}\r\n    LIMIT ?\r\n  `\r\n\r\n  const [countResult, dataResult] = await Promise.all([\r\n    db.prepare(countSql).bind(...binds).first<{ total: number }>(),\r\n    db.prepare(dataSql).bind(...binds, limit).all<Record<string, unknown>>(),\r\n  ])\r\n\r\n  const total = Number(countResult?.total ?? 0)\r\n  return {\r\n    data: rows(dataResult),\r\n    total,\r\n  }\r\n}\r\n\r\nexport async function getLenderStaleness(db: D1Database, staleHours = 48) {\r\n  const result = await db\r\n    .prepare(\r\n      `SELECT\r\n        bank_name,\r\n        MAX(collection_date) AS latest_date,\r\n        MAX(parsed_at) AS latest_parsed_at,\r\n        COUNT(*) AS total_rows\r\n       FROM historical_loan_rates\r\n       GROUP BY bank_name\r\n       ORDER BY bank_name ASC`,\r\n    )\r\n    .all<{ bank_name: string; latest_date: string; latest_parsed_at: string; total_rows: number }>()\r\n\r\n  const now = Date.now()\r\n  return rows(result).map((r) => {\r\n    const parsedAt = new Date(r.latest_parsed_at).getTime()\r\n    const ageMs = now - parsedAt\r\n    const ageHours = Math.round(ageMs / (1000 * 60 * 60))\r\n    return {\r\n      bank_name: r.bank_name,\r\n      latest_date: r.latest_date,\r\n      latest_parsed_at: r.latest_parsed_at,\r\n      total_rows: Number(r.total_rows),\r\n      age_hours: ageHours,\r\n      stale: ageHours > staleHours,\r\n    }\r\n  })\r\n}\r\n\r\nexport async function getQualityDiagnostics(db: D1Database) {\r\n  const [totals, byFlag] = await Promise.all([\r\n    db\r\n      .prepare(\r\n        `SELECT\r\n          COUNT(*) AS total_rows,\r\n          SUM(CASE WHEN interest_rate BETWEEN ? AND ? THEN 1 ELSE 0 END) AS in_range_rows,\r\n          SUM(CASE WHEN confidence_score >= ? THEN 1 ELSE 0 END) AS confidence_ok_rows\r\n         FROM historical_loan_rates`,\r\n      )\r\n      .bind(MIN_PUBLIC_RATE, MAX_PUBLIC_RATE, MIN_CONFIDENCE_ALL)\r\n      .first<{ total_rows: number; in_range_rows: number; confidence_ok_rows: number }>(),\r\n    db\r\n      .prepare(\r\n        `SELECT data_quality_flag, COUNT(*) AS n\r\n         FROM historical_loan_rates\r\n         GROUP BY data_quality_flag\r\n         ORDER BY n DESC`,\r\n      )\r\n      .all<{ data_quality_flag: string; n: number }>(),\r\n  ])\r\n\r\n  return {\r\n    total_rows: Number(totals?.total_rows ?? 0),\r\n    in_range_rows: Number(totals?.in_range_rows ?? 0),\r\n    confidence_ok_rows: Number(totals?.confidence_ok_rows ?? 0),\r\n    by_flag: rows(byFlag).map((x) => ({\r\n      data_quality_flag: x.data_quality_flag,\r\n      count: Number(x.n),\r\n    })),\r\n  }\r\n}", "import { Hono } from 'hono'\r\nimport { API_BASE_PATH, DEFAULT_PUBLIC_CACHE_SECONDS, MELBOURNE_TIMEZONE } from '../constants'\r\nimport { getFilters, getLenderStaleness, getQualityDiagnostics, queryLatestRates, queryRatesForExport, queryRatesPaginated, queryTimeseries } from '../db/queries'\r\nimport { getLastManualRunStartedAt } from '../db/run-reports'\r\nimport { triggerDailyRun } from '../pipeline/bootstrap-jobs'\r\nimport type { AppContext } from '../types'\r\nimport { jsonError, withPublicCache } from '../utils/http'\r\nimport { log } from '../utils/logger'\r\nimport type { LogLevel } from '../utils/logger'\r\nimport { getLogStats, queryLogs } from '../utils/logger'\r\nimport { getMelbourneNowParts, parseIntegerEnv } from '../utils/time'\r\n\r\nexport const publicRoutes = new Hono<AppContext>()\r\n\r\npublicRoutes.use('*', async (c, next) => {\r\n  withPublicCache(c, DEFAULT_PUBLIC_CACHE_SECONDS)\r\n  await next()\r\n})\r\n\r\npublicRoutes.get('/health', async (c) => {\r\n  withPublicCache(c, 30)\r\n\r\n  const melbourne = getMelbourneNowParts(new Date(), c.env.MELBOURNE_TIMEZONE || MELBOURNE_TIMEZONE)\r\n  const targetHour = parseIntegerEnv(c.env.MELBOURNE_TARGET_HOUR, 6)\r\n\r\n  return c.json({\r\n    ok: true,\r\n    service: 'australianrates-api',\r\n    phase: 'phase1',\r\n    version: c.env.WORKER_VERSION || 'dev',\r\n    api_base_path: c.env.PUBLIC_API_BASE_PATH || API_BASE_PATH,\r\n    melbourne,\r\n    scheduled_target_hour: targetHour,\r\n    features: {\r\n      prospective: String(c.env.FEATURE_PROSPECTIVE_ENABLED || 'true').toLowerCase() === 'true',\r\n      backfill: String(c.env.FEATURE_BACKFILL_ENABLED || 'true').toLowerCase() === 'true',\r\n    },\r\n    bindings: {\r\n      db: Boolean(c.env.DB),\r\n      raw_bucket: Boolean(c.env.RAW_BUCKET),\r\n      ingest_queue: Boolean(c.env.INGEST_QUEUE),\r\n      run_lock_do: Boolean(c.env.RUN_LOCK_DO),\r\n    },\r\n  })\r\n})\r\n\r\npublicRoutes.get('/staleness', async (c) => {\r\n  withPublicCache(c, 60)\r\n  const staleness = await getLenderStaleness(c.env.DB)\r\n  const staleLenders = staleness.filter((l) => l.stale)\r\n  return c.json({\r\n    ok: true,\r\n    stale_count: staleLenders.length,\r\n    lenders: staleness,\r\n  })\r\n})\r\n\r\npublicRoutes.post('/trigger-run', async (c) => {\r\n  const DEFAULT_COOLDOWN_SECONDS = 0 // 0 = no cooldown for manual runs\r\n  const cooldownSeconds = parseIntegerEnv(c.env.MANUAL_RUN_COOLDOWN_SECONDS, DEFAULT_COOLDOWN_SECONDS)\r\n  const cooldownMs = cooldownSeconds * 1000\r\n\r\n  if (cooldownMs > 0) {\r\n    const lastStartedAt = await getLastManualRunStartedAt(c.env.DB)\r\n    if (lastStartedAt) {\r\n      const lastMs = new Date(lastStartedAt.endsWith('Z') ? lastStartedAt : lastStartedAt.trim() + 'Z').getTime()\r\n      const elapsed = Number.isNaN(lastMs) ? cooldownMs : Date.now() - lastMs\r\n      if (elapsed >= 0 && elapsed < cooldownMs) {\r\n        const retryAfter = Math.ceil((cooldownMs - elapsed) / 1000)\r\n        return c.json(\r\n          { ok: false, reason: 'rate_limited', retry_after_seconds: retryAfter },\r\n          429,\r\n        )\r\n      }\r\n    }\r\n  }\r\n\r\n  log.info('api', 'Public manual run triggered')\r\n  const result = await triggerDailyRun(c.env, { source: 'manual', force: true })\r\n  return c.json({ ok: true, result })\r\n})\r\n\r\npublicRoutes.get('/filters', async (c) => {\r\n  const filters = await getFilters(c.env.DB)\r\n  return c.json({\r\n    ok: true,\r\n    filters,\r\n  })\r\n})\r\n\r\npublicRoutes.get('/quality/diagnostics', async (c) => {\r\n  const diagnostics = await getQualityDiagnostics(c.env.DB)\r\n  return c.json({\r\n    ok: true,\r\n    diagnostics,\r\n  })\r\n})\r\n\r\npublicRoutes.get('/rates', async (c) => {\r\n  const query = c.req.query()\r\n  const dir = String(query.dir || 'desc').toLowerCase()\r\n  const includeManual = query.include_manual === 'true' || query.include_manual === '1'\r\n\r\n  const result = await queryRatesPaginated(c.env.DB, {\r\n    page: Number(query.page || 1),\r\n    size: Number(query.size || 50),\r\n    startDate: query.start_date,\r\n    endDate: query.end_date,\r\n    bank: query.bank,\r\n    securityPurpose: query.security_purpose,\r\n    repaymentType: query.repayment_type,\r\n    rateStructure: query.rate_structure,\r\n    lvrTier: query.lvr_tier,\r\n    featureSet: query.feature_set,\r\n    sort: query.sort,\r\n    dir: dir === 'asc' || dir === 'desc' ? dir : 'desc',\r\n    includeManual,\r\n  })\r\n\r\n  return c.json(result)\r\n})\r\n\r\npublicRoutes.get('/export', async (c) => {\r\n  const query = c.req.query()\r\n  const format = String(query.format || 'json').toLowerCase()\r\n  if (format !== 'csv' && format !== 'json') {\r\n    return jsonError(c, 400, 'INVALID_FORMAT', 'format must be csv or json')\r\n  }\r\n  const dir = String(query.dir || 'desc').toLowerCase()\r\n  const includeManual = query.include_manual === 'true' || query.include_manual === '1'\r\n\r\n  const { data, total } = await queryRatesForExport(c.env.DB, {\r\n    startDate: query.start_date,\r\n    endDate: query.end_date,\r\n    bank: query.bank,\r\n    securityPurpose: query.security_purpose,\r\n    repaymentType: query.repayment_type,\r\n    rateStructure: query.rate_structure,\r\n    lvrTier: query.lvr_tier,\r\n    featureSet: query.feature_set,\r\n    sort: query.sort,\r\n    dir: dir === 'asc' || dir === 'desc' ? dir : 'desc',\r\n    includeManual,\r\n    limit: 10000,\r\n  })\r\n\r\n  if (format === 'csv') {\r\n    c.header('Content-Type', 'text/csv; charset=utf-8')\r\n    c.header('Content-Disposition', 'attachment; filename=\"rates-export.csv\"')\r\n    return c.body(toCsv(data as Array<Record<string, unknown>>))\r\n  }\r\n\r\n  c.header('Content-Type', 'application/json; charset=utf-8')\r\n  c.header('Content-Disposition', 'attachment; filename=\"rates-export.json\"')\r\n  return c.json({ data, total, last_page: 1 })\r\n})\r\n\r\npublicRoutes.get('/latest', async (c) => {\r\n  const query = c.req.query()\r\n  const limit = Number(query.limit || 200)\r\n  const modeRaw = String(query.mode || 'all').toLowerCase()\r\n  const mode = modeRaw === 'daily' || modeRaw === 'historical' ? modeRaw : 'all'\r\n  const orderByRaw = String(query.order_by || query.orderBy || 'default').toLowerCase()\r\n  const orderBy = orderByRaw === 'rate_asc' || orderByRaw === 'rate_desc' ? orderByRaw : 'default'\r\n\r\n  const rows = await queryLatestRates(c.env.DB, {\r\n    bank: query.bank,\r\n    securityPurpose: query.security_purpose,\r\n    repaymentType: query.repayment_type,\r\n    rateStructure: query.rate_structure,\r\n    lvrTier: query.lvr_tier,\r\n    featureSet: query.feature_set,\r\n    mode,\r\n    limit,\r\n    orderBy,\r\n  })\r\n\r\n  return c.json({\r\n    ok: true,\r\n    count: rows.length,\r\n    rows,\r\n  })\r\n})\r\n\r\npublicRoutes.get('/timeseries', async (c) => {\r\n  const query = c.req.query()\r\n  const productKey = query.product_key || query.productKey\r\n  const modeRaw = String(query.mode || 'all').toLowerCase()\r\n  const mode = modeRaw === 'daily' || modeRaw === 'historical' ? modeRaw : 'all'\r\n\r\n  if (!productKey) {\r\n    return jsonError(c, 400, 'INVALID_REQUEST', 'product_key is required for timeseries queries.')\r\n  }\r\n\r\n  const rows = await queryTimeseries(c.env.DB, {\r\n    bank: query.bank,\r\n    productKey,\r\n    securityPurpose: query.security_purpose,\r\n    repaymentType: query.repayment_type,\r\n    featureSet: query.feature_set,\r\n    mode,\r\n    startDate: query.start_date,\r\n    endDate: query.end_date,\r\n    limit: Number(query.limit || 1000),\r\n  })\r\n\r\n  return c.json({\r\n    ok: true,\r\n    count: rows.length,\r\n    rows,\r\n  })\r\n})\r\n\r\npublicRoutes.get('/logs/stats', async (c) => {\r\n  withPublicCache(c, 30)\r\n  const stats = await getLogStats(c.env.DB)\r\n  return c.json({ ok: true, ...stats })\r\n})\r\n\r\npublicRoutes.get('/logs', async (c) => {\r\n  withPublicCache(c, 15)\r\n  const query = c.req.query()\r\n  const level = query.level as LogLevel | undefined\r\n  const source = query.source\r\n  const limit = Number(query.limit || 5000)\r\n  const offset = Number(query.offset || 0)\r\n  const format = String(query.format || 'text').toLowerCase()\r\n\r\n  const { entries, total } = await queryLogs(c.env.DB, { level, source, limit, offset })\r\n\r\n  if (format === 'json') {\r\n    return c.json({ ok: true, total, count: entries.length, entries })\r\n  }\r\n\r\n  const lines = entries.map((e) => {\r\n    const parts = [\r\n      String(e.ts ?? ''),\r\n      `[${String(e.level ?? 'info').toUpperCase()}]`,\r\n      `[${String(e.source ?? 'api')}]`,\r\n      String(e.message ?? ''),\r\n    ]\r\n    if (e.run_id) parts.push(`run=${e.run_id}`)\r\n    if (e.lender_code) parts.push(`lender=${e.lender_code}`)\r\n    if (e.context) parts.push(String(e.context))\r\n    return parts.join(' ')\r\n  })\r\n\r\n  c.header('Content-Type', 'text/plain; charset=utf-8')\r\n  c.header('Content-Disposition', 'attachment; filename=\"australianrates-log.txt\"')\r\n  return c.body(`# AustralianRates Global Log (${total} entries total, showing ${entries.length})\\n# Downloaded at ${new Date().toISOString()}\\n\\n${lines.join('\\n')}\\n`)\r\n})\r\n\r\nfunction csvEscape(value: unknown): string {\r\n  if (value == null) return ''\r\n  const raw = String(value)\r\n  if (/[\",\\n\\r]/.test(raw)) {\r\n    return `\"${raw.replace(/\"/g, '\"\"')}\"`\r\n  }\r\n  return raw\r\n}\r\n\r\nfunction toCsv(rows: Array<Record<string, unknown>>): string {\r\n  if (rows.length === 0) {\r\n    return ''\r\n  }\r\n  const headers = Object.keys(rows[0])\r\n  const lines = [headers.join(',')]\r\n  for (const row of rows) {\r\n    lines.push(headers.map((h) => csvEscape(row[h])).join(','))\r\n  }\r\n  return lines.join('\\n')\r\n}\r\n\r\npublicRoutes.get('/export.csv', async (c) => {\r\n  const query = c.req.query()\r\n  const dataset = String(query.dataset || 'latest').toLowerCase()\r\n  const modeRaw = String(query.mode || 'all').toLowerCase()\r\n  const mode = modeRaw === 'daily' || modeRaw === 'historical' ? modeRaw : 'all'\r\n\r\n  if (dataset === 'timeseries') {\r\n    const productKey = query.product_key || query.productKey\r\n    if (!productKey) {\r\n      return jsonError(c, 400, 'INVALID_REQUEST', 'product_key is required for timeseries CSV export.')\r\n    }\r\n    const rows = await queryTimeseries(c.env.DB, {\r\n      bank: query.bank,\r\n      productKey,\r\n      securityPurpose: query.security_purpose,\r\n      repaymentType: query.repayment_type,\r\n      featureSet: query.feature_set,\r\n      mode,\r\n      startDate: query.start_date,\r\n      endDate: query.end_date,\r\n      limit: Number(query.limit || 5000),\r\n    })\r\n    c.header('Content-Type', 'text/csv; charset=utf-8')\r\n    c.header('Content-Disposition', `attachment; filename=\"timeseries-${mode}.csv\"`)\r\n    return c.body(toCsv(rows as Array<Record<string, unknown>>))\r\n  }\r\n\r\n  const rows = await queryLatestRates(c.env.DB, {\r\n    bank: query.bank,\r\n    securityPurpose: query.security_purpose,\r\n    repaymentType: query.repayment_type,\r\n    rateStructure: query.rate_structure,\r\n    lvrTier: query.lvr_tier,\r\n    featureSet: query.feature_set,\r\n    mode,\r\n    limit: Number(query.limit || 1000),\r\n  })\r\n\r\n  c.header('Content-Type', 'text/csv; charset=utf-8')\r\n  c.header('Content-Disposition', `attachment; filename=\"latest-${mode}.csv\"`)\r\n  return c.body(toCsv(rows as Array<Record<string, unknown>>))\r\n})", "import { INTEREST_PAYMENTS, SAVINGS_ACCOUNT_TYPES, SAVINGS_RATE_TYPES } from '../constants'\r\n\r\nconst MIN_PUBLIC_RATE = 0\r\nconst MAX_PUBLIC_RATE = 15\r\nconst MIN_CONFIDENCE = 0.85\r\n\r\nfunction safeLimit(limit: number | undefined, fallback: number, max = 500): number {\r\n  if (!Number.isFinite(limit)) return fallback\r\n  return Math.min(max, Math.max(1, Math.floor(limit as number)))\r\n}\r\n\r\nfunction rows<T>(result: D1Result<T>): T[] {\r\n  return result.results ?? []\r\n}\r\n\r\nexport async function getSavingsFilters(db: D1Database) {\r\n  const [banks, accountTypes, rateTypes, depositTiers] = await Promise.all([\r\n    db.prepare('SELECT DISTINCT bank_name AS value FROM historical_savings_rates ORDER BY bank_name ASC').all<{ value: string }>(),\r\n    db.prepare('SELECT DISTINCT account_type AS value FROM historical_savings_rates ORDER BY account_type ASC').all<{ value: string }>(),\r\n    db.prepare('SELECT DISTINCT rate_type AS value FROM historical_savings_rates ORDER BY rate_type ASC').all<{ value: string }>(),\r\n    db.prepare('SELECT DISTINCT deposit_tier AS value FROM historical_savings_rates ORDER BY deposit_tier ASC').all<{ value: string }>(),\r\n  ])\r\n\r\n  const fallback = (vals: string[], fb: string[]) => (vals.length > 0 ? vals : fb)\r\n\r\n  return {\r\n    banks: rows(banks).map((x) => x.value),\r\n    account_types: fallback(rows(accountTypes).map((x) => x.value), SAVINGS_ACCOUNT_TYPES),\r\n    rate_types: fallback(rows(rateTypes).map((x) => x.value), SAVINGS_RATE_TYPES),\r\n    deposit_tiers: rows(depositTiers).map((x) => x.value),\r\n  }\r\n}\r\n\r\ntype SavingsPaginatedFilters = {\r\n  page?: number\r\n  size?: number\r\n  startDate?: string\r\n  endDate?: string\r\n  bank?: string\r\n  accountType?: string\r\n  rateType?: string\r\n  depositTier?: string\r\n  sort?: string\r\n  dir?: 'asc' | 'desc'\r\n  includeManual?: boolean\r\n}\r\n\r\nconst SORT_COLUMNS: Record<string, string> = {\r\n  collection_date: 'h.collection_date',\r\n  bank_name: 'h.bank_name',\r\n  product_name: 'h.product_name',\r\n  account_type: 'h.account_type',\r\n  rate_type: 'h.rate_type',\r\n  interest_rate: 'h.interest_rate',\r\n  deposit_tier: 'h.deposit_tier',\r\n  monthly_fee: 'h.monthly_fee',\r\n  parsed_at: 'h.parsed_at',\r\n  run_source: 'h.run_source',\r\n}\r\n\r\nfunction buildWhere(filters: SavingsPaginatedFilters): { clause: string; binds: Array<string | number> } {\r\n  const where: string[] = []\r\n  const binds: Array<string | number> = []\r\n\r\n  where.push('h.interest_rate BETWEEN ? AND ?')\r\n  binds.push(MIN_PUBLIC_RATE, MAX_PUBLIC_RATE)\r\n  where.push('h.confidence_score >= ?')\r\n  binds.push(MIN_CONFIDENCE)\r\n\r\n  if (!filters.includeManual) where.push(\"(h.run_source IS NULL OR h.run_source != 'manual')\")\r\n  if (filters.bank) { where.push('h.bank_name = ?'); binds.push(filters.bank) }\r\n  if (filters.accountType) { where.push('h.account_type = ?'); binds.push(filters.accountType) }\r\n  if (filters.rateType) { where.push('h.rate_type = ?'); binds.push(filters.rateType) }\r\n  if (filters.depositTier) { where.push('h.deposit_tier = ?'); binds.push(filters.depositTier) }\r\n  if (filters.startDate) { where.push('h.collection_date >= ?'); binds.push(filters.startDate) }\r\n  if (filters.endDate) { where.push('h.collection_date <= ?'); binds.push(filters.endDate) }\r\n\r\n  return { clause: where.length ? `WHERE ${where.join(' AND ')}` : '', binds }\r\n}\r\n\r\nexport async function querySavingsRatesPaginated(db: D1Database, filters: SavingsPaginatedFilters) {\r\n  const { clause: whereClause, binds } = buildWhere(filters)\r\n  const sortCol = SORT_COLUMNS[filters.sort ?? ''] ?? 'h.collection_date'\r\n  const sortDir = filters.dir === 'desc' ? 'DESC' : 'ASC'\r\n  const orderClause = `ORDER BY ${sortCol} ${sortDir}, h.bank_name ASC, h.product_name ASC`\r\n\r\n  const page = Math.max(1, Math.floor(Number(filters.page) || 1))\r\n  const size = Math.min(500, Math.max(1, Math.floor(Number(filters.size) || 50)))\r\n  const offset = (page - 1) * size\r\n\r\n  const countSql = `SELECT COUNT(*) AS total FROM historical_savings_rates h ${whereClause}`\r\n  const dataSql = `\r\n    SELECT\r\n      h.bank_name, h.collection_date, h.product_id, h.product_name,\r\n      h.account_type, h.rate_type, h.interest_rate, h.deposit_tier,\r\n      h.min_balance, h.max_balance, h.conditions, h.monthly_fee,\r\n      h.source_url, h.data_quality_flag, h.confidence_score,\r\n      h.parsed_at, h.run_id, h.run_source,\r\n      h.bank_name || '|' || h.product_id || '|' || h.account_type || '|' || h.rate_type || '|' || h.deposit_tier AS product_key\r\n    FROM historical_savings_rates h\r\n    ${whereClause} ${orderClause}\r\n    LIMIT ? OFFSET ?\r\n  `\r\n\r\n  const [countResult, dataResult] = await Promise.all([\r\n    db.prepare(countSql).bind(...binds).first<{ total: number }>(),\r\n    db.prepare(dataSql).bind(...binds, size, offset).all<Record<string, unknown>>(),\r\n  ])\r\n\r\n  const total = Number(countResult?.total ?? 0)\r\n  return { last_page: Math.max(1, Math.ceil(total / size)), total, data: rows(dataResult) }\r\n}\r\n\r\nexport async function queryLatestSavingsRates(db: D1Database, filters: {\r\n  bank?: string; accountType?: string; rateType?: string; depositTier?: string\r\n  limit?: number; orderBy?: 'default' | 'rate_asc' | 'rate_desc'\r\n}) {\r\n  const where: string[] = []\r\n  const binds: Array<string | number> = []\r\n\r\n  where.push('v.interest_rate BETWEEN ? AND ?')\r\n  binds.push(MIN_PUBLIC_RATE, MAX_PUBLIC_RATE)\r\n  where.push('v.confidence_score >= ?')\r\n  binds.push(MIN_CONFIDENCE)\r\n\r\n  if (filters.bank) { where.push('v.bank_name = ?'); binds.push(filters.bank) }\r\n  if (filters.accountType) { where.push('v.account_type = ?'); binds.push(filters.accountType) }\r\n  if (filters.rateType) { where.push('v.rate_type = ?'); binds.push(filters.rateType) }\r\n  if (filters.depositTier) { where.push('v.deposit_tier = ?'); binds.push(filters.depositTier) }\r\n\r\n  const orderMap: Record<string, string> = {\r\n    default: 'v.collection_date DESC, v.bank_name ASC, v.product_name ASC',\r\n    rate_asc: 'v.interest_rate ASC, v.bank_name ASC',\r\n    rate_desc: 'v.interest_rate DESC, v.bank_name ASC',\r\n  }\r\n  const limit = safeLimit(filters.limit, 200, 1000)\r\n  binds.push(limit)\r\n\r\n  const sql = `\r\n    SELECT v.*, v.product_key\r\n    FROM vw_latest_savings_rates v\r\n    ${where.length ? `WHERE ${where.join(' AND ')}` : ''}\r\n    ORDER BY ${orderMap[filters.orderBy ?? 'default'] ?? orderMap.default}\r\n    LIMIT ?\r\n  `\r\n  const result = await db.prepare(sql).bind(...binds).all<Record<string, unknown>>()\r\n  return rows(result)\r\n}\r\n\r\nexport async function querySavingsTimeseries(db: D1Database, input: {\r\n  bank?: string; productKey?: string; accountType?: string; rateType?: string\r\n  startDate?: string; endDate?: string; limit?: number\r\n}) {\r\n  const where: string[] = []\r\n  const binds: Array<string | number> = []\r\n\r\n  where.push('t.interest_rate BETWEEN ? AND ?')\r\n  binds.push(MIN_PUBLIC_RATE, MAX_PUBLIC_RATE)\r\n  where.push('t.confidence_score >= ?')\r\n  binds.push(MIN_CONFIDENCE)\r\n\r\n  if (input.bank) { where.push('t.bank_name = ?'); binds.push(input.bank) }\r\n  if (input.productKey) { where.push('t.product_key = ?'); binds.push(input.productKey) }\r\n  if (input.accountType) { where.push('t.account_type = ?'); binds.push(input.accountType) }\r\n  if (input.rateType) { where.push('t.rate_type = ?'); binds.push(input.rateType) }\r\n  if (input.startDate) { where.push('t.collection_date >= ?'); binds.push(input.startDate) }\r\n  if (input.endDate) { where.push('t.collection_date <= ?'); binds.push(input.endDate) }\r\n\r\n  const limit = safeLimit(input.limit, 500, 5000)\r\n  binds.push(limit)\r\n\r\n  const sql = `\r\n    SELECT t.*\r\n    FROM vw_savings_timeseries t\r\n    ${where.length ? `WHERE ${where.join(' AND ')}` : ''}\r\n    ORDER BY t.collection_date ASC\r\n    LIMIT ?\r\n  `\r\n  const result = await db.prepare(sql).bind(...binds).all<Record<string, unknown>>()\r\n  return rows(result)\r\n}\r\n\r\nexport async function querySavingsForExport(db: D1Database, filters: SavingsPaginatedFilters, maxRows = 10000) {\r\n  const { clause: whereClause, binds } = buildWhere(filters)\r\n  const sortCol = SORT_COLUMNS[filters.sort ?? ''] ?? 'h.collection_date'\r\n  const sortDir = filters.dir === 'desc' ? 'DESC' : 'ASC'\r\n  const limit = Math.min(maxRows, Math.max(1, Math.floor(Number(maxRows))))\r\n\r\n  const countSql = `SELECT COUNT(*) AS total FROM historical_savings_rates h ${whereClause}`\r\n  const dataSql = `\r\n    SELECT\r\n      h.bank_name, h.collection_date, h.product_id, h.product_name,\r\n      h.account_type, h.rate_type, h.interest_rate, h.deposit_tier,\r\n      h.min_balance, h.max_balance, h.conditions, h.monthly_fee,\r\n      h.source_url, h.data_quality_flag, h.confidence_score,\r\n      h.parsed_at, h.run_id, h.run_source,\r\n      h.bank_name || '|' || h.product_id || '|' || h.account_type || '|' || h.rate_type || '|' || h.deposit_tier AS product_key\r\n    FROM historical_savings_rates h\r\n    ${whereClause}\r\n    ORDER BY ${sortCol} ${sortDir}, h.bank_name ASC, h.product_name ASC\r\n    LIMIT ?\r\n  `\r\n\r\n  const [countResult, dataResult] = await Promise.all([\r\n    db.prepare(countSql).bind(...binds).first<{ total: number }>(),\r\n    db.prepare(dataSql).bind(...binds, limit).all<Record<string, unknown>>(),\r\n  ])\r\n\r\n  return { data: rows(dataResult), total: Number(countResult?.total ?? 0) }\r\n}\r\n", "import { Hono } from 'hono'\r\nimport { DEFAULT_PUBLIC_CACHE_SECONDS } from '../constants'\r\nimport {\r\n  getSavingsFilters,\r\n  queryLatestSavingsRates,\r\n  querySavingsForExport,\r\n  querySavingsRatesPaginated,\r\n  querySavingsTimeseries,\r\n} from '../db/savings-queries'\r\nimport { getLastManualRunStartedAt } from '../db/run-reports'\r\nimport { triggerDailyRun } from '../pipeline/bootstrap-jobs'\r\nimport type { AppContext } from '../types'\r\nimport { jsonError, withPublicCache } from '../utils/http'\r\nimport { log } from '../utils/logger'\r\nimport { parseIntegerEnv } from '../utils/time'\r\n\r\nexport const savingsPublicRoutes = new Hono<AppContext>()\r\n\r\nsavingsPublicRoutes.use('*', async (c, next) => {\r\n  withPublicCache(c, DEFAULT_PUBLIC_CACHE_SECONDS)\r\n  await next()\r\n})\r\n\r\nsavingsPublicRoutes.get('/health', (c) => {\r\n  withPublicCache(c, 30)\r\n  return c.json({ ok: true, service: 'australianrates-savings' })\r\n})\r\n\r\nsavingsPublicRoutes.post('/trigger-run', async (c) => {\r\n  const DEFAULT_COOLDOWN_SECONDS = 0\r\n  const cooldownSeconds = parseIntegerEnv(c.env.MANUAL_RUN_COOLDOWN_SECONDS, DEFAULT_COOLDOWN_SECONDS)\r\n  const cooldownMs = cooldownSeconds * 1000\r\n\r\n  if (cooldownMs > 0) {\r\n    const lastStartedAt = await getLastManualRunStartedAt(c.env.DB)\r\n    if (lastStartedAt) {\r\n      const lastMs = new Date(lastStartedAt.endsWith('Z') ? lastStartedAt : lastStartedAt.trim() + 'Z').getTime()\r\n      const elapsed = Number.isNaN(lastMs) ? cooldownMs : Date.now() - lastMs\r\n      if (elapsed >= 0 && elapsed < cooldownMs) {\r\n        const retryAfter = Math.ceil((cooldownMs - elapsed) / 1000)\r\n        return c.json(\r\n          { ok: false, reason: 'rate_limited', retry_after_seconds: retryAfter },\r\n          429,\r\n        )\r\n      }\r\n    }\r\n  }\r\n\r\n  log.info('api', 'Public manual run triggered (savings)')\r\n  const result = await triggerDailyRun(c.env, { source: 'manual', force: true })\r\n  return c.json({ ok: true, result })\r\n})\r\n\r\nsavingsPublicRoutes.get('/filters', async (c) => {\r\n  const filters = await getSavingsFilters(c.env.DB)\r\n  return c.json({ ok: true, filters })\r\n})\r\n\r\nsavingsPublicRoutes.get('/rates', async (c) => {\r\n  const q = c.req.query()\r\n  const dir = String(q.dir || 'desc').toLowerCase()\r\n  const includeManual = q.include_manual === 'true' || q.include_manual === '1'\r\n\r\n  const result = await querySavingsRatesPaginated(c.env.DB, {\r\n    page: Number(q.page || 1),\r\n    size: Number(q.size || 50),\r\n    startDate: q.start_date,\r\n    endDate: q.end_date,\r\n    bank: q.bank,\r\n    accountType: q.account_type,\r\n    rateType: q.rate_type,\r\n    depositTier: q.deposit_tier,\r\n    sort: q.sort,\r\n    dir: dir === 'asc' || dir === 'desc' ? dir : 'desc',\r\n    includeManual,\r\n  })\r\n  return c.json(result)\r\n})\r\n\r\nsavingsPublicRoutes.get('/latest', async (c) => {\r\n  const q = c.req.query()\r\n  const orderByRaw = String(q.order_by || q.orderBy || 'default').toLowerCase()\r\n  const orderBy = orderByRaw === 'rate_asc' || orderByRaw === 'rate_desc' ? orderByRaw : 'default'\r\n\r\n  const rows = await queryLatestSavingsRates(c.env.DB, {\r\n    bank: q.bank,\r\n    accountType: q.account_type,\r\n    rateType: q.rate_type,\r\n    depositTier: q.deposit_tier,\r\n    limit: Number(q.limit || 200),\r\n    orderBy,\r\n  })\r\n  return c.json({ ok: true, count: rows.length, rows })\r\n})\r\n\r\nsavingsPublicRoutes.get('/timeseries', async (c) => {\r\n  const q = c.req.query()\r\n  const productKey = q.product_key || q.productKey\r\n  if (!productKey) {\r\n    return jsonError(c, 400, 'INVALID_REQUEST', 'product_key is required for timeseries queries.')\r\n  }\r\n\r\n  const rows = await querySavingsTimeseries(c.env.DB, {\r\n    bank: q.bank,\r\n    productKey,\r\n    accountType: q.account_type,\r\n    rateType: q.rate_type,\r\n    startDate: q.start_date,\r\n    endDate: q.end_date,\r\n    limit: Number(q.limit || 1000),\r\n  })\r\n  return c.json({ ok: true, count: rows.length, rows })\r\n})\r\n\r\nsavingsPublicRoutes.get('/export', async (c) => {\r\n  const q = c.req.query()\r\n  const format = String(q.format || 'json').toLowerCase()\r\n  if (format !== 'csv' && format !== 'json') {\r\n    return jsonError(c, 400, 'INVALID_FORMAT', 'format must be csv or json')\r\n  }\r\n  const dir = String(q.dir || 'desc').toLowerCase()\r\n  const includeManual = q.include_manual === 'true' || q.include_manual === '1'\r\n\r\n  const { data, total } = await querySavingsForExport(c.env.DB, {\r\n    startDate: q.start_date,\r\n    endDate: q.end_date,\r\n    bank: q.bank,\r\n    accountType: q.account_type,\r\n    rateType: q.rate_type,\r\n    depositTier: q.deposit_tier,\r\n    sort: q.sort,\r\n    dir: dir === 'asc' || dir === 'desc' ? dir : 'desc',\r\n    includeManual,\r\n  })\r\n\r\n  if (format === 'csv') {\r\n    c.header('Content-Type', 'text/csv; charset=utf-8')\r\n    c.header('Content-Disposition', 'attachment; filename=\"savings-export.csv\"')\r\n    return c.body(toCsv(data as Array<Record<string, unknown>>))\r\n  }\r\n  c.header('Content-Type', 'application/json; charset=utf-8')\r\n  c.header('Content-Disposition', 'attachment; filename=\"savings-export.json\"')\r\n  return c.json({ data, total, last_page: 1 })\r\n})\r\n\r\nsavingsPublicRoutes.get('/export.csv', async (c) => {\r\n  const q = c.req.query()\r\n  const dataset = String(q.dataset || 'latest').toLowerCase()\r\n\r\n  if (dataset === 'timeseries') {\r\n    const productKey = q.product_key || q.productKey\r\n    if (!productKey) {\r\n      return jsonError(c, 400, 'INVALID_REQUEST', 'product_key is required for timeseries CSV export.')\r\n    }\r\n    const rows = await querySavingsTimeseries(c.env.DB, {\r\n      bank: q.bank,\r\n      productKey,\r\n      accountType: q.account_type,\r\n      rateType: q.rate_type,\r\n      startDate: q.start_date,\r\n      endDate: q.end_date,\r\n      limit: Number(q.limit || 5000),\r\n    })\r\n    c.header('Content-Type', 'text/csv; charset=utf-8')\r\n    c.header('Content-Disposition', 'attachment; filename=\"savings-timeseries.csv\"')\r\n    return c.body(toCsv(rows as Array<Record<string, unknown>>))\r\n  }\r\n\r\n  const rows = await queryLatestSavingsRates(c.env.DB, {\r\n    bank: q.bank,\r\n    accountType: q.account_type,\r\n    rateType: q.rate_type,\r\n    depositTier: q.deposit_tier,\r\n    limit: Number(q.limit || 1000),\r\n  })\r\n  c.header('Content-Type', 'text/csv; charset=utf-8')\r\n  c.header('Content-Disposition', 'attachment; filename=\"savings-latest.csv\"')\r\n  return c.body(toCsv(rows as Array<Record<string, unknown>>))\r\n})\r\n\r\nfunction csvEscape(value: unknown): string {\r\n  if (value == null) return ''\r\n  const raw = String(value)\r\n  if (/[\",\\n\\r]/.test(raw)) return `\"${raw.replace(/\"/g, '\"\"')}\"`\r\n  return raw\r\n}\r\n\r\nfunction toCsv(rows: Array<Record<string, unknown>>): string {\r\n  if (rows.length === 0) return ''\r\n  const headers = Object.keys(rows[0])\r\n  const lines = [headers.join(',')]\r\n  for (const row of rows) {\r\n    lines.push(headers.map((h) => csvEscape(row[h])).join(','))\r\n  }\r\n  return lines.join('\\n')\r\n}\r\n", "import { INTEREST_PAYMENTS } from '../constants'\r\n\r\nconst MIN_PUBLIC_RATE = 0\r\nconst MAX_PUBLIC_RATE = 15\r\nconst MIN_CONFIDENCE = 0.85\r\n\r\nfunction safeLimit(limit: number | undefined, fallback: number, max = 500): number {\r\n  if (!Number.isFinite(limit)) return fallback\r\n  return Math.min(max, Math.max(1, Math.floor(limit as number)))\r\n}\r\n\r\nfunction rows<T>(result: D1Result<T>): T[] {\r\n  return result.results ?? []\r\n}\r\n\r\nexport async function getTdFilters(db: D1Database) {\r\n  const [banks, termMonths, depositTiers, interestPayments] = await Promise.all([\r\n    db.prepare('SELECT DISTINCT bank_name AS value FROM historical_term_deposit_rates ORDER BY bank_name ASC').all<{ value: string }>(),\r\n    db.prepare('SELECT DISTINCT term_months AS value FROM historical_term_deposit_rates ORDER BY CAST(term_months AS INTEGER) ASC').all<{ value: string }>(),\r\n    db.prepare('SELECT DISTINCT deposit_tier AS value FROM historical_term_deposit_rates ORDER BY deposit_tier ASC').all<{ value: string }>(),\r\n    db.prepare('SELECT DISTINCT interest_payment AS value FROM historical_term_deposit_rates ORDER BY interest_payment ASC').all<{ value: string }>(),\r\n  ])\r\n\r\n  const fallback = (vals: string[], fb: string[]) => (vals.length > 0 ? vals : fb)\r\n\r\n  return {\r\n    banks: rows(banks).map((x) => x.value),\r\n    term_months: rows(termMonths).map((x) => x.value),\r\n    deposit_tiers: rows(depositTiers).map((x) => x.value),\r\n    interest_payments: fallback(rows(interestPayments).map((x) => x.value), INTEREST_PAYMENTS),\r\n  }\r\n}\r\n\r\ntype TdPaginatedFilters = {\r\n  page?: number\r\n  size?: number\r\n  startDate?: string\r\n  endDate?: string\r\n  bank?: string\r\n  termMonths?: string\r\n  depositTier?: string\r\n  interestPayment?: string\r\n  sort?: string\r\n  dir?: 'asc' | 'desc'\r\n  includeManual?: boolean\r\n}\r\n\r\nconst SORT_COLUMNS: Record<string, string> = {\r\n  collection_date: 'h.collection_date',\r\n  bank_name: 'h.bank_name',\r\n  product_name: 'h.product_name',\r\n  term_months: 'h.term_months',\r\n  interest_rate: 'h.interest_rate',\r\n  deposit_tier: 'h.deposit_tier',\r\n  interest_payment: 'h.interest_payment',\r\n  parsed_at: 'h.parsed_at',\r\n  run_source: 'h.run_source',\r\n}\r\n\r\nfunction buildWhere(filters: TdPaginatedFilters): { clause: string; binds: Array<string | number> } {\r\n  const where: string[] = []\r\n  const binds: Array<string | number> = []\r\n\r\n  where.push('h.interest_rate BETWEEN ? AND ?')\r\n  binds.push(MIN_PUBLIC_RATE, MAX_PUBLIC_RATE)\r\n  where.push('h.confidence_score >= ?')\r\n  binds.push(MIN_CONFIDENCE)\r\n\r\n  if (!filters.includeManual) where.push(\"(h.run_source IS NULL OR h.run_source != 'manual')\")\r\n  if (filters.bank) { where.push('h.bank_name = ?'); binds.push(filters.bank) }\r\n  if (filters.termMonths) { where.push('CAST(h.term_months AS TEXT) = ?'); binds.push(filters.termMonths) }\r\n  if (filters.depositTier) { where.push('h.deposit_tier = ?'); binds.push(filters.depositTier) }\r\n  if (filters.interestPayment) { where.push('h.interest_payment = ?'); binds.push(filters.interestPayment) }\r\n  if (filters.startDate) { where.push('h.collection_date >= ?'); binds.push(filters.startDate) }\r\n  if (filters.endDate) { where.push('h.collection_date <= ?'); binds.push(filters.endDate) }\r\n\r\n  return { clause: where.length ? `WHERE ${where.join(' AND ')}` : '', binds }\r\n}\r\n\r\nexport async function queryTdRatesPaginated(db: D1Database, filters: TdPaginatedFilters) {\r\n  const { clause: whereClause, binds } = buildWhere(filters)\r\n  const sortCol = SORT_COLUMNS[filters.sort ?? ''] ?? 'h.collection_date'\r\n  const sortDir = filters.dir === 'desc' ? 'DESC' : 'ASC'\r\n  const orderClause = `ORDER BY ${sortCol} ${sortDir}, h.bank_name ASC, h.product_name ASC`\r\n\r\n  const page = Math.max(1, Math.floor(Number(filters.page) || 1))\r\n  const size = Math.min(500, Math.max(1, Math.floor(Number(filters.size) || 50)))\r\n  const offset = (page - 1) * size\r\n\r\n  const countSql = `SELECT COUNT(*) AS total FROM historical_term_deposit_rates h ${whereClause}`\r\n  const dataSql = `\r\n    SELECT\r\n      h.bank_name, h.collection_date, h.product_id, h.product_name,\r\n      h.term_months, h.interest_rate, h.deposit_tier,\r\n      h.min_deposit, h.max_deposit, h.interest_payment,\r\n      h.source_url, h.data_quality_flag, h.confidence_score,\r\n      h.parsed_at, h.run_id, h.run_source,\r\n      h.bank_name || '|' || h.product_id || '|' || h.term_months || '|' || h.deposit_tier AS product_key\r\n    FROM historical_term_deposit_rates h\r\n    ${whereClause} ${orderClause}\r\n    LIMIT ? OFFSET ?\r\n  `\r\n\r\n  const [countResult, dataResult] = await Promise.all([\r\n    db.prepare(countSql).bind(...binds).first<{ total: number }>(),\r\n    db.prepare(dataSql).bind(...binds, size, offset).all<Record<string, unknown>>(),\r\n  ])\r\n\r\n  const total = Number(countResult?.total ?? 0)\r\n  return { last_page: Math.max(1, Math.ceil(total / size)), total, data: rows(dataResult) }\r\n}\r\n\r\nexport async function queryLatestTdRates(db: D1Database, filters: {\r\n  bank?: string; termMonths?: string; depositTier?: string; interestPayment?: string\r\n  limit?: number; orderBy?: 'default' | 'rate_asc' | 'rate_desc'\r\n}) {\r\n  const where: string[] = []\r\n  const binds: Array<string | number> = []\r\n\r\n  where.push('v.interest_rate BETWEEN ? AND ?')\r\n  binds.push(MIN_PUBLIC_RATE, MAX_PUBLIC_RATE)\r\n  where.push('v.confidence_score >= ?')\r\n  binds.push(MIN_CONFIDENCE)\r\n\r\n  if (filters.bank) { where.push('v.bank_name = ?'); binds.push(filters.bank) }\r\n  if (filters.termMonths) { where.push('CAST(v.term_months AS TEXT) = ?'); binds.push(filters.termMonths) }\r\n  if (filters.depositTier) { where.push('v.deposit_tier = ?'); binds.push(filters.depositTier) }\r\n  if (filters.interestPayment) { where.push('v.interest_payment = ?'); binds.push(filters.interestPayment) }\r\n\r\n  const orderMap: Record<string, string> = {\r\n    default: 'v.collection_date DESC, v.bank_name ASC, v.product_name ASC',\r\n    rate_asc: 'v.interest_rate ASC, v.bank_name ASC',\r\n    rate_desc: 'v.interest_rate DESC, v.bank_name ASC',\r\n  }\r\n  const limit = safeLimit(filters.limit, 200, 1000)\r\n  binds.push(limit)\r\n\r\n  const sql = `\r\n    SELECT v.*, v.product_key\r\n    FROM vw_latest_td_rates v\r\n    ${where.length ? `WHERE ${where.join(' AND ')}` : ''}\r\n    ORDER BY ${orderMap[filters.orderBy ?? 'default'] ?? orderMap.default}\r\n    LIMIT ?\r\n  `\r\n  const result = await db.prepare(sql).bind(...binds).all<Record<string, unknown>>()\r\n  return rows(result)\r\n}\r\n\r\nexport async function queryTdTimeseries(db: D1Database, input: {\r\n  bank?: string; productKey?: string; termMonths?: string\r\n  startDate?: string; endDate?: string; limit?: number\r\n}) {\r\n  const where: string[] = []\r\n  const binds: Array<string | number> = []\r\n\r\n  where.push('t.interest_rate BETWEEN ? AND ?')\r\n  binds.push(MIN_PUBLIC_RATE, MAX_PUBLIC_RATE)\r\n  where.push('t.confidence_score >= ?')\r\n  binds.push(MIN_CONFIDENCE)\r\n\r\n  if (input.bank) { where.push('t.bank_name = ?'); binds.push(input.bank) }\r\n  if (input.productKey) { where.push('t.product_key = ?'); binds.push(input.productKey) }\r\n  if (input.termMonths) { where.push('CAST(t.term_months AS TEXT) = ?'); binds.push(input.termMonths) }\r\n  if (input.startDate) { where.push('t.collection_date >= ?'); binds.push(input.startDate) }\r\n  if (input.endDate) { where.push('t.collection_date <= ?'); binds.push(input.endDate) }\r\n\r\n  const limit = safeLimit(input.limit, 500, 5000)\r\n  binds.push(limit)\r\n\r\n  const sql = `\r\n    SELECT t.*\r\n    FROM vw_td_timeseries t\r\n    ${where.length ? `WHERE ${where.join(' AND ')}` : ''}\r\n    ORDER BY t.collection_date ASC\r\n    LIMIT ?\r\n  `\r\n  const result = await db.prepare(sql).bind(...binds).all<Record<string, unknown>>()\r\n  return rows(result)\r\n}\r\n\r\nexport async function queryTdForExport(db: D1Database, filters: TdPaginatedFilters, maxRows = 10000) {\r\n  const { clause: whereClause, binds } = buildWhere(filters)\r\n  const sortCol = SORT_COLUMNS[filters.sort ?? ''] ?? 'h.collection_date'\r\n  const sortDir = filters.dir === 'desc' ? 'DESC' : 'ASC'\r\n  const limit = Math.min(maxRows, Math.max(1, Math.floor(Number(maxRows))))\r\n\r\n  const countSql = `SELECT COUNT(*) AS total FROM historical_term_deposit_rates h ${whereClause}`\r\n  const dataSql = `\r\n    SELECT\r\n      h.bank_name, h.collection_date, h.product_id, h.product_name,\r\n      h.term_months, h.interest_rate, h.deposit_tier,\r\n      h.min_deposit, h.max_deposit, h.interest_payment,\r\n      h.source_url, h.data_quality_flag, h.confidence_score,\r\n      h.parsed_at, h.run_id, h.run_source,\r\n      h.bank_name || '|' || h.product_id || '|' || h.term_months || '|' || h.deposit_tier AS product_key\r\n    FROM historical_term_deposit_rates h\r\n    ${whereClause}\r\n    ORDER BY ${sortCol} ${sortDir}, h.bank_name ASC, h.product_name ASC\r\n    LIMIT ?\r\n  `\r\n\r\n  const [countResult, dataResult] = await Promise.all([\r\n    db.prepare(countSql).bind(...binds).first<{ total: number }>(),\r\n    db.prepare(dataSql).bind(...binds, limit).all<Record<string, unknown>>(),\r\n  ])\r\n\r\n  return { data: rows(dataResult), total: Number(countResult?.total ?? 0) }\r\n}\r\n", "import { Hono } from 'hono'\r\nimport { DEFAULT_PUBLIC_CACHE_SECONDS } from '../constants'\r\nimport {\r\n  getTdFilters,\r\n  queryLatestTdRates,\r\n  queryTdForExport,\r\n  queryTdRatesPaginated,\r\n  queryTdTimeseries,\r\n} from '../db/td-queries'\r\nimport { getLastManualRunStartedAt } from '../db/run-reports'\r\nimport { triggerDailyRun } from '../pipeline/bootstrap-jobs'\r\nimport type { AppContext } from '../types'\r\nimport { jsonError, withPublicCache } from '../utils/http'\r\nimport { log } from '../utils/logger'\r\nimport { parseIntegerEnv } from '../utils/time'\r\n\r\nexport const tdPublicRoutes = new Hono<AppContext>()\r\n\r\ntdPublicRoutes.use('*', async (c, next) => {\r\n  withPublicCache(c, DEFAULT_PUBLIC_CACHE_SECONDS)\r\n  await next()\r\n})\r\n\r\ntdPublicRoutes.get('/health', (c) => {\r\n  withPublicCache(c, 30)\r\n  return c.json({ ok: true, service: 'australianrates-term-deposits' })\r\n})\r\n\r\ntdPublicRoutes.post('/trigger-run', async (c) => {\r\n  const DEFAULT_COOLDOWN_SECONDS = 0\r\n  const cooldownSeconds = parseIntegerEnv(c.env.MANUAL_RUN_COOLDOWN_SECONDS, DEFAULT_COOLDOWN_SECONDS)\r\n  const cooldownMs = cooldownSeconds * 1000\r\n\r\n  if (cooldownMs > 0) {\r\n    const lastStartedAt = await getLastManualRunStartedAt(c.env.DB)\r\n    if (lastStartedAt) {\r\n      const lastMs = new Date(lastStartedAt.endsWith('Z') ? lastStartedAt : lastStartedAt.trim() + 'Z').getTime()\r\n      const elapsed = Number.isNaN(lastMs) ? cooldownMs : Date.now() - lastMs\r\n      if (elapsed >= 0 && elapsed < cooldownMs) {\r\n        const retryAfter = Math.ceil((cooldownMs - elapsed) / 1000)\r\n        return c.json(\r\n          { ok: false, reason: 'rate_limited', retry_after_seconds: retryAfter },\r\n          429,\r\n        )\r\n      }\r\n    }\r\n  }\r\n\r\n  log.info('api', 'Public manual run triggered (term-deposits)')\r\n  const result = await triggerDailyRun(c.env, { source: 'manual', force: true })\r\n  return c.json({ ok: true, result })\r\n})\r\n\r\ntdPublicRoutes.get('/filters', async (c) => {\r\n  const filters = await getTdFilters(c.env.DB)\r\n  return c.json({ ok: true, filters })\r\n})\r\n\r\ntdPublicRoutes.get('/rates', async (c) => {\r\n  const q = c.req.query()\r\n  const dir = String(q.dir || 'desc').toLowerCase()\r\n  const includeManual = q.include_manual === 'true' || q.include_manual === '1'\r\n\r\n  const result = await queryTdRatesPaginated(c.env.DB, {\r\n    page: Number(q.page || 1),\r\n    size: Number(q.size || 50),\r\n    startDate: q.start_date,\r\n    endDate: q.end_date,\r\n    bank: q.bank,\r\n    termMonths: q.term_months,\r\n    depositTier: q.deposit_tier,\r\n    interestPayment: q.interest_payment,\r\n    sort: q.sort,\r\n    dir: dir === 'asc' || dir === 'desc' ? dir : 'desc',\r\n    includeManual,\r\n  })\r\n  return c.json(result)\r\n})\r\n\r\ntdPublicRoutes.get('/latest', async (c) => {\r\n  const q = c.req.query()\r\n  const orderByRaw = String(q.order_by || q.orderBy || 'default').toLowerCase()\r\n  const orderBy = orderByRaw === 'rate_asc' || orderByRaw === 'rate_desc' ? orderByRaw : 'default'\r\n\r\n  const rows = await queryLatestTdRates(c.env.DB, {\r\n    bank: q.bank,\r\n    termMonths: q.term_months,\r\n    depositTier: q.deposit_tier,\r\n    interestPayment: q.interest_payment,\r\n    limit: Number(q.limit || 200),\r\n    orderBy,\r\n  })\r\n  return c.json({ ok: true, count: rows.length, rows })\r\n})\r\n\r\ntdPublicRoutes.get('/timeseries', async (c) => {\r\n  const q = c.req.query()\r\n  const productKey = q.product_key || q.productKey\r\n  if (!productKey) {\r\n    return jsonError(c, 400, 'INVALID_REQUEST', 'product_key is required for timeseries queries.')\r\n  }\r\n\r\n  const rows = await queryTdTimeseries(c.env.DB, {\r\n    bank: q.bank,\r\n    productKey,\r\n    termMonths: q.term_months,\r\n    startDate: q.start_date,\r\n    endDate: q.end_date,\r\n    limit: Number(q.limit || 1000),\r\n  })\r\n  return c.json({ ok: true, count: rows.length, rows })\r\n})\r\n\r\ntdPublicRoutes.get('/export', async (c) => {\r\n  const q = c.req.query()\r\n  const format = String(q.format || 'json').toLowerCase()\r\n  if (format !== 'csv' && format !== 'json') {\r\n    return jsonError(c, 400, 'INVALID_FORMAT', 'format must be csv or json')\r\n  }\r\n  const dir = String(q.dir || 'desc').toLowerCase()\r\n  const includeManual = q.include_manual === 'true' || q.include_manual === '1'\r\n\r\n  const { data, total } = await queryTdForExport(c.env.DB, {\r\n    startDate: q.start_date,\r\n    endDate: q.end_date,\r\n    bank: q.bank,\r\n    termMonths: q.term_months,\r\n    depositTier: q.deposit_tier,\r\n    interestPayment: q.interest_payment,\r\n    sort: q.sort,\r\n    dir: dir === 'asc' || dir === 'desc' ? dir : 'desc',\r\n    includeManual,\r\n  })\r\n\r\n  if (format === 'csv') {\r\n    c.header('Content-Type', 'text/csv; charset=utf-8')\r\n    c.header('Content-Disposition', 'attachment; filename=\"td-export.csv\"')\r\n    return c.body(toCsv(data as Array<Record<string, unknown>>))\r\n  }\r\n  c.header('Content-Type', 'application/json; charset=utf-8')\r\n  c.header('Content-Disposition', 'attachment; filename=\"td-export.json\"')\r\n  return c.json({ data, total, last_page: 1 })\r\n})\r\n\r\ntdPublicRoutes.get('/export.csv', async (c) => {\r\n  const q = c.req.query()\r\n  const dataset = String(q.dataset || 'latest').toLowerCase()\r\n\r\n  if (dataset === 'timeseries') {\r\n    const productKey = q.product_key || q.productKey\r\n    if (!productKey) {\r\n      return jsonError(c, 400, 'INVALID_REQUEST', 'product_key is required for timeseries CSV export.')\r\n    }\r\n    const rows = await queryTdTimeseries(c.env.DB, {\r\n      bank: q.bank,\r\n      productKey,\r\n      termMonths: q.term_months,\r\n      startDate: q.start_date,\r\n      endDate: q.end_date,\r\n      limit: Number(q.limit || 5000),\r\n    })\r\n    c.header('Content-Type', 'text/csv; charset=utf-8')\r\n    c.header('Content-Disposition', 'attachment; filename=\"td-timeseries.csv\"')\r\n    return c.body(toCsv(rows as Array<Record<string, unknown>>))\r\n  }\r\n\r\n  const rows = await queryLatestTdRates(c.env.DB, {\r\n    bank: q.bank,\r\n    termMonths: q.term_months,\r\n    depositTier: q.deposit_tier,\r\n    interestPayment: q.interest_payment,\r\n    limit: Number(q.limit || 1000),\r\n  })\r\n  c.header('Content-Type', 'text/csv; charset=utf-8')\r\n  c.header('Content-Disposition', 'attachment; filename=\"td-latest.csv\"')\r\n  return c.body(toCsv(rows as Array<Record<string, unknown>>))\r\n})\r\n\r\nfunction csvEscape(value: unknown): string {\r\n  if (value == null) return ''\r\n  const raw = String(value)\r\n  if (/[\",\\n\\r]/.test(raw)) return `\"${raw.replace(/\"/g, '\"\"')}\"`\r\n  return raw\r\n}\r\n\r\nfunction toCsv(rows: Array<Record<string, unknown>>): string {\r\n  if (rows.length === 0) return ''\r\n  const headers = Object.keys(rows[0])\r\n  const lines = [headers.join(',')]\r\n  for (const row of rows) {\r\n    lines.push(headers.map((h) => csvEscape(row[h])).join(','))\r\n  }\r\n  return lines.join('\\n')\r\n}\r\n", "import { Hono } from 'hono'\r\nimport { cors } from 'hono/cors'\r\nimport { logger } from 'hono/logger'\r\nimport { secureHeaders } from 'hono/secure-headers'\r\nimport { API_BASE_PATH, SAVINGS_API_BASE_PATH, TD_API_BASE_PATH } from './constants'\r\nimport { RunLockDO } from './durable/run-lock'\r\nimport { handleScheduledDaily } from './pipeline/scheduled'\r\nimport { consumeIngestQueue } from './queue/consumer'\r\nimport { adminRoutes } from './routes/admin'\r\nimport { publicRoutes } from './routes/public'\r\nimport { savingsPublicRoutes } from './routes/savings-public'\r\nimport { tdPublicRoutes } from './routes/td-public'\r\nimport type { AppContext, EnvBindings, IngestMessage } from './types'\r\nimport { flushBufferedLogs, initLogger, log } from './utils/logger'\r\n\r\nconst app = new Hono<AppContext>()\r\n\r\napp.use('*', async (c, next) => {\r\n  initLogger(c.env.DB)\r\n  await flushBufferedLogs()\r\n  await next()\r\n  await flushBufferedLogs()\r\n})\r\n\r\napp.use('*', logger())\r\napp.use(\r\n  '*',\r\n  secureHeaders({\r\n    contentSecurityPolicy: {\r\n      defaultSrc: [\"'self'\"],\r\n      scriptSrc: [\"'self'\", \"'unsafe-inline'\", 'https://unpkg.com', 'https://cdn.jsdelivr.net', 'https://cdn.plot.ly'],\r\n      styleSrc: [\"'self'\", \"'unsafe-inline'\", 'https://unpkg.com', 'https://cdn.jsdelivr.net', 'https://fonts.googleapis.com'],\r\n      fontSrc: [\"'self'\", 'https://fonts.gstatic.com'],\r\n      imgSrc: [\"'self'\", 'data:', 'https:'],\r\n      connectSrc: [\"'self'\", 'https://api.github.com'],\r\n    },\r\n  }),\r\n)\r\napp.use(\r\n  '*',\r\n  cors({\r\n    origin: (origin) => {\r\n      if (!origin) return '*'\r\n      if (origin.endsWith('.australianrates.com') || origin === 'https://australianrates.com') return origin\r\n      if (origin.includes('localhost') || origin.includes('127.0.0.1')) return origin\r\n      return 'https://www.australianrates.com'\r\n    },\r\n    allowMethods: ['GET', 'POST', 'PUT', 'DELETE', 'OPTIONS'],\r\n    allowHeaders: ['Content-Type', 'Authorization', 'Cf-Access-Jwt-Assertion'],\r\n  }),\r\n)\r\n\r\napp.route(API_BASE_PATH, publicRoutes)\r\napp.route(`${API_BASE_PATH}/admin`, adminRoutes)\r\napp.route(SAVINGS_API_BASE_PATH, savingsPublicRoutes)\r\napp.route(TD_API_BASE_PATH, tdPublicRoutes)\r\n\r\napp.notFound((c) => c.json({ ok: false, error: { code: 'NOT_FOUND', message: 'Route not found.' } }, 404))\r\n\r\napp.onError((error, c) => {\r\n  log.error('api', `Unhandled error: ${(error as Error)?.message || String(error)}`, {\r\n    context: (error as Error)?.stack,\r\n  })\r\n  return c.json({ ok: false, error: { code: 'INTERNAL_ERROR', message: 'Internal server error.' } }, 500)\r\n})\r\n\r\nconst worker: ExportedHandler<EnvBindings, IngestMessage> = {\r\n  fetch(request, env, ctx) {\r\n    return app.fetch(request, env, ctx)\r\n  },\r\n\r\n  async scheduled(event, env): Promise<void> {\r\n    initLogger(env.DB)\r\n    log.info('scheduler', `Cron triggered at ${new Date(event.scheduledTime).toISOString()}`)\r\n    const result = await handleScheduledDaily(event, env)\r\n    log.info('scheduler', `Scheduled run completed`, { context: JSON.stringify(result) })\r\n    await flushBufferedLogs()\r\n  },\r\n\r\n  async queue(batch, env): Promise<void> {\r\n    initLogger(env.DB)\r\n    await consumeIngestQueue(batch, env)\r\n    await flushBufferedLogs()\r\n  },\r\n}\r\n\r\nexport { RunLockDO }\r\nexport default worker\r\n"],
  "mappings": "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",
  "names": ["match", "decoder", "raw", "clone", "app", "Node", "_Node", "Node", "Hono", "navigator", "match", "clone", "raw", "raw", "safeLimit", "rows", "year", "day", "message", "log", "message", "log", "log", "rows", "log", "asText", "lower", "n", "rows", "log", "rows", "log", "rows", "rows", "log", "year", "message", "message", "message", "message", "types", "isObject", "isObject", "isObject", "isObject", "isObject", "isObject", "jwk", "isObject", "jwksCache", "match", "encoder", "APP_CONFIG_TABLE", "Hono", "rows", "Hono", "rows", "Hono", "log", "Hono", "log", "rows", "raw", "MIN_PUBLIC_RATE", "MAX_PUBLIC_RATE", "safeLimit", "rows", "Hono", "log", "rows", "toCsv", "csvEscape", "raw", "MIN_PUBLIC_RATE", "MAX_PUBLIC_RATE", "MIN_CONFIDENCE", "safeLimit", "rows", "SORT_COLUMNS", "buildWhere", "Hono", "log", "rows", "toCsv", "csvEscape", "raw", "Hono", "log"]
}
